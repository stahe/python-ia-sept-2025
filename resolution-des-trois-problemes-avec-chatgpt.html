
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Tutoriel complet pour générer du code Python.">
      
      
        <meta name="author" content="Serge Tahé">
      
      
        <link rel="canonical" href="https://stahe.github.io/python-ia-sept-2025/resolution-des-trois-problemes-avec-chatgpt.html">
      
      
        <link rel="prev" href="resolution-des-trois-problemes-avec-google-gemini.html">
      
      
        <link rel="next" href="resolution-des-trois-problemes-avec-grok.html">
      
      
        
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>5. Résolution des trois problèmes avec ChatGPT - Générer un script Python avec des outils d’IA</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="stylesheets/focus.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#5-resolution-des-trois-problemes-avec-chatgpt" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="Générer un script Python avec des outils d’IA" class="md-header__button md-logo" aria-label="Générer un script Python avec des outils d’IA" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Générer un script Python avec des outils d’IA
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              5. Résolution des trois problèmes avec ChatGPT
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Passer au mode sombre"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Passer au mode sombre" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Passer au mode clair"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Passer au mode clair" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/stahe/python-ia-sept-2025" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Générer un script Python avec des outils d’IA" class="md-nav__button md-logo" aria-label="Générer un script Python avec des outils d’IA" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Générer un script Python avec des outils d’IA
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/stahe/python-ia-sept-2025" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Accueil
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="introduction.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1. Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-trois-problemes-etudies-et-les-resultats.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2. Les trois problèmes étudiés et les résultats
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="installation-dun-environnement-de-travail.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3. Installation d'un environnement de travail
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="resolution-des-trois-problemes-avec-google-gemini.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4. Résolution des trois problèmes avec Google Gemini
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    5. Résolution des trois problèmes avec ChatGPT
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="resolution-des-trois-problemes-avec-chatgpt.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    5. Résolution des trois problèmes avec ChatGPT
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#51-introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.1. Introduction
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#52-le-probleme-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.2. Le problème 1
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#53-le-probleme-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.3. Le problème 2
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#54-le-probleme-3" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.4. Le problème 3
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#55-le-probleme-4" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.5. Le problème 4
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#56-retour-sur-gemini" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.6. Retour sur Gemini
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#57-quen-pense-chatgpt" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.7. Qu’en pense ChatGPT
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#58-le-probleme-3-avec-des-test-unitaires-generes-par-les-ia" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.8. Le problème 3 avec des test unitaires générés par les IA
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="resolution-des-trois-problemes-avec-grok.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    6. Résolution des trois problèmes avec Grok
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="resolution-des-trois-problemes-avec-claudeai.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    7. Résolution des trois problèmes avec ClaudeAI
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="resolution-des-trois-problemes-avec-mistralai.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    8. Résolution des trois problèmes avec MistralAI
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="resolution-des-trois-problemes-avec-deepseek.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    9. Résolution des trois problèmes avec DeepSeek
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="resolution-des-trois-problemes-avec-perplexity.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    10. Résolution des trois problèmes avec Perplexity
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="conclusion.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    11. Conclusion
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="5-resolution-des-trois-problemes-avec-chatgpt">5. Résolution des trois problèmes avec ChatGPT</h1>
<h2 id="51-introduction">5.1. Introduction</h2>
<p>Voici une première copie d’écran d’une session ChatGPT :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000031D000004D311F3028B.png" style="display:inline-block; margin:4px;width:6.32cm;height:9.8cm;" /><img src="images/100000000000031D000004D311F3028B.png" style="display:inline-block; margin:4px;width:6.32cm;height:9.8cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<ul>
<li>En [1-3], les trois problèmes posés à ChatGPT ;</li>
<li>En [4], l’URL de ChatGPT ;</li>
<li>En [5], la version de ChatGPT utilisée ;</li>
</ul>
<p>ChatGPT est un produit de OpenAI disponible à l’URL [https://chatgpt.com/]. Pour avoir un historique de vos sessions de questions / réponses comme ci-dessus, il vous faut créer un compte. Par ailleurs, comme toutes les autres IA testées, ChatGPT limite le nombre de vos questions et le nombre de fichiers téléchargés. Quand cette limite est atteinte, la session est terminée et on vous propose de la continuer plus tard dans le temps. Les limites imposées par ChatGPT sont atteintes très rapidement. Pour faire ce tutoriel, j’ai du prendre un abonnement payant d’un mois.</p>
<p>L’interface de ChatGPT est la suivante :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000006860000017DDA2B4B71.png" style="display:inline-block; margin:4px;width:13.33cm;height:3.039cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<ul>
<li>En [1], pour joindre des fichiers à la question posée ;</li>
<li>En [2], la question posée ;</li>
<li>En [3], pour lancer l’exécution de l’IA ;</li>
</ul>
<h2 id="52-le-probleme-1">5.2. Le problème 1</h2>
<p>La question à ChatGPT :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000453000000CCD959B39E.png" style="display:inline-block; margin:4px;width:8.789cm;height:1.619cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>ChatGPT répond correctement.</p>
<h2 id="53-le-probleme-2">5.3. Le problème 2</h2>
<p>C’est le calcul de l’impôt avec le PDF. Pour être honnête, on va utiliser le PDF généré par Gemini qui corrige des erreurs du PDF initial.</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000639000001CBF9F430A3.png" style="display:inline-block; margin:4px;width:12.629cm;height:3.641cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<ul>
<li>En [1], on a donné le PDF généré par Gemini ;</li>
<li>En [2], on a ajouté le test unitaire par lequel Gemini a démontré sa supériorité :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a>test12 : (2, 2, 49500) -&gt; (1297, 431, 324)
</code></pre></div></td></tr></table></div>
<p>On lance ChatGPT. Il met environ 3 minutes pour générer sa réponse. Contrairement à Gemini, il livre bien un lien qui marche pour récupérer le script généré. On charge celui-ci dans PyCharm :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000020A000002E4706FDC95.png" style="display:inline-block; margin:4px;width:4.14cm;height:5.87cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Le script [chatGPT1] fonctionne du premier coup. Là il n’y a pas photo, sur ce problème ChatGPT a été plus performant que Gemini.</p>
<p>Le script [chatGPT1] fourni par ChatGPT est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">  1</a></span>
<span class="normal"><a href="#__codelineno-1-2">  2</a></span>
<span class="normal"><a href="#__codelineno-1-3">  3</a></span>
<span class="normal"><a href="#__codelineno-1-4">  4</a></span>
<span class="normal"><a href="#__codelineno-1-5">  5</a></span>
<span class="normal"><a href="#__codelineno-1-6">  6</a></span>
<span class="normal"><a href="#__codelineno-1-7">  7</a></span>
<span class="normal"><a href="#__codelineno-1-8">  8</a></span>
<span class="normal"><a href="#__codelineno-1-9">  9</a></span>
<span class="normal"><a href="#__codelineno-1-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-1-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-1-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-1-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-1-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-1-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-1-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-1-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-1-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-1-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-1-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-1-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-1-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-1-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-1-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-1-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-1-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-1-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-1-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-1-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-1-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-1-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-1-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-1-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-1-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-1-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-1-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-1-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-1-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-1-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-1-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-1-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-1-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-1-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-1-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-1-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-1-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-1-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-1-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-1-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-1-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-1-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-1-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-1-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-1-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-1-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-1-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-1-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-1-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-1-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-1-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-1-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-1-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-1-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-1-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-1-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-1-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-1-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-1-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-1-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-1-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-1-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-1-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-1-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-1-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-1-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-1-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-1-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-1-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-1-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-1-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-1-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-1-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-1-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-1-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-1-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-1-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-1-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-1-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-1-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-1-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-1-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-1-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-1-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-1-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-1-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-1-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-1-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-1-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-1-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-1-100">100</a></span>
<span class="normal"><a href="#__codelineno-1-101">101</a></span>
<span class="normal"><a href="#__codelineno-1-102">102</a></span>
<span class="normal"><a href="#__codelineno-1-103">103</a></span>
<span class="normal"><a href="#__codelineno-1-104">104</a></span>
<span class="normal"><a href="#__codelineno-1-105">105</a></span>
<span class="normal"><a href="#__codelineno-1-106">106</a></span>
<span class="normal"><a href="#__codelineno-1-107">107</a></span>
<span class="normal"><a href="#__codelineno-1-108">108</a></span>
<span class="normal"><a href="#__codelineno-1-109">109</a></span>
<span class="normal"><a href="#__codelineno-1-110">110</a></span>
<span class="normal"><a href="#__codelineno-1-111">111</a></span>
<span class="normal"><a href="#__codelineno-1-112">112</a></span>
<span class="normal"><a href="#__codelineno-1-113">113</a></span>
<span class="normal"><a href="#__codelineno-1-114">114</a></span>
<span class="normal"><a href="#__codelineno-1-115">115</a></span>
<span class="normal"><a href="#__codelineno-1-116">116</a></span>
<span class="normal"><a href="#__codelineno-1-117">117</a></span>
<span class="normal"><a href="#__codelineno-1-118">118</a></span>
<span class="normal"><a href="#__codelineno-1-119">119</a></span>
<span class="normal"><a href="#__codelineno-1-120">120</a></span>
<span class="normal"><a href="#__codelineno-1-121">121</a></span>
<span class="normal"><a href="#__codelineno-1-122">122</a></span>
<span class="normal"><a href="#__codelineno-1-123">123</a></span>
<span class="normal"><a href="#__codelineno-1-124">124</a></span>
<span class="normal"><a href="#__codelineno-1-125">125</a></span>
<span class="normal"><a href="#__codelineno-1-126">126</a></span>
<span class="normal"><a href="#__codelineno-1-127">127</a></span>
<span class="normal"><a href="#__codelineno-1-128">128</a></span>
<span class="normal"><a href="#__codelineno-1-129">129</a></span>
<span class="normal"><a href="#__codelineno-1-130">130</a></span>
<span class="normal"><a href="#__codelineno-1-131">131</a></span>
<span class="normal"><a href="#__codelineno-1-132">132</a></span>
<span class="normal"><a href="#__codelineno-1-133">133</a></span>
<span class="normal"><a href="#__codelineno-1-134">134</a></span>
<span class="normal"><a href="#__codelineno-1-135">135</a></span>
<span class="normal"><a href="#__codelineno-1-136">136</a></span>
<span class="normal"><a href="#__codelineno-1-137">137</a></span>
<span class="normal"><a href="#__codelineno-1-138">138</a></span>
<span class="normal"><a href="#__codelineno-1-139">139</a></span>
<span class="normal"><a href="#__codelineno-1-140">140</a></span>
<span class="normal"><a href="#__codelineno-1-141">141</a></span>
<span class="normal"><a href="#__codelineno-1-142">142</a></span>
<span class="normal"><a href="#__codelineno-1-143">143</a></span>
<span class="normal"><a href="#__codelineno-1-144">144</a></span>
<span class="normal"><a href="#__codelineno-1-145">145</a></span>
<span class="normal"><a href="#__codelineno-1-146">146</a></span>
<span class="normal"><a href="#__codelineno-1-147">147</a></span>
<span class="normal"><a href="#__codelineno-1-148">148</a></span>
<span class="normal"><a href="#__codelineno-1-149">149</a></span>
<span class="normal"><a href="#__codelineno-1-150">150</a></span>
<span class="normal"><a href="#__codelineno-1-151">151</a></span>
<span class="normal"><a href="#__codelineno-1-152">152</a></span>
<span class="normal"><a href="#__codelineno-1-153">153</a></span>
<span class="normal"><a href="#__codelineno-1-154">154</a></span>
<span class="normal"><a href="#__codelineno-1-155">155</a></span>
<span class="normal"><a href="#__codelineno-1-156">156</a></span>
<span class="normal"><a href="#__codelineno-1-157">157</a></span>
<span class="normal"><a href="#__codelineno-1-158">158</a></span>
<span class="normal"><a href="#__codelineno-1-159">159</a></span>
<span class="normal"><a href="#__codelineno-1-160">160</a></span>
<span class="normal"><a href="#__codelineno-1-161">161</a></span>
<span class="normal"><a href="#__codelineno-1-162">162</a></span>
<span class="normal"><a href="#__codelineno-1-163">163</a></span>
<span class="normal"><a href="#__codelineno-1-164">164</a></span>
<span class="normal"><a href="#__codelineno-1-165">165</a></span>
<span class="normal"><a href="#__codelineno-1-166">166</a></span>
<span class="normal"><a href="#__codelineno-1-167">167</a></span>
<span class="normal"><a href="#__codelineno-1-168">168</a></span>
<span class="normal"><a href="#__codelineno-1-169">169</a></span>
<span class="normal"><a href="#__codelineno-1-170">170</a></span>
<span class="normal"><a href="#__codelineno-1-171">171</a></span>
<span class="normal"><a href="#__codelineno-1-172">172</a></span>
<span class="normal"><a href="#__codelineno-1-173">173</a></span>
<span class="normal"><a href="#__codelineno-1-174">174</a></span>
<span class="normal"><a href="#__codelineno-1-175">175</a></span>
<span class="normal"><a href="#__codelineno-1-176">176</a></span>
<span class="normal"><a href="#__codelineno-1-177">177</a></span>
<span class="normal"><a href="#__codelineno-1-178">178</a></span>
<span class="normal"><a href="#__codelineno-1-179">179</a></span>
<span class="normal"><a href="#__codelineno-1-180">180</a></span>
<span class="normal"><a href="#__codelineno-1-181">181</a></span>
<span class="normal"><a href="#__codelineno-1-182">182</a></span>
<span class="normal"><a href="#__codelineno-1-183">183</a></span>
<span class="normal"><a href="#__codelineno-1-184">184</a></span>
<span class="normal"><a href="#__codelineno-1-185">185</a></span>
<span class="normal"><a href="#__codelineno-1-186">186</a></span>
<span class="normal"><a href="#__codelineno-1-187">187</a></span>
<span class="normal"><a href="#__codelineno-1-188">188</a></span>
<span class="normal"><a href="#__codelineno-1-189">189</a></span>
<span class="normal"><a href="#__codelineno-1-190">190</a></span>
<span class="normal"><a href="#__codelineno-1-191">191</a></span>
<span class="normal"><a href="#__codelineno-1-192">192</a></span>
<span class="normal"><a href="#__codelineno-1-193">193</a></span>
<span class="normal"><a href="#__codelineno-1-194">194</a></span>
<span class="normal"><a href="#__codelineno-1-195">195</a></span>
<span class="normal"><a href="#__codelineno-1-196">196</a></span>
<span class="normal"><a href="#__codelineno-1-197">197</a></span>
<span class="normal"><a href="#__codelineno-1-198">198</a></span>
<span class="normal"><a href="#__codelineno-1-199">199</a></span>
<span class="normal"><a href="#__codelineno-1-200">200</a></span>
<span class="normal"><a href="#__codelineno-1-201">201</a></span>
<span class="normal"><a href="#__codelineno-1-202">202</a></span>
<span class="normal"><a href="#__codelineno-1-203">203</a></span>
<span class="normal"><a href="#__codelineno-1-204">204</a></span>
<span class="normal"><a href="#__codelineno-1-205">205</a></span>
<span class="normal"><a href="#__codelineno-1-206">206</a></span>
<span class="normal"><a href="#__codelineno-1-207">207</a></span>
<span class="normal"><a href="#__codelineno-1-208">208</a></span>
<span class="normal"><a href="#__codelineno-1-209">209</a></span>
<span class="normal"><a href="#__codelineno-1-210">210</a></span>
<span class="normal"><a href="#__codelineno-1-211">211</a></span>
<span class="normal"><a href="#__codelineno-1-212">212</a></span>
<span class="normal"><a href="#__codelineno-1-213">213</a></span>
<span class="normal"><a href="#__codelineno-1-214">214</a></span>
<span class="normal"><a href="#__codelineno-1-215">215</a></span>
<span class="normal"><a href="#__codelineno-1-216">216</a></span>
<span class="normal"><a href="#__codelineno-1-217">217</a></span>
<span class="normal"><a href="#__codelineno-1-218">218</a></span>
<span class="normal"><a href="#__codelineno-1-219">219</a></span>
<span class="normal"><a href="#__codelineno-1-220">220</a></span>
<span class="normal"><a href="#__codelineno-1-221">221</a></span>
<span class="normal"><a href="#__codelineno-1-222">222</a></span>
<span class="normal"><a href="#__codelineno-1-223">223</a></span>
<span class="normal"><a href="#__codelineno-1-224">224</a></span>
<span class="normal"><a href="#__codelineno-1-225">225</a></span>
<span class="normal"><a href="#__codelineno-1-226">226</a></span>
<span class="normal"><a href="#__codelineno-1-227">227</a></span>
<span class="normal"><a href="#__codelineno-1-228">228</a></span>
<span class="normal"><a href="#__codelineno-1-229">229</a></span>
<span class="normal"><a href="#__codelineno-1-230">230</a></span>
<span class="normal"><a href="#__codelineno-1-231">231</a></span>
<span class="normal"><a href="#__codelineno-1-232">232</a></span>
<span class="normal"><a href="#__codelineno-1-233">233</a></span>
<span class="normal"><a href="#__codelineno-1-234">234</a></span>
<span class="normal"><a href="#__codelineno-1-235">235</a></span>
<span class="normal"><a href="#__codelineno-1-236">236</a></span>
<span class="normal"><a href="#__codelineno-1-237">237</a></span>
<span class="normal"><a href="#__codelineno-1-238">238</a></span>
<span class="normal"><a href="#__codelineno-1-239">239</a></span>
<span class="normal"><a href="#__codelineno-1-240">240</a></span>
<span class="normal"><a href="#__codelineno-1-241">241</a></span>
<span class="normal"><a href="#__codelineno-1-242">242</a></span>
<span class="normal"><a href="#__codelineno-1-243">243</a></span>
<span class="normal"><a href="#__codelineno-1-244">244</a></span>
<span class="normal"><a href="#__codelineno-1-245">245</a></span>
<span class="normal"><a href="#__codelineno-1-246">246</a></span>
<span class="normal"><a href="#__codelineno-1-247">247</a></span>
<span class="normal"><a href="#__codelineno-1-248">248</a></span>
<span class="normal"><a href="#__codelineno-1-249">249</a></span>
<span class="normal"><a href="#__codelineno-1-250">250</a></span>
<span class="normal"><a href="#__codelineno-1-251">251</a></span>
<span class="normal"><a href="#__codelineno-1-252">252</a></span>
<span class="normal"><a href="#__codelineno-1-253">253</a></span>
<span class="normal"><a href="#__codelineno-1-254">254</a></span>
<span class="normal"><a href="#__codelineno-1-255">255</a></span>
<span class="normal"><a href="#__codelineno-1-256">256</a></span>
<span class="normal"><a href="#__codelineno-1-257">257</a></span>
<span class="normal"><a href="#__codelineno-1-258">258</a></span>
<span class="normal"><a href="#__codelineno-1-259">259</a></span>
<span class="normal"><a href="#__codelineno-1-260">260</a></span>
<span class="normal"><a href="#__codelineno-1-261">261</a></span>
<span class="normal"><a href="#__codelineno-1-262">262</a></span>
<span class="normal"><a href="#__codelineno-1-263">263</a></span>
<span class="normal"><a href="#__codelineno-1-264">264</a></span>
<span class="normal"><a href="#__codelineno-1-265">265</a></span>
<span class="normal"><a href="#__codelineno-1-266">266</a></span>
<span class="normal"><a href="#__codelineno-1-267">267</a></span>
<span class="normal"><a href="#__codelineno-1-268">268</a></span>
<span class="normal"><a href="#__codelineno-1-269">269</a></span>
<span class="normal"><a href="#__codelineno-1-270">270</a></span>
<span class="normal"><a href="#__codelineno-1-271">271</a></span>
<span class="normal"><a href="#__codelineno-1-272">272</a></span>
<span class="normal"><a href="#__codelineno-1-273">273</a></span>
<span class="normal"><a href="#__codelineno-1-274">274</a></span>
<span class="normal"><a href="#__codelineno-1-275">275</a></span>
<span class="normal"><a href="#__codelineno-1-276">276</a></span>
<span class="normal"><a href="#__codelineno-1-277">277</a></span>
<span class="normal"><a href="#__codelineno-1-278">278</a></span>
<span class="normal"><a href="#__codelineno-1-279">279</a></span>
<span class="normal"><a href="#__codelineno-1-280">280</a></span>
<span class="normal"><a href="#__codelineno-1-281">281</a></span>
<span class="normal"><a href="#__codelineno-1-282">282</a></span>
<span class="normal"><a href="#__codelineno-1-283">283</a></span>
<span class="normal"><a href="#__codelineno-1-284">284</a></span>
<span class="normal"><a href="#__codelineno-1-285">285</a></span>
<span class="normal"><a href="#__codelineno-1-286">286</a></span>
<span class="normal"><a href="#__codelineno-1-287">287</a></span>
<span class="normal"><a href="#__codelineno-1-288">288</a></span>
<span class="normal"><a href="#__codelineno-1-289">289</a></span>
<span class="normal"><a href="#__codelineno-1-290">290</a></span>
<span class="normal"><a href="#__codelineno-1-291">291</a></span>
<span class="normal"><a href="#__codelineno-1-292">292</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="c1"># -*- coding: utf-8 -*-</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="sd">Calcul de l&#39;impôt 2019 (revenus 2018) en Python.</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="sd">Hypothèses et règles (d&#39;après le PDF fourni) :</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="sd">- Tous les revenus sont portés sur le déclarant 1 (même pour un couple).</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="sd">- Abattement forfaitaire de 10 % encadré par un minimum et un maximum.</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="sd">- Barème progressif 2018 appliqué au quotient familial (QF).</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="sd">- Plafonnement du quotient familial : avantage par demi-part enfant limité.</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="sd">- Décote et réduction de 20 % pour faibles revenus, avec la règle de repêchage.</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="sd">- Ordre des correctifs : plafonnement QF -&gt; décote -&gt; réduction 20 %.</span>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="sd">- Arrondis : abattement (↑), décote (↑), réduction (↑), impôt final (↓).</span>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="sd">- On renvoie l&#39;impôt à payer (arrondi à l&#39;euro inf.), la décote et la réduction</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="sd">  (arrondies à l&#39;euro sup.).</span>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="sd">Les nombres “magiques” sont regroupés en constantes, et chaque étape est isolée</span>
<a id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="sd">dans des fonctions pour la clarté.</span>
<a id="__codelineno-1-18" name="__codelineno-1-18"></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-1-19" name="__codelineno-1-19"></a>
<a id="__codelineno-1-20" name="__codelineno-1-20"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<a id="__codelineno-1-21" name="__codelineno-1-21"></a><span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="n">ceil</span><span class="p">,</span> <span class="n">floor</span>
<a id="__codelineno-1-22" name="__codelineno-1-22"></a>
<a id="__codelineno-1-23" name="__codelineno-1-23"></a><span class="c1"># ---------- Constantes réglementaires ----------</span>
<a id="__codelineno-1-24" name="__codelineno-1-24"></a>
<a id="__codelineno-1-25" name="__codelineno-1-25"></a><span class="c1"># Abattement frais pro (plancher/plafond) pour revenus 2018</span>
<a id="__codelineno-1-26" name="__codelineno-1-26"></a><span class="n">ABATTEMENT_TAUX</span> <span class="o">=</span> <span class="mf">0.10</span>
<a id="__codelineno-1-27" name="__codelineno-1-27"></a><span class="n">ABATTEMENT_MIN</span> <span class="o">=</span> <span class="mi">437</span>
<a id="__codelineno-1-28" name="__codelineno-1-28"></a><span class="n">ABATTEMENT_MAX</span> <span class="o">=</span> <span class="mi">12502</span>
<a id="__codelineno-1-29" name="__codelineno-1-29"></a>
<a id="__codelineno-1-30" name="__codelineno-1-30"></a><span class="c1"># Barème 2018 (QF)</span>
<a id="__codelineno-1-31" name="__codelineno-1-31"></a><span class="c1"># Chaque tranche est (borne_sup, taux). La première tranche 0% se termine à 9 964 €.</span>
<a id="__codelineno-1-32" name="__codelineno-1-32"></a><span class="n">BAREME_2018</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-1-33" name="__codelineno-1-33"></a>    <span class="p">(</span><span class="mi">9964</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">),</span>
<a id="__codelineno-1-34" name="__codelineno-1-34"></a>    <span class="p">(</span><span class="mi">27519</span><span class="p">,</span> <span class="mf">0.14</span><span class="p">),</span>
<a id="__codelineno-1-35" name="__codelineno-1-35"></a>    <span class="p">(</span><span class="mi">73779</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">),</span>
<a id="__codelineno-1-36" name="__codelineno-1-36"></a>    <span class="p">(</span><span class="mi">156244</span><span class="p">,</span> <span class="mf">0.41</span><span class="p">),</span>
<a id="__codelineno-1-37" name="__codelineno-1-37"></a>    <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">),</span> <span class="mf">0.45</span><span class="p">),</span>
<a id="__codelineno-1-38" name="__codelineno-1-38"></a><span class="p">]</span>
<a id="__codelineno-1-39" name="__codelineno-1-39"></a>
<a id="__codelineno-1-40" name="__codelineno-1-40"></a><span class="c1"># Plafonnement du quotient familial</span>
<a id="__codelineno-1-41" name="__codelineno-1-41"></a><span class="n">PF_QF_AVANTAGE_PAR_DEMI_PART</span> <span class="o">=</span> <span class="mi">1551</span>  <span class="c1"># avantage max par 1/2 part ENFANT</span>
<a id="__codelineno-1-42" name="__codelineno-1-42"></a>
<a id="__codelineno-1-43" name="__codelineno-1-43"></a><span class="c1"># Décote (seuils selon le nombre d&#39;adultes / statut couple)</span>
<a id="__codelineno-1-44" name="__codelineno-1-44"></a><span class="n">DECOTE_SEUIL_CELIB</span> <span class="o">=</span> <span class="mi">1196</span>
<a id="__codelineno-1-45" name="__codelineno-1-45"></a><span class="n">DECOTE_SEUIL_COUPLE</span> <span class="o">=</span> <span class="mi">1970</span>
<a id="__codelineno-1-46" name="__codelineno-1-46"></a>
<a id="__codelineno-1-47" name="__codelineno-1-47"></a><span class="c1"># Réduction de 20 % : seuils en fonction des parts</span>
<a id="__codelineno-1-48" name="__codelineno-1-48"></a><span class="n">REDUCTION_BASE_1_PART</span> <span class="o">=</span> <span class="mi">18985</span>
<a id="__codelineno-1-49" name="__codelineno-1-49"></a><span class="n">REDUCTION_BASE_2_PARTS</span> <span class="o">=</span> <span class="mi">37970</span>
<a id="__codelineno-1-50" name="__codelineno-1-50"></a><span class="n">REDUCTION_PAR_DEMI_PART_SUP</span> <span class="o">=</span> <span class="mi">3803</span>  <span class="c1"># ajout par 1/2 part au-delà du socle de 1 ou 2 parts</span>
<a id="__codelineno-1-51" name="__codelineno-1-51"></a>
<a id="__codelineno-1-52" name="__codelineno-1-52"></a>
<a id="__codelineno-1-53" name="__codelineno-1-53"></a><span class="c1"># ---------- Structures de données ----------</span>
<a id="__codelineno-1-54" name="__codelineno-1-54"></a>
<a id="__codelineno-1-55" name="__codelineno-1-55"></a><span class="nd">@dataclass</span>
<a id="__codelineno-1-56" name="__codelineno-1-56"></a><span class="k">class</span><span class="w"> </span><span class="nc">ResultatImpot</span><span class="p">:</span>
<a id="__codelineno-1-57" name="__codelineno-1-57"></a>    <span class="n">impot</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># impôt final à payer, arrondi à l&#39;euro inférieur</span>
<a id="__codelineno-1-58" name="__codelineno-1-58"></a>    <span class="n">decote</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># décote arrondie à l&#39;euro supérieur</span>
<a id="__codelineno-1-59" name="__codelineno-1-59"></a>    <span class="n">reduction</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># réduction 20 % arrondie à l&#39;euro supérieur</span>
<a id="__codelineno-1-60" name="__codelineno-1-60"></a>
<a id="__codelineno-1-61" name="__codelineno-1-61"></a>
<a id="__codelineno-1-62" name="__codelineno-1-62"></a><span class="c1"># ---------- Fonctions utilitaires ----------</span>
<a id="__codelineno-1-63" name="__codelineno-1-63"></a>
<a id="__codelineno-1-64" name="__codelineno-1-64"></a><span class="k">def</span><span class="w"> </span><span class="nf">arrondi_sup</span><span class="p">(</span><span class="n">euros</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-1-65" name="__codelineno-1-65"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Arrondi à l&#39;euro supérieur (ceil).&quot;&quot;&quot;</span>
<a id="__codelineno-1-66" name="__codelineno-1-66"></a>    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="n">euros</span><span class="p">))</span>
<a id="__codelineno-1-67" name="__codelineno-1-67"></a>
<a id="__codelineno-1-68" name="__codelineno-1-68"></a>
<a id="__codelineno-1-69" name="__codelineno-1-69"></a><span class="k">def</span><span class="w"> </span><span class="nf">arrondi_inf</span><span class="p">(</span><span class="n">euros</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-1-70" name="__codelineno-1-70"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Arrondi à l&#39;euro inférieur (floor).&quot;&quot;&quot;</span>
<a id="__codelineno-1-71" name="__codelineno-1-71"></a>    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">euros</span><span class="p">))</span>
<a id="__codelineno-1-72" name="__codelineno-1-72"></a>
<a id="__codelineno-1-73" name="__codelineno-1-73"></a>
<a id="__codelineno-1-74" name="__codelineno-1-74"></a><span class="c1"># ---------- Étape 1 : Revenu Net Imposable (RNI) ----------</span>
<a id="__codelineno-1-75" name="__codelineno-1-75"></a>
<a id="__codelineno-1-76" name="__codelineno-1-76"></a><span class="k">def</span><span class="w"> </span><span class="nf">calcul_abattement</span><span class="p">(</span><span class="n">revenus_bruts</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-1-77" name="__codelineno-1-77"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-1-78" name="__codelineno-1-78"></a><span class="sd">    Calcule l&#39;abattement de 10 %, plafonné/planche, ARRONDI À L&#39;EURO SUPÉRIEUR.</span>
<a id="__codelineno-1-79" name="__codelineno-1-79"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-1-80" name="__codelineno-1-80"></a>    <span class="n">abattement_calcule</span> <span class="o">=</span> <span class="n">revenus_bruts</span> <span class="o">*</span> <span class="n">ABATTEMENT_TAUX</span>
<a id="__codelineno-1-81" name="__codelineno-1-81"></a>    <span class="n">abattement_calcule</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ABATTEMENT_MIN</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">ABATTEMENT_MAX</span><span class="p">,</span> <span class="n">abattement_calcule</span><span class="p">))</span>
<a id="__codelineno-1-82" name="__codelineno-1-82"></a>    <span class="k">return</span> <span class="n">arrondi_sup</span><span class="p">(</span><span class="n">abattement_calcule</span><span class="p">)</span>
<a id="__codelineno-1-83" name="__codelineno-1-83"></a>
<a id="__codelineno-1-84" name="__codelineno-1-84"></a>
<a id="__codelineno-1-85" name="__codelineno-1-85"></a><span class="k">def</span><span class="w"> </span><span class="nf">revenu_net_imposable</span><span class="p">(</span><span class="n">revenus_bruts</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-1-86" name="__codelineno-1-86"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;RNI = revenus bruts - abattement (abattement arrondi ↑).&quot;&quot;&quot;</span>
<a id="__codelineno-1-87" name="__codelineno-1-87"></a>    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">revenus_bruts</span> <span class="o">-</span> <span class="n">calcul_abattement</span><span class="p">(</span><span class="n">revenus_bruts</span><span class="p">)))</span>
<a id="__codelineno-1-88" name="__codelineno-1-88"></a>
<a id="__codelineno-1-89" name="__codelineno-1-89"></a>
<a id="__codelineno-1-90" name="__codelineno-1-90"></a><span class="c1"># ---------- Étape 2 : Nombre de parts ----------</span>
<a id="__codelineno-1-91" name="__codelineno-1-91"></a>
<a id="__codelineno-1-92" name="__codelineno-1-92"></a><span class="k">def</span><span class="w"> </span><span class="nf">nombre_parts</span><span class="p">(</span><span class="n">adultes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">enfants</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-1-93" name="__codelineno-1-93"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-1-94" name="__codelineno-1-94"></a><span class="sd">    Règles : 1 part si 1 adulte, 2 parts si 2 adultes.</span>
<a id="__codelineno-1-95" name="__codelineno-1-95"></a><span class="sd">    Enfants : +0,5 pour les 2 premiers, +1 par enfant à partir du 3e.</span>
<a id="__codelineno-1-96" name="__codelineno-1-96"></a><span class="sd">    (On ignore ici tout cas particulier type parent isolé, conformément au PDF.)</span>
<a id="__codelineno-1-97" name="__codelineno-1-97"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-1-98" name="__codelineno-1-98"></a>    <span class="n">parts</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="k">if</span> <span class="n">adultes</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="mf">2.0</span>
<a id="__codelineno-1-99" name="__codelineno-1-99"></a>    <span class="k">if</span> <span class="n">enfants</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-1-100" name="__codelineno-1-100"></a>        <span class="k">return</span> <span class="n">parts</span>
<a id="__codelineno-1-101" name="__codelineno-1-101"></a>    <span class="k">if</span> <span class="n">enfants</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-1-102" name="__codelineno-1-102"></a>        <span class="k">return</span> <span class="n">parts</span> <span class="o">+</span> <span class="mf">0.5</span>
<a id="__codelineno-1-103" name="__codelineno-1-103"></a>    <span class="c1"># enfants &gt;= 2</span>
<a id="__codelineno-1-104" name="__codelineno-1-104"></a>    <span class="n">parts</span> <span class="o">+=</span> <span class="mf">1.0</span>  <span class="c1"># +0,5 +0,5 pour les deux premiers</span>
<a id="__codelineno-1-105" name="__codelineno-1-105"></a>    <span class="k">if</span> <span class="n">enfants</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-1-106" name="__codelineno-1-106"></a>        <span class="n">parts</span> <span class="o">+=</span> <span class="p">(</span><span class="n">enfants</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.0</span>  <span class="c1"># +1 par enfant à partir du 3e</span>
<a id="__codelineno-1-107" name="__codelineno-1-107"></a>    <span class="k">return</span> <span class="n">parts</span>
<a id="__codelineno-1-108" name="__codelineno-1-108"></a>
<a id="__codelineno-1-109" name="__codelineno-1-109"></a>
<a id="__codelineno-1-110" name="__codelineno-1-110"></a><span class="k">def</span><span class="w"> </span><span class="nf">demi_parts_enfants</span><span class="p">(</span><span class="n">enfants</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-1-111" name="__codelineno-1-111"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Nombre de DEMI-parts dû aux enfants (utile pour le plafonnement QF).&quot;&quot;&quot;</span>
<a id="__codelineno-1-112" name="__codelineno-1-112"></a>    <span class="k">if</span> <span class="n">enfants</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-1-113" name="__codelineno-1-113"></a>        <span class="k">return</span> <span class="mi">0</span>
<a id="__codelineno-1-114" name="__codelineno-1-114"></a>    <span class="k">if</span> <span class="n">enfants</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-1-115" name="__codelineno-1-115"></a>        <span class="k">return</span> <span class="mi">1</span>  <span class="c1"># 0,5 part</span>
<a id="__codelineno-1-116" name="__codelineno-1-116"></a>    <span class="c1"># Deux premiers enfants = 2 * demi-part, puis +2 demi-parts par enfant à partir du 3e</span>
<a id="__codelineno-1-117" name="__codelineno-1-117"></a>    <span class="k">return</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">enfants</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
<a id="__codelineno-1-118" name="__codelineno-1-118"></a>
<a id="__codelineno-1-119" name="__codelineno-1-119"></a>
<a id="__codelineno-1-120" name="__codelineno-1-120"></a><span class="c1"># ---------- Étape 3 : Impôt brut via QF ----------</span>
<a id="__codelineno-1-121" name="__codelineno-1-121"></a>
<a id="__codelineno-1-122" name="__codelineno-1-122"></a><span class="k">def</span><span class="w"> </span><span class="nf">impot_brut_par_parts</span><span class="p">(</span><span class="n">qf</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-1-123" name="__codelineno-1-123"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Impôt par part via barème progressif 2018 (sans arrondi).&quot;&quot;&quot;</span>
<a id="__codelineno-1-124" name="__codelineno-1-124"></a>    <span class="n">imp</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-1-125" name="__codelineno-1-125"></a>    <span class="n">previous</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-1-126" name="__codelineno-1-126"></a>    <span class="k">for</span> <span class="n">borne_sup</span><span class="p">,</span> <span class="n">taux</span> <span class="ow">in</span> <span class="n">BAREME_2018</span><span class="p">:</span>
<a id="__codelineno-1-127" name="__codelineno-1-127"></a>        <span class="n">montant_tranche</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">qf</span><span class="p">,</span> <span class="n">borne_sup</span><span class="p">)</span> <span class="o">-</span> <span class="n">previous</span><span class="p">)</span>
<a id="__codelineno-1-128" name="__codelineno-1-128"></a>        <span class="n">imp</span> <span class="o">+=</span> <span class="n">montant_tranche</span> <span class="o">*</span> <span class="n">taux</span>
<a id="__codelineno-1-129" name="__codelineno-1-129"></a>        <span class="k">if</span> <span class="n">qf</span> <span class="o">&lt;=</span> <span class="n">borne_sup</span><span class="p">:</span>
<a id="__codelineno-1-130" name="__codelineno-1-130"></a>            <span class="k">break</span>
<a id="__codelineno-1-131" name="__codelineno-1-131"></a>        <span class="n">previous</span> <span class="o">=</span> <span class="n">borne_sup</span>
<a id="__codelineno-1-132" name="__codelineno-1-132"></a>    <span class="k">return</span> <span class="n">imp</span>
<a id="__codelineno-1-133" name="__codelineno-1-133"></a>
<a id="__codelineno-1-134" name="__codelineno-1-134"></a>
<a id="__codelineno-1-135" name="__codelineno-1-135"></a><span class="k">def</span><span class="w"> </span><span class="nf">impot_brut_total</span><span class="p">(</span><span class="n">rni</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">parts</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-1-136" name="__codelineno-1-136"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Impôt brut total = impôt par part * nombre de parts (sans arrondi).&quot;&quot;&quot;</span>
<a id="__codelineno-1-137" name="__codelineno-1-137"></a>    <span class="k">if</span> <span class="n">parts</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-1-138" name="__codelineno-1-138"></a>        <span class="k">return</span> <span class="mf">0.0</span>
<a id="__codelineno-1-139" name="__codelineno-1-139"></a>    <span class="n">qf</span> <span class="o">=</span> <span class="n">rni</span> <span class="o">/</span> <span class="n">parts</span>
<a id="__codelineno-1-140" name="__codelineno-1-140"></a>    <span class="k">return</span> <span class="n">impot_brut_par_parts</span><span class="p">(</span><span class="n">qf</span><span class="p">)</span> <span class="o">*</span> <span class="n">parts</span>
<a id="__codelineno-1-141" name="__codelineno-1-141"></a>
<a id="__codelineno-1-142" name="__codelineno-1-142"></a>
<a id="__codelineno-1-143" name="__codelineno-1-143"></a><span class="c1"># ---------- Étape 4.1 : Plafonnement du quotient familial ----------</span>
<a id="__codelineno-1-144" name="__codelineno-1-144"></a>
<a id="__codelineno-1-145" name="__codelineno-1-145"></a><span class="k">def</span><span class="w"> </span><span class="nf">apply_plafonnement_qf</span><span class="p">(</span><span class="n">impot_avec_enfants</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">rni</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">adultes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">enfants</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-1-146" name="__codelineno-1-146"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-1-147" name="__codelineno-1-147"></a><span class="sd">    Calcule l&#39;impôt après plafonnement QF si l&#39;avantage des enfants dépasse le plafond.</span>
<a id="__codelineno-1-148" name="__codelineno-1-148"></a><span class="sd">    - Impôt A : avec parts incluant enfants</span>
<a id="__codelineno-1-149" name="__codelineno-1-149"></a><span class="sd">    - Impôt B : avec seulement parts des adultes (1 ou 2)</span>
<a id="__codelineno-1-150" name="__codelineno-1-150"></a><span class="sd">    - Avantage réel = B - A</span>
<a id="__codelineno-1-151" name="__codelineno-1-151"></a><span class="sd">    - Avantage maximal = 1551 € par 1/2 part ENFANT</span>
<a id="__codelineno-1-152" name="__codelineno-1-152"></a><span class="sd">    Si avantage réel &gt; avantage max, impôt = B - avantage max, sinon impôt = A.</span>
<a id="__codelineno-1-153" name="__codelineno-1-153"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-1-154" name="__codelineno-1-154"></a>    <span class="n">parts_adultes</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="k">if</span> <span class="n">adultes</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="mf">2.0</span>
<a id="__codelineno-1-155" name="__codelineno-1-155"></a>    <span class="n">imp_b</span> <span class="o">=</span> <span class="n">impot_brut_total</span><span class="p">(</span><span class="n">rni</span><span class="p">,</span> <span class="n">parts_adultes</span><span class="p">)</span>
<a id="__codelineno-1-156" name="__codelineno-1-156"></a>    <span class="n">imp_a</span> <span class="o">=</span> <span class="n">impot_avec_enfants</span>
<a id="__codelineno-1-157" name="__codelineno-1-157"></a>    <span class="n">avantage_reel</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">imp_b</span> <span class="o">-</span> <span class="n">imp_a</span><span class="p">)</span>
<a id="__codelineno-1-158" name="__codelineno-1-158"></a>    <span class="n">avantage_max</span> <span class="o">=</span> <span class="n">PF_QF_AVANTAGE_PAR_DEMI_PART</span> <span class="o">*</span> <span class="n">demi_parts_enfants</span><span class="p">(</span><span class="n">enfants</span><span class="p">)</span>
<a id="__codelineno-1-159" name="__codelineno-1-159"></a>    <span class="k">if</span> <span class="n">avantage_reel</span> <span class="o">&gt;</span> <span class="n">avantage_max</span><span class="p">:</span>
<a id="__codelineno-1-160" name="__codelineno-1-160"></a>        <span class="k">return</span> <span class="n">imp_b</span> <span class="o">-</span> <span class="n">avantage_max</span>
<a id="__codelineno-1-161" name="__codelineno-1-161"></a>    <span class="k">return</span> <span class="n">imp_a</span>
<a id="__codelineno-1-162" name="__codelineno-1-162"></a>
<a id="__codelineno-1-163" name="__codelineno-1-163"></a>
<a id="__codelineno-1-164" name="__codelineno-1-164"></a><span class="c1"># ---------- Étape 4.2 : Décote et Réduction 20 % ----------</span>
<a id="__codelineno-1-165" name="__codelineno-1-165"></a>
<a id="__codelineno-1-166" name="__codelineno-1-166"></a><span class="k">def</span><span class="w"> </span><span class="nf">seuil_decote</span><span class="p">(</span><span class="n">adultes</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-1-167" name="__codelineno-1-167"></a>    <span class="k">return</span> <span class="n">DECOTE_SEUIL_COUPLE</span> <span class="k">if</span> <span class="n">adultes</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">DECOTE_SEUIL_CELIB</span>
<a id="__codelineno-1-168" name="__codelineno-1-168"></a>
<a id="__codelineno-1-169" name="__codelineno-1-169"></a>
<a id="__codelineno-1-170" name="__codelineno-1-170"></a><span class="k">def</span><span class="w"> </span><span class="nf">seuil_reduction_20</span><span class="p">(</span><span class="n">rni</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">adultes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">parts</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-1-171" name="__codelineno-1-171"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-1-172" name="__codelineno-1-172"></a><span class="sd">    Seuil d&#39;éligibilité à la réduction de 20 % :</span>
<a id="__codelineno-1-173" name="__codelineno-1-173"></a><span class="sd">    - Base : 18 985 € pour 1 part, 37 970 € pour 2 parts</span>
<a id="__codelineno-1-174" name="__codelineno-1-174"></a><span class="sd">    - + 3 803 € par 1/2 part supplémentaire au-delà de la base correspondante.</span>
<a id="__codelineno-1-175" name="__codelineno-1-175"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-1-176" name="__codelineno-1-176"></a>    <span class="n">base</span> <span class="o">=</span> <span class="n">REDUCTION_BASE_2_PARTS</span> <span class="k">if</span> <span class="n">adultes</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">REDUCTION_BASE_1_PART</span>
<a id="__codelineno-1-177" name="__codelineno-1-177"></a>    <span class="n">base_parts</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="k">if</span> <span class="n">adultes</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="k">else</span> <span class="mf">1.0</span>
<a id="__codelineno-1-178" name="__codelineno-1-178"></a>    <span class="n">demi_sup</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">parts</span> <span class="o">-</span> <span class="n">base_parts</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)))</span>
<a id="__codelineno-1-179" name="__codelineno-1-179"></a>    <span class="k">return</span> <span class="n">base</span> <span class="o">+</span> <span class="n">demi_sup</span> <span class="o">*</span> <span class="n">REDUCTION_PAR_DEMI_PART_SUP</span>
<a id="__codelineno-1-180" name="__codelineno-1-180"></a>
<a id="__codelineno-1-181" name="__codelineno-1-181"></a>
<a id="__codelineno-1-182" name="__codelineno-1-182"></a><span class="k">def</span><span class="w"> </span><span class="nf">calc_decote_reduction</span><span class="p">(</span><span class="n">impot_apres_plaf</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">rni</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">adultes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">parts</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<a id="__codelineno-1-183" name="__codelineno-1-183"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-1-184" name="__codelineno-1-184"></a><span class="sd">    Calcule (decote_arrondie, reduction_arrondie, impot_apres_correctifs).</span>
<a id="__codelineno-1-185" name="__codelineno-1-185"></a><span class="sd">    Règle d&#39;interaction : la décote peut s&#39;appliquer via repêchage si, après</span>
<a id="__codelineno-1-186" name="__codelineno-1-186"></a><span class="sd">    application THÉORIQUE de la réduction de 20 %, l&#39;impôt passerait sous le seuil.</span>
<a id="__codelineno-1-187" name="__codelineno-1-187"></a><span class="sd">    Ordre : décote -&gt; réduction.</span>
<a id="__codelineno-1-188" name="__codelineno-1-188"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-1-189" name="__codelineno-1-189"></a>    <span class="n">imp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">impot_apres_plaf</span><span class="p">)</span>
<a id="__codelineno-1-190" name="__codelineno-1-190"></a>    <span class="n">decote</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-1-191" name="__codelineno-1-191"></a>    <span class="n">reduction</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-1-192" name="__codelineno-1-192"></a>
<a id="__codelineno-1-193" name="__codelineno-1-193"></a>    <span class="c1"># Éligibilité réduction 20 % basée sur RNI</span>
<a id="__codelineno-1-194" name="__codelineno-1-194"></a>    <span class="n">seuil_red</span> <span class="o">=</span> <span class="n">seuil_reduction_20</span><span class="p">(</span><span class="n">rni</span><span class="p">,</span> <span class="n">adultes</span><span class="p">,</span> <span class="n">parts</span><span class="p">)</span>
<a id="__codelineno-1-195" name="__codelineno-1-195"></a>    <span class="n">eligible_reduction</span> <span class="o">=</span> <span class="n">rni</span> <span class="o">&lt;</span> <span class="n">seuil_red</span>  <span class="c1"># &quot;inférieur à un seuil&quot; dans le PDF</span>
<a id="__codelineno-1-196" name="__codelineno-1-196"></a>
<a id="__codelineno-1-197" name="__codelineno-1-197"></a>    <span class="c1"># Éligibilité décote : sous le seuil directement, ou repêchage si réduction ferait passer sous le seuil</span>
<a id="__codelineno-1-198" name="__codelineno-1-198"></a>    <span class="n">s_dec</span> <span class="o">=</span> <span class="n">seuil_decote</span><span class="p">(</span><span class="n">adultes</span><span class="p">)</span>
<a id="__codelineno-1-199" name="__codelineno-1-199"></a>    <span class="n">direct_decote</span> <span class="o">=</span> <span class="n">imp</span> <span class="o">&lt;=</span> <span class="n">s_dec</span>
<a id="__codelineno-1-200" name="__codelineno-1-200"></a>    <span class="n">repechage</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-1-201" name="__codelineno-1-201"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">direct_decote</span> <span class="ow">and</span> <span class="n">eligible_reduction</span><span class="p">:</span>
<a id="__codelineno-1-202" name="__codelineno-1-202"></a>        <span class="n">imp_theorique_apres_red</span> <span class="o">=</span> <span class="n">imp</span> <span class="o">*</span> <span class="mf">0.80</span>  <span class="c1"># réduction théorique 20%</span>
<a id="__codelineno-1-203" name="__codelineno-1-203"></a>        <span class="k">if</span> <span class="n">imp_theorique_apres_red</span> <span class="o">&lt;=</span> <span class="n">s_dec</span><span class="p">:</span>
<a id="__codelineno-1-204" name="__codelineno-1-204"></a>            <span class="n">repechage</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-1-205" name="__codelineno-1-205"></a>
<a id="__codelineno-1-206" name="__codelineno-1-206"></a>    <span class="n">elig_decote</span> <span class="o">=</span> <span class="p">(</span><span class="n">direct_decote</span> <span class="ow">or</span> <span class="n">repechage</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">imp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-1-207" name="__codelineno-1-207"></a>
<a id="__codelineno-1-208" name="__codelineno-1-208"></a>    <span class="c1"># Appliquer la décote en premier (si éligible)</span>
<a id="__codelineno-1-209" name="__codelineno-1-209"></a>    <span class="k">if</span> <span class="n">elig_decote</span><span class="p">:</span>
<a id="__codelineno-1-210" name="__codelineno-1-210"></a>        <span class="n">montant_decote</span> <span class="o">=</span> <span class="n">s_dec</span> <span class="o">-</span> <span class="p">(</span><span class="n">imp</span> <span class="o">*</span> <span class="mf">0.75</span><span class="p">)</span>
<a id="__codelineno-1-211" name="__codelineno-1-211"></a>        <span class="n">decote_calc</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">arrondi_sup</span><span class="p">(</span><span class="n">montant_decote</span><span class="p">))</span>
<a id="__codelineno-1-212" name="__codelineno-1-212"></a>        <span class="c1"># La décote ne peut pas excéder l&#39;impôt restant : on la borne</span>
<a id="__codelineno-1-213" name="__codelineno-1-213"></a>        <span class="n">decote</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">decote_calc</span><span class="p">,</span> <span class="n">arrondi_sup</span><span class="p">(</span><span class="n">imp</span><span class="p">))</span>
<a id="__codelineno-1-214" name="__codelineno-1-214"></a>        <span class="n">imp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">imp</span> <span class="o">-</span> <span class="n">decote</span><span class="p">)</span>
<a id="__codelineno-1-215" name="__codelineno-1-215"></a>
<a id="__codelineno-1-216" name="__codelineno-1-216"></a>    <span class="c1"># Puis appliquer la réduction si éligible</span>
<a id="__codelineno-1-217" name="__codelineno-1-217"></a>    <span class="k">if</span> <span class="n">eligible_reduction</span> <span class="ow">and</span> <span class="n">imp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-1-218" name="__codelineno-1-218"></a>        <span class="n">montant_reduction</span> <span class="o">=</span> <span class="n">imp</span> <span class="o">*</span> <span class="mf">0.20</span>
<a id="__codelineno-1-219" name="__codelineno-1-219"></a>        <span class="n">reduction</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">arrondi_sup</span><span class="p">(</span><span class="n">montant_reduction</span><span class="p">))</span>
<a id="__codelineno-1-220" name="__codelineno-1-220"></a>        <span class="n">imp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">imp</span> <span class="o">-</span> <span class="n">reduction</span><span class="p">)</span>
<a id="__codelineno-1-221" name="__codelineno-1-221"></a>
<a id="__codelineno-1-222" name="__codelineno-1-222"></a>    <span class="k">return</span> <span class="n">decote</span><span class="p">,</span> <span class="n">reduction</span><span class="p">,</span> <span class="n">imp</span>
<a id="__codelineno-1-223" name="__codelineno-1-223"></a>
<a id="__codelineno-1-224" name="__codelineno-1-224"></a>
<a id="__codelineno-1-225" name="__codelineno-1-225"></a><span class="c1"># ---------- API principale ----------</span>
<a id="__codelineno-1-226" name="__codelineno-1-226"></a>
<a id="__codelineno-1-227" name="__codelineno-1-227"></a><span class="k">def</span><span class="w"> </span><span class="nf">calcule_impot</span><span class="p">(</span><span class="n">adultes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">enfants</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">revenus_bruts</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ResultatImpot</span><span class="p">:</span>
<a id="__codelineno-1-228" name="__codelineno-1-228"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-1-229" name="__codelineno-1-229"></a><span class="sd">    Calcule l&#39;impôt 2019 (revenus 2018) pour un foyer.</span>
<a id="__codelineno-1-230" name="__codelineno-1-230"></a><span class="sd">    Retourne ResultatImpot(impot, decote, reduction).</span>
<a id="__codelineno-1-231" name="__codelineno-1-231"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-1-232" name="__codelineno-1-232"></a>    <span class="c1"># 1) RNI</span>
<a id="__codelineno-1-233" name="__codelineno-1-233"></a>    <span class="n">rni</span> <span class="o">=</span> <span class="n">revenu_net_imposable</span><span class="p">(</span><span class="n">revenus_bruts</span><span class="p">)</span>
<a id="__codelineno-1-234" name="__codelineno-1-234"></a>
<a id="__codelineno-1-235" name="__codelineno-1-235"></a>    <span class="c1"># 2) Parts</span>
<a id="__codelineno-1-236" name="__codelineno-1-236"></a>    <span class="n">parts</span> <span class="o">=</span> <span class="n">nombre_parts</span><span class="p">(</span><span class="n">adultes</span><span class="p">,</span> <span class="n">enfants</span><span class="p">)</span>
<a id="__codelineno-1-237" name="__codelineno-1-237"></a>
<a id="__codelineno-1-238" name="__codelineno-1-238"></a>    <span class="c1"># 3) Impôt brut via barème (avec toutes parts)</span>
<a id="__codelineno-1-239" name="__codelineno-1-239"></a>    <span class="n">imp_brut_A</span> <span class="o">=</span> <span class="n">impot_brut_total</span><span class="p">(</span><span class="n">rni</span><span class="p">,</span> <span class="n">parts</span><span class="p">)</span>
<a id="__codelineno-1-240" name="__codelineno-1-240"></a>
<a id="__codelineno-1-241" name="__codelineno-1-241"></a>    <span class="c1"># 4.1) Plafonnement du quotient familial</span>
<a id="__codelineno-1-242" name="__codelineno-1-242"></a>    <span class="n">imp_apres_plaf</span> <span class="o">=</span> <span class="n">apply_plafonnement_qf</span><span class="p">(</span><span class="n">imp_brut_A</span><span class="p">,</span> <span class="n">rni</span><span class="p">,</span> <span class="n">adultes</span><span class="p">,</span> <span class="n">enfants</span><span class="p">)</span>
<a id="__codelineno-1-243" name="__codelineno-1-243"></a>
<a id="__codelineno-1-244" name="__codelineno-1-244"></a>    <span class="c1"># 4.2) Décote puis réduction 20 % (avec repêchage)</span>
<a id="__codelineno-1-245" name="__codelineno-1-245"></a>    <span class="n">decote</span><span class="p">,</span> <span class="n">reduction</span><span class="p">,</span> <span class="n">imp_corrige</span> <span class="o">=</span> <span class="n">calc_decote_reduction</span><span class="p">(</span><span class="n">imp_apres_plaf</span><span class="p">,</span> <span class="n">rni</span><span class="p">,</span> <span class="n">adultes</span><span class="p">,</span> <span class="n">parts</span><span class="p">)</span>
<a id="__codelineno-1-246" name="__codelineno-1-246"></a>
<a id="__codelineno-1-247" name="__codelineno-1-247"></a>    <span class="c1"># 5) Arrondi final impôt (↓) et bornage à 0</span>
<a id="__codelineno-1-248" name="__codelineno-1-248"></a>    <span class="n">imp_final</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">arrondi_inf</span><span class="p">(</span><span class="n">imp_corrige</span><span class="p">))</span>
<a id="__codelineno-1-249" name="__codelineno-1-249"></a>
<a id="__codelineno-1-250" name="__codelineno-1-250"></a>    <span class="k">return</span> <span class="n">ResultatImpot</span><span class="p">(</span><span class="n">impot</span><span class="o">=</span><span class="n">imp_final</span><span class="p">,</span> <span class="n">decote</span><span class="o">=</span><span class="n">decote</span><span class="p">,</span> <span class="n">reduction</span><span class="o">=</span><span class="n">reduction</span><span class="p">)</span>
<a id="__codelineno-1-251" name="__codelineno-1-251"></a>
<a id="__codelineno-1-252" name="__codelineno-1-252"></a>
<a id="__codelineno-1-253" name="__codelineno-1-253"></a><span class="c1"># ---------- Petit exécutable de test ----------</span>
<a id="__codelineno-1-254" name="__codelineno-1-254"></a>
<a id="__codelineno-1-255" name="__codelineno-1-255"></a><span class="k">def</span><span class="w"> </span><span class="nf">_nearly_equal</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">tol</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-1-256" name="__codelineno-1-256"></a>    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tol</span>
<a id="__codelineno-1-257" name="__codelineno-1-257"></a>
<a id="__codelineno-1-258" name="__codelineno-1-258"></a>
<a id="__codelineno-1-259" name="__codelineno-1-259"></a><span class="k">def</span><span class="w"> </span><span class="nf">tests_unitaires</span><span class="p">():</span>
<a id="__codelineno-1-260" name="__codelineno-1-260"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-1-261" name="__codelineno-1-261"></a><span class="sd">    Renvoie une liste de tuples (inputs, attendu, obtenu, ok) pour chaque test.</span>
<a id="__codelineno-1-262" name="__codelineno-1-262"></a><span class="sd">    Tolérance : ±1 € sur chaque valeur (impôt, décote, réduction).</span>
<a id="__codelineno-1-263" name="__codelineno-1-263"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-1-264" name="__codelineno-1-264"></a>    <span class="n">cas</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-1-265" name="__codelineno-1-265"></a>        <span class="c1"># (adultes, enfants, revenus) -&gt; (impot, decote, reduction)</span>
<a id="__codelineno-1-266" name="__codelineno-1-266"></a>        <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">55555</span><span class="p">),</span> <span class="p">(</span><span class="mi">2815</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
<a id="__codelineno-1-267" name="__codelineno-1-267"></a>        <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">50000</span><span class="p">),</span> <span class="p">(</span><span class="mi">1385</span><span class="p">,</span> <span class="mi">384</span><span class="p">,</span> <span class="mi">346</span><span class="p">)),</span>
<a id="__codelineno-1-268" name="__codelineno-1-268"></a>        <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">50000</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">720</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
<a id="__codelineno-1-269" name="__codelineno-1-269"></a>        <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100000</span><span class="p">),</span> <span class="p">(</span><span class="mi">19884</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
<a id="__codelineno-1-270" name="__codelineno-1-270"></a>        <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">100000</span><span class="p">),</span> <span class="p">(</span><span class="mi">16782</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
<a id="__codelineno-1-271" name="__codelineno-1-271"></a>        <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">100000</span><span class="p">),</span> <span class="p">(</span><span class="mi">9200</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
<a id="__codelineno-1-272" name="__codelineno-1-272"></a>        <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">100000</span><span class="p">),</span> <span class="p">(</span><span class="mi">4230</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
<a id="__codelineno-1-273" name="__codelineno-1-273"></a>        <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100000</span><span class="p">),</span> <span class="p">(</span><span class="mi">22986</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
<a id="__codelineno-1-274" name="__codelineno-1-274"></a>        <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">30000</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
<a id="__codelineno-1-275" name="__codelineno-1-275"></a>        <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">200000</span><span class="p">),</span> <span class="p">(</span><span class="mi">64211</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
<a id="__codelineno-1-276" name="__codelineno-1-276"></a>        <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">200000</span><span class="p">),</span> <span class="p">(</span><span class="mi">42843</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
<a id="__codelineno-1-277" name="__codelineno-1-277"></a>        <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">49500</span><span class="p">),</span> <span class="p">(</span><span class="mi">1297</span><span class="p">,</span> <span class="mi">431</span><span class="p">,</span> <span class="mi">324</span><span class="p">)),</span>
<a id="__codelineno-1-278" name="__codelineno-1-278"></a>    <span class="p">]</span>
<a id="__codelineno-1-279" name="__codelineno-1-279"></a>
<a id="__codelineno-1-280" name="__codelineno-1-280"></a>    <span class="n">resultats</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-1-281" name="__codelineno-1-281"></a>    <span class="k">for</span> <span class="p">(</span><span class="n">adultes</span><span class="p">,</span> <span class="n">enfants</span><span class="p">,</span> <span class="n">revenus</span><span class="p">),</span> <span class="n">attendu</span> <span class="ow">in</span> <span class="n">cas</span><span class="p">:</span>
<a id="__codelineno-1-282" name="__codelineno-1-282"></a>        <span class="n">res</span> <span class="o">=</span> <span class="n">calcule_impot</span><span class="p">(</span><span class="n">adultes</span><span class="p">,</span> <span class="n">enfants</span><span class="p">,</span> <span class="n">revenus</span><span class="p">)</span>
<a id="__codelineno-1-283" name="__codelineno-1-283"></a>        <span class="n">obtenu</span> <span class="o">=</span> <span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">impot</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">decote</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">reduction</span><span class="p">)</span>
<a id="__codelineno-1-284" name="__codelineno-1-284"></a>        <span class="n">ok</span> <span class="o">=</span> <span class="n">_nearly_equal</span><span class="p">(</span><span class="n">obtenu</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">attendu</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="n">_nearly_equal</span><span class="p">(</span><span class="n">obtenu</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">attendu</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="n">_nearly_equal</span><span class="p">(</span><span class="n">obtenu</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
<a id="__codelineno-1-285" name="__codelineno-1-285"></a>                                                                                                             <span class="n">attendu</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<a id="__codelineno-1-286" name="__codelineno-1-286"></a>        <span class="n">resultats</span><span class="o">.</span><span class="n">append</span><span class="p">(((</span><span class="n">adultes</span><span class="p">,</span> <span class="n">enfants</span><span class="p">,</span> <span class="n">revenus</span><span class="p">),</span> <span class="n">attendu</span><span class="p">,</span> <span class="n">obtenu</span><span class="p">,</span> <span class="n">ok</span><span class="p">))</span>
<a id="__codelineno-1-287" name="__codelineno-1-287"></a>    <span class="k">return</span> <span class="n">resultats</span>
<a id="__codelineno-1-288" name="__codelineno-1-288"></a>
<a id="__codelineno-1-289" name="__codelineno-1-289"></a>
<a id="__codelineno-1-290" name="__codelineno-1-290"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-1-291" name="__codelineno-1-291"></a>    <span class="k">for</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">attendu</span><span class="p">,</span> <span class="n">obtenu</span><span class="p">,</span> <span class="n">ok</span> <span class="ow">in</span> <span class="n">tests_unitaires</span><span class="p">():</span>
<a id="__codelineno-1-292" name="__codelineno-1-292"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">inputs</span><span class="si">}</span><span class="s2"> -&gt; attendu=</span><span class="si">{</span><span class="n">attendu</span><span class="si">}</span><span class="s2">, obtenu=</span><span class="si">{</span><span class="n">obtenu</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="s1">&#39;OK&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">ok</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;ECHEC&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h2 id="54-le-probleme-3">5.4. Le problème 3</h2>
<p>Maintenant on demande à ChatGPT de chercher les règles de calcul de l’impôt sur internet :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000673000001FD7D9CE21F.png" style="display:inline-block; margin:4px;width:13.169cm;height:4.06cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Cette fois-ci on ne fournit pas le PDF qui donnait les règles de calcul à observer. On donne seulement nos instructions dans le fichier texte. On rappelle que ce fichier texte contient maintenant 12 tests unitaires après avoir ajouté aux 11 tests initiaux, celui utilisé par Gemini pour démontrer que mon PDF initial était erroné.</p>
<p>ChatGPT répond en 8 minutes, donne un lien pour télécharger le script généré. Une fois chargé dans PyCharm, ce script passe les 12 tests. Donc aux deux problèmes posés, ChatGPT a répondu juste du premier coup, surpassant ainsi Gemini.</p>
<p>ChatGPT donne ses sources dans sa réponse :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000066200000317A5207586.png" style="display:inline-block; margin:4px;width:12.98cm;height:6.279cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Il n’y a rien à dire, c’est du beau travail.</p>
<p>Maintenant, on peut lui demander, comme on l’a fait avec Gemini de générer un PDF pour des étudiants.</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000062E0000018288E0BA96.png" style="display:inline-block; margin:4px;width:12.621cm;height:3.08cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>La réponse de ChatGPT a été obtenue après plusieurs allers-retours car le PDF généré utilisait une police qui remplaçait des caractères par un carré. Mais finalement, il a généré le PDF. Je le donne car il donne des règles différentes du PDF de Gemini et je me suis demandé alors qui avait raison. On va enquêter.</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000531000004702E3BE282.png" style="display:inline-block; margin:4px;width:10.55cm;height:9.021cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000004E400000277BC0C5F56.png" style="display:inline-block; margin:4px;width:9.901cm;height:4.99cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000022B000000ED2428F088.png" style="display:inline-block; margin:4px;width:4.399cm;height:1.88cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000283000000B3DC05178F.png" style="display:inline-block; margin:4px;width:5.099cm;height:1.42cm;" /></td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000556000003DBD8EF9369.png" style="display:inline-block; margin:4px;width:10.8cm;height:7.8cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>La différence avec le PDF de Gemini est dans le calcul de la décote. Les deux IA n’ont pas la même approche. Gemini avait écrit :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000007C10000036985C26354.png" style="display:inline-block; margin:4px;width:10.5cm;height:4.62cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000008A70000029AD87B8767.png" style="display:inline-block; margin:4px;width:11.64cm;height:3.5cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000008190000038CE2F045A3.png" style="display:inline-block; margin:4px;width:11.03cm;height:4.83cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Les deux IA ont deux approches différentes. Qui a raison ?</p>
<h2 id="55-le-probleme-4">5.5. Le problème 4</h2>
<p>On va demander à ChatGPT de s’appuyer sur son PDF pour faire le calcul de l’impôt :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000065000000145A1B85B27.png" style="display:inline-block; margin:4px;width:12.779cm;height:2.57cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000001950000012FABD91014.png" style="display:inline-block; margin:4px;width:3.221cm;height:2.409cm;" /></td></tr></table>

<p>Comme les fois précédentes, il génère un script Python qui marche du premier coup. On avait ajouté dans les instructions un test supplémentaire :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a>test13 : (1, 0, 18535) -&gt; (359, 491, 90)
</code></pre></div></td></tr></table></div>
<p>Les 13 tests ont été passés avec succès.</p>
<h2 id="56-retour-sur-gemini">5.6. Retour sur Gemini</h2>
<p>Maintenant, on revient dans Gemini à qui on va présenter le PDF de ChatGPT. Vu que les règles implémentées dans ce PDF sont différentes de celles implémentées dans le PDF de Gemini, on peut se demander ce qui va se passer :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000039A0000014414391F2C.png" style="display:inline-block; margin:4px;width:7.31cm;height:2.57cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Gemini a tout d’abord généré un script Python qui ratait des tests. On lui a présenté les logs :</p>
<p>Question 2</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000042D0000019446D7AF08.png" style="display:inline-block; margin:4px;width:8.49cm;height:3.21cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Question 3</p>
<p>Il y a encore des erreurs. On continue.</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000023700000159BF21B4C0.png" style="display:inline-block; margin:4px;width:4.5cm;height:2.739cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Question 4</p>
<p>Toujours des erreurs à l’exécution :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000002E40000017EC0E48299.png" style="display:inline-block; margin:4px;width:5.87cm;height:3.03cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Cette fois-ci c’est bon.</p>
<p>On est quand même intrigués qu’avec des PDF ayant des règles de calcul assez différentes les IA génèrent toutes deux des résultats corrects.</p>
<p>On pose la question suivante à Gemini :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000003FA000001B7B872A20E.png" style="display:inline-block; margin:4px;width:8.07cm;height:3.48cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>La question complète est la suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a>Après tout ce qu&#39;on a fait, compare les deux approches, la tienne et celle de ChatGPT dans les pDF que je te joins [.. selon Gemini] pour toi, [.. selon ChatGPT] pour ChatGPT. Dis-moi laquelle on doit préférer vu que sur les 13 tests générés tu les réussis tous avec l&#39;un ou avec l&#39;autre PDF.
</code></pre></div></td></tr></table></div>
<p>La réponse de Gemini est catégorique :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000594000001F53B5B49AD.png" style="display:inline-block; margin:4px;width:11.291cm;height:3.96cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005BA000002F6B11E401B.png" style="display:inline-block; margin:4px;width:11.569cm;height:5.98cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005AE00000262483D08A6.png" style="display:inline-block; margin:4px;width:11.561cm;height:4.851cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005CD000002F59EF01BB3.png" style="display:inline-block; margin:4px;width:11.85cm;height:6.04cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005BE0000024CDCB38A25.png" style="display:inline-block; margin:4px;width:11.7cm;height:4.68cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005B80000022107C84C45.png" style="display:inline-block; margin:4px;width:11.58cm;height:4.309cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<h2 id="57-quen-pense-chatgpt">5.7. Qu’en pense ChatGPT</h2>
<p>On pose à ChatGPT la même question posée à Gemini.</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000049D000002CCDF520656.png" style="display:inline-block; margin:4px;width:9.37cm;height:5.68cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>La réponse de ChatGPT est la suivante :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000064200000312E32DE034.png" style="display:inline-block; margin:4px;width:12.64cm;height:6.2cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000062D0000029B4F3AAC48.png" style="display:inline-block; margin:4px;width:12.471cm;height:5.26cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Du coup, ChatGPT nous propose un test unitaire pour départager les deux méthodes. Nous dupliquons :</p>
<ul>
<li>Le script [gemini3] généré par Gemini en prenant comme source son PDF [Le problème selon Gemini] est dupliqué dans le script [gemini4] ;</li>
<li>Le script [chatGPT3] généré par ChatGPT en prenant comme source son PDF [Le problème selon ChatGPT] est dupliqué dans le script [chatGPT4] ;</li>
</ul>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000155000000FABE0492CC.png" style="display:inline-block; margin:4px;width:4.51cm;height:3.307cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000157000000EF5BE24E31.png" style="display:inline-block; margin:4px;width:4.538cm;height:3.163cm;" /></td></tr></table>

<p>Par ailleurs, on ajoute dans chacun des scripts [gemini4, chatGPT4] le test unitaire proposé par ChatGPT pour départager les deux IA.</p>
<p>L’exécution de [gemini4] donne les résultats suivants :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span>
<span class="normal"><a href="#__codelineno-4-17">17</a></span>
<span class="normal"><a href="#__codelineno-4-18">18</a></span>
<span class="normal"><a href="#__codelineno-4-19">19</a></span>
<span class="normal"><a href="#__codelineno-4-20">20</a></span>
<span class="normal"><a href="#__codelineno-4-21">21</a></span>
<span class="normal"><a href="#__codelineno-4-22">22</a></span>
<span class="normal"><a href="#__codelineno-4-23">23</a></span>
<span class="normal"><a href="#__codelineno-4-24">24</a></span>
<span class="normal"><a href="#__codelineno-4-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a>C:\Data\st-2025\dev\python\code\python-flask-2025-cours\.venv\Scripts\python.exe &quot;C:/Program Files/JetBrains/PyCharm 2025.2.1.1/plugins/python-ce/helpers/pycharm/_jb_unittest_runner.py&quot; --path &quot;C:\Data\st-2025\dev\python\code\python-flask-2025-cours\outils ia\gemini\gemini4.py&quot; 
<a id="__codelineno-4-2" name="__codelineno-4-2"></a>Testing started at 17:45 ...
<a id="__codelineno-4-3" name="__codelineno-4-3"></a>Launching unittests with arguments python -m unittest C:\Data\st-2025\dev\python\code\python-flask-2025-cours\outils ia\gemini\gemini4.py in C:\Data\st-2025\dev\python\code\python-flask-2025-cours
<a id="__codelineno-4-4" name="__codelineno-4-4"></a>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a>SubTest failure: Traceback (most recent call last):
<a id="__codelineno-4-6" name="__codelineno-4-6"></a>  File &quot;C:\Program Files\Python313\Lib\unittest\case.py&quot;, line 58, in testPartExecutor
<a id="__codelineno-4-7" name="__codelineno-4-7"></a>    yield
<a id="__codelineno-4-8" name="__codelineno-4-8"></a>  File &quot;C:\Program Files\Python313\Lib\unittest\case.py&quot;, line 556, in subTest
<a id="__codelineno-4-9" name="__codelineno-4-9"></a>    yield
<a id="__codelineno-4-10" name="__codelineno-4-10"></a>  File &quot;C:\Data\st-2025\dev\python\code\python-flask-2025-cours\outils ia\gemini\gemini4.py&quot;, line 234, in test_cas_verifies_simulateur_officiel
<a id="__codelineno-4-11" name="__codelineno-4-11"></a>    self.assertAlmostEqual(calcul_impot, attendu_impot, delta=1, msg=&quot;Échec sur le montant de l&#39;impôt&quot;)
<a id="__codelineno-4-12" name="__codelineno-4-12"></a>    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<a id="__codelineno-4-13" name="__codelineno-4-13"></a>AssertionError: 2669 != 2270 within 1 delta (399 difference) : Échec sur le montant de l&#39;impôt
<a id="__codelineno-4-14" name="__codelineno-4-14"></a>
<a id="__codelineno-4-15" name="__codelineno-4-15"></a>
<a id="__codelineno-4-16" name="__codelineno-4-16"></a>
<a id="__codelineno-4-17" name="__codelineno-4-17"></a>
<a id="__codelineno-4-18" name="__codelineno-4-18"></a>Ran 1 test in 0.010s
<a id="__codelineno-4-19" name="__codelineno-4-19"></a>
<a id="__codelineno-4-20" name="__codelineno-4-20"></a>FAILED (failures=1)
<a id="__codelineno-4-21" name="__codelineno-4-21"></a>
<a id="__codelineno-4-22" name="__codelineno-4-22"></a>One or more subtests failed
<a id="__codelineno-4-23" name="__codelineno-4-23"></a>Failed subtests list: [Test &#39;test12&#39; avec entrée (2, 0, 43333)]
<a id="__codelineno-4-24" name="__codelineno-4-24"></a>
<a id="__codelineno-4-25" name="__codelineno-4-25"></a>Process finished with exit code 1
</code></pre></div></td></tr></table></div>
<p>Donc Gemini échoue au test rajouté par ChatGPT.</p>
<p>L’exécution de [chatGPT4] donne les résultats suivants :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span>
<span class="normal"><a href="#__codelineno-5-16">16</a></span>
<span class="normal"><a href="#__codelineno-5-17">17</a></span>
<span class="normal"><a href="#__codelineno-5-18">18</a></span>
<span class="normal"><a href="#__codelineno-5-19">19</a></span>
<span class="normal"><a href="#__codelineno-5-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a>C:\Data\st-2025\dev\python\code\python-flask-2025-cours\.venv\Scripts\python.exe &quot;C:\Data\st-2025\dev\python\code\python-flask-2025-cours\outils ia\chatGPT\chatGPT4.py&quot; 
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>Test (2, 2, 55555) -&gt; obtenu (impôt=2814, décote=0, réduction=0) | attendu (2815, 0, 0) | OK
<a id="__codelineno-5-3" name="__codelineno-5-3"></a>Test (2, 2, 50000) -&gt; obtenu (impôt=1384, décote=384, réduction=347) | attendu (1385, 384, 346) | OK
<a id="__codelineno-5-4" name="__codelineno-5-4"></a>Test (2, 3, 50000) -&gt; obtenu (impôt=0, décote=721, réduction=0) | attendu (0, 720, 0) | OK
<a id="__codelineno-5-5" name="__codelineno-5-5"></a>Test (1, 2, 100000) -&gt; obtenu (impôt=19884, décote=0, réduction=0) | attendu (19884, 0, 0) | OK
<a id="__codelineno-5-6" name="__codelineno-5-6"></a>Test (1, 3, 100000) -&gt; obtenu (impôt=16782, décote=0, réduction=0) | attendu (16782, 0, 0) | OK
<a id="__codelineno-5-7" name="__codelineno-5-7"></a>Test (2, 3, 100000) -&gt; obtenu (impôt=9200, décote=0, réduction=0) | attendu (9200, 0, 0) | OK
<a id="__codelineno-5-8" name="__codelineno-5-8"></a>Test (2, 5, 100000) -&gt; obtenu (impôt=4230, décote=0, réduction=0) | attendu (4230, 0, 0) | OK
<a id="__codelineno-5-9" name="__codelineno-5-9"></a>Test (1, 0, 100000) -&gt; obtenu (impôt=22986, décote=0, réduction=0) | attendu (22986, 0, 0) | OK
<a id="__codelineno-5-10" name="__codelineno-5-10"></a>Test (2, 2, 30000) -&gt; obtenu (impôt=0, décote=0, réduction=0) | attendu (0, 0, 0) | OK
<a id="__codelineno-5-11" name="__codelineno-5-11"></a>Test (1, 0, 200000) -&gt; obtenu (impôt=64210, décote=0, réduction=0) | attendu (64211, 0, 0) | OK
<a id="__codelineno-5-12" name="__codelineno-5-12"></a>Test (2, 3, 200000) -&gt; obtenu (impôt=42842, décote=0, réduction=0) | attendu (42843, 0, 0) | OK
<a id="__codelineno-5-13" name="__codelineno-5-13"></a>Test (2, 2, 49500) -&gt; obtenu (impôt=1296, décote=431, réduction=325) | attendu (1297, 431, 324) | OK
<a id="__codelineno-5-14" name="__codelineno-5-14"></a>Test (1, 0, 18535) -&gt; obtenu (impôt=359, décote=491, réduction=90) | attendu (359, 491, 90) | OK
<a id="__codelineno-5-15" name="__codelineno-5-15"></a>Test (2, 0, 43333) -&gt; obtenu (impôt=2268, décote=0, réduction=401) | attendu (2270, 0, 400) | ECHEC
<a id="__codelineno-5-16" name="__codelineno-5-16"></a> Détails tolérance ±1€ : impôt ok? False, décote ok? True, réduction ok? True
<a id="__codelineno-5-17" name="__codelineno-5-17"></a>
<a id="__codelineno-5-18" name="__codelineno-5-18"></a>Résultat global : AU MOINS UN TEST ÉCHOUE ❌
<a id="__codelineno-5-19" name="__codelineno-5-19"></a>
<a id="__codelineno-5-20" name="__codelineno-5-20"></a>Process finished with exit code 0
</code></pre></div></td></tr></table></div>
<p>ChatGPT échoue lui aussi sur le test rajouté mais pas pour les mêmes raisons que Gemini. ChatGPT a trouvé les bons résultats mais à 2 euros près au lieu des 1 euro imposés.</p>
<p>Donc désormais c’est le PDF généré par ChatGPT que nous utiliserons avec les IA suivantes. Il faut noter que c’est à cause du manque de tests unitaires proposés dans mes instructions que les deux IA ont toutes deux réussi les premiers tests. D’où dans cet exemple précis, l’importance de mettre des tests unitaires pour les cas limites du calcul de l’impôt. Comme c’est plutôt difficile d’imaginer soi-même ces tests. On va demander aux IA d’en rajouter eux-mêmes.</p>
<h2 id="58-le-probleme-3-avec-des-test-unitaires-generes-par-les-ia">5.8. Le problème 3 avec des test unitaires générés par les IA</h2>
<p>Les résultats obtenus avec Gemini et ChatGPT laissent un doute. Les IA ont-elles trouvé une solution générale qui valide tous les tests imaginables ou ont-elles trouvé une solution qui valide les seuls tests imposés. On va repartir sur une solution sans PDF pour obliger les IA à aller sur internet rechercher les informations dont elles ont besoin. Et on modifie nos instructions de la façon suivante :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000002560000022846DF1FEC.png" style="display:inline-block; margin:4px;width:4.75cm;height:4.38cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Le fichier texte [instructionsSansPDF4.txt] contient déjà 14 tests imposés. A ces tests, on rajoute les instructions suivantes :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span>
<span class="normal"><a href="#__codelineno-6-16">16</a></span>
<span class="normal"><a href="#__codelineno-6-17">17</a></span>
<span class="normal"><a href="#__codelineno-6-18">18</a></span>
<span class="normal"><a href="#__codelineno-6-19">19</a></span>
<span class="normal"><a href="#__codelineno-6-20">20</a></span>
<span class="normal"><a href="#__codelineno-6-21">21</a></span>
<span class="normal"><a href="#__codelineno-6-22">22</a></span>
<span class="normal"><a href="#__codelineno-6-23">23</a></span>
<span class="normal"><a href="#__codelineno-6-24">24</a></span>
<span class="normal"><a href="#__codelineno-6-25">25</a></span>
<span class="normal"><a href="#__codelineno-6-26">26</a></span>
<span class="normal"><a href="#__codelineno-6-27">27</a></span>
<span class="normal"><a href="#__codelineno-6-28">28</a></span>
<span class="normal"><a href="#__codelineno-6-29">29</a></span>
<span class="normal"><a href="#__codelineno-6-30">30</a></span>
<span class="normal"><a href="#__codelineno-6-31">31</a></span>
<span class="normal"><a href="#__codelineno-6-32">32</a></span>
<span class="normal"><a href="#__codelineno-6-33">33</a></span>
<span class="normal"><a href="#__codelineno-6-34">34</a></span>
<span class="normal"><a href="#__codelineno-6-35">35</a></span>
<span class="normal"><a href="#__codelineno-6-36">36</a></span>
<span class="normal"><a href="#__codelineno-6-37">37</a></span>
<span class="normal"><a href="#__codelineno-6-38">38</a></span>
<span class="normal"><a href="#__codelineno-6-39">39</a></span>
<span class="normal"><a href="#__codelineno-6-40">40</a></span>
<span class="normal"><a href="#__codelineno-6-41">41</a></span>
<span class="normal"><a href="#__codelineno-6-42">42</a></span>
<span class="normal"><a href="#__codelineno-6-43">43</a></span>
<span class="normal"><a href="#__codelineno-6-44">44</a></span>
<span class="normal"><a href="#__codelineno-6-45">45</a></span>
<span class="normal"><a href="#__codelineno-6-46">46</a></span>
<span class="normal"><a href="#__codelineno-6-47">47</a></span>
<span class="normal"><a href="#__codelineno-6-48">48</a></span>
<span class="normal"><a href="#__codelineno-6-49">49</a></span>
<span class="normal"><a href="#__codelineno-6-50">50</a></span>
<span class="normal"><a href="#__codelineno-6-51">51</a></span>
<span class="normal"><a href="#__codelineno-6-52">52</a></span>
<span class="normal"><a href="#__codelineno-6-53">53</a></span>
<span class="normal"><a href="#__codelineno-6-54">54</a></span>
<span class="normal"><a href="#__codelineno-6-55">55</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="mi">7</span> <span class="o">-</span> <span class="n">tu</span> <span class="n">ajouteras</span> <span class="n">autant</span> <span class="n">de</span> <span class="n">tests</span> <span class="n">unitaires</span> <span class="n">que</span> <span class="n">nécessaires</span> <span class="n">pour</span> <span class="n">vérifier</span> <span class="n">les</span> <span class="n">cas</span> <span class="n">limites</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt.</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="n">Pour</span> <span class="n">le</span> <span class="n">code</span> <span class="n">tu</span> <span class="n">complèteras</span> <span class="n">le</span> <span class="n">script</span> <span class="n">suivant</span> <span class="n">auquel</span> <span class="n">tu</span> <span class="n">auras</span> <span class="n">rajouté</span> <span class="n">tes</span> <span class="n">propres</span> <span class="n">tests</span><span class="o">.</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="c1"># =========================</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="c1"># Tests unitaires (tolérance de ±1 €)</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="c1"># =========================</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="n">TESTS</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a>    <span class="c1"># (adultes, enfants, revenus) -&gt; (impot, decote, reduction)</span>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a>    <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">55555</span><span class="p">),</span> <span class="p">(</span><span class="mi">2815</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a>    <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">50000</span><span class="p">),</span> <span class="p">(</span><span class="mi">1385</span><span class="p">,</span> <span class="mi">384</span><span class="p">,</span> <span class="mi">346</span><span class="p">)),</span>
<a id="__codelineno-6-13" name="__codelineno-6-13"></a>    <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">50000</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">720</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
<a id="__codelineno-6-14" name="__codelineno-6-14"></a>    <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100000</span><span class="p">),</span> <span class="p">(</span><span class="mi">19884</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
<a id="__codelineno-6-15" name="__codelineno-6-15"></a>    <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">100000</span><span class="p">),</span> <span class="p">(</span><span class="mi">16782</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
<a id="__codelineno-6-16" name="__codelineno-6-16"></a>    <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">100000</span><span class="p">),</span> <span class="p">(</span><span class="mi">9200</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
<a id="__codelineno-6-17" name="__codelineno-6-17"></a>    <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">100000</span><span class="p">),</span> <span class="p">(</span><span class="mi">4230</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
<a id="__codelineno-6-18" name="__codelineno-6-18"></a>    <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100000</span><span class="p">),</span> <span class="p">(</span><span class="mi">22986</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
<a id="__codelineno-6-19" name="__codelineno-6-19"></a>    <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">30000</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
<a id="__codelineno-6-20" name="__codelineno-6-20"></a>    <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">200000</span><span class="p">),</span> <span class="p">(</span><span class="mi">64211</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
<a id="__codelineno-6-21" name="__codelineno-6-21"></a>    <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">200000</span><span class="p">),</span> <span class="p">(</span><span class="mi">42843</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
<a id="__codelineno-6-22" name="__codelineno-6-22"></a>    <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">49500</span><span class="p">),</span> <span class="p">(</span><span class="mi">1297</span><span class="p">,</span> <span class="mi">431</span><span class="p">,</span> <span class="mi">324</span><span class="p">)),</span>
<a id="__codelineno-6-23" name="__codelineno-6-23"></a>    <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">18535</span><span class="p">),</span> <span class="p">(</span><span class="mi">359</span><span class="p">,</span> <span class="mi">491</span><span class="p">,</span> <span class="mi">90</span><span class="p">)),</span>
<a id="__codelineno-6-24" name="__codelineno-6-24"></a>    <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">43333</span><span class="p">),</span> <span class="p">(</span><span class="mi">2270</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">400</span><span class="p">)),</span>
<a id="__codelineno-6-25" name="__codelineno-6-25"></a><span class="p">]</span>
<a id="__codelineno-6-26" name="__codelineno-6-26"></a>
<a id="__codelineno-6-27" name="__codelineno-6-27"></a>
<a id="__codelineno-6-28" name="__codelineno-6-28"></a><span class="k">def</span><span class="w"> </span><span class="nf">_ok</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-6-29" name="__codelineno-6-29"></a>    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tol</span>
<a id="__codelineno-6-30" name="__codelineno-6-30"></a>
<a id="__codelineno-6-31" name="__codelineno-6-31"></a>
<a id="__codelineno-6-32" name="__codelineno-6-32"></a><span class="k">def</span><span class="w"> </span><span class="nf">run_tests</span><span class="p">(</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-6-33" name="__codelineno-6-33"></a>    <span class="n">all_ok</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-6-34" name="__codelineno-6-34"></a>    <span class="k">for</span> <span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span> <span class="ow">in</span> <span class="n">TESTS</span><span class="p">:</span>
<a id="__codelineno-6-35" name="__codelineno-6-35"></a>        <span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">params</span>
<a id="__codelineno-6-36" name="__codelineno-6-36"></a>        <span class="n">exp_impot</span><span class="p">,</span> <span class="n">exp_decote</span><span class="p">,</span> <span class="n">exp_reduc</span> <span class="o">=</span> <span class="n">expected</span>
<a id="__codelineno-6-37" name="__codelineno-6-37"></a>        <span class="n">res</span> <span class="o">=</span> <span class="n">calcul_impot_2019</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
<a id="__codelineno-6-38" name="__codelineno-6-38"></a>        <span class="n">ok_impot</span> <span class="o">=</span> <span class="n">_ok</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">impot</span><span class="p">,</span> <span class="n">exp_impot</span><span class="p">)</span>
<a id="__codelineno-6-39" name="__codelineno-6-39"></a>        <span class="n">ok_decote</span> <span class="o">=</span> <span class="n">_ok</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">decote</span><span class="p">,</span> <span class="n">exp_decote</span><span class="p">)</span>
<a id="__codelineno-6-40" name="__codelineno-6-40"></a>        <span class="n">ok_reduc</span> <span class="o">=</span> <span class="n">_ok</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">reduction</span><span class="p">,</span> <span class="n">exp_reduc</span><span class="p">)</span>
<a id="__codelineno-6-41" name="__codelineno-6-41"></a>        <span class="n">test_ok</span> <span class="o">=</span> <span class="n">ok_impot</span> <span class="ow">and</span> <span class="n">ok_decote</span> <span class="ow">and</span> <span class="n">ok_reduc</span>
<a id="__codelineno-6-42" name="__codelineno-6-42"></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
<a id="__codelineno-6-43" name="__codelineno-6-43"></a>            <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-6-44" name="__codelineno-6-44"></a>                <span class="sa">f</span><span class="s2">&quot;Test </span><span class="si">{</span><span class="n">params</span><span class="si">}</span><span class="s2"> -&gt; obtenu (impôt=</span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">impot</span><span class="si">}</span><span class="s2">, décote=</span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">decote</span><span class="si">}</span><span class="s2">, réduction=</span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">reduction</span><span class="si">}</span><span class="s2">) | attendu </span><span class="si">{</span><span class="n">expected</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="s1">&#39;OK&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">test_ok</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;ECHEC&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-6-45" name="__codelineno-6-45"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">test_ok</span><span class="p">:</span>
<a id="__codelineno-6-46" name="__codelineno-6-46"></a>                <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-6-47" name="__codelineno-6-47"></a>                    <span class="sa">f</span><span class="s2">&quot; Détails tolérance ±1€ : impôt ok? </span><span class="si">{</span><span class="n">ok_impot</span><span class="si">}</span><span class="s2">, décote ok? </span><span class="si">{</span><span class="n">ok_decote</span><span class="si">}</span><span class="s2">, réduction ok? </span><span class="si">{</span><span class="n">ok_reduc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-6-48" name="__codelineno-6-48"></a>        <span class="n">all_ok</span> <span class="o">&amp;=</span> <span class="n">test_ok</span>
<a id="__codelineno-6-49" name="__codelineno-6-49"></a>    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
<a id="__codelineno-6-50" name="__codelineno-6-50"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Résultat global :&quot;</span><span class="p">,</span> <span class="s2">&quot;TOUS LES TESTS PASSENT ✅&quot;</span> <span class="k">if</span> <span class="n">all_ok</span> <span class="k">else</span> <span class="s2">&quot;AU MOINS UN TEST ÉCHOUE ❌&quot;</span><span class="p">)</span>
<a id="__codelineno-6-51" name="__codelineno-6-51"></a>    <span class="k">return</span> <span class="n">all_ok</span>
<a id="__codelineno-6-52" name="__codelineno-6-52"></a>
<a id="__codelineno-6-53" name="__codelineno-6-53"></a>
<a id="__codelineno-6-54" name="__codelineno-6-54"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-6-55" name="__codelineno-6-55"></a>    <span class="n">run_tests</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>Lignes 11-24, les 14 tests imposés ;</li>
<li>Lignes 5-55 : ce code vient du script généré par ChatGPT. On va imposer à Gemini d’utiliser ce code pour faciliter les comparaisons entre les deux scripts générés.</li>
</ul>
<p>On commence par ChatGPT :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000670000001C32DE2F563.png" style="display:inline-block; margin:4px;width:13.16cm;height:3.6cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Sa première réponse est incorrecte. Je le lui dis en lui donnant les logs de l’exécution :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000002C00000010F605FA0EA.png" style="display:inline-block; margin:4px;width:5.59cm;height:2.15cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000001D7000001867A8C80F6.png" style="display:inline-block; margin:4px;width:3.739cm;height:3.099cm;" /></td></tr></table>

<p>Sa deuxième réponse est la bonne. ChatGPT a rajouté les 11 tests suivants aux 14 tests imposés :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span>
<span class="normal"><a href="#__codelineno-7-14">14</a></span>
<span class="normal"><a href="#__codelineno-7-15">15</a></span>
<span class="normal"><a href="#__codelineno-7-16">16</a></span>
<span class="normal"><a href="#__codelineno-7-17">17</a></span>
<span class="normal"><a href="#__codelineno-7-18">18</a></span>
<span class="normal"><a href="#__codelineno-7-19">19</a></span>
<span class="normal"><a href="#__codelineno-7-20">20</a></span>
<span class="normal"><a href="#__codelineno-7-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a># Cas limites supplémentaires (bords de paliers/arrondis)
<a id="__codelineno-7-2" name="__codelineno-7-2"></a>TESTS += [
<a id="__codelineno-7-3" name="__codelineno-7-3"></a>    # Abattement 10 % : plancher et plafond
<a id="__codelineno-7-4" name="__codelineno-7-4"></a>    ((1, 0, 3000), (0, 0, 0)),  # 10 % = 300 &lt; plancher 437 =&gt; RNI faible -&gt; impôt nul
<a id="__codelineno-7-5" name="__codelineno-7-5"></a>    ((1, 0, 200000), (64211, 0, 0)),  # plafond abattement déjà couvert dans tests initiaux
<a id="__codelineno-7-6" name="__codelineno-7-6"></a>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a>    # Décote : juste en dessous / au-dessus des seuils
<a id="__codelineno-7-8" name="__codelineno-7-8"></a>    ((1, 0, 25000), None),  # diagnostique
<a id="__codelineno-7-9" name="__codelineno-7-9"></a>    ((2, 0, 35000), None),  # diagnostique
<a id="__codelineno-7-10" name="__codelineno-7-10"></a>
<a id="__codelineno-7-11" name="__codelineno-7-11"></a>    # Réduction 20 % : plein droit vs écrêtement
<a id="__codelineno-7-12" name="__codelineno-7-12"></a>    ((1, 0, 17000), None),  # diagnostique
<a id="__codelineno-7-13" name="__codelineno-7-13"></a>    ((2, 0, 34000), None),  # diagnostique
<a id="__codelineno-7-14" name="__codelineno-7-14"></a>    ((1, 0, 20000), None),  # diagnostique
<a id="__codelineno-7-15" name="__codelineno-7-15"></a>    ((2, 0, 40000), None),  # diagnostique
<a id="__codelineno-7-16" name="__codelineno-7-16"></a>
<a id="__codelineno-7-17" name="__codelineno-7-17"></a>    # Changement de parts (plafonnement QF)
<a id="__codelineno-7-18" name="__codelineno-7-18"></a>    ((2, 1, 80000), None),
<a id="__codelineno-7-19" name="__codelineno-7-19"></a>    ((2, 2, 80000), None),
<a id="__codelineno-7-20" name="__codelineno-7-20"></a>    ((2, 3, 80000), None),
<a id="__codelineno-7-21" name="__codelineno-7-21"></a>]
</code></pre></div></td></tr></table></div>
<p>Il y a maintenant 25 tests unitaires. J’ai vérifié manuellement les 11 nouveaux tests avec le simulateur officiel de la DGIP et c’est bon.</p>
<p>Maintenant, on passe à Gemini. Cela va être beaucoup plus compliqué. Il va réussir à générer un script qui passe les 25 tests de ChatGPT mais après un long débogage.</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000001E800000139F615216D.png" style="display:inline-block; margin:4px;width:3.87cm;height:2.48cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Ci-dessous, la liste du débogage :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000034F000001712DF75461.png" style="display:inline-block; margin:4px;width:6.729cm;height:2.93cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Bizarrement, une majorité de tests a échoué même parmi les 14 imposés alors que par le passé Gemini avait généré du code qui les passait tous.</p>
<p>La réponse suivante de Gemini n’est toujours pas correcte :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000001D90000013FCD8E5FBC.png" style="display:inline-block; margin:4px;width:3.75cm;height:2.529cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>La réponse suivante non plus :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000022F00000189EDA67B17.png" style="display:inline-block; margin:4px;width:4.44cm;height:3.12cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>La réponse suivante non plus. Du coup je change mon fusil d’épaule. Je lui demande de réussir les 25 tests qu’a réussis ChatGPT en lui joignant les logs de ChatGPT :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000004160000021384BCD4D2.png" style="display:inline-block; margin:4px;width:8.29cm;height:4.21cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Gemini échoue. Il a bien ajouté les tests de ChatGPT. Je lui joins les logs de son exécution :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000028D000001463F31B53D.png" style="display:inline-block; margin:4px;width:5.189cm;height:2.589cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Toujours pas :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000033B00000156A3FDD4CA.png" style="display:inline-block; margin:4px;width:6.579cm;height:2.72cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Toujours pas :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000001D10000017A594C0E0C.png" style="display:inline-block; margin:4px;width:3.69cm;height:3cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Toujours pas :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000040300000192B59ABE5D.png" style="display:inline-block; margin:4px;width:8.149cm;height:3.191cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Toujours pas mais c’est mieux :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000026300000155675A1EBA.png" style="display:inline-block; margin:4px;width:4.86cm;height:2.709cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Gemini fait de nouvelles erreurs :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000001D800000158DADFC1EC.png" style="display:inline-block; margin:4px;width:3.75cm;height:2.731cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Il s’améliore de nouveau :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000023E0000015D4789B0E2.png" style="display:inline-block; margin:4px;width:4.56cm;height:2.769cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Cette fois, c’est bon :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000001F80000009F02FBB640.png" style="display:inline-block; margin:4px;width:4.001cm;height:1.259cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000019B00000122F03E6B75.png" style="display:inline-block; margin:4px;width:3.26cm;height:2.3cm;" /></td></tr></table>

<p>Indiscutablement, sur cet exemple précis du calcul de l’impôt 2019 avec les contraintes placées dans le fichier des instructions, ChatGPT a été plus pertinent que Gemini. Mais ce n’est qu’un exemple.</p>
<p>On peut aller plus loin. On peut demander à Gemini de régénérer un PDF selon les règles de calcul qu’il a utilisées pour réussir les 25 tests. On veut voir s’il a changé son raisonnement premier sur les calculs de la décote et de la réduction de 20% :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000004420000021639AE9EC3.png" style="display:inline-block; margin:4px;width:8.661cm;height:4.24cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000027B00000301394A1817.png" style="display:inline-block; margin:4px;width:5.039cm;height:6.1cm;" /></td></tr></table>

<p>Cette fois-ci, Gemini a généré un fichier MarkDown que j’ai ensuite transformé en PDF [Le problème selon Gemini version 2]. Et Gemini a effectivement changé son raisonnement :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000052B000002008EB7EB63.png" style="display:inline-block; margin:4px;width:10.539cm;height:4.08cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000052A00000429ED432D90.png" style="display:inline-block; margin:4px;width:10.55cm;height:8.5cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>On constate qu’il n’y a plus le calcul particulier de la décote ni la règle de repêchage. Gemini a désormais adopté le raisonnement de ChatGPT.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner">

      <div>
        <a href="https://tahe.developpez.com" target="_blank">
          https://tahe.developpez.com
        </a>
        <br>
        Ce cours tutoriel écrit par <strong>Serge Tahé</strong> est mis à disposition du public selon les termes de la
        <em>Licence Creative Commons Attribution – Pas d’Utilisation Commerciale –
        Partage dans les Mêmes Conditions 3.0 non transposé</em>.
      </div>

    </div>
  </div>

      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": ".", "features": ["navigation.sections", "navigation.indexes", "navigation.expand", "toc.integrate", "navigation.top"], "search": "assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="javascripts/focus.js"></script>
      
    
  </body>
</html>