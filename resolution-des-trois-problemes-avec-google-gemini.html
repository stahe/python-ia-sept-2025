
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Tutoriel complet pour générer du code Python.">
      
      
        <meta name="author" content="Serge Tahé">
      
      
        <link rel="canonical" href="https://stahe.github.io/python-ia-sept-2025/resolution-des-trois-problemes-avec-google-gemini.html">
      
      
        <link rel="prev" href="installation-dx27un-environnement-de-travail.html">
      
      
        <link rel="next" href="resolution-des-trois-problemes-avec-chatgpt.html">
      
      
        
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>4. Résolution des trois problèmes avec Google Gemini - Générer un script Python avec des outils d’IA</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="stylesheets/focus.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-EBZC3JVJNR"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    // CORRECTION ICI : Utilisation de guillemets doubles pour entourer le titre qui contient une apostrophe
    var siteName = "Générer un script Python avec des outils d’IA";

    gtag('config', 'G-EBZC3JVJNR', {
        'page_title': siteName
    });
    console.log("[GA Debug] page_title forced to: " + siteName);
  </script>

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#4-resolution-des-trois-problemes-avec-google-gemini" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="Générer un script Python avec des outils d’IA" class="md-header__button md-logo" aria-label="Générer un script Python avec des outils d’IA" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Générer un script Python avec des outils d’IA
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              4. Résolution des trois problèmes avec Google Gemini
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Passer au mode sombre"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Passer au mode sombre" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Passer au mode clair"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Passer au mode clair" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/stahe/python-ia-sept-2025" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Générer un script Python avec des outils d’IA" class="md-nav__button md-logo" aria-label="Générer un script Python avec des outils d’IA" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Générer un script Python avec des outils d’IA
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/stahe/python-ia-sept-2025" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Accueil
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="introduction.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1. Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-trois-problemes-etudies-et-les-resultats.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2. Les trois problèmes étudiés et les résultats
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="installation-dx27un-environnement-de-travail.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3. Installation d&#x27;un environnement de travail
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    4. Résolution des trois problèmes avec Google Gemini
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="resolution-des-trois-problemes-avec-google-gemini.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    4. Résolution des trois problèmes avec Google Gemini
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#41-introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1. Introduction
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#42-le-probleme-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.2. Le problème 1
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#43-le-probleme-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.3. Le problème 2
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.3. Le problème 2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#431-introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.3.1. Introduction
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.3.1. Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#4311-calcul-de-limpot-brut" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.3.1.1. Calcul de l’impôt brut
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4312-plafonnement-du-quotient-familial" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.3.1.2. Plafonnement du quotient familial
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4313-calcul-de-la-decote" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.3.1.3. Calcul de la décote
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4314-calcul-de-la-reduction-dimpots" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.3.1.4. Calcul de la réduction d’impôts
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4315-calcul-de-limpot-net" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.3.1.5. Calcul de l’impôt net
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4316-cas-des-hauts-revenus" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.3.1.6. Cas des hauts revenus
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.3.1.6. Cas des hauts revenus">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#43161-plafonnement-de-la-reduction-de-10-sur-les-revenus-annuels" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.3.1.6.1. Plafonnement de la réduction de 10 % sur les revenus annuels
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43162-plafonnement-du-quotient-familial" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.3.1.6.2. Plafonnement du quotient familial
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4317-chiffres-officiels" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.3.1.7. Chiffres officiels
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#432-configuration-de-la-session-gemini" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.3.2. Configuration de la session Gemini
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#433-la-reponse-de-gemini" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.3.3. La réponse de Gemini
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#44-le-probleme-3" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.4. Le problème 3
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="resolution-des-trois-problemes-avec-chatgpt.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    5. Résolution des trois problèmes avec ChatGPT
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="resolution-des-trois-problemes-avec-grok.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    6. Résolution des trois problèmes avec Grok
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="resolution-des-trois-problemes-avec-claudeai.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    7. Résolution des trois problèmes avec ClaudeAI
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="resolution-des-trois-problemes-avec-mistralai.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    8. Résolution des trois problèmes avec MistralAI
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="resolution-des-trois-problemes-avec-deepseek.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    9. Résolution des trois problèmes avec DeepSeek
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="resolution-des-trois-problemes-avec-perplexity.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    10. Résolution des trois problèmes avec Perplexity
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="conclusion.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    11. Conclusion
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="4-resolution-des-trois-problemes-avec-google-gemini">4. Résolution des trois problèmes avec Google Gemini</h1>
<p>Nous allons donner les copies d’écran des trois sessions Gemini qui ont permis de résoudre les trois problèmes posés. Nous irons assez dans les détails. Ceci fait, nous ne répéterons pas le processus pour les autres IA testées. Elles fonctionnent de manière analogue. Nous ne donnerons que les détails frappants.</p>
<h2 id="41-introduction">4.1. Introduction</h2>
<p>Nous rappelons la première copie d’écran de Gemini donnée précédemment :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000037B000004744C75919A.png" style="display:inline-block; margin:4px;width:7.07cm;height:9.051cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<ul>
<li>En [1], l’URL de Gemini ;</li>
<li>En [2], la version de Gemini utilisée ;</li>
<li>En [3-5], les trois problèmes posés à Gemini ;
Gemini est un produit de Google disponible à l’URL [https://gemini.google.com/]. Pour avoir un historique de vos sessions de questions / réponses comme ci-dessus, il vous faut créer un compte. Par ailleurs, comme toutes les autres IA testées, Gemini limite le nombre de vos questions et le nombre de fichiers téléchargés. Quand cette limite est atteinte, la session est terminée et on vous propose de la continuer plus tard dans le temps. Comme il est assez frustrant de s’arrêter en plein milieu d’une session, j’ai pris un abonnement. Le premier mois de l’abonnement Gemini est par chance gratuit. J’ai fait de même avec les autres IA qui avaient ces limites, à savoir ChatGPT, MistralAI, ClaudeAI. J’ai pris un abonnement d’un mois, mais là le premier mois était payant. Je n’ai pas rencontré de limites avec Grok. DeepSeek n’annonce pas de limites mais répond parfois [Server busy] et interrompt la session. Ca revient à mettre des limites sans le dire.</li>
</ul>
<p>Dans la suite, je parlerai de session de questions / réponses, raccourcie à session simplement. Les IA utilisent le plus souvent le terme anglais <strong>chat</strong> (discussion) ou conversation.</p>
<p>L’interface de Gemini pour poser une question est la suivante :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000062900000148B5DD8E2C.png" style="display:inline-block; margin:4px;width:10.389cm;height:2.161cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000240000001A0C12DA836.png" style="display:inline-block; margin:4px;width:4.57cm;height:3.3cm;" /></td></tr></table>

<ul>
<li>En [1], votre question ;</li>
<li>En [2], l’icône qui lance l’IA pour le calcul de la réponse ;</li>
<li>En [3-4], vous pouvez joindre des fichiers ;</li>
</ul>
<h2 id="42-le-probleme-1">4.2. Le problème 1</h2>
<p>La session pour le problème 1 est la suivante :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000665000002F6537BB492.png" style="display:inline-block; margin:4px;width:12.98cm;height:6.01cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<ul>
<li>En [1], la question ;</li>
<li>En [2], le début de la réponse de Gemini ;
La suite de la réponse est la suivante :</li>
</ul>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005C500000228ABB13993.png" style="display:inline-block; margin:4px;width:11.719cm;height:4.38cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000600000002E7BCE3D4E6.png" style="display:inline-block; margin:4px;width:12.16cm;height:5.881cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005A7000001A7DA4C6201.png" style="display:inline-block; margin:4px;width:11.43cm;height:3.341cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005E400000296F7B60621.png" style="display:inline-block; margin:4px;width:12cm;height:5.271cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>La réponse est correcte. Les cinq autres IA donneront également la bonne réponse sous une forme analogue.</p>
<h2 id="43-le-probleme-2">4.3. Le problème 2</h2>
<h3 id="431-introduction">4.3.1. Introduction</h3>
<p>On rappelle ici le problème initial du cours [<a href="https://tahe.developpez.com/tutoriels-cours/python-flask-2020/"><u><u>python3-flask-2020</u></u></a>]. C’est un texte donné en TD à des étudiants.</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000010000031C0000030AEA140AD5.png" style="display:inline-block; margin:4px;width:13.151cm;height:12.851cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Le tableau ci-dessus permet de calculer l’impôt dans le cas simplifié d&#x27;un contribuable n&#x27;ayant que son seul salaire à déclarer. Comme l’indique la note (1), l’impôt ainsi calculé est l’impôt avant trois mécanismes :</p>
<ul>
<li>Le plafonnement du quotient familial qui intervient pour les hauts revenus ;</li>
<li>La décote et la réduction d’impôts qui interviennent pour les faibles revenus ;
Ainsi le calcul de l’impôt comprend les étapes suivantes <strong>[http://impotsurlerevenu.org/comprendre-le-calcul-de-l-impot/1217-calcul-de-l-impot-2019.php]</strong> :</li>
</ul>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000001000003180000010D0356A18F.png" style="display:inline-block; margin:4px;width:13.14cm;height:4.462cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>On se propose d&#x27;écrire un programme permettant de calculer l&#x27;impôt d&#x27;un contribuable en 2019 dans le cas simplifié d&#x27;un contribuable n&#x27;ayant que son seul salaire à déclarer.</p>
<h4 id="4311-calcul-de-limpot-brut">4.3.1.1. Calcul de l’impôt brut</h4>
<p>L’impôt brut peut être calculé de la façon suivante :</p>
<p>On calcule d’abord le nombre de parts du contribuable :</p>
<ul>
<li>Chaque parent amène 1 part ;</li>
<li>Les deux premiers enfants amènent chacun 1/2 part ;</li>
<li>
<p>Les enfants suivants amènent une part chacun :
Le nombre de parts est donc :</p>
</li>
<li>
<p>nbParts=1+nbEnfants*0,5+(nbEnfants-2)*0,5 si le salarié n’est pas marié ;</p>
</li>
<li>nbParts=2+nbEnfants*0,5+(nbEnfants-2)*0,5 s&#x27;il est marié ;</li>
<li>où nbEnfants est son nombre d&#x27;enfants ;</li>
<li>On calcule le revenu imposable <strong>R=0.9*S</strong> où S est le salaire annuel ;</li>
<li>On calcule le quotient familial <strong>QF=R/nbParts ;</strong></li>
<li>On calcule l’impôt brut <strong>I</strong> d&#x27;après les données suivantes (2019) :</li>
</ul>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">9964</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">0</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">0</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">27519    </p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">0.14</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">1394.96</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">73779    </p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">0.3</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">5798</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">156244    </p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">0.4</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">13913.69</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">0    </p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">0.45</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">20163.45</p></td></tr></table>

<p>Chaque ligne a 3 champs : champ1, champ2, champ3. Pour calculer l&#x27;impôt I, on recherche la première ligne où QF&lt;=champ1 et on prend les valeurs de cette ligne. Par exemple, pour un salarié marié avec deux enfants et un salaire annuel S de <strong>50000</strong> euros :</p>
<p>Revenu imposable : <strong>R</strong>=0,9*S=45000</p>
<p>Nombre de parts : <strong>nbParts</strong>=2+2*0,5=3</p>
<p>Quotient familial : <strong>QF</strong>=45000/3=15000</p>
<p>La 1re ligne où QF&lt;=champ1 est la suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a>    <span class="mi">27519</span>    <span class="mf">0.14</span>    <span class="mf">1394.96</span>
</code></pre></div></td></tr></table></div>
<p>L&#x27;impôt I est alors égal à <strong>0.14*R – 1394,96*nbParts</strong>=<strong>[0,14*45000-1394,96*3]</strong>=<strong>2115</strong>. L’impôt est arrondi à l’euro inférieur.</p>
<p>Si la relation QF&lt;=champ1 dès la 1re ligne, alors l’impôt est nul.</p>
<p>Si QF est tel que la relation QF&lt;=champ1 n&#x27;est jamais vérifiée, alors ce sont les coefficients de la dernière ligne qui sont utilisés. Ici :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a>    <span class="mi">0</span>    <span class="mf">0.45</span>    <span class="mf">20163.45</span>
</code></pre></div></td></tr></table></div>
<p>ce qui donne l&#x27;impôt brut I=<strong>0.45*R – 20163,45*nbParts</strong>.</p>
<h4 id="4312-plafonnement-du-quotient-familial">4.3.1.2. Plafonnement du quotient familial</h4>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000010000032A0000015B69106252.png" style="display:inline-block; margin:4px;width:10.97cm;height:4.691cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Pour savoir si le plafonnement du quotient familial QF s’applique, on refait le calcul de l’impôt brut sans les enfants. Toujours pour le salarié marié avec deux enfants et un salaire annuel S de <strong>50000</strong> euros :</p>
<p>Revenu imposable : <strong>R</strong>=0,9*S=45000</p>
<p>Nombre de parts : <strong>nbParts</strong>=2 (on ne compte plus les enfants)</p>
<p>Quotient familial : <strong>QF</strong>=45000/2=22500</p>
<p>La 1re ligne où QF&lt;=champ1 est la suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a>    <span class="mi">27519</span>    <span class="mf">0.14</span>    <span class="mf">1394.96</span>
</code></pre></div></td></tr></table></div>
<p>L&#x27;impôt I est alors égal à <strong>0.14*R – 1394,96*nbParts</strong>=<strong>[0,14*45000-1394,96*2]</strong>=<strong>3510</strong>.</p>
<p>Gain maximal lié aux enfants : 1551 * 2  = 3102 euros</p>
<p>Impôt minimal : 3510-3102 = 408 euros</p>
<p>L’impôt brut avec 2 parts déjà calculé au paragraphe précédent 2115 euros est supérieur à l’impôt minimal 408 euros, donc le plafonnement familial ne s’applique pas ici.</p>
<p>De façon générale, l’impôt brut est <strong>sup(impôt1, impôt2)</strong> où :</p>
<ul>
<li><strong>[impôt1]</strong> : est l’impôt brut calculé avec les enfants ;</li>
<li><strong>[impôt2]</strong> : est l’impôt brut calculé sans les enfants et diminué du gain maximal (ici 1551 euros par demi-part) lié aux enfants ;</li>
</ul>
<h4 id="4313-calcul-de-la-decote">4.3.1.3. Calcul de la décote</h4>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000010000032A0000011264DC824C.png" style="display:inline-block; margin:4px;width:13.851cm;height:4.68cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Toujours pour le salarié marié avec deux enfants et un salaire annuel S de <strong>50000</strong> euros :</p>
<p>L’impôt brut (2115 euros) issu de l’étape précédente est inférieur à 2627 euros pour un couple (1595 euros pour un célibataire) : la décote s’applique donc. Elle est obtenue avec le calcul suivant :</p>
<p>décote= seuil (couple=1970/célibataire=1196)-0,75* Impôt brut</p>
<p><strong>décote</strong>=1970-0,75*2115=383,75 arrondi à <strong>384</strong> euros.</p>
<p><strong>Nouvel Impôt brut</strong>= 2115-384= <strong>1731</strong> euros</p>
<p>Il faut observer deux règles dans le calcul de la décote (certains outils d’IA ont buté sur cette question) :</p>
<ul>
<li>La décote ne peut être négative ;</li>
<li>La décote ne peut être supérieure à l’impôt déjà calculé ;</li>
</ul>
<h4 id="4314-calcul-de-la-reduction-dimpots">4.3.1.4. Calcul de la réduction d’impôts</h4>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000010000032A0000011687901CDA.png" style="display:inline-block; margin:4px;width:13.831cm;height:4.74cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Au-dessous d’un certain seuil, une réduction de 20 % est faite sur l’impôt brut issu des calculs précédents. En 2019, les seuils sont les suivants :</p>
<ul>
<li>célibataire : 21037 euros ;</li>
<li>couple : 42074 euros ; (le chiffre 37968 utilisé dans l’exemple ci-dessus semble erroné) ;
Ce seuil est augmenté de la valeur : 3797 * (nombre de demi-parts amenées par les enfants).</li>
</ul>
<p>Toujours pour le salarié marié avec deux enfants et un salaire annuel S de <strong>50000</strong> euros :</p>
<ul>
<li>Son revenu imposable (45000 euros) est inférieur au seuil (42074+2*3797)=49668 euros ;</li>
<li>Il a donc droit à une réduction de 20 % de son impôt : 1731 * 0,2= 346,2 euros arrondi à 347 euros ;</li>
<li>L’impôt brut du contribuable devient : 1731-347= <strong>1384</strong> euros ;</li>
</ul>
<h4 id="4315-calcul-de-limpot-net">4.3.1.5. Calcul de l’impôt net</h4>
<p>Notre calcul s’arrêtera là : l’impôt net à payer sera de <strong>1384</strong> euros. Dans la réalité, le contribuable peut bénéficier d’autres réductions notamment pour des dons à des organismes d’intérêt public ou général.</p>
<h4 id="4316-cas-des-hauts-revenus">4.3.1.6. Cas des hauts revenus</h4>
<p>Notre exemple précédent correspond à la majorité des cas de salariés. Cependant le calcul de l’impôt est différent dans le cas des hauts revenus.</p>
<h5 id="43161-plafonnement-de-la-reduction-de-10-sur-les-revenus-annuels">4.3.1.6.1. Plafonnement de la réduction de 10 % sur les revenus annuels</h5>
<p>Dans la plupart des cas, le revenu imposable est obtenu par la formule : R=0,9*S où S est le salaire annuel. On appelle cela la réduction des 10 %. Cette réduction est plafonnée. En 2019 :</p>
<ul>
<li>Elle ne peut être supérieure à 12502 euros ;</li>
<li>
<p>Elle ne peut être inférieure à 437 euros ;
Prenons le cas d’un salarié non marié sans enfants et un salaire annuel de 200000 euros :</p>
</li>
<li>
<p>La réduction de 10 % est de 20000 euros &gt; 12502 euros. Elle est donc ramenée à 12502 euros ;</p>
</li>
</ul>
<h5 id="43162-plafonnement-du-quotient-familial">4.3.1.6.2. Plafonnement du quotient familial</h5>
<p>Prenons un cas où le plafonnement familial présenté au paragraphe |<a href="#_Plafonnement_du_quotient"><u><u>Plafonnement du quotient familial</u></u></a>|, intervient. Prenons le cas d’un couple avec trois enfants et des revenus annuels de 100000 euros. Reprenons les étapes du calcul :</p>
<ul>
<li>L’abattement de 10 % est de 100000 euros &lt; 12502 euros. Le revenu imposable <strong>R</strong> est donc 100000-10000=90000 euros ;</li>
<li>Le couple a <strong>nbParts</strong>=2+0,5*2+1=<strong>4</strong> parts ;</li>
<li>Son quotient familial est donc <strong>QF</strong>= R/nbParts=90000/4=<strong>22500</strong> euros ;</li>
<li>Son impôt brut <strong>I1</strong> <strong>avec</strong> enfants est I1=0,14*90000-1394,96*4= 7020 euros ;</li>
<li>Son impôt brut <strong>I2</strong> <strong>sans</strong> enfants :</li>
<li><strong>QF</strong>=90000/2=45000 euros ;</li>
<li><strong>I2</strong>=0,3*90000-5798*2=15404 euros ;</li>
<li>La règle du plafonnement du quotient familial dit que le gain amené par les enfants ne peut dépasser (1551*4 demi-parts)=6204 euros. Or ici, il est I2-I1=15404-7020= 8384 euros, donc supérieur à 6204 euros ;</li>
<li>L’impôt brut est donc recalculé comme <strong>I3</strong>=<strong>I2</strong>-6204=15404-6204= <strong>9200</strong> euros ;</li>
<li>Comme I3&gt;I1, ce sera l’impôt I3 qui sera conservé ;
Ce couple n’aura ni décote, ni réduction et son impôt final sera de <strong>9200</strong> euros.</li>
</ul>
<h4 id="4317-chiffres-officiels">4.3.1.7. Chiffres officiels</h4>
<p>Le calcul de l’impôt est complexe. Tout au long du document, les tests seront faits avec les exemples suivants. Les résultats sont ceux du simulateur de l’administration fiscale |<a href="https://www3.impots.gouv.fr/simulateur/calcul_impot/2019/simplifie/index.htm"><u><u>https://www3.impots.gouv.fr/simulateur/calcul_impot/2019/simplifie/index.htm</u></u></a>| :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;"><b>Contribuable</b></p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;"><b>Résultats officiels</b></p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;"><b>Résultats de l’algorithme du document</b></p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Couple avec 2 enfants et des revenus annuels de 55555 euros</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Impôt=<b>2815</b> euros</p><p style="margin:0;">Taux d’imposition=14 %</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Impôt=<b>2814</b> euros</p><p style="margin:0;">Taux d’imposition=14 %</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Couple avec 2 enfants et des revenus annuels de 50000 euros</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Impôt=<b>1385</b> euros</p><p style="margin:0;">Décote=384 euros</p><p style="margin:0;">Réduction=346 euros</p><p style="margin:0;">Taux d’imposition=14 %</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Impôt=<b>1384</b> euros</p><p style="margin:0;">Décote=384 euros</p><p style="margin:0;">Réduction=347 euros</p><p style="margin:0;">Taux d’imposition=14 %</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Couple avec 3 enfants et des revenus annuels de 50000 euros</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Impôt=<b>0</b> euro</p><p style="margin:0;">décote=720 euros</p><p style="margin:0;">Réduction=0 euro</p><p style="margin:0;">Taux d’imposition=14 %</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Impôt=<b>0</b> euro</p><p style="margin:0;">décote=720 euros</p><p style="margin:0;">Réduction=0 euro</p><p style="margin:0;">Taux d’imposition=14 %</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Célibataire avec 2 enfants et des revenus annuels de 100000 euros</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Impôt=<b>19884</b> euros</p><p style="margin:0;">décote=0 euro</p><p style="margin:0;">Réduction=0 euro</p><p style="margin:0;">Taux d’imposition=41 %</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Impôt=<b>19884</b> euros</p><p style="margin:0;">Surcote=4480 euros</p><p style="margin:0;">décote=0 euro</p><p style="margin:0;">Réduction=0 euro</p><p style="margin:0;">Taux d’imposition=41 %</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Célibataire avec 3 enfants et des revenus annuels de 100000 euros</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Impôt=<b>16782</b> euros</p><p style="margin:0;">décote=0 euro</p><p style="margin:0;">Réduction=0 euro</p><p style="margin:0;">Taux d’imposition=41 %</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Impôt=<b>16782</b> euros</p><p style="margin:0;">Surcote=7176 euros</p><p style="margin:0;">décote=0 euro</p><p style="margin:0;">Réduction=0 euro</p><p style="margin:0;">Taux d’imposition=41 %</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Couple avec 3 enfants et des revenus annuels de 100000 euros</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Impôt=<b>9200</b> euros</p><p style="margin:0;">décote=0 euro</p><p style="margin:0;">Réduction=0 euro</p><p style="margin:0;">Taux d’imposition=30 %</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Impôt=<b>9200</b> euros</p><p style="margin:0;">Surcote=2180 euros</p><p style="margin:0;">décote=0 euro</p><p style="margin:0;">Réduction=0 euro</p><p style="margin:0;">Taux d’imposition=30 %</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Couple avec 5 enfants et des revenus annuels de 100000 euros</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Impôt=<b>4230</b> euros</p><p style="margin:0;">décote=0 euro</p><p style="margin:0;">Réduction=0 euro</p><p style="margin:0;">Taux d’imposition=14 %</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Impôt=<b>4230</b> euros</p><p style="margin:0;">décote=0 euro</p><p style="margin:0;">Réduction=0 euro</p><p style="margin:0;">Taux d’imposition=14 %</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Célibataire sans enfants et des revenus annuels de 100000 euros</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Impôt=<b>22986</b> euros</p><p style="margin:0;">décote=0 euro</p><p style="margin:0;">Réduction=0 euro</p><p style="margin:0;">Taux d’imposition=41 %</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Impôt=<b> 22986</b> euros</p><p style="margin:0;">Surcote=0 euro</p><p style="margin:0;">décote=0 euro</p><p style="margin:0;">Réduction=0 euro</p><p style="margin:0;">Taux d’imposition=41 %</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Couple avec 2 enfants et des revenus annuels de 30000 euros</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Impôt=<b>0</b> euro</p><p style="margin:0;">décote=0 euro</p><p style="margin:0;">Réduction=0 euro</p><p style="margin:0;">Taux d’imposition=0 %</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Impôt=<b>0</b> euro</p><p style="margin:0;">décote=0 euro</p><p style="margin:0;">Réduction=0 euro</p><p style="margin:0;">Taux d’imposition=0 %</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Célibataire sans enfants et des revenus annuels de 200000 euros</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Impôt=<b>64211</b> euro</p><p style="margin:0;">décote=0 euro</p><p style="margin:0;">Réduction=0 euro</p><p style="margin:0;">Taux d’imposition=45 %</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Impôt=<b> 64210</b> euros</p><p style="margin:0;">Surcote=7498 euros</p><p style="margin:0;">décote=0 euro</p><p style="margin:0;">Réduction=0 euro</p><p style="margin:0;">Taux d’imposition=45 %</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Couple avec 3 enfants et des revenus annuels de 200000 euros</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Impôt=<b>42843</b> euro</p><p style="margin:0;">décote=0 euro</p><p style="margin:0;">Réduction=0 euro</p><p style="margin:0;">Taux d’imposition=41 %</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Impôt=<b>42842</b> euros</p><p style="margin:0;">Surcote=17283 euros</p><p style="margin:0;">décote=0 euro</p><p style="margin:0;">Réduction=0 euro</p><p style="margin:0;">Taux d’imposition=41 %</p></td></tr></table>

<p>Ci-dessus, on appelle surcote, ce que paient en plus les hauts revenus à cause de deux phénomènes :</p>
<ul>
<li>Le plafonnement de l’abattement de 10 % sur les revenus annuels ;</li>
<li>Le plafonnement du quotient familial ;
Cet indicateur n’a pu être vérifié car le simulateur de l’administration fiscale ne le donne pas.</li>
</ul>
<p>On voit que l’algorithme du document donne un impôt juste à chaque fois, avec cependant une marge d’erreur de 1 euro. Cette marge d’erreur provient des arrondis. Toutes les sommes d’argent sont arrondies parfois à l’euro supérieur, parfois à l’euro inférieur. Comme je ne connaissais pas les règles officielles, les sommes d’argent de l’algorithme du document ont été arrondies :</p>
<ul>
<li>À l’euro supérieur pour les décotes et réductions ;</li>
<li>À l’euro inférieur pour les surcotes et l’impôt final ;
Nous allons demander à l’IA de faire ce calcul d’impôt.</li>
</ul>
<h3 id="432-configuration-de-la-session-gemini">4.3.2. Configuration de la session Gemini</h3>
<p>La question posée à Gemini s’accompagne de deux fichiers :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000039A0000015F9D1AD635.png" style="display:inline-block; margin:4px;width:7.331cm;height:2.79cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<ul>
<li>En [1], le calcul qui vient d’être détaillé a été mis dans un PDF qui est donné à Gemini. Gemini va y trouver les règles exactes de calcul simplifié de l’impôt 2019 sur les revenus 2018 ;</li>
<li>En [2], nos instructions ;</li>
<li>En [3] pour lancer l’IA ;
Nos instructions dans le fichier texte [instructionsAvecPDF.txt] sont les suivantes :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span>
<span class="normal"><a href="#__codelineno-3-14">14</a></span>
<span class="normal"><a href="#__codelineno-3-15">15</a></span>
<span class="normal"><a href="#__codelineno-3-16">16</a></span>
<span class="normal"><a href="#__codelineno-3-17">17</a></span>
<span class="normal"><a href="#__codelineno-3-18">18</a></span>
<span class="normal"><a href="#__codelineno-3-19">19</a></span>
<span class="normal"><a href="#__codelineno-3-20">20</a></span>
<span class="normal"><a href="#__codelineno-3-21">21</a></span>
<span class="normal"><a href="#__codelineno-3-22">22</a></span>
<span class="normal"><a href="#__codelineno-3-23">23</a></span>
<span class="normal"><a href="#__codelineno-3-24">24</a></span>
<span class="normal"><a href="#__codelineno-3-25">25</a></span>
<span class="normal"><a href="#__codelineno-3-26">26</a></span>
<span class="normal"><a href="#__codelineno-3-27">27</a></span>
<span class="normal"><a href="#__codelineno-3-28">28</a></span>
<span class="normal"><a href="#__codelineno-3-29">29</a></span>
<span class="normal"><a href="#__codelineno-3-30">30</a></span>
<span class="normal"><a href="#__codelineno-3-31">31</a></span>
<span class="normal"><a href="#__codelineno-3-32">32</a></span>
<span class="normal"><a href="#__codelineno-3-33">33</a></span>
<span class="normal"><a href="#__codelineno-3-34">34</a></span>
<span class="normal"><a href="#__codelineno-3-35">35</a></span>
<span class="normal"><a href="#__codelineno-3-36">36</a></span>
<span class="normal"><a href="#__codelineno-3-37">37</a></span>
<span class="normal"><a href="#__codelineno-3-38">38</a></span>
<span class="normal"><a href="#__codelineno-3-39">39</a></span>
<span class="normal"><a href="#__codelineno-3-40">40</a></span>
<span class="normal"><a href="#__codelineno-3-41">41</a></span>
<span class="normal"><a href="#__codelineno-3-42">42</a></span>
<span class="normal"><a href="#__codelineno-3-43">43</a></span>
<span class="normal"><a href="#__codelineno-3-44">44</a></span>
<span class="normal"><a href="#__codelineno-3-45">45</a></span>
<span class="normal"><a href="#__codelineno-3-46">46</a></span>
<span class="normal"><a href="#__codelineno-3-47">47</a></span>
<span class="normal"><a href="#__codelineno-3-48">48</a></span>
<span class="normal"><a href="#__codelineno-3-49">49</a></span>
<span class="normal"><a href="#__codelineno-3-50">50</a></span>
<span class="normal"><a href="#__codelineno-3-51">51</a></span>
<span class="normal"><a href="#__codelineno-3-52">52</a></span>
<span class="normal"><a href="#__codelineno-3-53">53</a></span>
<span class="normal"><a href="#__codelineno-3-54">54</a></span>
<span class="normal"><a href="#__codelineno-3-55">55</a></span>
<span class="normal"><a href="#__codelineno-3-56">56</a></span>
<span class="normal"><a href="#__codelineno-3-57">57</a></span>
<span class="normal"><a href="#__codelineno-3-58">58</a></span>
<span class="normal"><a href="#__codelineno-3-59">59</a></span>
<span class="normal"><a href="#__codelineno-3-60">60</a></span>
<span class="normal"><a href="#__codelineno-3-61">61</a></span>
<span class="normal"><a href="#__codelineno-3-62">62</a></span>
<span class="normal"><a href="#__codelineno-3-63">63</a></span>
<span class="normal"><a href="#__codelineno-3-64">64</a></span>
<span class="normal"><a href="#__codelineno-3-65">65</a></span>
<span class="normal"><a href="#__codelineno-3-66">66</a></span>
<span class="normal"><a href="#__codelineno-3-67">67</a></span>
<span class="normal"><a href="#__codelineno-3-68">68</a></span>
<span class="normal"><a href="#__codelineno-3-69">69</a></span>
<span class="normal"><a href="#__codelineno-3-70">70</a></span>
<span class="normal"><a href="#__codelineno-3-71">71</a></span>
<span class="normal"><a href="#__codelineno-3-72">72</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="mi">1</span> <span class="o">-</span> <span class="n">Exprime</span><span class="o">-</span><span class="n">toi</span> <span class="n">en</span> <span class="n">français</span><span class="o">.</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="mi">2</span> <span class="o">-</span> <span class="n">Peux</span><span class="o">-</span><span class="n">tu</span> <span class="n">générer</span> <span class="n">un</span> <span class="n">script</span> <span class="n">Python</span> <span class="n">permettant</span> <span class="n">de</span> <span class="n">calculer</span> <span class="n">l</span><span class="s1">&#39;impôt payé par les familles en 2019 sur leurs revenus de 2018.</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="mi">3</span> <span class="o">-</span> <span class="n">Tu</span> <span class="n">t</span><span class="s1">&#39;aideras du document PDF que j&#39;</span><span class="n">ai</span> <span class="n">joint</span> <span class="n">et</span> <span class="n">qui</span> <span class="n">explique</span> <span class="n">les</span> <span class="n">calculs</span> <span class="n">à</span> <span class="n">faire</span><span class="o">.</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="mi">4</span> <span class="o">-</span> <span class="n">Tu</span> <span class="n">dois</span> <span class="n">faire</span> <span class="n">attention</span> <span class="n">aux</span> <span class="n">points</span> <span class="n">suivants</span> <span class="p">:</span>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="o">-</span> <span class="n">plafonnement</span> <span class="n">du</span> <span class="n">quotient</span> <span class="n">familial</span><span class="o">.</span> <span class="n">Il</span> <span class="n">y</span> <span class="n">a</span> <span class="n">des</span> <span class="n">seuils</span> <span class="n">à</span> <span class="n">vérifier</span><span class="o">.</span>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="o">-</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">la</span> <span class="n">décote</span> <span class="n">dans</span> <span class="n">certains</span> <span class="n">cas</span><span class="o">.</span> <span class="n">Il</span> <span class="n">y</span> <span class="n">a</span> <span class="n">des</span> <span class="n">seuils</span> <span class="n">à</span> <span class="n">vérifier</span><span class="o">.</span>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="o">-</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">la</span> <span class="n">réduction</span> <span class="n">de</span> <span class="mi">20</span><span class="o">%</span> <span class="n">dans</span> <span class="n">certains</span> <span class="n">cas</span><span class="o">.</span> <span class="n">Il</span> <span class="n">y</span> <span class="n">a</span> <span class="n">des</span> <span class="n">seuils</span> <span class="n">à</span> <span class="n">vérifier</span><span class="o">.</span>
<a id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="o">-</span> <span class="n">plafonnement</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;abattement de 10</span><span class="si">% s</span><span class="s1">ur les revenus annuels dans certains cas.</span>
<a id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="o">-</span> <span class="n">tu</span> <span class="n">considèreras</span> <span class="n">que</span> <span class="n">tous</span> <span class="n">les</span> <span class="n">revenus</span> <span class="n">sont</span> <span class="n">à</span> <span class="n">déclarer</span> <span class="n">pour</span> <span class="n">le</span> <span class="n">déclarant</span> <span class="mi">1</span> <span class="n">même</span> <span class="n">si</span> <span class="n">le</span> <span class="n">couple</span> <span class="n">est</span> <span class="n">marié</span><span class="o">.</span>
<a id="__codelineno-3-14" name="__codelineno-3-14"></a>
<a id="__codelineno-3-15" name="__codelineno-3-15"></a><span class="mi">5</span> <span class="o">-</span> <span class="n">Tu</span> <span class="n">ajouteras</span> <span class="n">au</span> <span class="n">script</span> <span class="n">généré</span> <span class="n">des</span> <span class="n">tests</span> <span class="n">unitaires</span> <span class="n">pour</span> <span class="n">les</span> <span class="n">cas</span> <span class="n">suivants</span><span class="o">.</span>
<a id="__codelineno-3-16" name="__codelineno-3-16"></a>
<a id="__codelineno-3-17" name="__codelineno-3-17"></a><span class="n">Dans</span> <span class="n">ces</span> <span class="n">tests</span> <span class="n">on</span> <span class="n">appelle</span> <span class="p">:</span>
<a id="__codelineno-3-18" name="__codelineno-3-18"></a>
<a id="__codelineno-3-19" name="__codelineno-3-19"></a><span class="n">adultes</span> <span class="p">:</span><span class="n">nombre</span> <span class="n">d</span><span class="s1">&#39;adultes du foyer fiscal</span>
<a id="__codelineno-3-20" name="__codelineno-3-20"></a><span class="n">enfants</span> <span class="p">:</span> <span class="n">nombre</span> <span class="n">d</span><span class="s1">&#39;enfants du foyer fiscal</span>
<a id="__codelineno-3-21" name="__codelineno-3-21"></a><span class="n">revenus</span> <span class="p">:</span> <span class="n">revenus</span> <span class="n">nets</span> <span class="n">annuels</span> <span class="n">avant</span> <span class="n">impôt</span><span class="p">,</span> <span class="n">ç</span><span class="o">-</span><span class="n">à</span><span class="o">-</span><span class="n">d</span> <span class="n">avant</span> <span class="n">le</span> <span class="mi">1</span><span class="n">er</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;abattement.</span>
<a id="__codelineno-3-22" name="__codelineno-3-22"></a><span class="n">impot</span> <span class="p">:</span> <span class="n">l</span><span class="s1">&#39;impôt à payer</span>
<a id="__codelineno-3-23" name="__codelineno-3-23"></a><span class="n">decote</span> <span class="p">:</span><span class="n">la</span> <span class="n">décote</span> <span class="n">éventuelle</span> <span class="n">du</span> <span class="n">foyer</span> <span class="n">fiscal</span>
<a id="__codelineno-3-24" name="__codelineno-3-24"></a><span class="n">reduction</span> <span class="p">:</span> <span class="n">la</span> <span class="n">réduction</span> <span class="n">de</span> <span class="mi">20</span><span class="o">%</span> <span class="n">pour</span> <span class="n">les</span> <span class="n">faibles</span> <span class="n">revenus</span>
<a id="__codelineno-3-25" name="__codelineno-3-25"></a>
<a id="__codelineno-3-26" name="__codelineno-3-26"></a><span class="n">Voici</span> <span class="n">les</span> <span class="mi">11</span> <span class="n">tests</span> <span class="n">à</span> <span class="n">vérifier</span><span class="o">.</span> <span class="n">Ils</span> <span class="n">ont</span> <span class="n">tous</span> <span class="n">été</span> <span class="n">vérifiés</span> <span class="n">manuellement</span> <span class="n">sur</span> <span class="n">le</span> <span class="n">simulateur</span> <span class="n">officiel</span>
<a id="__codelineno-3-27" name="__codelineno-3-27"></a><span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt 2019 [https://www3.impots.gouv.fr/simulateur/calcul_impot/2019/simplifie/index.html].</span>
<a id="__codelineno-3-28" name="__codelineno-3-28"></a><span class="n">Si</span> <span class="n">tu</span> <span class="n">utilises</span> <span class="n">ce</span> <span class="n">simulateur</span> <span class="n">les</span> <span class="n">revenus</span> <span class="n">doivent</span> <span class="n">être</span> <span class="n">associés</span> <span class="n">au</span> <span class="n">seul</span> <span class="n">déclarant</span> <span class="mi">1</span> <span class="n">dans</span> <span class="n">le</span> <span class="n">cas</span> <span class="n">d</span><span class="s1">&#39;un couple, le déclarant 2 étant alors ignoré. Lorsqu&#39;</span><span class="n">on</span> <span class="n">répartit</span> <span class="n">les</span> <span class="n">revenus</span>
<a id="__codelineno-3-29" name="__codelineno-3-29"></a><span class="n">sur</span> <span class="n">deux</span> <span class="n">déclarants</span><span class="p">,</span> <span class="n">on</span> <span class="n">n</span><span class="s1">&#39;obtient pas le même résultat.</span>
<a id="__codelineno-3-30" name="__codelineno-3-30"></a>
<a id="__codelineno-3-31" name="__codelineno-3-31"></a><span class="n">On</span> <span class="n">utilise</span> <span class="n">la</span> <span class="n">syntaxe</span> <span class="p">(</span><span class="n">adultes</span><span class="p">,</span> <span class="n">enfants</span><span class="p">,</span> <span class="n">revenus</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">impot</span><span class="p">,</span> <span class="n">decote</span><span class="p">,</span> <span class="n">reduction</span><span class="p">)</span> <span class="n">pour</span> <span class="n">dire</span> <span class="n">que</span> <span class="n">le</span> <span class="n">script</span> <span class="n">reçoit</span> <span class="n">les</span> <span class="n">entrées</span>
<a id="__codelineno-3-32" name="__codelineno-3-32"></a><span class="p">(</span><span class="n">adultes</span><span class="p">,</span> <span class="n">enfants</span><span class="p">,</span> <span class="n">revenus</span><span class="p">)</span> <span class="n">et</span> <span class="n">produit</span> <span class="n">les</span> <span class="n">résultats</span> <span class="p">(</span><span class="n">impot</span><span class="p">,</span> <span class="n">decote</span><span class="p">,</span> <span class="n">reduction</span><span class="p">)</span>
<a id="__codelineno-3-33" name="__codelineno-3-33"></a>
<a id="__codelineno-3-34" name="__codelineno-3-34"></a><span class="n">test1</span> <span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">55555</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="mi">2815</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-3-35" name="__codelineno-3-35"></a><span class="n">test2</span> <span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">50000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="mi">1385</span><span class="p">,</span> <span class="mi">384</span><span class="p">,</span> <span class="mi">346</span><span class="p">)</span>
<a id="__codelineno-3-36" name="__codelineno-3-36"></a><span class="n">test3</span> <span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">50000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">720</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-3-37" name="__codelineno-3-37"></a><span class="n">test4</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">100000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="mi">19884</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-3-38" name="__codelineno-3-38"></a><span class="n">test5</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">100000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="mi">16782</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-3-39" name="__codelineno-3-39"></a><span class="n">test6</span> <span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">100000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="mi">9200</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-3-40" name="__codelineno-3-40"></a><span class="n">test7</span> <span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">100000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="mi">4230</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-3-41" name="__codelineno-3-41"></a><span class="n">test8</span> <span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="mi">22986</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-3-42" name="__codelineno-3-42"></a><span class="n">test9</span> <span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">30000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-3-43" name="__codelineno-3-43"></a><span class="n">test10</span> <span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">200000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="mi">64211</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-3-44" name="__codelineno-3-44"></a><span class="n">test11</span>  <span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">200000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="mi">42843</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-3-45" name="__codelineno-3-45"></a>
<a id="__codelineno-3-46" name="__codelineno-3-46"></a><span class="mi">6</span> <span class="o">-</span> <span class="n">Il</span> <span class="n">peut</span> <span class="n">y</span> <span class="n">avoir</span> <span class="n">des</span> <span class="n">problèmes</span> <span class="n">d</span><span class="s1">&#39;arrondis. Tu procèderas comme suit</span>
<a id="__codelineno-3-47" name="__codelineno-3-47"></a><span class="o">-</span> <span class="n">l</span><span class="s1">&#39;impôt à payer sera arrondi à l&#39;</span><span class="n">euro</span> <span class="n">inférieur</span><span class="p">,</span>
<a id="__codelineno-3-48" name="__codelineno-3-48"></a><span class="o">-</span> <span class="n">la</span> <span class="n">décote</span> <span class="n">sera</span> <span class="n">arrondie</span> <span class="n">à</span> <span class="n">l</span><span class="s1">&#39;euro supérieur,</span>
<a id="__codelineno-3-49" name="__codelineno-3-49"></a><span class="o">-</span> <span class="n">la</span> <span class="n">réduction</span> <span class="n">de</span> <span class="mi">20</span> <span class="o">%</span> <span class="n">sera</span> <span class="n">arrondie</span> <span class="n">à</span> <span class="n">l</span><span class="s1">&#39;euro supérieur.</span>
<a id="__codelineno-3-50" name="__codelineno-3-50"></a><span class="o">-</span> <span class="n">l</span><span class="s1">&#39;abattement de 10</span><span class="si">% s</span><span class="s1">era arrondi à l&#39;</span><span class="n">euro</span> <span class="n">supérieur</span>
<a id="__codelineno-3-51" name="__codelineno-3-51"></a>
<a id="__codelineno-3-52" name="__codelineno-3-52"></a><span class="n">Fais</span> <span class="n">tous</span> <span class="n">les</span> <span class="n">tests</span> <span class="n">unitaires</span> <span class="n">à</span> <span class="n">l</span><span class="s1">&#39;euro près à cause de ces éventuelles erreurs d&#39;</span><span class="n">arrondi</span><span class="o">.</span>
<a id="__codelineno-3-53" name="__codelineno-3-53"></a><span class="n">Ne</span> <span class="n">cherche</span> <span class="n">pas</span> <span class="n">à</span> <span class="n">avoir</span> <span class="n">les</span> <span class="n">valeurs</span> <span class="n">exactes</span> <span class="n">ci</span><span class="o">-</span><span class="n">dessus</span> <span class="n">mais</span> <span class="n">ces</span> <span class="n">valeurs</span> <span class="n">à</span> <span class="mi">1</span> <span class="n">euro</span> <span class="n">près</span><span class="o">.</span>
<a id="__codelineno-3-54" name="__codelineno-3-54"></a>
<a id="__codelineno-3-55" name="__codelineno-3-55"></a><span class="mi">7</span> <span class="o">-</span> <span class="n">Evite</span> <span class="n">de</span> <span class="n">chercher</span> <span class="n">sur</span> <span class="n">internet</span><span class="o">.</span> <span class="n">Le</span> <span class="n">PDF</span> <span class="n">que</span> <span class="n">je</span> <span class="n">te</span> <span class="n">donne</span> <span class="n">est</span> <span class="n">correct</span><span class="o">.</span>
<a id="__codelineno-3-56" name="__codelineno-3-56"></a><span class="n">Ne</span> <span class="n">donne</span> <span class="n">ton</span> <span class="n">résultat</span> <span class="n">que</span> <span class="n">lorsque</span> <span class="n">tu</span> <span class="k">as</span> <span class="n">passé</span> <span class="n">les</span> <span class="mi">11</span> <span class="n">tests</span> <span class="n">unitaires</span> <span class="n">avec</span> <span class="n">succès</span><span class="o">.</span>
<a id="__codelineno-3-57" name="__codelineno-3-57"></a>
<a id="__codelineno-3-58" name="__codelineno-3-58"></a><span class="mi">8</span> <span class="o">-</span> <span class="n">si</span> <span class="n">l</span><span class="s1">&#39;un des tests échoue et que tu es bloqué, affiche ton raisonnement pour ce test</span>
<a id="__codelineno-3-59" name="__codelineno-3-59"></a><span class="n">afin</span> <span class="n">que</span> <span class="n">je</span> <span class="n">puisse</span> <span class="n">t</span><span class="s1">&#39;aider.</span>
<a id="__codelineno-3-60" name="__codelineno-3-60"></a>
<a id="__codelineno-3-61" name="__codelineno-3-61"></a><span class="mi">9</span><span class="o">-</span> <span class="n">Mets</span> <span class="n">des</span> <span class="n">commentaires</span> <span class="n">détaillés</span> <span class="n">dans</span> <span class="n">le</span> <span class="n">script</span> <span class="n">que</span> <span class="n">tu</span> <span class="n">génères</span><span class="o">.</span>
<a id="__codelineno-3-62" name="__codelineno-3-62"></a><span class="n">Mets</span> <span class="n">le</span> <span class="n">barème</span> <span class="n">progressif</span> <span class="n">dans</span> <span class="n">une</span> <span class="n">liste</span> <span class="n">ou</span> <span class="n">dictionnaire</span> <span class="n">puis</span> <span class="n">utilise</span> <span class="n">cette</span> <span class="n">liste</span> <span class="n">ou</span> <span class="n">dictionnaire</span>
<a id="__codelineno-3-63" name="__codelineno-3-63"></a><span class="n">Mets</span> <span class="n">les</span> <span class="n">nombres</span> <span class="n">en</span> <span class="n">dur</span> <span class="p">(</span><span class="n">nombres</span> <span class="n">magiques</span><span class="p">)</span> <span class="n">que</span> <span class="n">tu</span> <span class="n">utilises</span> <span class="n">dans</span> <span class="n">des</span> <span class="n">constantes</span>
<a id="__codelineno-3-64" name="__codelineno-3-64"></a><span class="n">Utilise</span> <span class="n">des</span> <span class="n">fonctions</span> <span class="n">pour</span> <span class="n">séparer</span> <span class="n">les</span> <span class="n">étapes</span> <span class="n">du</span> <span class="n">calcul</span><span class="o">.</span>
<a id="__codelineno-3-65" name="__codelineno-3-65"></a><span class="n">Ecris</span> <span class="n">le</span> <span class="n">tout</span> <span class="n">en</span> <span class="n">français</span>
<a id="__codelineno-3-66" name="__codelineno-3-66"></a>
<a id="__codelineno-3-67" name="__codelineno-3-67"></a><span class="mi">9</span> <span class="o">-</span> <span class="n">n</span><span class="s1">&#39;affiche pas le code généré à l&#39;</span><span class="n">écran</span><span class="o">.</span> <span class="n">Donne</span><span class="o">-</span><span class="n">moi</span> <span class="n">simplement</span> <span class="n">un</span> <span class="n">lien</span> <span class="n">pour</span> <span class="n">le</span> <span class="n">récupérer</span><span class="o">.</span>
<a id="__codelineno-3-68" name="__codelineno-3-68"></a><span class="n">Si</span> <span class="n">les</span> <span class="n">tests</span> <span class="n">unitaires</span> <span class="n">échouent</span><span class="p">,</span> <span class="n">je</span> <span class="n">te</span> <span class="n">donnerai</span> <span class="n">les</span> <span class="n">logs</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;exécution du script pour que</span>
<a id="__codelineno-3-69" name="__codelineno-3-69"></a><span class="n">tu</span> <span class="n">voies</span> <span class="n">tes</span> <span class="n">erreurs</span><span class="o">.</span>
<a id="__codelineno-3-70" name="__codelineno-3-70"></a>
<a id="__codelineno-3-71" name="__codelineno-3-71"></a><span class="mi">10</span> <span class="o">-</span> <span class="n">si</span> <span class="n">c</span><span class="s1">&#39;est possible, indique le temps en minutes et secondes que tu as mis pour produire</span>
<a id="__codelineno-3-72" name="__codelineno-3-72"></a><span class="n">le</span> <span class="n">script</span> <span class="n">demandé</span><span class="o">.</span>
</code></pre></div></td></tr></table></div>
<p>Ces instructions sont le résultat de très nombreuses questions posées à Gemini. Assez rapidement, on se rend compte que l’IA doit être très cadrée si on veut obtenir ce qu’on veut. C’est à cause de tous ces tâtonnements que la session Gemini était finalement stoppée pour dépassement de limites. Examinons la suite de ces instructions :</p>
<ul>
<li>Ligne 1 : on demande que la conversation soit en français. Cette indication est pour DeepSeek qui avait tendance à parler anglais ;</li>
<li>Ligne 3 : ce qu’on veut ;</li>
<li>Ligne 5 : on dit à l’IA d’utiliser le PDF qu’on lui a donné ;</li>
<li>Lignes 7-14 : un certain nombre de conseils utiles surtout pour le problème 3 sans PDF. Plusieurs IA se sont perdues dans le calcul de l’impôt ;</li>
<li>Lignes 15-44 : les 11 tests unitaires que l’on veut voir inclus dans le script généré. Lorsque le script sera généré, on l’exécutera dans PyCharm et on verra bien si les 11 tests passent ;</li>
<li>Lignes 46-53 : sans ces instructions, les IA généraient des tests unitaires cherchant des résultats exacts qui échouaient ;</li>
<li>Lignes 55-56 : je dis à l’IA de ne pas aller sur internet. La solution la plus simple est d’utiliser le PDF ;</li>
<li>Lignes 58-59 : cette instruction n’a pas été suivie par les IA. J’ai été obligé de l’écrire explicitement dans une question, lorsque je constatais qu’un test avait échoué ;</li>
<li>Lignes 61-65 : j’indique quel type de script Python je souhaite ;</li>
<li>Lignes 67-69 : j’aurais préféré un lien pour récupérer le script généré car l’affichage du code à l’écran prend du temps. Il s’est avéré que la plupart des IA ne savent pas faire cela. Les liens donnés ne marchaient pas ;</li>
<li>Lignes 71-72 : j’aurais aimé avoir le temps passé par l’IA pour répondre à la question. Seule Gemini a pu me donner ce renseignement. Les autres IA soit ne répondaient pas à cette instruction, soit donnaient des chiffres fantaisistes montrant qu’elles ne comprenaient pas cette instruction ;</li>
</ul>
<h3 id="433-la-reponse-de-gemini">4.3.3. La réponse de Gemini</h3>
<p>La première réponse de Gemini est la suivante :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000060E000002A6639786EB.png" style="display:inline-block; margin:4px;width:12.3cm;height:5.38cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<ul>
<li>En [1-4], Gemini fournit des liens sur la partie du PDF ou du fichier texte des instructions qu’il utilise à un moment donné ;
La suite est la suivante :</li>
</ul>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005B7000003A022E83FC3.png" style="display:inline-block; margin:4px;width:11.569cm;height:7.34cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<ul>
<li>En [1], Gemini affirme qu’il a exécuté les 11 tests unitaires avec succès. La plupart des IA ont affirmé cela aussi bien sur le problème 2 que le problème 3 et souvent lorsqu’on chargeait le script généré ça ne marchait pas. Il faut donc se méfier de cette affirmation. Pour Gemini cela va s’avérer vrai ; </li>
<li>En [2], un lien qui s’avérera ne pas marcher ;</li>
<li>En [3 seule Gemini a donné un temps d’exécution réaliste ;
Donc le lien [2] ne marche pas. On le dit à Gemini :</li>
</ul>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000408000000E183B39731.png" style="display:inline-block; margin:4px;width:8.209cm;height:1.79cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>La réponse de Gemini :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005FE000002D8C30E662C.png" style="display:inline-block; margin:4px;width:12.16cm;height:5.77cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<ul>
<li>En [1], le script Python généré par Gemini ;
On charge ce script dans PyCharm et on l’exécute :</li>
</ul>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000001DC0000024C4F5FDCC9.png" style="display:inline-block; margin:4px;width:3.78cm;height:4.671cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<ul>
<li>En [1], [gemini1] est le script généré par Gemini ;
A l’exécution du script apparaissent des erreurs de compilation :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span>
<span class="normal"><a href="#__codelineno-4-17">17</a></span>
<span class="normal"><a href="#__codelineno-4-18">18</a></span>
<span class="normal"><a href="#__codelineno-4-19">19</a></span>
<span class="normal"><a href="#__codelineno-4-20">20</a></span>
<span class="normal"><a href="#__codelineno-4-21">21</a></span>
<span class="normal"><a href="#__codelineno-4-22">22</a></span>
<span class="normal"><a href="#__codelineno-4-23">23</a></span>
<span class="normal"><a href="#__codelineno-4-24">24</a></span>
<span class="normal"><a href="#__codelineno-4-25">25</a></span>
<span class="normal"><a href="#__codelineno-4-26">26</a></span>
<span class="normal"><a href="#__codelineno-4-27">27</a></span>
<span class="normal"><a href="#__codelineno-4-28">28</a></span>
<span class="normal"><a href="#__codelineno-4-29">29</a></span>
<span class="normal"><a href="#__codelineno-4-30">30</a></span>
<span class="normal"><a href="#__codelineno-4-31">31</a></span>
<span class="normal"><a href="#__codelineno-4-32">32</a></span>
<span class="normal"><a href="#__codelineno-4-33">33</a></span>
<span class="normal"><a href="#__codelineno-4-34">34</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="s2">&quot;C:\Program Files\Python313\python.exe&quot;</span> <span class="s2">&quot;C:/Program Files/JetBrains/PyCharm 2025.2.0.1/plugins/python-ce/helpers/pycharm/_jb_unittest_runner.py&quot;</span> <span class="o">--</span><span class="n">path</span> <span class="s2">&quot;C:\Data\st-2025\dev\python\code\python-flask-2025-cours\outils ia\chatGPT\chatGPT1.py&quot;</span> 
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="n">Testing</span> <span class="n">started</span> <span class="n">at</span> <span class="mi">17</span><span class="p">:</span><span class="mi">12</span> <span class="o">...</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="n">Launching</span> <span class="n">unittests</span> <span class="k">with</span> <span class="n">arguments</span> <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">unittest</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2025</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">code</span>\<span class="n">python</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="n">cours</span>\<span class="n">outils</span> <span class="n">ia</span>\<span class="n">chatGPT</span>\<span class="n">chatGPT1</span><span class="o">.</span><span class="n">py</span> <span class="ow">in</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2025</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">code</span>\<span class="n">python</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="n">cours</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a>  <span class="n">File</span> <span class="s2">&quot;C:\Program Files\JetBrains\PyCharm 2025.2.0.1\plugins\python-ce\helpers\pycharm\_jb_unittest_runner.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">38</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">main</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">testRunner</span><span class="o">=</span><span class="n">unittestpy</span><span class="o">.</span><span class="n">TeamcityTestRunner</span><span class="p">,</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a>             <span class="o">~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a>                  <span class="n">buffer</span><span class="o">=</span><span class="ow">not</span> <span class="n">JB_DISABLE_BUFFERING</span><span class="p">))</span>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a>                  <span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a>  <span class="n">File</span> <span class="s2">&quot;C:\Program Files\Python313\Lib\unittest\main.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">103</span><span class="p">,</span> <span class="ow">in</span> <span class="fm">__init__</span>
<a id="__codelineno-4-12" name="__codelineno-4-12"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">parseArgs</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
<a id="__codelineno-4-13" name="__codelineno-4-13"></a>    <span class="o">~~~~~~~~~~~~~~^^^^^^</span>
<a id="__codelineno-4-14" name="__codelineno-4-14"></a>  <span class="n">File</span> <span class="s2">&quot;C:\Program Files\Python313\Lib\unittest\main.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">142</span><span class="p">,</span> <span class="ow">in</span> <span class="n">parseArgs</span>
<a id="__codelineno-4-15" name="__codelineno-4-15"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">createTests</span><span class="p">()</span>
<a id="__codelineno-4-16" name="__codelineno-4-16"></a>    <span class="o">~~~~~~~~~~~~~~~~^^</span>
<a id="__codelineno-4-17" name="__codelineno-4-17"></a>  <span class="n">File</span> <span class="s2">&quot;C:\Program Files\Python313\Lib\unittest\main.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">153</span><span class="p">,</span> <span class="ow">in</span> <span class="n">createTests</span>
<a id="__codelineno-4-18" name="__codelineno-4-18"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testLoader</span><span class="o">.</span><span class="n">loadTestsFromNames</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testNames</span><span class="p">,</span>
<a id="__codelineno-4-19" name="__codelineno-4-19"></a>                <span class="o">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^</span>
<a id="__codelineno-4-20" name="__codelineno-4-20"></a>                                                   <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">)</span>
<a id="__codelineno-4-21" name="__codelineno-4-21"></a>                                                   <span class="o">^^^^^^^^^^^^</span>
<a id="__codelineno-4-22" name="__codelineno-4-22"></a>  <span class="n">File</span> <span class="s2">&quot;C:\Program Files\Python313\Lib\unittest\loader.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">207</span><span class="p">,</span> <span class="ow">in</span> <span class="n">loadTestsFromNames</span>
<a id="__codelineno-4-23" name="__codelineno-4-23"></a>    <span class="n">suites</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">loadTestsFromName</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">module</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>
<a id="__codelineno-4-24" name="__codelineno-4-24"></a>              <span class="o">~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^</span>
<a id="__codelineno-4-25" name="__codelineno-4-25"></a>  <span class="n">File</span> <span class="s2">&quot;C:\Program Files\Python313\Lib\unittest\loader.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">137</span><span class="p">,</span> <span class="ow">in</span> <span class="n">loadTestsFromName</span>
<a id="__codelineno-4-26" name="__codelineno-4-26"></a>    <span class="n">module</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>
<a id="__codelineno-4-27" name="__codelineno-4-27"></a>  <span class="n">File</span> <span class="s2">&quot;C:\Data\st-2025\dev\python\code\python-flask-2025-cours\outils ia\chatGPT\chatGPT1.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">28</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<a id="__codelineno-4-28" name="__codelineno-4-28"></a>    <span class="p">[</span><span class="n">cite_start</span><span class="p">]</span>
<a id="__codelineno-4-29" name="__codelineno-4-29"></a>     <span class="o">^^^^^^^^^^</span>
<a id="__codelineno-4-30" name="__codelineno-4-30"></a><span class="ne">NameError</span><span class="p">:</span> <span class="n">name</span> <span class="s1">&#39;cite_start&#39;</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">defined</span>
<a id="__codelineno-4-31" name="__codelineno-4-31"></a>
<a id="__codelineno-4-32" name="__codelineno-4-32"></a><span class="n">Process</span> <span class="n">finished</span> <span class="k">with</span> <span class="n">exit</span> <span class="n">code</span> <span class="mi">1</span>
<a id="__codelineno-4-33" name="__codelineno-4-33"></a>
<a id="__codelineno-4-34" name="__codelineno-4-34"></a><span class="n">Empty</span> <span class="n">suite</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>Ligne 30, l’erreur de compilation. [cite_start] est un marqueur pour générer une certaine forme de texte ;
On met les logs ci-dessus dans un fichier [logs gemini1.txt] et on donne celui-ci à Gemini :</li>
</ul>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000003930000019E2A3CFA50.png" style="display:inline-block; margin:4px;width:7.271cm;height:3.29cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>La réponse de Gemini est alors la suivante :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005D40000026D86628674.png" style="display:inline-block; margin:4px;width:11.85cm;height:4.93cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Chargé dans PyCharm, l’exécution du nouveau script génère exactement la même erreur. On le dit à Gemini en lui fournissant de nouveau les logs de l’exécution :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000002E30000014900C5CF2E.png" style="display:inline-block; margin:4px;width:5.86cm;height:2.611cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>La réponse de Gemini est la suivante :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000006090000030112645E4F.png" style="display:inline-block; margin:4px;width:12.321cm;height:6.13cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Cette fois c’est bon. Les 11 tests unitaires sont réussis. On le dit à Gemini :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000019D00000098B8DAB429.png" style="display:inline-block; margin:4px;width:3.29cm;height:1.21cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Qui répond :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005D80000019E8E44FCFE.png" style="display:inline-block; margin:4px;width:11.85cm;height:3.281cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Le script généré par Gemini a suivi les instructions données dans le fichier texte [instructionsAvecPDF.txt] :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">  1</a></span>
<span class="normal"><a href="#__codelineno-5-2">  2</a></span>
<span class="normal"><a href="#__codelineno-5-3">  3</a></span>
<span class="normal"><a href="#__codelineno-5-4">  4</a></span>
<span class="normal"><a href="#__codelineno-5-5">  5</a></span>
<span class="normal"><a href="#__codelineno-5-6">  6</a></span>
<span class="normal"><a href="#__codelineno-5-7">  7</a></span>
<span class="normal"><a href="#__codelineno-5-8">  8</a></span>
<span class="normal"><a href="#__codelineno-5-9">  9</a></span>
<span class="normal"><a href="#__codelineno-5-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-5-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-5-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-5-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-5-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-5-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-5-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-5-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-5-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-5-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-5-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-5-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-5-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-5-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-5-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-5-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-5-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-5-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-5-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-5-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-5-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-5-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-5-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-5-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-5-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-5-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-5-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-5-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-5-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-5-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-5-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-5-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-5-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-5-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-5-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-5-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-5-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-5-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-5-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-5-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-5-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-5-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-5-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-5-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-5-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-5-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-5-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-5-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-5-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-5-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-5-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-5-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-5-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-5-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-5-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-5-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-5-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-5-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-5-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-5-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-5-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-5-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-5-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-5-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-5-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-5-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-5-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-5-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-5-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-5-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-5-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-5-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-5-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-5-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-5-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-5-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-5-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-5-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-5-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-5-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-5-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-5-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-5-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-5-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-5-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-5-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-5-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-5-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-5-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-5-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-5-100">100</a></span>
<span class="normal"><a href="#__codelineno-5-101">101</a></span>
<span class="normal"><a href="#__codelineno-5-102">102</a></span>
<span class="normal"><a href="#__codelineno-5-103">103</a></span>
<span class="normal"><a href="#__codelineno-5-104">104</a></span>
<span class="normal"><a href="#__codelineno-5-105">105</a></span>
<span class="normal"><a href="#__codelineno-5-106">106</a></span>
<span class="normal"><a href="#__codelineno-5-107">107</a></span>
<span class="normal"><a href="#__codelineno-5-108">108</a></span>
<span class="normal"><a href="#__codelineno-5-109">109</a></span>
<span class="normal"><a href="#__codelineno-5-110">110</a></span>
<span class="normal"><a href="#__codelineno-5-111">111</a></span>
<span class="normal"><a href="#__codelineno-5-112">112</a></span>
<span class="normal"><a href="#__codelineno-5-113">113</a></span>
<span class="normal"><a href="#__codelineno-5-114">114</a></span>
<span class="normal"><a href="#__codelineno-5-115">115</a></span>
<span class="normal"><a href="#__codelineno-5-116">116</a></span>
<span class="normal"><a href="#__codelineno-5-117">117</a></span>
<span class="normal"><a href="#__codelineno-5-118">118</a></span>
<span class="normal"><a href="#__codelineno-5-119">119</a></span>
<span class="normal"><a href="#__codelineno-5-120">120</a></span>
<span class="normal"><a href="#__codelineno-5-121">121</a></span>
<span class="normal"><a href="#__codelineno-5-122">122</a></span>
<span class="normal"><a href="#__codelineno-5-123">123</a></span>
<span class="normal"><a href="#__codelineno-5-124">124</a></span>
<span class="normal"><a href="#__codelineno-5-125">125</a></span>
<span class="normal"><a href="#__codelineno-5-126">126</a></span>
<span class="normal"><a href="#__codelineno-5-127">127</a></span>
<span class="normal"><a href="#__codelineno-5-128">128</a></span>
<span class="normal"><a href="#__codelineno-5-129">129</a></span>
<span class="normal"><a href="#__codelineno-5-130">130</a></span>
<span class="normal"><a href="#__codelineno-5-131">131</a></span>
<span class="normal"><a href="#__codelineno-5-132">132</a></span>
<span class="normal"><a href="#__codelineno-5-133">133</a></span>
<span class="normal"><a href="#__codelineno-5-134">134</a></span>
<span class="normal"><a href="#__codelineno-5-135">135</a></span>
<span class="normal"><a href="#__codelineno-5-136">136</a></span>
<span class="normal"><a href="#__codelineno-5-137">137</a></span>
<span class="normal"><a href="#__codelineno-5-138">138</a></span>
<span class="normal"><a href="#__codelineno-5-139">139</a></span>
<span class="normal"><a href="#__codelineno-5-140">140</a></span>
<span class="normal"><a href="#__codelineno-5-141">141</a></span>
<span class="normal"><a href="#__codelineno-5-142">142</a></span>
<span class="normal"><a href="#__codelineno-5-143">143</a></span>
<span class="normal"><a href="#__codelineno-5-144">144</a></span>
<span class="normal"><a href="#__codelineno-5-145">145</a></span>
<span class="normal"><a href="#__codelineno-5-146">146</a></span>
<span class="normal"><a href="#__codelineno-5-147">147</a></span>
<span class="normal"><a href="#__codelineno-5-148">148</a></span>
<span class="normal"><a href="#__codelineno-5-149">149</a></span>
<span class="normal"><a href="#__codelineno-5-150">150</a></span>
<span class="normal"><a href="#__codelineno-5-151">151</a></span>
<span class="normal"><a href="#__codelineno-5-152">152</a></span>
<span class="normal"><a href="#__codelineno-5-153">153</a></span>
<span class="normal"><a href="#__codelineno-5-154">154</a></span>
<span class="normal"><a href="#__codelineno-5-155">155</a></span>
<span class="normal"><a href="#__codelineno-5-156">156</a></span>
<span class="normal"><a href="#__codelineno-5-157">157</a></span>
<span class="normal"><a href="#__codelineno-5-158">158</a></span>
<span class="normal"><a href="#__codelineno-5-159">159</a></span>
<span class="normal"><a href="#__codelineno-5-160">160</a></span>
<span class="normal"><a href="#__codelineno-5-161">161</a></span>
<span class="normal"><a href="#__codelineno-5-162">162</a></span>
<span class="normal"><a href="#__codelineno-5-163">163</a></span>
<span class="normal"><a href="#__codelineno-5-164">164</a></span>
<span class="normal"><a href="#__codelineno-5-165">165</a></span>
<span class="normal"><a href="#__codelineno-5-166">166</a></span>
<span class="normal"><a href="#__codelineno-5-167">167</a></span>
<span class="normal"><a href="#__codelineno-5-168">168</a></span>
<span class="normal"><a href="#__codelineno-5-169">169</a></span>
<span class="normal"><a href="#__codelineno-5-170">170</a></span>
<span class="normal"><a href="#__codelineno-5-171">171</a></span>
<span class="normal"><a href="#__codelineno-5-172">172</a></span>
<span class="normal"><a href="#__codelineno-5-173">173</a></span>
<span class="normal"><a href="#__codelineno-5-174">174</a></span>
<span class="normal"><a href="#__codelineno-5-175">175</a></span>
<span class="normal"><a href="#__codelineno-5-176">176</a></span>
<span class="normal"><a href="#__codelineno-5-177">177</a></span>
<span class="normal"><a href="#__codelineno-5-178">178</a></span>
<span class="normal"><a href="#__codelineno-5-179">179</a></span>
<span class="normal"><a href="#__codelineno-5-180">180</a></span>
<span class="normal"><a href="#__codelineno-5-181">181</a></span>
<span class="normal"><a href="#__codelineno-5-182">182</a></span>
<span class="normal"><a href="#__codelineno-5-183">183</a></span>
<span class="normal"><a href="#__codelineno-5-184">184</a></span>
<span class="normal"><a href="#__codelineno-5-185">185</a></span>
<span class="normal"><a href="#__codelineno-5-186">186</a></span>
<span class="normal"><a href="#__codelineno-5-187">187</a></span>
<span class="normal"><a href="#__codelineno-5-188">188</a></span>
<span class="normal"><a href="#__codelineno-5-189">189</a></span>
<span class="normal"><a href="#__codelineno-5-190">190</a></span>
<span class="normal"><a href="#__codelineno-5-191">191</a></span>
<span class="normal"><a href="#__codelineno-5-192">192</a></span>
<span class="normal"><a href="#__codelineno-5-193">193</a></span>
<span class="normal"><a href="#__codelineno-5-194">194</a></span>
<span class="normal"><a href="#__codelineno-5-195">195</a></span>
<span class="normal"><a href="#__codelineno-5-196">196</a></span>
<span class="normal"><a href="#__codelineno-5-197">197</a></span>
<span class="normal"><a href="#__codelineno-5-198">198</a></span>
<span class="normal"><a href="#__codelineno-5-199">199</a></span>
<span class="normal"><a href="#__codelineno-5-200">200</a></span>
<span class="normal"><a href="#__codelineno-5-201">201</a></span>
<span class="normal"><a href="#__codelineno-5-202">202</a></span>
<span class="normal"><a href="#__codelineno-5-203">203</a></span>
<span class="normal"><a href="#__codelineno-5-204">204</a></span>
<span class="normal"><a href="#__codelineno-5-205">205</a></span>
<span class="normal"><a href="#__codelineno-5-206">206</a></span>
<span class="normal"><a href="#__codelineno-5-207">207</a></span>
<span class="normal"><a href="#__codelineno-5-208">208</a></span>
<span class="normal"><a href="#__codelineno-5-209">209</a></span>
<span class="normal"><a href="#__codelineno-5-210">210</a></span>
<span class="normal"><a href="#__codelineno-5-211">211</a></span>
<span class="normal"><a href="#__codelineno-5-212">212</a></span>
<span class="normal"><a href="#__codelineno-5-213">213</a></span>
<span class="normal"><a href="#__codelineno-5-214">214</a></span>
<span class="normal"><a href="#__codelineno-5-215">215</a></span>
<span class="normal"><a href="#__codelineno-5-216">216</a></span>
<span class="normal"><a href="#__codelineno-5-217">217</a></span>
<span class="normal"><a href="#__codelineno-5-218">218</a></span>
<span class="normal"><a href="#__codelineno-5-219">219</a></span>
<span class="normal"><a href="#__codelineno-5-220">220</a></span>
<span class="normal"><a href="#__codelineno-5-221">221</a></span>
<span class="normal"><a href="#__codelineno-5-222">222</a></span>
<span class="normal"><a href="#__codelineno-5-223">223</a></span>
<span class="normal"><a href="#__codelineno-5-224">224</a></span>
<span class="normal"><a href="#__codelineno-5-225">225</a></span>
<span class="normal"><a href="#__codelineno-5-226">226</a></span>
<span class="normal"><a href="#__codelineno-5-227">227</a></span>
<span class="normal"><a href="#__codelineno-5-228">228</a></span>
<span class="normal"><a href="#__codelineno-5-229">229</a></span>
<span class="normal"><a href="#__codelineno-5-230">230</a></span>
<span class="normal"><a href="#__codelineno-5-231">231</a></span>
<span class="normal"><a href="#__codelineno-5-232">232</a></span>
<span class="normal"><a href="#__codelineno-5-233">233</a></span>
<span class="normal"><a href="#__codelineno-5-234">234</a></span>
<span class="normal"><a href="#__codelineno-5-235">235</a></span>
<span class="normal"><a href="#__codelineno-5-236">236</a></span>
<span class="normal"><a href="#__codelineno-5-237">237</a></span>
<span class="normal"><a href="#__codelineno-5-238">238</a></span>
<span class="normal"><a href="#__codelineno-5-239">239</a></span>
<span class="normal"><a href="#__codelineno-5-240">240</a></span>
<span class="normal"><a href="#__codelineno-5-241">241</a></span>
<span class="normal"><a href="#__codelineno-5-242">242</a></span>
<span class="normal"><a href="#__codelineno-5-243">243</a></span>
<span class="normal"><a href="#__codelineno-5-244">244</a></span>
<span class="normal"><a href="#__codelineno-5-245">245</a></span>
<span class="normal"><a href="#__codelineno-5-246">246</a></span>
<span class="normal"><a href="#__codelineno-5-247">247</a></span>
<span class="normal"><a href="#__codelineno-5-248">248</a></span>
<span class="normal"><a href="#__codelineno-5-249">249</a></span>
<span class="normal"><a href="#__codelineno-5-250">250</a></span>
<span class="normal"><a href="#__codelineno-5-251">251</a></span>
<span class="normal"><a href="#__codelineno-5-252">252</a></span>
<span class="normal"><a href="#__codelineno-5-253">253</a></span>
<span class="normal"><a href="#__codelineno-5-254">254</a></span>
<span class="normal"><a href="#__codelineno-5-255">255</a></span>
<span class="normal"><a href="#__codelineno-5-256">256</a></span>
<span class="normal"><a href="#__codelineno-5-257">257</a></span>
<span class="normal"><a href="#__codelineno-5-258">258</a></span>
<span class="normal"><a href="#__codelineno-5-259">259</a></span>
<span class="normal"><a href="#__codelineno-5-260">260</a></span>
<span class="normal"><a href="#__codelineno-5-261">261</a></span>
<span class="normal"><a href="#__codelineno-5-262">262</a></span>
<span class="normal"><a href="#__codelineno-5-263">263</a></span>
<span class="normal"><a href="#__codelineno-5-264">264</a></span>
<span class="normal"><a href="#__codelineno-5-265">265</a></span>
<span class="normal"><a href="#__codelineno-5-266">266</a></span>
<span class="normal"><a href="#__codelineno-5-267">267</a></span>
<span class="normal"><a href="#__codelineno-5-268">268</a></span>
<span class="normal"><a href="#__codelineno-5-269">269</a></span>
<span class="normal"><a href="#__codelineno-5-270">270</a></span>
<span class="normal"><a href="#__codelineno-5-271">271</a></span>
<span class="normal"><a href="#__codelineno-5-272">272</a></span>
<span class="normal"><a href="#__codelineno-5-273">273</a></span>
<span class="normal"><a href="#__codelineno-5-274">274</a></span>
<span class="normal"><a href="#__codelineno-5-275">275</a></span>
<span class="normal"><a href="#__codelineno-5-276">276</a></span>
<span class="normal"><a href="#__codelineno-5-277">277</a></span>
<span class="normal"><a href="#__codelineno-5-278">278</a></span>
<span class="normal"><a href="#__codelineno-5-279">279</a></span>
<span class="normal"><a href="#__codelineno-5-280">280</a></span>
<span class="normal"><a href="#__codelineno-5-281">281</a></span>
<span class="normal"><a href="#__codelineno-5-282">282</a></span>
<span class="normal"><a href="#__codelineno-5-283">283</a></span>
<span class="normal"><a href="#__codelineno-5-284">284</a></span>
<span class="normal"><a href="#__codelineno-5-285">285</a></span>
<span class="normal"><a href="#__codelineno-5-286">286</a></span>
<span class="normal"><a href="#__codelineno-5-287">287</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="c1"># -*- coding: utf-8 -*-</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="sd">Script pour le calcul de l&#39;impôt 2019 sur les revenus de 2018 en France,</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="sd">basé sur les règles simplifiées fournies dans le document PDF.</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">unittest</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="c1"># --- CONSTANTES DE CALCUL POUR L&#39;IMPÔT 2019 ---</span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="c1"># Toutes les valeurs sont extraites du document PDF fourni.</span>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a>
<a id="__codelineno-5-13" name="__codelineno-5-13"></a><span class="c1"># Plafonds pour l&#39;abattement de 10% sur les revenus annuels</span>
<a id="__codelineno-5-14" name="__codelineno-5-14"></a><span class="n">PLAFOND_ABATTEMENT_10_POURCENT</span> <span class="o">=</span> <span class="mf">12502.0</span>
<a id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="n">MINIMUM_ABATTEMENT_10_POURCENT</span> <span class="o">=</span> <span class="mf">437.0</span>
<a id="__codelineno-5-16" name="__codelineno-5-16"></a>
<a id="__codelineno-5-17" name="__codelineno-5-17"></a><span class="c1"># Barème de l&#39;impôt sur le revenu 2019</span>
<a id="__codelineno-5-18" name="__codelineno-5-18"></a><span class="c1"># Structure: (Seuil maximum de la tranche, Taux d&#39;imposition, Montant à déduire par part)</span>
<a id="__codelineno-5-19" name="__codelineno-5-19"></a><span class="n">BAREME_IMPOT_2019</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-5-20" name="__codelineno-5-20"></a>    <span class="p">{</span><span class="s2">&quot;seuil&quot;</span><span class="p">:</span> <span class="mi">9964</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s2">&quot;deduction_par_part&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
<a id="__codelineno-5-21" name="__codelineno-5-21"></a>    <span class="p">{</span><span class="s2">&quot;seuil&quot;</span><span class="p">:</span> <span class="mi">27519</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">,</span> <span class="s2">&quot;deduction_par_part&quot;</span><span class="p">:</span> <span class="mf">1394.96</span><span class="p">},</span>
<a id="__codelineno-5-22" name="__codelineno-5-22"></a>    <span class="p">{</span><span class="s2">&quot;seuil&quot;</span><span class="p">:</span> <span class="mi">73779</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.30</span><span class="p">,</span> <span class="s2">&quot;deduction_par_part&quot;</span><span class="p">:</span> <span class="mi">5798</span><span class="p">},</span>
<a id="__codelineno-5-23" name="__codelineno-5-23"></a>    <span class="p">{</span><span class="s2">&quot;seuil&quot;</span><span class="p">:</span> <span class="mi">156244</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">,</span> <span class="s2">&quot;deduction_par_part&quot;</span><span class="p">:</span> <span class="mf">13913.69</span><span class="p">},</span>
<a id="__codelineno-5-24" name="__codelineno-5-24"></a>    <span class="p">{</span><span class="s2">&quot;seuil&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">),</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.45</span><span class="p">,</span> <span class="s2">&quot;deduction_par_part&quot;</span><span class="p">:</span> <span class="mf">20163.45</span><span class="p">}</span>
<a id="__codelineno-5-25" name="__codelineno-5-25"></a><span class="p">]</span>
<a id="__codelineno-5-26" name="__codelineno-5-26"></a>
<a id="__codelineno-5-27" name="__codelineno-5-27"></a><span class="c1"># Plafonnement du quotient familial</span>
<a id="__codelineno-5-28" name="__codelineno-5-28"></a><span class="n">GAIN_MAX_DEMI_PART</span> <span class="o">=</span> <span class="mf">1551.0</span>  <span class="c1"># Gain maximal par demi-part supplémentaire</span>
<a id="__codelineno-5-29" name="__codelineno-5-29"></a>
<a id="__codelineno-5-30" name="__codelineno-5-30"></a><span class="c1"># Seuils et montants pour la décote</span>
<a id="__codelineno-5-31" name="__codelineno-5-31"></a><span class="n">SEUIL_APPLICATION_DECOTE</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;celibataire&quot;</span><span class="p">:</span> <span class="mf">1595.0</span><span class="p">,</span> <span class="s2">&quot;couple&quot;</span><span class="p">:</span> <span class="mf">2627.0</span><span class="p">}</span>
<a id="__codelineno-5-32" name="__codelineno-5-32"></a><span class="n">SEUIL_CALCUL_DECOTE</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;celibataire&quot;</span><span class="p">:</span> <span class="mf">1196.0</span><span class="p">,</span> <span class="s2">&quot;couple&quot;</span><span class="p">:</span> <span class="mf">1970.0</span><span class="p">}</span>
<a id="__codelineno-5-33" name="__codelineno-5-33"></a>
<a id="__codelineno-5-34" name="__codelineno-5-34"></a><span class="c1"># Seuils pour la réduction d&#39;impôt de 20%</span>
<a id="__codelineno-5-35" name="__codelineno-5-35"></a><span class="n">SEUIL_BASE_REDUCTION_20</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;celibataire&quot;</span><span class="p">:</span> <span class="mf">21037.0</span><span class="p">,</span> <span class="s2">&quot;couple&quot;</span><span class="p">:</span> <span class="mf">42074.0</span><span class="p">}</span>
<a id="__codelineno-5-36" name="__codelineno-5-36"></a><span class="n">MAJORATION_SEUIL_REDUCTION_PAR_DEMI_PART</span> <span class="o">=</span> <span class="mf">3797.0</span>
<a id="__codelineno-5-37" name="__codelineno-5-37"></a>
<a id="__codelineno-5-38" name="__codelineno-5-38"></a>
<a id="__codelineno-5-39" name="__codelineno-5-39"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculer_nombre_parts</span><span class="p">(</span><span class="n">adultes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">enfants</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-5-40" name="__codelineno-5-40"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-5-41" name="__codelineno-5-41"></a><span class="sd">    Calcule le nombre de parts fiscales du foyer.</span>
<a id="__codelineno-5-42" name="__codelineno-5-42"></a><span class="sd">    - Chaque parent amène 1 part.</span>
<a id="__codelineno-5-43" name="__codelineno-5-43"></a><span class="sd">    - Les deux premiers enfants amènent chacun 1/2 part.</span>
<a id="__codelineno-5-44" name="__codelineno-5-44"></a><span class="sd">    - Les enfants suivants amènent une part chacun.</span>
<a id="__codelineno-5-45" name="__codelineno-5-45"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-5-46" name="__codelineno-5-46"></a>    <span class="k">if</span> <span class="n">adultes</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
<a id="__codelineno-5-47" name="__codelineno-5-47"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Le nombre d&#39;adultes doit être 1 ou 2.&quot;</span><span class="p">)</span>
<a id="__codelineno-5-48" name="__codelineno-5-48"></a>
<a id="__codelineno-5-49" name="__codelineno-5-49"></a>    <span class="n">parts</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">adultes</span><span class="p">)</span>
<a id="__codelineno-5-50" name="__codelineno-5-50"></a>    <span class="k">if</span> <span class="n">enfants</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-5-51" name="__codelineno-5-51"></a>        <span class="n">parts</span> <span class="o">+=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="nb">min</span><span class="p">(</span><span class="n">enfants</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-5-52" name="__codelineno-5-52"></a>    <span class="k">if</span> <span class="n">enfants</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-5-53" name="__codelineno-5-53"></a>        <span class="n">parts</span> <span class="o">+=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">enfants</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-5-54" name="__codelineno-5-54"></a>
<a id="__codelineno-5-55" name="__codelineno-5-55"></a>    <span class="k">return</span> <span class="n">parts</span>
<a id="__codelineno-5-56" name="__codelineno-5-56"></a>
<a id="__codelineno-5-57" name="__codelineno-5-57"></a>
<a id="__codelineno-5-58" name="__codelineno-5-58"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculer_revenu_imposable</span><span class="p">(</span><span class="n">revenus</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-5-59" name="__codelineno-5-59"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-5-60" name="__codelineno-5-60"></a><span class="sd">    Calcule le revenu net imposable après l&#39;abattement de 10%.</span>
<a id="__codelineno-5-61" name="__codelineno-5-61"></a><span class="sd">    Cet abattement est plafonné.</span>
<a id="__codelineno-5-62" name="__codelineno-5-62"></a><span class="sd">    L&#39;abattement est arrondi à l&#39;euro supérieur.</span>
<a id="__codelineno-5-63" name="__codelineno-5-63"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-5-64" name="__codelineno-5-64"></a>    <span class="n">abattement_calcule</span> <span class="o">=</span> <span class="n">revenus</span> <span class="o">*</span> <span class="mf">0.1</span>
<a id="__codelineno-5-65" name="__codelineno-5-65"></a>    <span class="c1"># L&#39;abattement est plafonné entre un minimum et un maximum</span>
<a id="__codelineno-5-66" name="__codelineno-5-66"></a>    <span class="n">abattement</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">PLAFOND_ABATTEMENT_10_POURCENT</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">MINIMUM_ABATTEMENT_10_POURCENT</span><span class="p">,</span> <span class="n">abattement_calcule</span><span class="p">))</span>
<a id="__codelineno-5-67" name="__codelineno-5-67"></a>
<a id="__codelineno-5-68" name="__codelineno-5-68"></a>    <span class="c1"># L&#39;énoncé demande d&#39;arrondir l&#39;abattement à l&#39;euro supérieur</span>
<a id="__codelineno-5-69" name="__codelineno-5-69"></a>    <span class="n">abattement_arrondi</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">abattement</span><span class="p">)</span>
<a id="__codelineno-5-70" name="__codelineno-5-70"></a>
<a id="__codelineno-5-71" name="__codelineno-5-71"></a>    <span class="k">return</span> <span class="n">revenus</span> <span class="o">-</span> <span class="n">abattement_arrondi</span>
<a id="__codelineno-5-72" name="__codelineno-5-72"></a>
<a id="__codelineno-5-73" name="__codelineno-5-73"></a>
<a id="__codelineno-5-74" name="__codelineno-5-74"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculer_impot_brut_base</span><span class="p">(</span><span class="n">revenu_imposable</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">nombre_parts</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-5-75" name="__codelineno-5-75"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-5-76" name="__codelineno-5-76"></a><span class="sd">    Calcule l&#39;impôt brut selon le barème progressif.</span>
<a id="__codelineno-5-77" name="__codelineno-5-77"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-5-78" name="__codelineno-5-78"></a>    <span class="k">if</span> <span class="n">nombre_parts</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-5-79" name="__codelineno-5-79"></a>        <span class="k">return</span> <span class="mf">0.0</span>
<a id="__codelineno-5-80" name="__codelineno-5-80"></a>
<a id="__codelineno-5-81" name="__codelineno-5-81"></a>    <span class="n">quotient_familial</span> <span class="o">=</span> <span class="n">revenu_imposable</span> <span class="o">/</span> <span class="n">nombre_parts</span>
<a id="__codelineno-5-82" name="__codelineno-5-82"></a>
<a id="__codelineno-5-83" name="__codelineno-5-83"></a>    <span class="n">tranche_applicable</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-5-84" name="__codelineno-5-84"></a>    <span class="k">for</span> <span class="n">tranche</span> <span class="ow">in</span> <span class="n">BAREME_IMPOT_2019</span><span class="p">:</span>
<a id="__codelineno-5-85" name="__codelineno-5-85"></a>        <span class="k">if</span> <span class="n">quotient_familial</span> <span class="o">&lt;=</span> <span class="n">tranche</span><span class="p">[</span><span class="s2">&quot;seuil&quot;</span><span class="p">]:</span>
<a id="__codelineno-5-86" name="__codelineno-5-86"></a>            <span class="n">tranche_applicable</span> <span class="o">=</span> <span class="n">tranche</span>
<a id="__codelineno-5-87" name="__codelineno-5-87"></a>            <span class="k">break</span>
<a id="__codelineno-5-88" name="__codelineno-5-88"></a>
<a id="__codelineno-5-89" name="__codelineno-5-89"></a>    <span class="c1"># Si le QF est supérieur à tous les seuils, on utilise la dernière tranche</span>
<a id="__codelineno-5-90" name="__codelineno-5-90"></a>    <span class="k">if</span> <span class="n">tranche_applicable</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-5-91" name="__codelineno-5-91"></a>        <span class="n">tranche_applicable</span> <span class="o">=</span> <span class="n">BAREME_IMPOT_2019</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-5-92" name="__codelineno-5-92"></a>
<a id="__codelineno-5-93" name="__codelineno-5-93"></a>    <span class="c1"># Formule de calcul de l&#39;impôt brut</span>
<a id="__codelineno-5-94" name="__codelineno-5-94"></a>    <span class="n">impot_brut</span> <span class="o">=</span> <span class="p">(</span><span class="n">revenu_imposable</span> <span class="o">*</span> <span class="n">tranche_applicable</span><span class="p">[</span><span class="s2">&quot;taux&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span>
<a id="__codelineno-5-95" name="__codelineno-5-95"></a>            <span class="n">tranche_applicable</span><span class="p">[</span><span class="s2">&quot;deduction_par_part&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">nombre_parts</span><span class="p">)</span>
<a id="__codelineno-5-96" name="__codelineno-5-96"></a>
<a id="__codelineno-5-97" name="__codelineno-5-97"></a>    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">impot_brut</span><span class="p">)</span>
<a id="__codelineno-5-98" name="__codelineno-5-98"></a>
<a id="__codelineno-5-99" name="__codelineno-5-99"></a>
<a id="__codelineno-5-100" name="__codelineno-5-100"></a><span class="k">def</span><span class="w"> </span><span class="nf">appliquer_plafonnement_qf</span><span class="p">(</span><span class="n">impot_brut_avec_enfants</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">revenu_imposable</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">adultes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-5-101" name="__codelineno-5-101"></a>                              <span class="n">enfants</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-5-102" name="__codelineno-5-102"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-5-103" name="__codelineno-5-103"></a><span class="sd">    Applique le plafonnement du quotient familial si nécessaire.</span>
<a id="__codelineno-5-104" name="__codelineno-5-104"></a><span class="sd">    L&#39;impôt final ne peut être inférieur à l&#39;impôt calculé sans les enfants,</span>
<a id="__codelineno-5-105" name="__codelineno-5-105"></a><span class="sd">    diminué d&#39;un gain maximal par demi-part.</span>
<a id="__codelineno-5-106" name="__codelineno-5-106"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-5-107" name="__codelineno-5-107"></a>    <span class="k">if</span> <span class="n">enfants</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-5-108" name="__codelineno-5-108"></a>        <span class="k">return</span> <span class="n">impot_brut_avec_enfants</span>
<a id="__codelineno-5-109" name="__codelineno-5-109"></a>
<a id="__codelineno-5-110" name="__codelineno-5-110"></a>    <span class="c1"># Calcul de l&#39;impôt sans les parts des enfants</span>
<a id="__codelineno-5-111" name="__codelineno-5-111"></a>    <span class="n">parts_sans_enfants</span> <span class="o">=</span> <span class="n">calculer_nombre_parts</span><span class="p">(</span><span class="n">adultes</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-5-112" name="__codelineno-5-112"></a>    <span class="n">impot_sans_enfants</span> <span class="o">=</span> <span class="n">calculer_impot_brut_base</span><span class="p">(</span><span class="n">revenu_imposable</span><span class="p">,</span> <span class="n">parts_sans_enfants</span><span class="p">)</span>
<a id="__codelineno-5-113" name="__codelineno-5-113"></a>
<a id="__codelineno-5-114" name="__codelineno-5-114"></a>    <span class="c1"># Calcul du gain maximal lié aux enfants</span>
<a id="__codelineno-5-115" name="__codelineno-5-115"></a>    <span class="n">parts_avec_enfants</span> <span class="o">=</span> <span class="n">calculer_nombre_parts</span><span class="p">(</span><span class="n">adultes</span><span class="p">,</span> <span class="n">enfants</span><span class="p">)</span>
<a id="__codelineno-5-116" name="__codelineno-5-116"></a>    <span class="n">demi_parts_enfants</span> <span class="o">=</span> <span class="p">(</span><span class="n">parts_avec_enfants</span> <span class="o">-</span> <span class="n">parts_sans_enfants</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
<a id="__codelineno-5-117" name="__codelineno-5-117"></a>    <span class="n">gain_maximal</span> <span class="o">=</span> <span class="n">demi_parts_enfants</span> <span class="o">*</span> <span class="n">GAIN_MAX_DEMI_PART</span>
<a id="__codelineno-5-118" name="__codelineno-5-118"></a>
<a id="__codelineno-5-119" name="__codelineno-5-119"></a>    <span class="n">impot_minimal_plafone</span> <span class="o">=</span> <span class="n">impot_sans_enfants</span> <span class="o">-</span> <span class="n">gain_maximal</span>
<a id="__codelineno-5-120" name="__codelineno-5-120"></a>
<a id="__codelineno-5-121" name="__codelineno-5-121"></a>    <span class="c1"># L&#39;impôt retenu est le plus élevé des deux calculs</span>
<a id="__codelineno-5-122" name="__codelineno-5-122"></a>    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">impot_brut_avec_enfants</span><span class="p">,</span> <span class="n">impot_minimal_plafone</span><span class="p">)</span>
<a id="__codelineno-5-123" name="__codelineno-5-123"></a>
<a id="__codelineno-5-124" name="__codelineno-5-124"></a>
<a id="__codelineno-5-125" name="__codelineno-5-125"></a><span class="k">def</span><span class="w"> </span><span class="nf">appliquer_decote</span><span class="p">(</span><span class="n">impot_avant_decote</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">adultes</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<a id="__codelineno-5-126" name="__codelineno-5-126"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-5-127" name="__codelineno-5-127"></a><span class="sd">    Applique la décote si l&#39;impôt est inférieur à certains seuils.</span>
<a id="__codelineno-5-128" name="__codelineno-5-128"></a><span class="sd">    La décote est arrondie à l&#39;euro supérieur.</span>
<a id="__codelineno-5-129" name="__codelineno-5-129"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-5-130" name="__codelineno-5-130"></a>    <span class="n">statut</span> <span class="o">=</span> <span class="s2">&quot;couple&quot;</span> <span class="k">if</span> <span class="n">adultes</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="s2">&quot;celibataire&quot;</span>
<a id="__codelineno-5-131" name="__codelineno-5-131"></a>    <span class="n">seuil_application</span> <span class="o">=</span> <span class="n">SEUIL_APPLICATION_DECOTE</span><span class="p">[</span><span class="n">statut</span><span class="p">]</span>
<a id="__codelineno-5-132" name="__codelineno-5-132"></a>    <span class="n">seuil_calcul</span> <span class="o">=</span> <span class="n">SEUIL_CALCUL_DECOTE</span><span class="p">[</span><span class="n">statut</span><span class="p">]</span>
<a id="__codelineno-5-133" name="__codelineno-5-133"></a>
<a id="__codelineno-5-134" name="__codelineno-5-134"></a>    <span class="n">decote</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-5-135" name="__codelineno-5-135"></a>    <span class="c1"># La décote s&#39;applique si l&#39;impôt est sous le seuil d&#39;application</span>
<a id="__codelineno-5-136" name="__codelineno-5-136"></a>    <span class="k">if</span> <span class="n">impot_avant_decote</span> <span class="o">&lt;</span> <span class="n">seuil_application</span><span class="p">:</span>
<a id="__codelineno-5-137" name="__codelineno-5-137"></a>        <span class="c1"># Formule de la décote : seuil - 0.75 * Impôt brut</span>
<a id="__codelineno-5-138" name="__codelineno-5-138"></a>        <span class="n">decote_calculee</span> <span class="o">=</span> <span class="n">seuil_calcul</span> <span class="o">-</span> <span class="p">(</span><span class="mf">0.75</span> <span class="o">*</span> <span class="n">impot_avant_decote</span><span class="p">)</span>
<a id="__codelineno-5-139" name="__codelineno-5-139"></a>
<a id="__codelineno-5-140" name="__codelineno-5-140"></a>        <span class="c1"># Arrondi à l&#39;euro supérieur</span>
<a id="__codelineno-5-141" name="__codelineno-5-141"></a>        <span class="n">decote</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">decote_calculee</span><span class="p">)</span>
<a id="__codelineno-5-142" name="__codelineno-5-142"></a>
<a id="__codelineno-5-143" name="__codelineno-5-143"></a>        <span class="c1"># La décote ne peut être négative ni supérieure à l&#39;impôt</span>
<a id="__codelineno-5-144" name="__codelineno-5-144"></a>        <span class="n">decote</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">decote</span><span class="p">,</span> <span class="n">impot_avant_decote</span><span class="p">))</span>
<a id="__codelineno-5-145" name="__codelineno-5-145"></a>
<a id="__codelineno-5-146" name="__codelineno-5-146"></a>    <span class="n">impot_apres_decote</span> <span class="o">=</span> <span class="n">impot_avant_decote</span> <span class="o">-</span> <span class="n">decote</span>
<a id="__codelineno-5-147" name="__codelineno-5-147"></a>    <span class="k">return</span> <span class="n">impot_apres_decote</span><span class="p">,</span> <span class="n">decote</span>
<a id="__codelineno-5-148" name="__codelineno-5-148"></a>
<a id="__codelineno-5-149" name="__codelineno-5-149"></a>
<a id="__codelineno-5-150" name="__codelineno-5-150"></a><span class="k">def</span><span class="w"> </span><span class="nf">appliquer_reduction_20_pourcent</span><span class="p">(</span><span class="n">impot_avant_reduction</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">revenu_imposable</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">adultes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-5-151" name="__codelineno-5-151"></a>                                    <span class="n">enfants</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<a id="__codelineno-5-152" name="__codelineno-5-152"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-5-153" name="__codelineno-5-153"></a><span class="sd">    Applique la réduction de 20% sous condition de revenus.</span>
<a id="__codelineno-5-154" name="__codelineno-5-154"></a><span class="sd">    La réduction est arrondie à l&#39;euro supérieur.</span>
<a id="__codelineno-5-155" name="__codelineno-5-155"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-5-156" name="__codelineno-5-156"></a>    <span class="n">statut</span> <span class="o">=</span> <span class="s2">&quot;couple&quot;</span> <span class="k">if</span> <span class="n">adultes</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="s2">&quot;celibataire&quot;</span>
<a id="__codelineno-5-157" name="__codelineno-5-157"></a>    <span class="n">seuil_base</span> <span class="o">=</span> <span class="n">SEUIL_BASE_REDUCTION_20</span><span class="p">[</span><span class="n">statut</span><span class="p">]</span>
<a id="__codelineno-5-158" name="__codelineno-5-158"></a>
<a id="__codelineno-5-159" name="__codelineno-5-159"></a>    <span class="c1"># Le seuil est augmenté pour chaque demi-part liée aux enfants</span>
<a id="__codelineno-5-160" name="__codelineno-5-160"></a>    <span class="n">parts_avec_enfants</span> <span class="o">=</span> <span class="n">calculer_nombre_parts</span><span class="p">(</span><span class="n">adultes</span><span class="p">,</span> <span class="n">enfants</span><span class="p">)</span>
<a id="__codelineno-5-161" name="__codelineno-5-161"></a>    <span class="n">parts_adultes</span> <span class="o">=</span> <span class="n">calculer_nombre_parts</span><span class="p">(</span><span class="n">adultes</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-5-162" name="__codelineno-5-162"></a>    <span class="n">demi_parts_enfants</span> <span class="o">=</span> <span class="p">(</span><span class="n">parts_avec_enfants</span> <span class="o">-</span> <span class="n">parts_adultes</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
<a id="__codelineno-5-163" name="__codelineno-5-163"></a>    <span class="n">seuil_final</span> <span class="o">=</span> <span class="n">seuil_base</span> <span class="o">+</span> <span class="p">(</span><span class="n">demi_parts_enfants</span> <span class="o">*</span> <span class="n">MAJORATION_SEUIL_REDUCTION_PAR_DEMI_PART</span><span class="p">)</span>
<a id="__codelineno-5-164" name="__codelineno-5-164"></a>
<a id="__codelineno-5-165" name="__codelineno-5-165"></a>    <span class="n">reduction</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-5-166" name="__codelineno-5-166"></a>    <span class="c1"># La réduction s&#39;applique si le revenu imposable est sous le seuil</span>
<a id="__codelineno-5-167" name="__codelineno-5-167"></a>    <span class="k">if</span> <span class="n">revenu_imposable</span> <span class="o">&lt;</span> <span class="n">seuil_final</span><span class="p">:</span>
<a id="__codelineno-5-168" name="__codelineno-5-168"></a>        <span class="n">reduction_calculee</span> <span class="o">=</span> <span class="n">impot_avant_reduction</span> <span class="o">*</span> <span class="mf">0.20</span>
<a id="__codelineno-5-169" name="__codelineno-5-169"></a>
<a id="__codelineno-5-170" name="__codelineno-5-170"></a>        <span class="c1"># Arrondi à l&#39;euro supérieur</span>
<a id="__codelineno-5-171" name="__codelineno-5-171"></a>        <span class="n">reduction</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">reduction_calculee</span><span class="p">)</span>
<a id="__codelineno-5-172" name="__codelineno-5-172"></a>
<a id="__codelineno-5-173" name="__codelineno-5-173"></a>    <span class="n">impot_apres_reduction</span> <span class="o">=</span> <span class="n">impot_avant_reduction</span> <span class="o">-</span> <span class="n">reduction</span>
<a id="__codelineno-5-174" name="__codelineno-5-174"></a>    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">impot_apres_reduction</span><span class="p">),</span> <span class="n">reduction</span>
<a id="__codelineno-5-175" name="__codelineno-5-175"></a>
<a id="__codelineno-5-176" name="__codelineno-5-176"></a>
<a id="__codelineno-5-177" name="__codelineno-5-177"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculer_impot</span><span class="p">(</span><span class="n">adultes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">revenus</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">enfants</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-5-178" name="__codelineno-5-178"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-5-179" name="__codelineno-5-179"></a><span class="sd">    Orchestre le calcul complet de l&#39;impôt net à payer.</span>
<a id="__codelineno-5-180" name="__codelineno-5-180"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-5-181" name="__codelineno-5-181"></a>    <span class="c1"># Étape 1: Calcul du revenu imposable</span>
<a id="__codelineno-5-182" name="__codelineno-5-182"></a>    <span class="n">revenu_imposable</span> <span class="o">=</span> <span class="n">calculer_revenu_imposable</span><span class="p">(</span><span class="n">revenus</span><span class="p">)</span>
<a id="__codelineno-5-183" name="__codelineno-5-183"></a>
<a id="__codelineno-5-184" name="__codelineno-5-184"></a>    <span class="c1"># Étape 2: Calcul du nombre de parts</span>
<a id="__codelineno-5-185" name="__codelineno-5-185"></a>    <span class="n">nombre_parts</span> <span class="o">=</span> <span class="n">calculer_nombre_parts</span><span class="p">(</span><span class="n">adultes</span><span class="p">,</span> <span class="n">enfants</span><span class="p">)</span>
<a id="__codelineno-5-186" name="__codelineno-5-186"></a>
<a id="__codelineno-5-187" name="__codelineno-5-187"></a>    <span class="c1"># Étape 3: Calcul de l&#39;impôt brut</span>
<a id="__codelineno-5-188" name="__codelineno-5-188"></a>    <span class="n">impot_brut_initial</span> <span class="o">=</span> <span class="n">calculer_impot_brut_base</span><span class="p">(</span><span class="n">revenu_imposable</span><span class="p">,</span> <span class="n">nombre_parts</span><span class="p">)</span>
<a id="__codelineno-5-189" name="__codelineno-5-189"></a>
<a id="__codelineno-5-190" name="__codelineno-5-190"></a>    <span class="c1"># Étape 4: Application du plafonnement du QF</span>
<a id="__codelineno-5-191" name="__codelineno-5-191"></a>    <span class="n">impot_apres_plafonnement</span> <span class="o">=</span> <span class="n">appliquer_plafonnement_qf</span><span class="p">(</span><span class="n">impot_brut_initial</span><span class="p">,</span> <span class="n">revenu_imposable</span><span class="p">,</span> <span class="n">adultes</span><span class="p">,</span> <span class="n">enfants</span><span class="p">)</span>
<a id="__codelineno-5-192" name="__codelineno-5-192"></a>
<a id="__codelineno-5-193" name="__codelineno-5-193"></a>    <span class="c1"># Étape 5: Application de la décote</span>
<a id="__codelineno-5-194" name="__codelineno-5-194"></a>    <span class="n">impot_apres_decote</span><span class="p">,</span> <span class="n">decote_calculee</span> <span class="o">=</span> <span class="n">appliquer_decote</span><span class="p">(</span><span class="n">impot_apres_plafonnement</span><span class="p">,</span> <span class="n">adultes</span><span class="p">)</span>
<a id="__codelineno-5-195" name="__codelineno-5-195"></a>
<a id="__codelineno-5-196" name="__codelineno-5-196"></a>    <span class="c1"># Étape 6: Application de la réduction de 20%</span>
<a id="__codelineno-5-197" name="__codelineno-5-197"></a>    <span class="n">impot_avant_arrondi_final</span><span class="p">,</span> <span class="n">reduction_calculee</span> <span class="o">=</span> <span class="n">appliquer_reduction_20_pourcent</span><span class="p">(</span><span class="n">impot_apres_decote</span><span class="p">,</span>
<a id="__codelineno-5-198" name="__codelineno-5-198"></a>                                                                                    <span class="n">revenu_imposable</span><span class="p">,</span> <span class="n">adultes</span><span class="p">,</span> <span class="n">enfants</span><span class="p">)</span>
<a id="__codelineno-5-199" name="__codelineno-5-199"></a>
<a id="__codelineno-5-200" name="__codelineno-5-200"></a>    <span class="c1"># Étape 7: Arrondi final de l&#39;impôt à l&#39;euro inférieur</span>
<a id="__codelineno-5-201" name="__codelineno-5-201"></a>    <span class="n">impot_final</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">impot_avant_arrondi_final</span><span class="p">)</span>
<a id="__codelineno-5-202" name="__codelineno-5-202"></a>
<a id="__codelineno-5-203" name="__codelineno-5-203"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-5-204" name="__codelineno-5-204"></a>        <span class="s2">&quot;impot&quot;</span><span class="p">:</span> <span class="n">impot_final</span><span class="p">,</span>
<a id="__codelineno-5-205" name="__codelineno-5-205"></a>        <span class="s2">&quot;decote&quot;</span><span class="p">:</span> <span class="n">decote_calculee</span><span class="p">,</span>
<a id="__codelineno-5-206" name="__codelineno-5-206"></a>        <span class="s2">&quot;reduction&quot;</span><span class="p">:</span> <span class="n">reduction_calculee</span>
<a id="__codelineno-5-207" name="__codelineno-5-207"></a>    <span class="p">}</span>
<a id="__codelineno-5-208" name="__codelineno-5-208"></a>
<a id="__codelineno-5-209" name="__codelineno-5-209"></a>
<a id="__codelineno-5-210" name="__codelineno-5-210"></a><span class="c1"># --- TESTS UNITAIRES ---</span>
<a id="__codelineno-5-211" name="__codelineno-5-211"></a><span class="c1"># Validation du script avec les cas fournis</span>
<a id="__codelineno-5-212" name="__codelineno-5-212"></a><span class="k">class</span><span class="w"> </span><span class="nc">TestCalculImpot2019</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<a id="__codelineno-5-213" name="__codelineno-5-213"></a>
<a id="__codelineno-5-214" name="__codelineno-5-214"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_verifier_resultat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">adultes</span><span class="p">,</span> <span class="n">enfants</span><span class="p">,</span> <span class="n">revenus</span><span class="p">,</span> <span class="n">impot_attendu</span><span class="p">,</span> <span class="n">decote_attendue</span><span class="p">,</span> <span class="n">reduction_attendue</span><span class="p">):</span>
<a id="__codelineno-5-215" name="__codelineno-5-215"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Fonction utilitaire pour exécuter un test et vérifier les résultats à 1 euro près.&quot;&quot;&quot;</span>
<a id="__codelineno-5-216" name="__codelineno-5-216"></a>        <span class="n">resultat</span> <span class="o">=</span> <span class="n">calculer_impot</span><span class="p">(</span><span class="n">adultes</span><span class="o">=</span><span class="n">adultes</span><span class="p">,</span> <span class="n">revenus</span><span class="o">=</span><span class="n">revenus</span><span class="p">,</span> <span class="n">enfants</span><span class="o">=</span><span class="n">enfants</span><span class="p">)</span>
<a id="__codelineno-5-217" name="__codelineno-5-217"></a>
<a id="__codelineno-5-218" name="__codelineno-5-218"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">resultat</span><span class="p">[</span><span class="s2">&quot;impot&quot;</span><span class="p">],</span> <span class="n">impot_attendu</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-5-219" name="__codelineno-5-219"></a>                               <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Test (</span><span class="si">{</span><span class="n">adultes</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">enfants</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">revenus</span><span class="si">}</span><span class="s2">): Impôt attendu </span><span class="si">{</span><span class="n">impot_attendu</span><span class="si">}</span><span class="s2">, obtenu </span><span class="si">{</span><span class="n">resultat</span><span class="p">[</span><span class="s1">&#39;impot&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-5-220" name="__codelineno-5-220"></a>
<a id="__codelineno-5-221" name="__codelineno-5-221"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">resultat</span><span class="p">[</span><span class="s2">&quot;decote&quot;</span><span class="p">],</span> <span class="n">decote_attendue</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-5-222" name="__codelineno-5-222"></a>                               <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Test (</span><span class="si">{</span><span class="n">adultes</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">enfants</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">revenus</span><span class="si">}</span><span class="s2">): Décote attendue </span><span class="si">{</span><span class="n">decote_attendue</span><span class="si">}</span><span class="s2">, obtenue </span><span class="si">{</span><span class="n">resultat</span><span class="p">[</span><span class="s1">&#39;decote&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-5-223" name="__codelineno-5-223"></a>
<a id="__codelineno-5-224" name="__codelineno-5-224"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">resultat</span><span class="p">[</span><span class="s2">&quot;reduction&quot;</span><span class="p">],</span> <span class="n">reduction_attendue</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-5-225" name="__codelineno-5-225"></a>                               <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Test (</span><span class="si">{</span><span class="n">adultes</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">enfants</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">revenus</span><span class="si">}</span><span class="s2">): Réduction attendue </span><span class="si">{</span><span class="n">reduction_attendue</span><span class="si">}</span><span class="s2">, obtenue </span><span class="si">{</span><span class="n">resultat</span><span class="p">[</span><span class="s1">&#39;reduction&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-5-226" name="__codelineno-5-226"></a>
<a id="__codelineno-5-227" name="__codelineno-5-227"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_cas_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-5-228" name="__codelineno-5-228"></a>        <span class="c1"># (2, 2, 55555) -&gt; (2815, 0, 0)</span>
<a id="__codelineno-5-229" name="__codelineno-5-229"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_verifier_resultat</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">55555</span><span class="p">,</span> <span class="mi">2815</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-5-230" name="__codelineno-5-230"></a>
<a id="__codelineno-5-231" name="__codelineno-5-231"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_cas_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-5-232" name="__codelineno-5-232"></a>        <span class="c1"># (2, 2, 50000) -&gt; (1385, 384, 346)</span>
<a id="__codelineno-5-233" name="__codelineno-5-233"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_verifier_resultat</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">50000</span><span class="p">,</span> <span class="mi">1385</span><span class="p">,</span> <span class="mi">384</span><span class="p">,</span> <span class="mi">346</span><span class="p">)</span>
<a id="__codelineno-5-234" name="__codelineno-5-234"></a>
<a id="__codelineno-5-235" name="__codelineno-5-235"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_cas_3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-5-236" name="__codelineno-5-236"></a>        <span class="c1"># (2, 3, 50000) -&gt; (0, 720, 0)</span>
<a id="__codelineno-5-237" name="__codelineno-5-237"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_verifier_resultat</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">50000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">720</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-5-238" name="__codelineno-5-238"></a>
<a id="__codelineno-5-239" name="__codelineno-5-239"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_cas_4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-5-240" name="__codelineno-5-240"></a>        <span class="c1"># (1, 2, 100000) -&gt; (19884, 0, 0)</span>
<a id="__codelineno-5-241" name="__codelineno-5-241"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_verifier_resultat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100000</span><span class="p">,</span> <span class="mi">19884</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-5-242" name="__codelineno-5-242"></a>
<a id="__codelineno-5-243" name="__codelineno-5-243"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_cas_5</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-5-244" name="__codelineno-5-244"></a>        <span class="c1"># (1, 3, 100000) -&gt; (16782, 0, 0)</span>
<a id="__codelineno-5-245" name="__codelineno-5-245"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_verifier_resultat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">100000</span><span class="p">,</span> <span class="mi">16782</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-5-246" name="__codelineno-5-246"></a>
<a id="__codelineno-5-247" name="__codelineno-5-247"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_cas_6</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-5-248" name="__codelineno-5-248"></a>        <span class="c1"># (2, 3, 100000) -&gt; (9200, 0, 0)</span>
<a id="__codelineno-5-249" name="__codelineno-5-249"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_verifier_resultat</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">100000</span><span class="p">,</span> <span class="mi">9200</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-5-250" name="__codelineno-5-250"></a>
<a id="__codelineno-5-251" name="__codelineno-5-251"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_cas_7</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-5-252" name="__codelineno-5-252"></a>        <span class="c1"># (2, 5, 100000) -&gt; (4230, 0, 0)</span>
<a id="__codelineno-5-253" name="__codelineno-5-253"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_verifier_resultat</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">100000</span><span class="p">,</span> <span class="mi">4230</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-5-254" name="__codelineno-5-254"></a>
<a id="__codelineno-5-255" name="__codelineno-5-255"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_cas_8</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-5-256" name="__codelineno-5-256"></a>        <span class="c1"># (1, 0, 100000) -&gt; (22986, 0, 0)</span>
<a id="__codelineno-5-257" name="__codelineno-5-257"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_verifier_resultat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100000</span><span class="p">,</span> <span class="mi">22986</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-5-258" name="__codelineno-5-258"></a>
<a id="__codelineno-5-259" name="__codelineno-5-259"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_cas_9</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-5-260" name="__codelineno-5-260"></a>        <span class="c1"># (2, 2, 30000) -&gt; (0, 0, 0)</span>
<a id="__codelineno-5-261" name="__codelineno-5-261"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_verifier_resultat</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">30000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-5-262" name="__codelineno-5-262"></a>
<a id="__codelineno-5-263" name="__codelineno-5-263"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_cas_10</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-5-264" name="__codelineno-5-264"></a>        <span class="c1"># (1, 0, 200000) -&gt; (64211, 0, 0)</span>
<a id="__codelineno-5-265" name="__codelineno-5-265"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_verifier_resultat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">200000</span><span class="p">,</span> <span class="mi">64211</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-5-266" name="__codelineno-5-266"></a>
<a id="__codelineno-5-267" name="__codelineno-5-267"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_cas_11</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-5-268" name="__codelineno-5-268"></a>        <span class="c1"># (2, 3, 200000) -&gt; (42843, 0, 0)</span>
<a id="__codelineno-5-269" name="__codelineno-5-269"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_verifier_resultat</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">200000</span><span class="p">,</span> <span class="mi">42843</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-5-270" name="__codelineno-5-270"></a>
<a id="__codelineno-5-271" name="__codelineno-5-271"></a>
<a id="__codelineno-5-272" name="__codelineno-5-272"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-5-273" name="__codelineno-5-273"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exécution des tests unitaires...&quot;</span><span class="p">)</span>
<a id="__codelineno-5-274" name="__codelineno-5-274"></a>    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;first-arg-is-ignored&#39;</span><span class="p">],</span> <span class="n">exit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-5-275" name="__codelineno-5-275"></a>
<a id="__codelineno-5-276" name="__codelineno-5-276"></a>    <span class="c1"># Exemple d&#39;utilisation du calculateur pour un cas précis</span>
<a id="__codelineno-5-277" name="__codelineno-5-277"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Exemple de calcul ---&quot;</span><span class="p">)</span>
<a id="__codelineno-5-278" name="__codelineno-5-278"></a>    <span class="n">revenus_annuels</span> <span class="o">=</span> <span class="mi">50000</span>
<a id="__codelineno-5-279" name="__codelineno-5-279"></a>    <span class="n">nombre_adultes</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-5-280" name="__codelineno-5-280"></a>    <span class="n">nombre_enfants</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-5-281" name="__codelineno-5-281"></a>
<a id="__codelineno-5-282" name="__codelineno-5-282"></a>    <span class="n">resultat_calcul</span> <span class="o">=</span> <span class="n">calculer_impot</span><span class="p">(</span><span class="n">adultes</span><span class="o">=</span><span class="n">nombre_adultes</span><span class="p">,</span> <span class="n">revenus</span><span class="o">=</span><span class="n">revenus_annuels</span><span class="p">,</span> <span class="n">enfants</span><span class="o">=</span><span class="n">nombre_enfants</span><span class="p">)</span>
<a id="__codelineno-5-283" name="__codelineno-5-283"></a>
<a id="__codelineno-5-284" name="__codelineno-5-284"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pour un couple (</span><span class="si">{</span><span class="n">nombre_adultes</span><span class="si">}</span><span class="s2"> adultes) avec </span><span class="si">{</span><span class="n">nombre_enfants</span><span class="si">}</span><span class="s2"> enfants et </span><span class="si">{</span><span class="n">revenus_annuels</span><span class="si">}</span><span class="s2">€ de revenus :&quot;</span><span class="p">)</span>
<a id="__codelineno-5-285" name="__codelineno-5-285"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Impôt à payer : </span><span class="si">{</span><span class="n">resultat_calcul</span><span class="p">[</span><span class="s1">&#39;impot&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">€&quot;</span><span class="p">)</span>
<a id="__codelineno-5-286" name="__codelineno-5-286"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Montant de la décote : </span><span class="si">{</span><span class="n">resultat_calcul</span><span class="p">[</span><span class="s1">&#39;decote&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">€&quot;</span><span class="p">)</span>
<a id="__codelineno-5-287" name="__codelineno-5-287"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Montant de la réduction : </span><span class="si">{</span><span class="n">resultat_calcul</span><span class="p">[</span><span class="s1">&#39;reduction&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">€&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>Je n’ai pas vérifié ce code. Puisque les 11 tests unitaires sont passés, je considère qu’il est « probablement correct ». Je n’ai pas fait davantage pour mon propre code que de vérifier ces 11 tests.</p>
<h2 id="44-le-probleme-3">4.4. Le problème 3</h2>
<p>Le problème 3 est identique au problème 2, si ce n’est qu’on ne donne plus à l’IA le PDF qui donnait les règles de calcul à observer.</p>
<p>La question initiale à Gemini est la suivante :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000001CE00000147770C16A7.png" style="display:inline-block; margin:4px;width:3.671cm;height:2.6cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Le fichier des instructions en [1] est quasiment le même que pour le problème 2 avec les différences suivantes :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span>
<span class="normal"><a href="#__codelineno-6-2">2</a></span>
<span class="normal"><a href="#__codelineno-6-3">3</a></span>
<span class="normal"><a href="#__codelineno-6-4">4</a></span>
<span class="normal"><a href="#__codelineno-6-5">5</a></span>
<span class="normal"><a href="#__codelineno-6-6">6</a></span>
<span class="normal"><a href="#__codelineno-6-7">7</a></span>
<span class="normal"><a href="#__codelineno-6-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="mi">1</span> <span class="o">-</span> <span class="n">Exprime</span><span class="o">-</span><span class="n">toi</span> <span class="n">en</span> <span class="n">français</span><span class="o">.</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="mi">2</span> <span class="o">-</span> <span class="n">Peux</span><span class="o">-</span><span class="n">tu</span> <span class="n">générer</span> <span class="n">un</span> <span class="n">script</span> <span class="n">Python</span> <span class="n">permettant</span> <span class="n">de</span> <span class="n">calculer</span> <span class="n">l</span><span class="s1">&#39;impôt payé par les familles en 2019 sur leurs revenus de 2018.</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="mi">3</span> <span class="o">-</span> <span class="n">Tu</span> <span class="n">t</span><span class="s1">&#39;aideras des sources que tu trouveras sur internet. Dans ta réponse indique-moi ces sources.</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="mi">4</span> <span class="o">-</span> <span class="n">Tu</span> <span class="n">dois</span> <span class="n">faire</span> <span class="n">attention</span> <span class="n">aux</span> <span class="n">points</span> <span class="n">suivants</span> <span class="p">:</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="err">…</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>En [3], on lui dit de trouver sur internet les règles de calcul de l’impôt 2019 sur les revenus 2018. C’est un exercice plus difficile que le précédent ;
Je ne donne ci-dessous que des parties de la première réponse de Gemini :</li>
</ul>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005C600000238566282B9.png" style="display:inline-block; margin:4px;width:11.71cm;height:4.5cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005B800000124B69AB2F6.png" style="display:inline-block; margin:4px;width:11.58cm;height:2.311cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Le temps estimé est plausible. On attend longtemps la réponse de Gemini.</p>
<p>Comme précédemment, Gemini a fourni un lien de téléchargement du script généré, lien qui ne marche pas. On le lui dit :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000003F8000000EA31429731.png" style="display:inline-block; margin:4px;width:8.08cm;height:1.859cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>La réponse de Gemini :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005E700000338348501BF.png" style="display:inline-block; margin:4px;width:11.989cm;height:6.541cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>On charge le script dans PyCharm sous le nom [gemini2]:</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000001F70000024474F0876F.png" style="display:inline-block; margin:4px;width:4.66cm;height:5.369cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>On l’exécute et… ça ne marche pas. Les logs de l’exécution sont les suivants :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span>
<span class="normal"><a href="#__codelineno-7-14">14</a></span>
<span class="normal"><a href="#__codelineno-7-15">15</a></span>
<span class="normal"><a href="#__codelineno-7-16">16</a></span>
<span class="normal"><a href="#__codelineno-7-17">17</a></span>
<span class="normal"><a href="#__codelineno-7-18">18</a></span>
<span class="normal"><a href="#__codelineno-7-19">19</a></span>
<span class="normal"><a href="#__codelineno-7-20">20</a></span>
<span class="normal"><a href="#__codelineno-7-21">21</a></span>
<span class="normal"><a href="#__codelineno-7-22">22</a></span>
<span class="normal"><a href="#__codelineno-7-23">23</a></span>
<span class="normal"><a href="#__codelineno-7-24">24</a></span>
<span class="normal"><a href="#__codelineno-7-25">25</a></span>
<span class="normal"><a href="#__codelineno-7-26">26</a></span>
<span class="normal"><a href="#__codelineno-7-27">27</a></span>
<span class="normal"><a href="#__codelineno-7-28">28</a></span>
<span class="normal"><a href="#__codelineno-7-29">29</a></span>
<span class="normal"><a href="#__codelineno-7-30">30</a></span>
<span class="normal"><a href="#__codelineno-7-31">31</a></span>
<span class="normal"><a href="#__codelineno-7-32">32</a></span>
<span class="normal"><a href="#__codelineno-7-33">33</a></span>
<span class="normal"><a href="#__codelineno-7-34">34</a></span>
<span class="normal"><a href="#__codelineno-7-35">35</a></span>
<span class="normal"><a href="#__codelineno-7-36">36</a></span>
<span class="normal"><a href="#__codelineno-7-37">37</a></span>
<span class="normal"><a href="#__codelineno-7-38">38</a></span>
<span class="normal"><a href="#__codelineno-7-39">39</a></span>
<span class="normal"><a href="#__codelineno-7-40">40</a></span>
<span class="normal"><a href="#__codelineno-7-41">41</a></span>
<span class="normal"><a href="#__codelineno-7-42">42</a></span>
<span class="normal"><a href="#__codelineno-7-43">43</a></span>
<span class="normal"><a href="#__codelineno-7-44">44</a></span>
<span class="normal"><a href="#__codelineno-7-45">45</a></span>
<span class="normal"><a href="#__codelineno-7-46">46</a></span>
<span class="normal"><a href="#__codelineno-7-47">47</a></span>
<span class="normal"><a href="#__codelineno-7-48">48</a></span>
<span class="normal"><a href="#__codelineno-7-49">49</a></span>
<span class="normal"><a href="#__codelineno-7-50">50</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="s2">&quot;C:\Program Files\Python313\python.exe&quot;</span> <span class="s2">&quot;C:/Program Files/JetBrains/PyCharm 2025.2.0.1/plugins/python-ce/helpers/pycharm/_jb_unittest_runner.py&quot;</span> <span class="o">--</span><span class="n">path</span> <span class="s2">&quot;C:\Data\st-2025\dev\python\code\python-flask-2025-cours\outils ia\gemini\gemini2.py&quot;</span> 
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="n">Testing</span> <span class="n">started</span> <span class="n">at</span> <span class="mi">17</span><span class="p">:</span><span class="mi">23</span> <span class="o">...</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="n">Launching</span> <span class="n">unittests</span> <span class="k">with</span> <span class="n">arguments</span> <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">unittest</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2025</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">code</span>\<span class="n">python</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="n">cours</span>\<span class="n">outils</span> <span class="n">ia</span>\<span class="n">gemini</span>\<span class="n">gemini2</span><span class="o">.</span><span class="n">py</span> <span class="ow">in</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2025</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">code</span>\<span class="n">python</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="n">cours</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="n">Failure</span>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a>  <span class="n">File</span> <span class="s2">&quot;C:\Data\st-2025\dev\python\code\python-flask-2025-cours\outils ia\gemini\gemini2.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">278</span><span class="p">,</span> <span class="ow">in</span> <span class="n">test_cas_2</span>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">impot</span><span class="p">,</span> <span class="mi">1385</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-7-10" name="__codelineno-7-10"></a>    <span class="o">~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^</span>
<a id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="ne">AssertionError</span><span class="p">:</span> <span class="mi">1691</span> <span class="o">!=</span> <span class="mi">1385</span> <span class="n">within</span> <span class="mi">1</span> <span class="n">delta</span> <span class="p">(</span><span class="mi">306</span> <span class="n">difference</span><span class="p">)</span>
<a id="__codelineno-7-12" name="__codelineno-7-12"></a>
<a id="__codelineno-7-13" name="__codelineno-7-13"></a>
<a id="__codelineno-7-14" name="__codelineno-7-14"></a><span class="n">Error</span>
<a id="__codelineno-7-15" name="__codelineno-7-15"></a><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
<a id="__codelineno-7-16" name="__codelineno-7-16"></a>  <span class="n">File</span> <span class="s2">&quot;C:\Data\st-2025\dev\python\code\python-flask-2025-cours\outils ia\gemini\gemini2.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">291</span><span class="p">,</span> <span class="ow">in</span> <span class="n">test_cas_3</span>
<a id="__codelineno-7-17" name="__codelineno-7-17"></a>    <span class="n">impot</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">calculer_impot_final</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">50000</span><span class="p">)</span>
<a id="__codelineno-7-18" name="__codelineno-7-18"></a>                  <span class="o">~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^</span>
<a id="__codelineno-7-19" name="__codelineno-7-19"></a>  <span class="n">File</span> <span class="s2">&quot;C:\Data\st-2025\dev\python\code\python-flask-2025-cours\outils ia\gemini\gemini2.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">187</span><span class="p">,</span> <span class="ow">in</span> <span class="n">calculer_impot_final</span>
<a id="__codelineno-7-20" name="__codelineno-7-20"></a>    <span class="n">decote</span><span class="p">,</span> <span class="n">impot_apres_decote</span> <span class="o">=</span> <span class="n">calculer_decote</span><span class="p">(</span><span class="n">impot_apres_plafonnement</span><span class="p">,</span> <span class="n">adultes</span><span class="p">)</span>
<a id="__codelineno-7-21" name="__codelineno-7-21"></a>                                 <span class="o">~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<a id="__codelineno-7-22" name="__codelineno-7-22"></a>  <span class="n">File</span> <span class="s2">&quot;C:\Data\st-2025\dev\python\code\python-flask-2025-cours\outils ia\gemini\gemini2.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">134</span><span class="p">,</span> <span class="ow">in</span> <span class="n">calculer_decote</span>
<a id="__codelineno-7-23" name="__codelineno-7-23"></a>    <span class="n">decote</span> <span class="o">=</span> <span class="n">seuil_decote</span> <span class="o">-</span> <span class="p">(</span><span class="n">impot_avant_decote</span> <span class="o">*</span> <span class="n">COFFICIENT_DECOTE</span><span class="p">)</span>
<a id="__codelineno-7-24" name="__codelineno-7-24"></a>                                                  <span class="o">^^^^^^^^^^^^^^^^^</span>
<a id="__codelineno-7-25" name="__codelineno-7-25"></a><span class="ne">NameError</span><span class="p">:</span> <span class="n">name</span> <span class="s1">&#39;COFFICIENT_DECOTE&#39;</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">defined</span><span class="o">.</span> <span class="n">Did</span> <span class="n">you</span> <span class="n">mean</span><span class="p">:</span> <span class="s1">&#39;COEFFICIENT_DECOTE&#39;</span><span class="err">?</span>
<a id="__codelineno-7-26" name="__codelineno-7-26"></a>
<a id="__codelineno-7-27" name="__codelineno-7-27"></a>
<a id="__codelineno-7-28" name="__codelineno-7-28"></a><span class="n">Error</span>
<a id="__codelineno-7-29" name="__codelineno-7-29"></a><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
<a id="__codelineno-7-30" name="__codelineno-7-30"></a>  <span class="n">File</span> <span class="s2">&quot;C:\Data\st-2025\dev\python\code\python-flask-2025-cours\outils ia\gemini\gemini2.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">316</span><span class="p">,</span> <span class="ow">in</span> <span class="n">test_cas_9</span>
<a id="__codelineno-7-31" name="__codelineno-7-31"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_verifier_cas</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">30000</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-7-32" name="__codelineno-7-32"></a>    <span class="o">~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^</span>
<a id="__codelineno-7-33" name="__codelineno-7-33"></a>  <span class="n">File</span> <span class="s2">&quot;C:\Data\st-2025\dev\python\code\python-flask-2025-cours\outils ia\gemini\gemini2.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">216</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_verifier_cas</span>
<a id="__codelineno-7-34" name="__codelineno-7-34"></a>    <span class="n">impot_calcule</span><span class="p">,</span> <span class="n">decote_calculee</span><span class="p">,</span> <span class="n">reduction_calculee</span> <span class="o">=</span> <span class="n">calculer_impot_final</span><span class="p">(</span><span class="n">adultes</span><span class="p">,</span> <span class="n">enfants</span><span class="p">,</span> <span class="n">revenus</span><span class="p">)</span>
<a id="__codelineno-7-35" name="__codelineno-7-35"></a>                                                         <span class="o">~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<a id="__codelineno-7-36" name="__codelineno-7-36"></a>  <span class="n">File</span> <span class="s2">&quot;C:\Data\st-2025\dev\python\code\python-flask-2025-cours\outils ia\gemini\gemini2.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">187</span><span class="p">,</span> <span class="ow">in</span> <span class="n">calculer_impot_final</span>
<a id="__codelineno-7-37" name="__codelineno-7-37"></a>    <span class="n">decote</span><span class="p">,</span> <span class="n">impot_apres_decote</span> <span class="o">=</span> <span class="n">calculer_decote</span><span class="p">(</span><span class="n">impot_apres_plafonnement</span><span class="p">,</span> <span class="n">adultes</span><span class="p">)</span>
<a id="__codelineno-7-38" name="__codelineno-7-38"></a>                                 <span class="o">~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<a id="__codelineno-7-39" name="__codelineno-7-39"></a>  <span class="n">File</span> <span class="s2">&quot;C:\Data\st-2025\dev\python\code\python-flask-2025-cours\outils ia\gemini\gemini2.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">134</span><span class="p">,</span> <span class="ow">in</span> <span class="n">calculer_decote</span>
<a id="__codelineno-7-40" name="__codelineno-7-40"></a>    <span class="n">decote</span> <span class="o">=</span> <span class="n">seuil_decote</span> <span class="o">-</span> <span class="p">(</span><span class="n">impot_avant_decote</span> <span class="o">*</span> <span class="n">COFFICIENT_DECOTE</span><span class="p">)</span>
<a id="__codelineno-7-41" name="__codelineno-7-41"></a>                                                  <span class="o">^^^^^^^^^^^^^^^^^</span>
<a id="__codelineno-7-42" name="__codelineno-7-42"></a><span class="ne">NameError</span><span class="p">:</span> <span class="n">name</span> <span class="s1">&#39;COFFICIENT_DECOTE&#39;</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">defined</span><span class="o">.</span> <span class="n">Did</span> <span class="n">you</span> <span class="n">mean</span><span class="p">:</span> <span class="s1">&#39;COEFFICIENT_DECOTE&#39;</span><span class="err">?</span>
<a id="__codelineno-7-43" name="__codelineno-7-43"></a>
<a id="__codelineno-7-44" name="__codelineno-7-44"></a>
<a id="__codelineno-7-45" name="__codelineno-7-45"></a>
<a id="__codelineno-7-46" name="__codelineno-7-46"></a><span class="n">Ran</span> <span class="mi">11</span> <span class="n">tests</span> <span class="ow">in</span> <span class="mf">0.038</span><span class="n">s</span>
<a id="__codelineno-7-47" name="__codelineno-7-47"></a>
<a id="__codelineno-7-48" name="__codelineno-7-48"></a><span class="n">FAILED</span> <span class="p">(</span><span class="n">failures</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-7-49" name="__codelineno-7-49"></a>
<a id="__codelineno-7-50" name="__codelineno-7-50"></a><span class="n">Process</span> <span class="n">finished</span> <span class="k">with</span> <span class="n">exit</span> <span class="n">code</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>Ligne 11, un test a échoué ;</li>
<li>Lignes 25, 42 : une même erreur de compilation ;
On met ces logs dans un fichier texte qu’on donne à Gemini :</li>
</ul>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000037100000160E62E9DEC.png" style="display:inline-block; margin:4px;width:6.98cm;height:2.79cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>La réponse de Gemini :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005D900000211468AB27B.png" style="display:inline-block; margin:4px;width:11.86cm;height:4.189cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005EB0000033F1D6631DD.png" style="display:inline-block; margin:4px;width:12cm;height:6.579cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>On charge dans PyCharm le script et on l’exécute. Encore des erreurs. On le dit à Gemini en joignant de nouveau les logs de l’exécution :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000030300000156645F52DA.png" style="display:inline-block; margin:4px;width:6.13cm;height:2.72cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>La réponse de Gemini :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005B9000001E38506CD84.png" style="display:inline-block; margin:4px;width:11.561cm;height:3.81cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005BA000001A4D4CBC265.png" style="display:inline-block; margin:4px;width:11.55cm;height:3.311cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005FA0000029FA79BFB64.png" style="display:inline-block; margin:4px;width:12.16cm;height:5.33cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>On charge ce nouveau script dans PyCharm et on l’exécute. Cette fois les 11 tests unitaires passent :</p>
<p>Le code généré par Gemini est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">  1</a></span>
<span class="normal"><a href="#__codelineno-8-2">  2</a></span>
<span class="normal"><a href="#__codelineno-8-3">  3</a></span>
<span class="normal"><a href="#__codelineno-8-4">  4</a></span>
<span class="normal"><a href="#__codelineno-8-5">  5</a></span>
<span class="normal"><a href="#__codelineno-8-6">  6</a></span>
<span class="normal"><a href="#__codelineno-8-7">  7</a></span>
<span class="normal"><a href="#__codelineno-8-8">  8</a></span>
<span class="normal"><a href="#__codelineno-8-9">  9</a></span>
<span class="normal"><a href="#__codelineno-8-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-8-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-8-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-8-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-8-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-8-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-8-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-8-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-8-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-8-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-8-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-8-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-8-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-8-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-8-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-8-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-8-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-8-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-8-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-8-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-8-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-8-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-8-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-8-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-8-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-8-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-8-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-8-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-8-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-8-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-8-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-8-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-8-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-8-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-8-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-8-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-8-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-8-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-8-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-8-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-8-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-8-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-8-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-8-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-8-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-8-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-8-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-8-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-8-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-8-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-8-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-8-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-8-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-8-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-8-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-8-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-8-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-8-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-8-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-8-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-8-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-8-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-8-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-8-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-8-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-8-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-8-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-8-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-8-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-8-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-8-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-8-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-8-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-8-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-8-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-8-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-8-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-8-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-8-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-8-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-8-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-8-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-8-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-8-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-8-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-8-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-8-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-8-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-8-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-8-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-8-100">100</a></span>
<span class="normal"><a href="#__codelineno-8-101">101</a></span>
<span class="normal"><a href="#__codelineno-8-102">102</a></span>
<span class="normal"><a href="#__codelineno-8-103">103</a></span>
<span class="normal"><a href="#__codelineno-8-104">104</a></span>
<span class="normal"><a href="#__codelineno-8-105">105</a></span>
<span class="normal"><a href="#__codelineno-8-106">106</a></span>
<span class="normal"><a href="#__codelineno-8-107">107</a></span>
<span class="normal"><a href="#__codelineno-8-108">108</a></span>
<span class="normal"><a href="#__codelineno-8-109">109</a></span>
<span class="normal"><a href="#__codelineno-8-110">110</a></span>
<span class="normal"><a href="#__codelineno-8-111">111</a></span>
<span class="normal"><a href="#__codelineno-8-112">112</a></span>
<span class="normal"><a href="#__codelineno-8-113">113</a></span>
<span class="normal"><a href="#__codelineno-8-114">114</a></span>
<span class="normal"><a href="#__codelineno-8-115">115</a></span>
<span class="normal"><a href="#__codelineno-8-116">116</a></span>
<span class="normal"><a href="#__codelineno-8-117">117</a></span>
<span class="normal"><a href="#__codelineno-8-118">118</a></span>
<span class="normal"><a href="#__codelineno-8-119">119</a></span>
<span class="normal"><a href="#__codelineno-8-120">120</a></span>
<span class="normal"><a href="#__codelineno-8-121">121</a></span>
<span class="normal"><a href="#__codelineno-8-122">122</a></span>
<span class="normal"><a href="#__codelineno-8-123">123</a></span>
<span class="normal"><a href="#__codelineno-8-124">124</a></span>
<span class="normal"><a href="#__codelineno-8-125">125</a></span>
<span class="normal"><a href="#__codelineno-8-126">126</a></span>
<span class="normal"><a href="#__codelineno-8-127">127</a></span>
<span class="normal"><a href="#__codelineno-8-128">128</a></span>
<span class="normal"><a href="#__codelineno-8-129">129</a></span>
<span class="normal"><a href="#__codelineno-8-130">130</a></span>
<span class="normal"><a href="#__codelineno-8-131">131</a></span>
<span class="normal"><a href="#__codelineno-8-132">132</a></span>
<span class="normal"><a href="#__codelineno-8-133">133</a></span>
<span class="normal"><a href="#__codelineno-8-134">134</a></span>
<span class="normal"><a href="#__codelineno-8-135">135</a></span>
<span class="normal"><a href="#__codelineno-8-136">136</a></span>
<span class="normal"><a href="#__codelineno-8-137">137</a></span>
<span class="normal"><a href="#__codelineno-8-138">138</a></span>
<span class="normal"><a href="#__codelineno-8-139">139</a></span>
<span class="normal"><a href="#__codelineno-8-140">140</a></span>
<span class="normal"><a href="#__codelineno-8-141">141</a></span>
<span class="normal"><a href="#__codelineno-8-142">142</a></span>
<span class="normal"><a href="#__codelineno-8-143">143</a></span>
<span class="normal"><a href="#__codelineno-8-144">144</a></span>
<span class="normal"><a href="#__codelineno-8-145">145</a></span>
<span class="normal"><a href="#__codelineno-8-146">146</a></span>
<span class="normal"><a href="#__codelineno-8-147">147</a></span>
<span class="normal"><a href="#__codelineno-8-148">148</a></span>
<span class="normal"><a href="#__codelineno-8-149">149</a></span>
<span class="normal"><a href="#__codelineno-8-150">150</a></span>
<span class="normal"><a href="#__codelineno-8-151">151</a></span>
<span class="normal"><a href="#__codelineno-8-152">152</a></span>
<span class="normal"><a href="#__codelineno-8-153">153</a></span>
<span class="normal"><a href="#__codelineno-8-154">154</a></span>
<span class="normal"><a href="#__codelineno-8-155">155</a></span>
<span class="normal"><a href="#__codelineno-8-156">156</a></span>
<span class="normal"><a href="#__codelineno-8-157">157</a></span>
<span class="normal"><a href="#__codelineno-8-158">158</a></span>
<span class="normal"><a href="#__codelineno-8-159">159</a></span>
<span class="normal"><a href="#__codelineno-8-160">160</a></span>
<span class="normal"><a href="#__codelineno-8-161">161</a></span>
<span class="normal"><a href="#__codelineno-8-162">162</a></span>
<span class="normal"><a href="#__codelineno-8-163">163</a></span>
<span class="normal"><a href="#__codelineno-8-164">164</a></span>
<span class="normal"><a href="#__codelineno-8-165">165</a></span>
<span class="normal"><a href="#__codelineno-8-166">166</a></span>
<span class="normal"><a href="#__codelineno-8-167">167</a></span>
<span class="normal"><a href="#__codelineno-8-168">168</a></span>
<span class="normal"><a href="#__codelineno-8-169">169</a></span>
<span class="normal"><a href="#__codelineno-8-170">170</a></span>
<span class="normal"><a href="#__codelineno-8-171">171</a></span>
<span class="normal"><a href="#__codelineno-8-172">172</a></span>
<span class="normal"><a href="#__codelineno-8-173">173</a></span>
<span class="normal"><a href="#__codelineno-8-174">174</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="c1"># -*- coding: utf-8 -*-</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">unittest</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="c1"># ==============================================================================</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="c1"># CONSTANTES POUR L&#39;IMPOSITION DES REVENUS 2018 (PAYÉE EN 2019)</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="c1"># ==============================================================================</span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="n">BAREME_IMPOT_2019</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a>    <span class="p">{</span><span class="s1">&#39;seuil&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;taux&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">},</span>
<a id="__codelineno-8-10" name="__codelineno-8-10"></a>    <span class="p">{</span><span class="s1">&#39;seuil&#39;</span><span class="p">:</span> <span class="mi">9964</span><span class="p">,</span> <span class="s1">&#39;taux&#39;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">},</span>
<a id="__codelineno-8-11" name="__codelineno-8-11"></a>    <span class="p">{</span><span class="s1">&#39;seuil&#39;</span><span class="p">:</span> <span class="mi">27519</span><span class="p">,</span> <span class="s1">&#39;taux&#39;</span><span class="p">:</span> <span class="mf">0.30</span><span class="p">},</span>
<a id="__codelineno-8-12" name="__codelineno-8-12"></a>    <span class="p">{</span><span class="s1">&#39;seuil&#39;</span><span class="p">:</span> <span class="mi">73779</span><span class="p">,</span> <span class="s1">&#39;taux&#39;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">},</span>
<a id="__codelineno-8-13" name="__codelineno-8-13"></a>    <span class="p">{</span><span class="s1">&#39;seuil&#39;</span><span class="p">:</span> <span class="mi">156244</span><span class="p">,</span> <span class="s1">&#39;taux&#39;</span><span class="p">:</span> <span class="mf">0.45</span><span class="p">},</span>
<a id="__codelineno-8-14" name="__codelineno-8-14"></a><span class="p">]</span>
<a id="__codelineno-8-15" name="__codelineno-8-15"></a><span class="n">ABATTEMENT_FORFAITAIRE_TAUX</span> <span class="o">=</span> <span class="mf">0.10</span>
<a id="__codelineno-8-16" name="__codelineno-8-16"></a><span class="n">ABATTEMENT_FORFAITAIRE_MINIMUM</span> <span class="o">=</span> <span class="mi">437</span>
<a id="__codelineno-8-17" name="__codelineno-8-17"></a><span class="n">ABATTEMENT_FORFAITAIRE_PLAFOND</span> <span class="o">=</span> <span class="mi">12502</span>
<a id="__codelineno-8-18" name="__codelineno-8-18"></a><span class="n">PLAFONNEMENT_AVANTAGE_QF_DEMI_PART</span> <span class="o">=</span> <span class="mi">1551</span>
<a id="__codelineno-8-19" name="__codelineno-8-19"></a><span class="n">SEUIL_DECOTE_CELIBATAIRE</span> <span class="o">=</span> <span class="mi">1196</span>
<a id="__codelineno-8-20" name="__codelineno-8-20"></a><span class="n">SEUIL_DECOTE_COUPLE</span> <span class="o">=</span> <span class="mi">1970</span>
<a id="__codelineno-8-21" name="__codelineno-8-21"></a><span class="n">COEFFICIENT_DECOTE</span> <span class="o">=</span> <span class="mf">0.75</span>
<a id="__codelineno-8-22" name="__codelineno-8-22"></a><span class="n">TAUX_REDUCTION_20_POURCENT</span> <span class="o">=</span> <span class="mf">0.20</span>
<a id="__codelineno-8-23" name="__codelineno-8-23"></a><span class="n">SEUIL_RFR_REDUCTION_CELIBATAIRE</span> <span class="o">=</span> <span class="mi">18985</span>
<a id="__codelineno-8-24" name="__codelineno-8-24"></a><span class="n">SEUIL_RFR_REDUCTION_COUPLE</span> <span class="o">=</span> <span class="mi">37970</span>
<a id="__codelineno-8-25" name="__codelineno-8-25"></a><span class="n">MAJORATION_RFR_REDUCTION_PAR_DEMI_PART</span> <span class="o">=</span> <span class="mi">3803</span>
<a id="__codelineno-8-26" name="__codelineno-8-26"></a>
<a id="__codelineno-8-27" name="__codelineno-8-27"></a>
<a id="__codelineno-8-28" name="__codelineno-8-28"></a><span class="c1"># ==============================================================================</span>
<a id="__codelineno-8-29" name="__codelineno-8-29"></a><span class="c1"># FONCTIONS DE CALCUL</span>
<a id="__codelineno-8-30" name="__codelineno-8-30"></a><span class="c1"># ==============================================================================</span>
<a id="__codelineno-8-31" name="__codelineno-8-31"></a>
<a id="__codelineno-8-32" name="__codelineno-8-32"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculer_nombre_parts</span><span class="p">(</span><span class="n">adultes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">enfants</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-8-33" name="__codelineno-8-33"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calcule le nombre de parts du foyer fiscal.&quot;&quot;&quot;</span>
<a id="__codelineno-8-34" name="__codelineno-8-34"></a>    <span class="k">if</span> <span class="n">adultes</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="mi">0</span>
<a id="__codelineno-8-35" name="__codelineno-8-35"></a>    <span class="n">parts</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">adultes</span><span class="p">)</span>
<a id="__codelineno-8-36" name="__codelineno-8-36"></a>    <span class="k">if</span> <span class="n">enfants</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span> <span class="n">parts</span> <span class="o">+=</span> <span class="mf">0.5</span>
<a id="__codelineno-8-37" name="__codelineno-8-37"></a>    <span class="k">if</span> <span class="n">enfants</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span> <span class="n">parts</span> <span class="o">+=</span> <span class="mf">0.5</span>
<a id="__codelineno-8-38" name="__codelineno-8-38"></a>    <span class="k">if</span> <span class="n">enfants</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span> <span class="n">parts</span> <span class="o">+=</span> <span class="p">(</span><span class="n">enfants</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.0</span>
<a id="__codelineno-8-39" name="__codelineno-8-39"></a>    <span class="k">return</span> <span class="n">parts</span>
<a id="__codelineno-8-40" name="__codelineno-8-40"></a>
<a id="__codelineno-8-41" name="__codelineno-8-41"></a>
<a id="__codelineno-8-42" name="__codelineno-8-42"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculer_revenu_imposable</span><span class="p">(</span><span class="n">revenus_bruts</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-8-43" name="__codelineno-8-43"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calcule le revenu net imposable après abattement de 10%.&quot;&quot;&quot;</span>
<a id="__codelineno-8-44" name="__codelineno-8-44"></a>    <span class="k">if</span> <span class="n">revenus_bruts</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="mf">0.0</span>
<a id="__codelineno-8-45" name="__codelineno-8-45"></a>    <span class="n">abattement</span> <span class="o">=</span> <span class="n">revenus_bruts</span> <span class="o">*</span> <span class="n">ABATTEMENT_FORFAITAIRE_TAUX</span>
<a id="__codelineno-8-46" name="__codelineno-8-46"></a>    <span class="k">if</span> <span class="n">abattement</span> <span class="o">&lt;</span> <span class="n">ABATTEMENT_FORFAITAIRE_MINIMUM</span><span class="p">:</span> <span class="n">abattement</span> <span class="o">=</span> <span class="n">ABATTEMENT_FORFAITAIRE_MINIMUM</span>
<a id="__codelineno-8-47" name="__codelineno-8-47"></a>    <span class="k">if</span> <span class="n">abattement</span> <span class="o">&gt;</span> <span class="n">ABATTEMENT_FORFAITAIRE_PLAFOND</span><span class="p">:</span> <span class="n">abattement</span> <span class="o">=</span> <span class="n">ABATTEMENT_FORFAITAIRE_PLAFOND</span>
<a id="__codelineno-8-48" name="__codelineno-8-48"></a>    <span class="n">abattement</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">abattement</span><span class="p">)</span>
<a id="__codelineno-8-49" name="__codelineno-8-49"></a>    <span class="n">revenu_imposable</span> <span class="o">=</span> <span class="n">revenus_bruts</span> <span class="o">-</span> <span class="n">abattement</span>
<a id="__codelineno-8-50" name="__codelineno-8-50"></a>    <span class="k">return</span> <span class="n">revenu_imposable</span> <span class="k">if</span> <span class="n">revenu_imposable</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
<a id="__codelineno-8-51" name="__codelineno-8-51"></a>
<a id="__codelineno-8-52" name="__codelineno-8-52"></a>
<a id="__codelineno-8-53" name="__codelineno-8-53"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculer_impot_brut_par_tranche</span><span class="p">(</span><span class="n">revenu_imposable</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">nombre_parts</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-8-54" name="__codelineno-8-54"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calcule l&#39;impôt brut en appliquant le barème progressif.&quot;&quot;&quot;</span>
<a id="__codelineno-8-55" name="__codelineno-8-55"></a>    <span class="k">if</span> <span class="n">nombre_parts</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">revenu_imposable</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="mf">0.0</span>
<a id="__codelineno-8-56" name="__codelineno-8-56"></a>    <span class="n">quotient_familial</span> <span class="o">=</span> <span class="n">revenu_imposable</span> <span class="o">/</span> <span class="n">nombre_parts</span>
<a id="__codelineno-8-57" name="__codelineno-8-57"></a>    <span class="n">impot_par_part</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-8-58" name="__codelineno-8-58"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">BAREME_IMPOT_2019</span><span class="p">)):</span>
<a id="__codelineno-8-59" name="__codelineno-8-59"></a>        <span class="n">tranche</span> <span class="o">=</span> <span class="n">BAREME_IMPOT_2019</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-8-60" name="__codelineno-8-60"></a>        <span class="n">seuil_actuel</span> <span class="o">=</span> <span class="n">tranche</span><span class="p">[</span><span class="s1">&#39;seuil&#39;</span><span class="p">]</span>
<a id="__codelineno-8-61" name="__codelineno-8-61"></a>        <span class="n">taux</span> <span class="o">=</span> <span class="n">tranche</span><span class="p">[</span><span class="s1">&#39;taux&#39;</span><span class="p">]</span>
<a id="__codelineno-8-62" name="__codelineno-8-62"></a>        <span class="k">if</span> <span class="n">quotient_familial</span> <span class="o">&gt;</span> <span class="n">seuil_actuel</span><span class="p">:</span>
<a id="__codelineno-8-63" name="__codelineno-8-63"></a>            <span class="n">base_imposable_tranche</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-8-64" name="__codelineno-8-64"></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">BAREME_IMPOT_2019</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-8-65" name="__codelineno-8-65"></a>                <span class="n">seuil_suivant</span> <span class="o">=</span> <span class="n">BAREME_IMPOT_2019</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="s1">&#39;seuil&#39;</span><span class="p">]</span>
<a id="__codelineno-8-66" name="__codelineno-8-66"></a>                <span class="n">base_imposable_tranche</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">quotient_familial</span><span class="p">,</span> <span class="n">seuil_suivant</span><span class="p">)</span> <span class="o">-</span> <span class="n">seuil_actuel</span>
<a id="__codelineno-8-67" name="__codelineno-8-67"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-8-68" name="__codelineno-8-68"></a>                <span class="n">base_imposable_tranche</span> <span class="o">=</span> <span class="n">quotient_familial</span> <span class="o">-</span> <span class="n">seuil_actuel</span>
<a id="__codelineno-8-69" name="__codelineno-8-69"></a>            <span class="n">impot_par_part</span> <span class="o">+=</span> <span class="n">base_imposable_tranche</span> <span class="o">*</span> <span class="n">taux</span>
<a id="__codelineno-8-70" name="__codelineno-8-70"></a>    <span class="k">return</span> <span class="n">impot_par_part</span> <span class="o">*</span> <span class="n">nombre_parts</span>
<a id="__codelineno-8-71" name="__codelineno-8-71"></a>
<a id="__codelineno-8-72" name="__codelineno-8-72"></a>
<a id="__codelineno-8-73" name="__codelineno-8-73"></a><span class="k">def</span><span class="w"> </span><span class="nf">appliquer_plafonnement_qf</span><span class="p">(</span><span class="n">revenu_imposable</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">nombre_parts</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">adultes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-8-74" name="__codelineno-8-74"></a>                              <span class="n">impot_brut_famille</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-8-75" name="__codelineno-8-75"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Applique le plafonnement des effets du quotient familial.&quot;&quot;&quot;</span>
<a id="__codelineno-8-76" name="__codelineno-8-76"></a>    <span class="k">if</span> <span class="n">nombre_parts</span> <span class="o">&lt;=</span> <span class="n">adultes</span><span class="p">:</span> <span class="k">return</span> <span class="n">impot_brut_famille</span>
<a id="__codelineno-8-77" name="__codelineno-8-77"></a>    <span class="n">impot_base</span> <span class="o">=</span> <span class="n">calculer_impot_brut_par_tranche</span><span class="p">(</span><span class="n">revenu_imposable</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">adultes</span><span class="p">))</span>
<a id="__codelineno-8-78" name="__codelineno-8-78"></a>    <span class="n">demi_parts_enfants</span> <span class="o">=</span> <span class="p">(</span><span class="n">nombre_parts</span> <span class="o">-</span> <span class="n">adultes</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
<a id="__codelineno-8-79" name="__codelineno-8-79"></a>    <span class="n">avantage_qf_max</span> <span class="o">=</span> <span class="n">PLAFONNEMENT_AVANTAGE_QF_DEMI_PART</span> <span class="o">*</span> <span class="n">demi_parts_enfants</span>
<a id="__codelineno-8-80" name="__codelineno-8-80"></a>    <span class="n">avantage_qf_reel</span> <span class="o">=</span> <span class="n">impot_base</span> <span class="o">-</span> <span class="n">impot_brut_famille</span>
<a id="__codelineno-8-81" name="__codelineno-8-81"></a>    <span class="k">if</span> <span class="n">avantage_qf_reel</span> <span class="o">&gt;</span> <span class="n">avantage_qf_max</span><span class="p">:</span>
<a id="__codelineno-8-82" name="__codelineno-8-82"></a>        <span class="k">return</span> <span class="n">impot_base</span> <span class="o">-</span> <span class="n">avantage_qf_max</span>
<a id="__codelineno-8-83" name="__codelineno-8-83"></a>    <span class="k">return</span> <span class="n">impot_brut_famille</span>
<a id="__codelineno-8-84" name="__codelineno-8-84"></a>
<a id="__codelineno-8-85" name="__codelineno-8-85"></a>
<a id="__codelineno-8-86" name="__codelineno-8-86"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculer_impot_final</span><span class="p">(</span><span class="n">adultes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">enfants</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">revenus</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-8-87" name="__codelineno-8-87"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Orchestre le calcul complet de l&#39;impôt.&quot;&quot;&quot;</span>
<a id="__codelineno-8-88" name="__codelineno-8-88"></a>    <span class="n">revenu_imposable</span> <span class="o">=</span> <span class="n">calculer_revenu_imposable</span><span class="p">(</span><span class="n">revenus</span><span class="p">)</span>
<a id="__codelineno-8-89" name="__codelineno-8-89"></a>    <span class="n">nombre_parts</span> <span class="o">=</span> <span class="n">calculer_nombre_parts</span><span class="p">(</span><span class="n">adultes</span><span class="p">,</span> <span class="n">enfants</span><span class="p">)</span>
<a id="__codelineno-8-90" name="__codelineno-8-90"></a>    <span class="n">impot_brut</span> <span class="o">=</span> <span class="n">calculer_impot_brut_par_tranche</span><span class="p">(</span><span class="n">revenu_imposable</span><span class="p">,</span> <span class="n">nombre_parts</span><span class="p">)</span>
<a id="__codelineno-8-91" name="__codelineno-8-91"></a>    <span class="n">impot_apres_plafonnement</span> <span class="o">=</span> <span class="n">appliquer_plafonnement_qf</span><span class="p">(</span><span class="n">revenu_imposable</span><span class="p">,</span> <span class="n">nombre_parts</span><span class="p">,</span> <span class="n">adultes</span><span class="p">,</span> <span class="n">impot_brut</span><span class="p">)</span>
<a id="__codelineno-8-92" name="__codelineno-8-92"></a>
<a id="__codelineno-8-93" name="__codelineno-8-93"></a>    <span class="c1"># CORRECTION : Si l&#39;impôt est déjà 0, pas de décote ni de réduction.</span>
<a id="__codelineno-8-94" name="__codelineno-8-94"></a>    <span class="k">if</span> <span class="n">impot_apres_plafonnement</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-8-95" name="__codelineno-8-95"></a>        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
<a id="__codelineno-8-96" name="__codelineno-8-96"></a>
<a id="__codelineno-8-97" name="__codelineno-8-97"></a>    <span class="c1"># --- LOGIQUE CORRIGÉE POUR L&#39;INTERACTION DÉCOTE / RÉDUCTION ---</span>
<a id="__codelineno-8-98" name="__codelineno-8-98"></a>    <span class="n">decote_calculee</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-8-99" name="__codelineno-8-99"></a>    <span class="n">reduction_calculee</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-8-100" name="__codelineno-8-100"></a>    <span class="n">impot_a_traiter</span> <span class="o">=</span> <span class="n">impot_apres_plafonnement</span>
<a id="__codelineno-8-101" name="__codelineno-8-101"></a>
<a id="__codelineno-8-102" name="__codelineno-8-102"></a>    <span class="c1"># 1. Déterminer l&#39;éligibilité à la réduction de 20%</span>
<a id="__codelineno-8-103" name="__codelineno-8-103"></a>    <span class="n">est_eligible_reduction</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-8-104" name="__codelineno-8-104"></a>    <span class="k">if</span> <span class="n">adultes</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-8-105" name="__codelineno-8-105"></a>        <span class="n">seuil_rfr</span> <span class="o">=</span> <span class="n">SEUIL_RFR_REDUCTION_COUPLE</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">nombre_parts</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">MAJORATION_RFR_REDUCTION_PAR_DEMI_PART</span>
<a id="__codelineno-8-106" name="__codelineno-8-106"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-8-107" name="__codelineno-8-107"></a>        <span class="n">seuil_rfr</span> <span class="o">=</span> <span class="n">SEUIL_RFR_REDUCTION_CELIBATAIRE</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span>
<a id="__codelineno-8-108" name="__codelineno-8-108"></a>                <span class="n">nombre_parts</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">MAJORATION_RFR_REDUCTION_PAR_DEMI_PART</span>
<a id="__codelineno-8-109" name="__codelineno-8-109"></a>    <span class="k">if</span> <span class="n">revenu_imposable</span> <span class="o">&lt;</span> <span class="n">seuil_rfr</span><span class="p">:</span>
<a id="__codelineno-8-110" name="__codelineno-8-110"></a>        <span class="n">est_eligible_reduction</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-8-111" name="__codelineno-8-111"></a>
<a id="__codelineno-8-112" name="__codelineno-8-112"></a>    <span class="c1"># 2. Déterminer l&#39;éligibilité à la décote</span>
<a id="__codelineno-8-113" name="__codelineno-8-113"></a>    <span class="n">seuil_decote_foyer</span> <span class="o">=</span> <span class="n">SEUIL_DECOTE_COUPLE</span> <span class="k">if</span> <span class="n">adultes</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">SEUIL_DECOTE_CELIBATAIRE</span>
<a id="__codelineno-8-114" name="__codelineno-8-114"></a>    <span class="n">reduction_theorique</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">impot_a_traiter</span> <span class="o">*</span> <span class="n">TAUX_REDUCTION_20_POURCENT</span><span class="p">)</span> <span class="k">if</span> <span class="n">est_eligible_reduction</span> <span class="k">else</span> <span class="mi">0</span>
<a id="__codelineno-8-115" name="__codelineno-8-115"></a>
<a id="__codelineno-8-116" name="__codelineno-8-116"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">impot_a_traiter</span> <span class="o">-</span> <span class="n">reduction_theorique</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">seuil_decote_foyer</span><span class="p">:</span>
<a id="__codelineno-8-117" name="__codelineno-8-117"></a>        <span class="n">decote_calculee</span> <span class="o">=</span> <span class="n">seuil_decote_foyer</span> <span class="o">-</span> <span class="p">(</span><span class="n">impot_a_traiter</span> <span class="o">*</span> <span class="n">COEFFICIENT_DECOTE</span><span class="p">)</span>
<a id="__codelineno-8-118" name="__codelineno-8-118"></a>        <span class="n">decote_calculee</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">decote_calculee</span><span class="p">)</span>
<a id="__codelineno-8-119" name="__codelineno-8-119"></a>        <span class="c1"># CORRECTION : La décote retournée ne peut excéder l&#39;impôt qu&#39;elle annule</span>
<a id="__codelineno-8-120" name="__codelineno-8-120"></a>        <span class="n">decote_calculee</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">decote_calculee</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">impot_a_traiter</span><span class="p">))</span>
<a id="__codelineno-8-121" name="__codelineno-8-121"></a>        <span class="n">impot_a_traiter</span> <span class="o">-=</span> <span class="n">decote_calculee</span>
<a id="__codelineno-8-122" name="__codelineno-8-122"></a>        <span class="n">impot_a_traiter</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">impot_a_traiter</span><span class="p">)</span>
<a id="__codelineno-8-123" name="__codelineno-8-123"></a>
<a id="__codelineno-8-124" name="__codelineno-8-124"></a>    <span class="c1"># 3. Appliquer la réduction de 20% si éligible</span>
<a id="__codelineno-8-125" name="__codelineno-8-125"></a>    <span class="k">if</span> <span class="n">est_eligible_reduction</span><span class="p">:</span>
<a id="__codelineno-8-126" name="__codelineno-8-126"></a>        <span class="n">reduction_calculee</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">impot_a_traiter</span> <span class="o">*</span> <span class="n">TAUX_REDUCTION_20_POURCENT</span><span class="p">)</span>
<a id="__codelineno-8-127" name="__codelineno-8-127"></a>        <span class="n">impot_a_traiter</span> <span class="o">-=</span> <span class="n">reduction_calculee</span>
<a id="__codelineno-8-128" name="__codelineno-8-128"></a>        <span class="n">impot_a_traiter</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">impot_a_traiter</span><span class="p">)</span>
<a id="__codelineno-8-129" name="__codelineno-8-129"></a>
<a id="__codelineno-8-130" name="__codelineno-8-130"></a>    <span class="n">impot_final</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">impot_a_traiter</span><span class="p">)</span>
<a id="__codelineno-8-131" name="__codelineno-8-131"></a>
<a id="__codelineno-8-132" name="__codelineno-8-132"></a>    <span class="k">return</span> <span class="n">impot_final</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">decote_calculee</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">reduction_calculee</span><span class="p">)</span>
<a id="__codelineno-8-133" name="__codelineno-8-133"></a>
<a id="__codelineno-8-134" name="__codelineno-8-134"></a>
<a id="__codelineno-8-135" name="__codelineno-8-135"></a><span class="c1"># ==============================================================================</span>
<a id="__codelineno-8-136" name="__codelineno-8-136"></a><span class="c1"># TESTS UNITAIRES</span>
<a id="__codelineno-8-137" name="__codelineno-8-137"></a><span class="c1"># ==============================================================================</span>
<a id="__codelineno-8-138" name="__codelineno-8-138"></a>
<a id="__codelineno-8-139" name="__codelineno-8-139"></a><span class="k">class</span><span class="w"> </span><span class="nc">TestCalculImpot2019</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<a id="__codelineno-8-140" name="__codelineno-8-140"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_verifier_cas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">adultes</span><span class="p">,</span> <span class="n">enfants</span><span class="p">,</span> <span class="n">revenus</span><span class="p">,</span> <span class="n">attendu</span><span class="p">):</span>
<a id="__codelineno-8-141" name="__codelineno-8-141"></a>        <span class="n">impot_attendu</span><span class="p">,</span> <span class="n">decote_attendue</span><span class="p">,</span> <span class="n">reduction_attendue</span> <span class="o">=</span> <span class="n">attendu</span>
<a id="__codelineno-8-142" name="__codelineno-8-142"></a>        <span class="n">impot_calcule</span><span class="p">,</span> <span class="n">decote_calculee</span><span class="p">,</span> <span class="n">reduction_calculee</span> <span class="o">=</span> <span class="n">calculer_impot_final</span><span class="p">(</span><span class="n">adultes</span><span class="p">,</span> <span class="n">enfants</span><span class="p">,</span> <span class="n">revenus</span><span class="p">)</span>
<a id="__codelineno-8-143" name="__codelineno-8-143"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">impot_calcule</span><span class="p">,</span> <span class="n">impot_attendu</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Impôt (</span><span class="si">{</span><span class="n">impot_calcule</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">impot_attendu</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<a id="__codelineno-8-144" name="__codelineno-8-144"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">decote_calculee</span><span class="p">,</span> <span class="n">decote_attendue</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-8-145" name="__codelineno-8-145"></a>                               <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Décote (</span><span class="si">{</span><span class="n">decote_calculee</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">decote_attendue</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<a id="__codelineno-8-146" name="__codelineno-8-146"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">reduction_calculee</span><span class="p">,</span> <span class="n">reduction_attendue</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-8-147" name="__codelineno-8-147"></a>                               <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Réduction (</span><span class="si">{</span><span class="n">reduction_calculee</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">reduction_attendue</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<a id="__codelineno-8-148" name="__codelineno-8-148"></a>
<a id="__codelineno-8-149" name="__codelineno-8-149"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_cas_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verifier_cas</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">55555</span><span class="p">,</span> <span class="p">(</span><span class="mi">2815</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-8-150" name="__codelineno-8-150"></a>
<a id="__codelineno-8-151" name="__codelineno-8-151"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_cas_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verifier_cas</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">50000</span><span class="p">,</span> <span class="p">(</span><span class="mi">1385</span><span class="p">,</span> <span class="mi">384</span><span class="p">,</span> <span class="mi">346</span><span class="p">))</span>
<a id="__codelineno-8-152" name="__codelineno-8-152"></a>
<a id="__codelineno-8-153" name="__codelineno-8-153"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_cas_3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verifier_cas</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">50000</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">720</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-8-154" name="__codelineno-8-154"></a>
<a id="__codelineno-8-155" name="__codelineno-8-155"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_cas_4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verifier_cas</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100000</span><span class="p">,</span> <span class="p">(</span><span class="mi">19884</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-8-156" name="__codelineno-8-156"></a>
<a id="__codelineno-8-157" name="__codelineno-8-157"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_cas_5</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verifier_cas</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">100000</span><span class="p">,</span> <span class="p">(</span><span class="mi">16782</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-8-158" name="__codelineno-8-158"></a>
<a id="__codelineno-8-159" name="__codelineno-8-159"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_cas_6</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verifier_cas</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">100000</span><span class="p">,</span> <span class="p">(</span><span class="mi">9200</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-8-160" name="__codelineno-8-160"></a>
<a id="__codelineno-8-161" name="__codelineno-8-161"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_cas_7</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verifier_cas</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">100000</span><span class="p">,</span> <span class="p">(</span><span class="mi">4230</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-8-162" name="__codelineno-8-162"></a>
<a id="__codelineno-8-163" name="__codelineno-8-163"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_cas_8</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verifier_cas</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100000</span><span class="p">,</span> <span class="p">(</span><span class="mi">22986</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-8-164" name="__codelineno-8-164"></a>
<a id="__codelineno-8-165" name="__codelineno-8-165"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_cas_9</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verifier_cas</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">30000</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-8-166" name="__codelineno-8-166"></a>
<a id="__codelineno-8-167" name="__codelineno-8-167"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_cas_10</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verifier_cas</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">200000</span><span class="p">,</span> <span class="p">(</span><span class="mi">64211</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-8-168" name="__codelineno-8-168"></a>
<a id="__codelineno-8-169" name="__codelineno-8-169"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_cas_11</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verifier_cas</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">200000</span><span class="p">,</span> <span class="p">(</span><span class="mi">42843</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-8-170" name="__codelineno-8-170"></a>
<a id="__codelineno-8-171" name="__codelineno-8-171"></a>
<a id="__codelineno-8-172" name="__codelineno-8-172"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-8-173" name="__codelineno-8-173"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lancement des tests unitaires pour le calcul de l&#39;impôt 2019...&quot;</span><span class="p">)</span>
<a id="__codelineno-8-174" name="__codelineno-8-174"></a>    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;first-arg-is-ignored&#39;</span><span class="p">],</span> <span class="n">exit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>De nouveau je n’ai pas inspecté ce code. J’ai simplement constaté qu’il passait les 11 tests avec succès.</p>
<p>Mais on peut être curieux de connaître son raisonnement, notamment pour les cas particuliers du calcul de l’impôt. On le lui demande :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000003CB000000CDDF9AF177.png" style="display:inline-block; margin:4px;width:7.721cm;height:1.63cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>C’est un cas de hauts revenus avec à la fois un plafonnement possible de l’abattement de 10% et un plafonnement possible du quotient familial.</p>
<p>La réponse de Gemini est la suivante :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005C000000296BD44A7B9.png" style="display:inline-block; margin:4px;width:11.719cm;height:5.271cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005C000000296BD44A7B9.png" style="display:inline-block; margin:4px;width:11.719cm;height:5.271cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000003A6000000FB2E572863.png" style="display:inline-block; margin:4px;width:7.41cm;height:1.99cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000059F000002965EFBAB46.png" style="display:inline-block; margin:4px;width:11.43cm;height:5.26cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000004DB000002281DFB8BA9.png" style="display:inline-block; margin:4px;width:9.91cm;height:4.399cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Ces deux dernières copies d’écran sont intéressantes. Gemini utilise une méthode de calcul différente de celle expliquée dans le PDF. On trouve effectivement cette méthode de calcul sur internet. Les deux méthodes sont équivalentes.</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005A60000030492F1EFB5.png" style="display:inline-block; margin:4px;width:11.43cm;height:6.1cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000060100000389755C6646.png" style="display:inline-block; margin:4px;width:12.16cm;height:7.16cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005BF0000008EDB839B7F.png" style="display:inline-block; margin:4px;width:11.7cm;height:1.131cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>L’explication est remarquable par sa clarté. On pourrait la donner telle-quelle à des étudiants pour expliquer la méthode de calcul de l’impôt.</p>
<p>Maintenant prenons un autre exemple cette fois-ci avec des faibles revenus. Dans ce cas, il peut y avoir décote et réduction :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000415000000F040474052.png" style="display:inline-block; margin:4px;width:8.32cm;height:1.91cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>La réponse de Gemini est la suivante :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000060B00000180A9BB231F.png" style="display:inline-block; margin:4px;width:12.33cm;height:3.06cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005E1000001F990D4EEB1.png" style="display:inline-block; margin:4px;width:12.01cm;height:4.03cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000033500000178E47E7A07.png" style="display:inline-block; margin:4px;width:6.53cm;height:2.99cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005D30000035E1B76539B.png" style="display:inline-block; margin:4px;width:11.85cm;height:6.849cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005B200000248B0E063BD.png" style="display:inline-block; margin:4px;width:11.561cm;height:4.63cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Ici, on constate que Gemini applique une règle qui n’est pas dans le PDF. Il l’a probablement trouvée sur internet, mais la source est-elle fiable ?</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000585000002521BC6988A.png" style="display:inline-block; margin:4px;width:11.16cm;height:4.69cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Ici, Gemini continue d’appliquer une règle inconnue (la règle spéciale ci-dessus).</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000593000001E382ED0975.png" style="display:inline-block; margin:4px;width:11.291cm;height:3.821cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005800000016726EA43CA.png" style="display:inline-block; margin:4px;width:11.18cm;height:2.85cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005DA000002BD4B2FC856.png" style="display:inline-block; margin:4px;width:11.86cm;height:5.549cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Donc les résultats de Gemini collent avec le résultat du simulateur officiel des impôts. Mais il a utilisé une règle non présente dans le PDF. Où est l’erreur ? On le lui demande en lui joignant le PDF :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000416000001EF5AA156F3.png" style="display:inline-block; margin:4px;width:8.31cm;height:3.93cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>La réponse de Gemini :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005D3000001EFCF8D7D70.png" style="display:inline-block; margin:4px;width:11.869cm;height:3.941cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000588000002B318948C16.png" style="display:inline-block; margin:4px;width:11.291cm;height:5.51cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000597000002E3FB545528.png" style="display:inline-block; margin:4px;width:11.291cm;height:5.83cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005E30000035B9C2D196E.png" style="display:inline-block; margin:4px;width:12cm;height:6.84cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Je pense que Gemini a raison et que mon PDF est erroné. Pour le vérifier, je lui demande un test :</p>
<ul>
<li>Où son raisonnement donnerait les mêmes résultats que le simulateur d’impôt officiel ;</li>
<li>Où le raisonnement du PDF donnerait lui des résultats différents de ceux du simulateur ;</li>
</ul>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000405000000FB47B49A7E.png" style="display:inline-block; margin:4px;width:8.16cm;height:1.99cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>La réponse de Gemini est la suivante :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005870000030B9E34F7FD.png" style="display:inline-block; margin:4px;width:11.299cm;height:6.219cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Ici Gemini se trompe. J’ai lancé le simulateur sur cet exemple et j’ai trouvé la chose suivante :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000004FE000001EE9E9F7013.png" style="display:inline-block; margin:4px;width:10.111cm;height:3.911cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Cependant, on va découvrir que le raisonnement de Gemini donne bien les résultats ci-dessus. On continue :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000043600000223A23C8B0F.png" style="display:inline-block; margin:4px;width:8.55cm;height:4.339cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000054000000162207630C3.png" style="display:inline-block; margin:4px;width:10.67cm;height:2.81cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005AA000001A6A3444CFA.png" style="display:inline-block; margin:4px;width:11.58cm;height:3.371cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000056C0000012CDC351913.png" style="display:inline-block; margin:4px;width:11.06cm;height:2.39cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Très bien. C’est noté. On continue :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000003FE00000195A7D13560.png" style="display:inline-block; margin:4px;width:8.1cm;height:3.21cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000058F000001E583770344.png" style="display:inline-block; margin:4px;width:11.299cm;height:3.851cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005BE000002CD1B027AA5.png" style="display:inline-block; margin:4px;width:11.71cm;height:5.71cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000063D00000236E17EB418.png" style="display:inline-block; margin:4px;width:12.64cm;height:4.48cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Donc Gemini a trouvé (impôt, décote, réduction)= (431, 325, 1296) alors que le simulateur utilisé par mes soins donne (431, 324, 1297). Donc Gemini a trouvé les bons résultats à 1 euro près mais il ne le sait pas. On le lui dit :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000409000001164220E9AB.png" style="display:inline-block; margin:4px;width:8.209cm;height:2.21cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Gemini répond :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000591000002752BC84F39.png" style="display:inline-block; margin:4px;width:11.31cm;height:4.99cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005980000017F4E8B85A2.png" style="display:inline-block; margin:4px;width:11.441cm;height:3.06cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Maintenant, on se demande si Gemini pourrait générer un PDF corrigé :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000003E6000001080BB60B4D.png" style="display:inline-block; margin:4px;width:7.939cm;height:2.101cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>La réponse de Gemini :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005A1000001BE18243C92.png" style="display:inline-block; margin:4px;width:11.441cm;height:3.54cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Gemini ne m’a donc pas donné de lien vers un PDF, mais il a généré un texte pour générer moi-même ce PDF. Bien que ce soit encombrant de donner ici, les copies d’écran du PDF, je le fais pour que le lecteur voie le côté génératif de l’IA :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000002420000027B7881D51E.png" style="display:inline-block; margin:4px;width:4.59cm;height:5.039cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p><img src="images/10000000000004F800000370F7E223F9.png" style="width:10.1cm;height:6.99cm;" alt="Image" /></p>
<p><img src="images/1000000000000505000002376BAB1040.png" style="width:10.22cm;height:4.51cm;" alt="Image" /></p>
<p><img src="images/10000000000004800000043415504A01.png" style="width:9.14cm;height:8.541cm;" alt="Image" /></p>
<p><img src="images/1000000000000442000001A79A36B8A7.png" style="width:8.661cm;height:3.36cm;" alt="Image" /></p>
<p><img src="images/100000000000048700000353B7B487F9.png" style="width:9.19cm;height:6.75cm;" alt="Image" /></p>
<p><img src="images/10000000000004C40000012D14FEB4F7.png" style="width:9.691cm;height:2.39cm;" alt="Image" /></p>
<p><img src="images/10000000000004F60000040570F8B67C.png" style="width:10.111cm;height:8.19cm;" alt="Image" /></p>
<p><img src="images/1000000000000499000002A3247DC320.png" style="width:9.35cm;height:5.36cm;" alt="Image" /></p>
<p><img src="images/1000000000000505000000D2FFFBBAA5.png" style="width:10.22cm;height:1.67cm;" alt="Image" /></p>
<p><img src="images/10000000000004900000021AB2E4E1F6.png" style="width:9.269cm;height:4.27cm;" alt="Image" /></p>
<p><img src="images/1000000000000406000001290E25B2C4.png" style="width:8.19cm;height:2.36cm;" alt="Image" /></p>
<p><img src="images/1000000000000524000003C5ABCF322B.png" style="width:10.43cm;height:7.65cm;" alt="Image" /></p>
<p><img src="images/10000000000004F5000002BC88AFDE39.png" style="width:10.111cm;height:5.579cm;" alt="Image" /></p>
<p>Honnêtement je n’ai pas vérifié si tout ce qui est dit dans ce PDF est vrai. En tout cas, c’est un document parfait pour un TD, généré en quelques secondes.</p>
<p>Néanmoins, on peut faire vérifier par Gemini lui-même que son PDF est bon. On démarre une nouvelle conversation :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000003B3000001559B479E5C.png" style="display:inline-block; margin:4px;width:7.53cm;height:2.709cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<ul>
<li>en [1], on a mis le PDF généré par Gemini [Le problème selon Gemini.pdf] ;</li>
<li>en [2], [instructionsAvecPDF2.txt] est identique aux instructions de [instructionsAvecPDF.txt], si ce n’est qu’on a ajouté un douzième test unitaire, celui-là même qui a montré que le PDF initial était erroné :
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="n">test12</span> <span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">49500</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="mi">1297</span><span class="p">,</span> <span class="mi">431</span><span class="p">,</span> <span class="mi">324</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></li>
</ul>
<p>Curieusement il a fallu plusieurs allers-retours avant que Gemini génère le bon script :</p>
<p>Question 2</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000003FD000000CDD0816227.png" style="display:inline-block; margin:4px;width:8.119cm;height:1.63cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Question 3</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000264000001632B56E6B4.png" style="display:inline-block; margin:4px;width:4.86cm;height:2.82cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Comme il a été fait maintenant plusieurs fois, lorsque le script généré et chargé dans PyCharm échoue, on donne à Gemini le fichier texte des logs de l’exécution. Gemini les comprend très bien.</p>
<p>Question 4</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000023A0000015C35998FBC.png" style="display:inline-block; margin:4px;width:4.521cm;height:2.76cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Question 5</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000020800000163BA5E81D1.png" style="display:inline-block; margin:4px;width:4.129cm;height:2.82cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Question 6 et fin</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000063E000002448A0217B7.png" style="display:inline-block; margin:4px;width:10.56cm;height:3.829cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000022200000305A3DB8DAC.png" style="display:inline-block; margin:4px;width:4.339cm;height:6.14cm;" /></td></tr></table>

<p>Maintenant nous sommes rassurés sur la validité du PDF généré par Gemini. Les règles de calcul qui y sont données sont correctes.</p>
<p>Nous allons maintenant faire la même chose pour les cinq autres IA mais nous serons très brefs dans nos explications, sauf pour ChatGPT l’IA leader du moment. Ce qui nous intéresse c’est de savoir si l’IA résoud ou non les trois problèmes qu’on lui pose. En effet, les interfaces de toutes ces IA sont très analogues et j’ai procédé avec elles comme avec Gemini. Le lecteur est encouragé à rejouer les conversations Gemini avec l’IA de son choix.</p>









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner">

      <div>
        <a href="https://tahe.developpez.com" target="_blank">
          https://tahe.developpez.com
        </a>
        <br>
        Ce cours tutoriel écrit par <strong>Serge Tahé</strong> est mis à disposition du public selon les termes de la
        <em>Licence Creative Commons Attribution – Pas d’Utilisation Commerciale –
        Partage dans les Mêmes Conditions 3.0 non transposé</em>.
      </div>

    </div>
  </div>

      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": ".", "features": ["navigation.sections", "navigation.indexes", "toc.integrate", "navigation.top"], "search": "assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="javascripts/focus.js"></script>
      
    
  </body>
</html>