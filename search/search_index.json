{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"index.html","title":"Accueil","text":"<p>G\u00e9n\u00e9rer un script Python avec des outils d\u2019IA</p> <p>Serge Tah\u00e9, septembre 2025</p>"},{"location":"conclusion.html","title":"11. Conclusion","text":"<p>Des paragraphes qui pr\u00e9c\u00e8dent, on retiendra que seules les IA [ChatGPT, Grok, Gemini] ont su r\u00e9soudre les trois probl\u00e8mes propos\u00e9s. On retiendra \u00e9galement que les tests 2 et 3 ont \u00e9t\u00e9 faits sur un exemple pr\u00e9cis, celui d\u2019une g\u00e9n\u00e9ration de code Python, et qu\u2019il ne faut donc pas g\u00e9n\u00e9raliser cette conclusion. Mais sur ce probl\u00e8me pr\u00e9cis de g\u00e9n\u00e9ration de code Python, les IA qui ont r\u00e9solu les probl\u00e8mes 2 et 3 se sont montr\u00e9es bien sup\u00e9rieures aux autres IA.</p>"},{"location":"installation-dx27un-environnement-de-travail.html","title":"3. Installation d'un environnement de travail","text":"<p>Nous montrons ici l\u2019environnement de travail utilis\u00e9 pour tester les scripts Python g\u00e9n\u00e9r\u00e9s par l\u2019IA. Ce paragraphe est pour les d\u00e9butants en Python. Si vous avez d\u00e9j\u00e0 un environnement de travail Python, passez la totalit\u00e9 de ce paragraphe et allez au paragraphe suivant.</p>"},{"location":"installation-dx27un-environnement-de-travail.html#31-python-3137","title":"3.1. Python 3.13.7","text":"<p>Les exemples de ce document ont \u00e9t\u00e9 test\u00e9s avec l'interpr\u00e9teur Python 3.13.7 disponible \u00e0 l'URL |https://www.python.org/downloads/| (ao\u00fbt 2025) sur une machine Windows 10\u00a0:</p> <p></p> <p>En [1-2] t\u00e9l\u00e9chargez l\u2019ex\u00e9cutable de l\u2019installateur de Python puis ex\u00e9cutez-le.</p> <p>L'installation de Python donne naissance \u00e0 l'arborescence de fichiers [1] suivante\u00a0:</p> <p></p> <p>Pour ex\u00e9cuter Python en mode interactif, double-cliquez sur [2]. Voici un exemple de code Python \u00e0 ex\u00e9cuter\u00a0:</p> <p></p> <p>Le prompt &gt;&gt;&gt; permet d'\u00e9mettre une instruction Python qui est imm\u00e9diatement ex\u00e9cut\u00e9e. Le code tap\u00e9 ci-dessus a la signification suivante\u00a0:</p> <pre><code>&gt;&gt;&gt; nom=\"tintin\"\n&gt;&gt;&gt; print(\"nom=%s\" % nom)\nnom=tintin\n&gt;&gt;&gt; print(\"type=%s\" % type(nom))\ntype=&lt;class 'str'&gt;\n&gt;&gt;&gt;\n</code></pre> <p>Lignes\u00a0:</p> <ul> <li>1\u00a0: initialisation d'une variable. En Python, on ne d\u00e9clare pas le type des variables. Celles-ci ont automatiquement le type de la valeur qu'on leur affecte. Ce type peut changer au cours du temps\u00a0;</li> <li>2\u00a0: affichage du nom. 'nom=%s' est un format d'affichage o\u00f9 %s est un param\u00e8tre formel d\u00e9signant une cha\u00eene de caract\u00e8res. nom est le param\u00e8tre effectif qui sera affich\u00e9 \u00e0 la place de %s\u00a0;</li> <li>3\u00a0: le r\u00e9sultat de l'affichage\u00a0;</li> <li>4\u00a0: l'affichage du type de la variable nom\u00a0;</li> <li>5\u00a0: la variable nom est ici de type class. Avec Python 2.7 elle aurait la valeur &lt;type 'str'&gt;\u00a0; Maintenant, ouvrons une console Windows\u00a0:</li> </ul> <p></p> <p>Le fait qu'on ait pu taper [python] en [1] et que l'ex\u00e9cutable [python.exe] ait \u00e9t\u00e9 trouv\u00e9 montre que celui-ci est dans le PATH de la machine Windows. C'est important car cela signifie que les outils de d\u00e9veloppement Python sauront trouver l'interpr\u00e9teur Python. On peut le v\u00e9rifier ainsi\u00a0:</p> <p></p> <ul> <li>En [1], on quitte l'interpr\u00e9teur Python\u00a0;</li> <li>En [2], la commande qui affiche le PATH des ex\u00e9cutables de la machine Windows\u00a0;</li> <li>En [3], on voit que le dossier de l'interpr\u00e9teur Python 3.13 fait partie du PATH\u00a0;</li> </ul>"},{"location":"installation-dx27un-environnement-de-travail.html#32-lide-pycharm-community","title":"3.2. L'IDE PyCharm Community","text":"<p>Pour construire et ex\u00e9cuter les scripts de ce document, nous avons utilis\u00e9 l'\u00e9diteur [PyCharm] Edition Community disponible (ao\u00fbt 2025) \u00e0 l'URL |https://www.jetbrains.com/fr-fr/pycharm/download/#section=windows|\u00a0:</p> <p></p> <p></p> <p>T\u00e9l\u00e9chargez l'IDE PyCharm Community (ici pour Windows) [1-4] et installez-le.</p> <p>Lan\u00e7ons l'IDE PyCharm. Un panneau de configuration appara\u00eet\u00a0:</p> <p></p> <ul> <li>En [1] pour cr\u00e9er l\u2019ic\u00f4ne PyCharm sur le bureau\u00a0;</li> <li>En [2] pour ouvrir n\u2019importe quel dossier du syst\u00e8me de fichiers comme un projet Python\u00a0;</li> <li>En [3], les fichiers Python auront le suffixe .py\u00a0;</li> <li>En [4], passer \u00e0 l\u2019\u00e9tape suivante\u00a0; La fen\u00eatre suivante propose de nouveau de la configuration\u00a0[1] :</li> </ul> <p></p> <ul> <li>En [2], on prend le th\u00e8me [Light]. Le lecteur prendra le th\u00e8me de son choix\u00a0;</li> <li>En [3], on laisse l\u2019IDE en anglais\u00a0;</li> <li>En [4], on garde les raccourcis de Windows\u00a0;  Cr\u00e9ons un premier projet Python\u00a0[1-2] :</li> </ul> <p></p> <p>Cela ouvre la fen\u00eatre suivante\u00a0:</p> <p></p> <ul> <li>En [2], indiquer le nom du dossier \u00e0 cr\u00e9er pour le projet\u00a0;</li> <li>En [3], indiquer que les diff\u00e9rentes versions du code qui seront sauvegard\u00e9es seront g\u00e9r\u00e9es par le gestionnaire de versions Git. PyCharm permet d\u2019en utiliser d\u2019autres\u00a0;</li> <li>En [4-6], indiquer que votre projet va utiliser un environnement virtuel. L\u2019environnement virtuel va cr\u00e9er un dossier [.venv] \u00e0 la racine du projet. Tous les plugins (packages) utilis\u00e9s par votre projet iront dans ce dossier. Cela assure une \u00e9tanch\u00e9it\u00e9 entre projets lorsqu\u2019il y a recherche de plugins. Le projet ne cherche ses plugins que dans son propre environnement virtuel [.venv]\u00a0et pas ailleurs o\u00f9 il pourrait trouver des plugins de m\u00eames noms mais de versions peut-\u00eatre diff\u00e9rentes qui sont parfois partiellement incompatibles entre elles\u00a0; L'IDE PyCharm pr\u00e9sente le projet cr\u00e9\u00e9 sous la forme suivante\u00a0:</li> </ul> <p></p> <ul> <li>En [1-2], l\u2019arborescence du projet\u00a0;</li> <li>En [3], le dossier du projet\u00a0;</li> <li>En [4], le dossier de l\u2019environnement virtuel du projet. C\u2019est dans ce dossier que s\u2019installeront les plugins que nous utiliserons pour le projet\u00a0; Avant de commencer \u00e0 coder, allons plus loin dans la configuration de l\u2019IDE\u00a0:</li> </ul> <p></p> <ul> <li>Cliquer sur [1]\u00a0pour faire appara\u00eetre le menu principal ;</li> </ul> <p></p> <ul> <li>En [1-2], configurez l\u2019IDE\u00a0;</li> </ul> <p></p> <ul> <li>En [1-4], indiquez que vous voulez voir le menu principal au-dessus de la barre d\u2019outils principale. Rien ne vous y oblige. On le fait ici pour \u00e9clairer les copies d\u2019\u00e9cran qui sont produites dans ce document. Validez votre changement\u00a0; D\u00e9sormais, le menu principal est toujours affich\u00e9\u00a0[1] :</li> </ul> <p></p> <p>Continuons la configuration\u00a0de l\u2019IDE :</p> <p></p> <p>En haut \u00e0 droite de la fen\u00eatre de PyCharm, on propose d\u2019essayer la version pro de PyCharm. Selon la fa\u00e7on dont vous avez install\u00e9 PyCharm, il se peut m\u00eame que la version pro ait \u00e9t\u00e9 install\u00e9e d\u2019office (2025). Cela am\u00e8ne des options de menu suppl\u00e9mentaires.</p> <p></p> <p>Si vous avez install\u00e9 la version pro d\u2019\u00e9valuation pour un essai d\u2019un mois, vous avez le message [2] en haut \u00e0 droite.</p> <p>Toujours pour la coh\u00e9rence des copies d\u2019\u00e9cran qui vont suivre, je montre comment annuler la version d\u2019essai pro de l\u2019IDE\u00a0(vous pouvez y revenir quand vous voulez) :</p> <p></p> <ul> <li>En [1-2], g\u00e9rez les souscriptions de votre IDE\u00a0;</li> </ul> <p></p> <ul> <li>En [1], d\u00e9sactivez la version pro. L\u2019IDE va se relancer\u00a0; Maintenant configurons l\u2019interpr\u00e9teur Python qui va ex\u00e9cuter notre projet. Nous nous souvenons d\u2019en avoir t\u00e9l\u00e9charg\u00e9 un lors d\u2019une \u00e9tape pr\u00e9c\u00e9dente\u00a0:</li> </ul> <p></p> <p></p> <ul> <li>En [1-3], nous configurons l\u2019interpr\u00e9teur Python du projet\u00a0;</li> <li>En [4], le chemin de l\u2019interpr\u00e9teur\u00a0;</li> <li>En [5], les packages (plugins) associ\u00e9s \u00e0 cet interpr\u00e9teur\u00a0; En [4], d\u00e9couvrons le chemin complet de l\u2019interpr\u00e9teur utilis\u00e9\u00a0:</li> </ul> <p></p> <p></p> <ul> <li>En [3], on d\u00e9couvre que l\u2019interpr\u00e9teur Python utilis\u00e9 se trouve dans le dossier de l\u2019environnement virtuel du projet [.venv]\u00a0; Il est possible de changer d\u2019interpr\u00e9teur Python, ce qui peut changer les plugins disponibles au projet\u00a0:</li> </ul> <p></p> <ul> <li>En [4], ajoutez un interpr\u00e9teur Python\u00a0;</li> </ul> <p></p> <ul> <li>En [5], ajoutez un interpr\u00e9teur local. PyCharm va alors explorer le PATH de la machine \u00e0 la recherche d\u2019un binaire [python.exe]\u00a0;</li> </ul> <p></p> <ul> <li>En [1], indiquez que le nouvel interpr\u00e9teur doit utiliser l\u2019environnement virtuel [.venv] existant du projet\u00a0;</li> <li>En [2], l\u2019IDE propose comme interpr\u00e9teur l\u2019application Python install\u00e9e dans une \u00e9tape pr\u00e9c\u00e9dente\u00a0;</li> <li>Validez ce choix\u00a0;</li> </ul> <p></p> <ul> <li>En [4], le nouvel interpr\u00e9teur\u00a0;</li> <li>En [5], les packages auxquels aura acc\u00e8s le projet. C\u2019est la principale diff\u00e9rence amen\u00e9e par le changement d\u2019interpr\u00e9teur. Si vous g\u00e9rez plusieurs projets qui utilisent diff\u00e9rents packages il est pr\u00e9f\u00e9rable d\u2019utiliser les packages de l\u2019environnement virtuel de chaque projet. Ainsi vous avez le contr\u00f4le des versions des plugins que vous utilisez. Pour cette raison, nous garderons l\u2019interpr\u00e9teur de l\u2019environnement virtuel\u00a0:</li> </ul> <p></p> <p></p> <p>Allons un peu plus loin dans la configuration\u00a0:</p> <ul> <li>En [1-2], entrez dans le mode configuration de l\u2019IDE\u00a0;</li> <li>En [3-4], configurez des options du syst\u00e8me\u00a0;</li> <li>En [5], pas de confirmation avant de quitter l\u2019IDE\u00a0;</li> <li>En [6], lorsqu\u2019on quitte l\u2019IDE et qu\u2019il y a un processus en cours d\u2019ex\u00e9cution lanc\u00e9 par le code ex\u00e9cut\u00e9, on arr\u00eate celui-ci\u00a0;</li> <li>En [7], lorsque l\u2019IDE est lanc\u00e9e, on ne rouvre pas automatiquement le dernier projet utilis\u00e9. On laisse l\u2019utilisateur choisir son projet\u00a0;</li> <li>En [8], lorsque l\u2019utilisateur g\u00e8re plusieurs projets en m\u00eame temps, chaque projet a sa fen\u00eatre personnelle\u00a0;</li> <li>En [9], on a d\u00e9sign\u00e9 le dossier par d\u00e9faut de notre projet\u00a0; Maintenant nous pouvons commencer \u00e0 coder. Commen\u00e7ons par cr\u00e9er un dossier dans lequel nous mettrons notre premier script Python\u00a0:</li> </ul> <ul> <li>Cliquer droit sur le projet, puis [1-3] pour cr\u00e9er un dossier\u00a0;</li> <li>En [4], tapez le nom du dossier\u00a0: il sera cr\u00e9\u00e9 dans le dossier du projet\u00a0;</li> </ul> <p></p> <p>Puis cr\u00e9ons un script Python\u00a0:</p> <p>Cliquer droit sur le dossier [bases], puis [1-4]\u00a0:</p> <ul> <li>Rappelons-nous ici que nous avons inclus le gestionnaire de versions Git \u00e0 notre projet. Cela s\u2019est fait lors de la cr\u00e9ation du projet o\u00f9 nous avons coch\u00e9 l\u2019option Git. Git peut prendre des photos du projet \u00e0 diff\u00e9rentes \u00e9tapes de celui-ci. Ici en [1-3], l\u2019IDE nous demande si nous voulons inclure le fichier [bases.py] que nous sommes en train de cr\u00e9er dans la photo. Nous r\u00e9pondons oui [3]. Par ailleurs nous cochons [2] pour que cela soit fait syst\u00e9matiquement \u00e0 la cr\u00e9ation d\u2019un fichier. Nous reviendrons bri\u00e8vement sur Git un peu plus loin\u00a0;</li> <li>En [4-5], le script [bases_01] a \u00e9t\u00e9 cr\u00e9\u00e9 et est pr\u00eat \u00e0 \u00eatre \u00e9dit\u00e9\u00a0; \u00c9crivons notre premier script\u00a0:</li> </ul> <ul> <li>Lignes 1, 3\u00a0: les commentaires commencent avec le signe #\u00a0;</li> <li>Ligne 2\u00a0: initialisation d'une variable. Python ne d\u00e9clare pas le type de ses variables\u00a0;</li> <li>Ligne 4\u00a0: affichage \u00e9cran. La syntaxe utilis\u00e9e ici est [format % donn\u00e9es] avec\u00a0:</li> <li>format\u00a0: nom=%s o\u00f9 %s d\u00e9signe l'emplacement d'une cha\u00eene de caract\u00e8res. Celle-ci sera trouv\u00e9e dans la partie [donn\u00e9es] de l'expression\u00a0;</li> <li>donn\u00e9es\u00a0: la valeur de la variable [nom] viendra remplacer le format %s dans la cha\u00eene de format\u00a0;</li> <li>Avec [1-2], on reformate le code selon les recommandations de l'organisme g\u00e9rant Python. On peut aussi taper au clavier la s\u00e9quence Ctrl-Alt-L\u00a0; Sur la copie d\u2019\u00e9cran on voit que certains textes sont soulign\u00e9s. PyCharm signale des erreurs d\u2019orthographe dans les commentaires et cha\u00eenes de caract\u00e8res. Il les appelle des typos. Il est par d\u00e9faut configur\u00e9 pour des textes en anglais. Pour \u00e9viter le signalement des typos en fran\u00e7ais, proc\u00e9dons comme suit\u00a0:</li> </ul> <ul> <li>En [1-2], configurons l\u2019IDE\u00a0;</li> <li>En [3-6], d\u00e9sactivons l\u2019option [Proofreading] de l\u2019\u00e9diteur\u00a0;</li> </ul> <p>En [7], le signalement des typos a disparu. Le script est ex\u00e9cut\u00e9 avec un clic sur l\u2019ic\u00f4ne [8] de la barre d\u2019outils principale. Le r\u00e9sultat est le suivant\u00a0:</p> <p></p> <ul> <li>En [1-2], une fen\u00eatre de r\u00e9sultats s\u2019est ouverte\u00a0;</li> <li>En [3], on voit que le code de [bases_01.py] a \u00e9t\u00e9 ex\u00e9cut\u00e9 par l\u2019interpr\u00e9teur Python de l\u2019environnement virtuel du projet\u00a0;</li> <li>En [4], le r\u00e9sultat de l\u2019ex\u00e9cution\u00a0; Pour ex\u00e9cuter les scripts de ce document, t\u00e9l\u00e9chargez le code \u00e0 l'URL |G\u00e9n\u00e9rer un script Python avec des outils d'IA| (cloud OneDrive) puis dans PyCharm proc\u00e9dez comme suit\u00a0:</li> </ul> <ul> <li>En [1-2], fermez le projet sur lequel vous \u00eates en train de travailler\u00a0;</li> </ul> <p></p> <ul> <li>En [1], on choisit l\u2019option [Projects]\u00a0;</li> <li>Dans la fen\u00eatre [2], on a la liste des derniers projets sur lesquels on a travaill\u00e9\u00a0;</li> <li>En [3], on indique qu\u2019on veut ouvrir un projet existant\u00a0;</li> </ul> <ul> <li>En [1], on ouvre le dossier qu\u2019on a t\u00e9l\u00e9charg\u00e9\u00a0;</li> </ul> <ul> <li>En [1-2], le projet PyCharm\u00a0;  Configurons ce projet pour qu\u2019il ait\u00a0un environnement virtuel d\u2019ex\u00e9cution\u00a0:</li> </ul> <ul> <li>En [1-2], on configure le nouveau projet\u00a0;</li> </ul> <ul> <li>En [3-4], on configure un interpr\u00e9teur pour le projet\u00a0;</li> </ul> <ul> <li>En [5-6], on choisit un environnement virtuel d\u2019ex\u00e9cution\u00a0;</li> </ul> <ul> <li>En [7], le nouvel interpr\u00e9teur Python utilis\u00e9 pour le projet\u00a0; Ceci fait, vous pouvez ex\u00e9cuter les scripts du projet\u00a0:</li> </ul>"},{"location":"introduction.html","title":"1. Introduction","text":"<p>On se propose ici de reprendre un probl\u00e8me expos\u00e9 en 2020 dans le cours [python3-flask-2020]. Ce cours prenait comme base un calcul d\u2019imp\u00f4t simplifi\u00e9 pour l\u2019ann\u00e9e 2019. Un script Python \u00e9tait d\u00e9velopp\u00e9 pour r\u00e9soudre le probl\u00e8me puis d\u00e9clin\u00e9 en de multiples versions (18) jusqu\u2019\u00e0 porter le calcul de l\u2019imp\u00f4t dans une application web MVC.</p> <p>On se propose ici de montrer que le script initial du calcul de l\u2019imp\u00f4t peut \u00eatre d\u00e9sormais g\u00e9n\u00e9r\u00e9 par des outils d\u2019IA (Intelligence Artificielle). On a utilis\u00e9 sept outils\u00a0: ChatGPT, Grok, Gemini, MistralAI, DeepSeek, ClaudeAI, Perplexity. Il en existe d\u2019autres.</p> <p>Le document ne n\u00e9cessite pas forc\u00e9ment de conna\u00eetre le langage Python. Les sept outils doivent g\u00e9n\u00e9rer un script Python comportant au d\u00e9but 11 tests unitaires, puis pour finir 25 tests. Il suffit de charger ce code dans un environnement de travail Python, de l\u2019ex\u00e9cuter et de v\u00e9rifier que les tests sont r\u00e9ussis. Ensuite ce code g\u00e9n\u00e9r\u00e9 peut \u00eatre consid\u00e9r\u00e9 comme \u00ab\u00a0probablement correct\u00a0\u00bb. L\u2019utilisateur Python lui s\u2019int\u00e9ressera davantage au code. Il s\u2019apercevra alors que les scripts Python g\u00e9n\u00e9r\u00e9s sont en g\u00e9n\u00e9ral tr\u00e8s bien \u00e9crits.</p> <p>Par ailleurs, ce document montre que les outils d\u2019IA utilis\u00e9s sont d\u2019un usage plut\u00f4t facile et que le dialogue entre l\u2019utilisateur (vous) et l\u2019outil d\u2019IA n\u2019est pas diff\u00e9rent de celui qu\u2019aurait un enseignant avec son \u00e9l\u00e8ve / \u00e9tudiant.</p> <p>Ce document a \u00e9t\u00e9 \u00e9crit en septembre 2025. L\u2019IA \u00e9volue vite et il est possible que les copies d\u2019\u00e9cran qui suivent deviennent rapidement obsol\u00e8tes. Si vous posez les m\u00eames questions que le document, il est tr\u00e8s plausible que vous obteniez des r\u00e9ponses diff\u00e9rentes que celles obtenues ici. Suivez simplement le processus d\u2019affinage de vos instructions, montr\u00e9 ici, pour aider l\u2019IA.</p> <p>Vous pouvez t\u00e9l\u00e9charger les codes et fichiers de ce tutoriel \u00e0 l\u2019adresse\u00a0: [G\u00e9n\u00e9rer un script Python avec des outils d'IA] :</p>"},{"location":"les-trois-problemes-etudies-et-les-resultats.html","title":"2. Les trois probl\u00e8mes \u00e9tudi\u00e9s et les r\u00e9sultats","text":"<p>On va demander aux IA d\u2019\u00e9tudier trois probl\u00e8mes du plus simple au plus compliqu\u00e9. Regardons une copie d\u2019\u00e9cran de Google Gemini\u00a0:</p> <ul> <li>En [1], l\u2019URL de Gemini\u00a0;</li> <li>En [2], la version de Gemini utilis\u00e9e\u00a0;</li> <li>En [3-5], les trois probl\u00e8mes pos\u00e9s \u00e0 Gemini\u00a0;</li> </ul>"},{"location":"les-trois-problemes-etudies-et-les-resultats.html#21-probleme-1","title":"2.1. Probl\u00e8me 1","text":"<p>Le probl\u00e8me 1 est une simple question\u00a0:</p> <p>Toutes les IA r\u00e9pondront correctement \u00e0 cette question.</p>"},{"location":"les-trois-problemes-etudies-et-les-resultats.html#22-probleme-2","title":"2.2. Probl\u00e8me 2","text":"<p>Le probl\u00e8me 2 est le suivant (copie d\u2019\u00e9cran de Gemini)\u00a0:</p> <ul> <li>En [1], le principe du calcul de l\u2019imp\u00f4t 2019 sur les revenus 2018 est expliqu\u00e9 dans un PDF. Nous y reviendrons\u00a0;</li> <li>En [2], on donne des instructions pr\u00e9cises \u00e0 Gemini sur ce qu\u2019on veut, un script Python propre qui r\u00e9sout le probl\u00e8me pos\u00e9 et qui valide la solution propos\u00e9e avec 11 tests unitaires\u00a0;</li> <li>En [3], pour lancer Gemini on doit \u00e9crire quelque chose\u00a0; On est l\u00e0 exactement dans le m\u00eame cas que celui d\u2019un TD donn\u00e9 \u00e0 l\u2019universit\u00e9.</li> </ul> <p>Les IA test\u00e9es vont r\u00e9soudre le probl\u00e8me \u00e0 l\u2019exception de MistralAI et Perplexity.</p>"},{"location":"les-trois-problemes-etudies-et-les-resultats.html#23-probleme-3","title":"2.3. Probl\u00e8me 3","text":"<p>Toujours avec une copie d\u2019\u00e9cran de Google Gemini, le probl\u00e8me 3 est le suivant\u00a0:</p> <ul> <li>En [1] on donne nos instructions, les m\u00eames que pr\u00e9c\u00e9demment. Mais comme on ne donne pas le PDF qui donnait les r\u00e8gles exactes de calcul. L\u2019IA va devoir chercher ces r\u00e8gles sur internet\u00a0;</li> <li> <p>En [3], on lance l\u2019ex\u00e9cution de l\u2019IA\u00a0; Seules trois IA ont pass\u00e9 ce test, dans l\u2019ordre d\u2019excellence\u00a0(avis strictement personnel, cela va de soi)\u00a0:</p> </li> <li> <p>ChatGPT d\u2019OpenAI\u00a0;</p> </li> <li>Grok de xAI\u00a0; </li> <li>Goggle Gemini\u00a0; L\u2019IA ClaudeAI a \u00e9chou\u00e9 sur le probl\u00e8me 3. L\u2019IA MistralAI a \u00e9chou\u00e9 sur les probl\u00e8mes 2 et 3, de m\u00eame que l\u2019IA Perplexity. L\u2019IA DeepSeek a \u00e9chou\u00e9 sur le probl\u00e8me 3.</li> </ul>"},{"location":"resolution-des-trois-problemes-avec-chatgpt.html","title":"5. R\u00e9solution des trois probl\u00e8mes avec ChatGPT","text":""},{"location":"resolution-des-trois-problemes-avec-chatgpt.html#51-introduction","title":"5.1. Introduction","text":"<p>Voici une premi\u00e8re copie d\u2019\u00e9cran d\u2019une session ChatGPT\u00a0:</p> <ul> <li>En [1-3], les trois probl\u00e8mes pos\u00e9s \u00e0 ChatGPT\u00a0;</li> <li>En [4], l\u2019URL de ChatGPT\u00a0;</li> <li>En [5], la version de ChatGPT utilis\u00e9e\u00a0; ChatGPT est un produit de OpenAI disponible \u00e0 l\u2019URL [https://chatgpt.com/]. Pour avoir un historique de vos sessions de questions / r\u00e9ponses comme ci-dessus, il vous faut cr\u00e9er un compte. Par ailleurs, comme toutes les autres IA test\u00e9es, ChatGPT limite le nombre de vos questions et le nombre de fichiers t\u00e9l\u00e9charg\u00e9s. Quand cette limite est atteinte, la session est termin\u00e9e et on vous propose de la continuer plus tard dans le temps. Les limites impos\u00e9es par ChatGPT sont atteintes tr\u00e8s rapidement. Pour faire ce tutoriel, j\u2019ai du prendre un abonnement payant d\u2019un mois.</li> </ul> <p>L\u2019interface de ChatGPT est la suivante\u00a0:</p> <ul> <li>En [1], pour joindre des fichiers \u00e0 la question pos\u00e9e\u00a0;</li> <li>En [2], la question pos\u00e9e\u00a0;</li> <li>En [3], pour lancer l\u2019ex\u00e9cution de l\u2019IA\u00a0;</li> </ul>"},{"location":"resolution-des-trois-problemes-avec-chatgpt.html#52-le-probleme-1","title":"5.2. Le probl\u00e8me 1","text":"<p>La question \u00e0 ChatGPT\u00a0:</p> <p>ChatGPT r\u00e9pond correctement.</p>"},{"location":"resolution-des-trois-problemes-avec-chatgpt.html#53-le-probleme-2","title":"5.3. Le probl\u00e8me 2","text":"<p>C\u2019est le calcul de l\u2019imp\u00f4t avec le PDF. Pour \u00eatre honn\u00eate, on va utiliser le PDF g\u00e9n\u00e9r\u00e9 par Gemini qui corrige des erreurs du PDF initial.</p> <ul> <li>En [1], on a donn\u00e9 le PDF g\u00e9n\u00e9r\u00e9 par Gemini\u00a0;</li> <li>En [2], on a ajout\u00e9 le test unitaire par lequel Gemini a d\u00e9montr\u00e9 sa sup\u00e9riorit\u00e9\u00a0: <pre><code>test12 : (2, 2, 49500) -&gt; (1297, 431, 324)\n</code></pre></li> </ul> <p>On lance ChatGPT. Il met environ 3 minutes pour g\u00e9n\u00e9rer sa r\u00e9ponse. Contrairement \u00e0 Gemini, il livre bien un lien qui marche pour r\u00e9cup\u00e9rer le script g\u00e9n\u00e9r\u00e9. On charge celui-ci dans PyCharm\u00a0:</p> <p>Le script [chatGPT1] fonctionne du premier coup. L\u00e0 il n\u2019y a pas photo, sur ce probl\u00e8me ChatGPT a \u00e9t\u00e9 plus performant que Gemini.</p> <p>Le script [chatGPT1] fourni par ChatGPT est le suivant\u00a0:</p> <pre><code># -*- coding: utf-8 -*-\n\"\"\"\nCalcul de l'imp\u00f4t 2019 (revenus 2018) en Python.\n\nHypoth\u00e8ses et r\u00e8gles (d'apr\u00e8s le PDF fourni) :\n- Tous les revenus sont port\u00e9s sur le d\u00e9clarant 1 (m\u00eame pour un couple).\n- Abattement forfaitaire de 10 % encadr\u00e9 par un minimum et un maximum.\n- Bar\u00e8me progressif 2018 appliqu\u00e9 au quotient familial (QF).\n- Plafonnement du quotient familial : avantage par demi-part enfant limit\u00e9.\n- D\u00e9cote et r\u00e9duction de 20 % pour faibles revenus, avec la r\u00e8gle de rep\u00eachage.\n- Ordre des correctifs : plafonnement QF -&gt; d\u00e9cote -&gt; r\u00e9duction 20 %.\n- Arrondis : abattement (\u2191), d\u00e9cote (\u2191), r\u00e9duction (\u2191), imp\u00f4t final (\u2193).\n- On renvoie l'imp\u00f4t \u00e0 payer (arrondi \u00e0 l'euro inf.), la d\u00e9cote et la r\u00e9duction\n  (arrondies \u00e0 l'euro sup.).\n\nLes nombres \u201cmagiques\u201d sont regroup\u00e9s en constantes, et chaque \u00e9tape est isol\u00e9e\ndans des fonctions pour la clart\u00e9.\n\"\"\"\n\nfrom dataclasses import dataclass\nfrom math import ceil, floor\n\n# ---------- Constantes r\u00e9glementaires ----------\n\n# Abattement frais pro (plancher/plafond) pour revenus 2018\nABATTEMENT_TAUX = 0.10\nABATTEMENT_MIN = 437\nABATTEMENT_MAX = 12502\n\n# Bar\u00e8me 2018 (QF)\n# Chaque tranche est (borne_sup, taux). La premi\u00e8re tranche 0% se termine \u00e0 9 964 \u20ac.\nBAREME_2018 = [\n    (9964, 0.00),\n    (27519, 0.14),\n    (73779, 0.30),\n    (156244, 0.41),\n    (float(\"inf\"), 0.45),\n]\n\n# Plafonnement du quotient familial\nPF_QF_AVANTAGE_PAR_DEMI_PART = 1551  # avantage max par 1/2 part ENFANT\n\n# D\u00e9cote (seuils selon le nombre d'adultes / statut couple)\nDECOTE_SEUIL_CELIB = 1196\nDECOTE_SEUIL_COUPLE = 1970\n\n# R\u00e9duction de 20 % : seuils en fonction des parts\nREDUCTION_BASE_1_PART = 18985\nREDUCTION_BASE_2_PARTS = 37970\nREDUCTION_PAR_DEMI_PART_SUP = 3803  # ajout par 1/2 part au-del\u00e0 du socle de 1 ou 2 parts\n\n\n# ---------- Structures de donn\u00e9es ----------\n\n@dataclass\nclass ResultatImpot:\n    impot: int  # imp\u00f4t final \u00e0 payer, arrondi \u00e0 l'euro inf\u00e9rieur\n    decote: int  # d\u00e9cote arrondie \u00e0 l'euro sup\u00e9rieur\n    reduction: int  # r\u00e9duction 20 % arrondie \u00e0 l'euro sup\u00e9rieur\n\n\n# ---------- Fonctions utilitaires ----------\n\ndef arrondi_sup(euros: float) -&gt; int:\n    \"\"\"Arrondi \u00e0 l'euro sup\u00e9rieur (ceil).\"\"\"\n    return int(ceil(euros))\n\n\ndef arrondi_inf(euros: float) -&gt; int:\n    \"\"\"Arrondi \u00e0 l'euro inf\u00e9rieur (floor).\"\"\"\n    return int(floor(euros))\n\n\n# ---------- \u00c9tape 1 : Revenu Net Imposable (RNI) ----------\n\ndef calcul_abattement(revenus_bruts: float) -&gt; int:\n    \"\"\"\n    Calcule l'abattement de 10 %, plafonn\u00e9/planche, ARRONDI \u00c0 L'EURO SUP\u00c9RIEUR.\n    \"\"\"\n    abattement_calcule = revenus_bruts * ABATTEMENT_TAUX\n    abattement_calcule = max(ABATTEMENT_MIN, min(ABATTEMENT_MAX, abattement_calcule))\n    return arrondi_sup(abattement_calcule)\n\n\ndef revenu_net_imposable(revenus_bruts: float) -&gt; int:\n    \"\"\"RNI = revenus bruts - abattement (abattement arrondi \u2191).\"\"\"\n    return int(round(revenus_bruts - calcul_abattement(revenus_bruts)))\n\n\n# ---------- \u00c9tape 2 : Nombre de parts ----------\n\ndef nombre_parts(adultes: int, enfants: int) -&gt; float:\n    \"\"\"\n    R\u00e8gles : 1 part si 1 adulte, 2 parts si 2 adultes.\n    Enfants : +0,5 pour les 2 premiers, +1 par enfant \u00e0 partir du 3e.\n    (On ignore ici tout cas particulier type parent isol\u00e9, conform\u00e9ment au PDF.)\n    \"\"\"\n    parts = 1.0 if adultes == 1 else 2.0\n    if enfants &lt;= 0:\n        return parts\n    if enfants == 1:\n        return parts + 0.5\n    # enfants &gt;= 2\n    parts += 1.0  # +0,5 +0,5 pour les deux premiers\n    if enfants &gt; 2:\n        parts += (enfants - 2) * 1.0  # +1 par enfant \u00e0 partir du 3e\n    return parts\n\n\ndef demi_parts_enfants(enfants: int) -&gt; int:\n    \"\"\"Nombre de DEMI-parts d\u00fb aux enfants (utile pour le plafonnement QF).\"\"\"\n    if enfants &lt;= 0:\n        return 0\n    if enfants == 1:\n        return 1  # 0,5 part\n    # Deux premiers enfants = 2 * demi-part, puis +2 demi-parts par enfant \u00e0 partir du 3e\n    return 2 + (enfants - 2) * 2\n\n\n# ---------- \u00c9tape 3 : Imp\u00f4t brut via QF ----------\n\ndef impot_brut_par_parts(qf: float) -&gt; float:\n    \"\"\"Imp\u00f4t par part via bar\u00e8me progressif 2018 (sans arrondi).\"\"\"\n    imp = 0.0\n    previous = 0.0\n    for borne_sup, taux in BAREME_2018:\n        montant_tranche = max(0.0, min(qf, borne_sup) - previous)\n        imp += montant_tranche * taux\n        if qf &lt;= borne_sup:\n            break\n        previous = borne_sup\n    return imp\n\n\ndef impot_brut_total(rni: float, parts: float) -&gt; float:\n    \"\"\"Imp\u00f4t brut total = imp\u00f4t par part * nombre de parts (sans arrondi).\"\"\"\n    if parts &lt;= 0:\n        return 0.0\n    qf = rni / parts\n    return impot_brut_par_parts(qf) * parts\n\n\n# ---------- \u00c9tape 4.1 : Plafonnement du quotient familial ----------\n\ndef apply_plafonnement_qf(impot_avec_enfants: float, rni: float, adultes: int, enfants: int) -&gt; float:\n    \"\"\"\n    Calcule l'imp\u00f4t apr\u00e8s plafonnement QF si l'avantage des enfants d\u00e9passe le plafond.\n    - Imp\u00f4t A : avec parts incluant enfants\n    - Imp\u00f4t B : avec seulement parts des adultes (1 ou 2)\n    - Avantage r\u00e9el = B - A\n    - Avantage maximal = 1551 \u20ac par 1/2 part ENFANT\n    Si avantage r\u00e9el &gt; avantage max, imp\u00f4t = B - avantage max, sinon imp\u00f4t = A.\n    \"\"\"\n    parts_adultes = 1.0 if adultes == 1 else 2.0\n    imp_b = impot_brut_total(rni, parts_adultes)\n    imp_a = impot_avec_enfants\n    avantage_reel = max(0.0, imp_b - imp_a)\n    avantage_max = PF_QF_AVANTAGE_PAR_DEMI_PART * demi_parts_enfants(enfants)\n    if avantage_reel &gt; avantage_max:\n        return imp_b - avantage_max\n    return imp_a\n\n\n# ---------- \u00c9tape 4.2 : D\u00e9cote et R\u00e9duction 20 % ----------\n\ndef seuil_decote(adultes: int) -&gt; int:\n    return DECOTE_SEUIL_COUPLE if adultes &gt;= 2 else DECOTE_SEUIL_CELIB\n\n\ndef seuil_reduction_20(rni: int, adultes: int, parts: float) -&gt; int:\n    \"\"\"\n    Seuil d'\u00e9ligibilit\u00e9 \u00e0 la r\u00e9duction de 20 % :\n    - Base : 18 985 \u20ac pour 1 part, 37 970 \u20ac pour 2 parts\n    - + 3 803 \u20ac par 1/2 part suppl\u00e9mentaire au-del\u00e0 de la base correspondante.\n    \"\"\"\n    base = REDUCTION_BASE_2_PARTS if adultes &gt;= 2 else REDUCTION_BASE_1_PART\n    base_parts = 2.0 if adultes &gt;= 2 else 1.0\n    demi_sup = max(0, int(round((parts - base_parts) * 2)))\n    return base + demi_sup * REDUCTION_PAR_DEMI_PART_SUP\n\n\ndef calc_decote_reduction(impot_apres_plaf: float, rni: int, adultes: int, parts: float):\n    \"\"\"\n    Calcule (decote_arrondie, reduction_arrondie, impot_apres_correctifs).\n    R\u00e8gle d'interaction : la d\u00e9cote peut s'appliquer via rep\u00eachage si, apr\u00e8s\n    application TH\u00c9ORIQUE de la r\u00e9duction de 20 %, l'imp\u00f4t passerait sous le seuil.\n    Ordre : d\u00e9cote -&gt; r\u00e9duction.\n    \"\"\"\n    imp = max(0.0, impot_apres_plaf)\n    decote = 0\n    reduction = 0\n\n    # \u00c9ligibilit\u00e9 r\u00e9duction 20 % bas\u00e9e sur RNI\n    seuil_red = seuil_reduction_20(rni, adultes, parts)\n    eligible_reduction = rni &lt; seuil_red  # \"inf\u00e9rieur \u00e0 un seuil\" dans le PDF\n\n    # \u00c9ligibilit\u00e9 d\u00e9cote : sous le seuil directement, ou rep\u00eachage si r\u00e9duction ferait passer sous le seuil\n    s_dec = seuil_decote(adultes)\n    direct_decote = imp &lt;= s_dec\n    repechage = False\n    if not direct_decote and eligible_reduction:\n        imp_theorique_apres_red = imp * 0.80  # r\u00e9duction th\u00e9orique 20%\n        if imp_theorique_apres_red &lt;= s_dec:\n            repechage = True\n\n    elig_decote = (direct_decote or repechage) and (imp &gt; 0)\n\n    # Appliquer la d\u00e9cote en premier (si \u00e9ligible)\n    if elig_decote:\n        montant_decote = s_dec - (imp * 0.75)\n        decote_calc = max(0, arrondi_sup(montant_decote))\n        # La d\u00e9cote ne peut pas exc\u00e9der l'imp\u00f4t restant : on la borne\n        decote = min(decote_calc, arrondi_sup(imp))\n        imp = max(0.0, imp - decote)\n\n    # Puis appliquer la r\u00e9duction si \u00e9ligible\n    if eligible_reduction and imp &gt; 0:\n        montant_reduction = imp * 0.20\n        reduction = max(0, arrondi_sup(montant_reduction))\n        imp = max(0.0, imp - reduction)\n\n    return decote, reduction, imp\n\n\n# ---------- API principale ----------\n\ndef calcule_impot(adultes: int, enfants: int, revenus_bruts: float) -&gt; ResultatImpot:\n    \"\"\"\n    Calcule l'imp\u00f4t 2019 (revenus 2018) pour un foyer.\n    Retourne ResultatImpot(impot, decote, reduction).\n    \"\"\"\n    # 1) RNI\n    rni = revenu_net_imposable(revenus_bruts)\n\n    # 2) Parts\n    parts = nombre_parts(adultes, enfants)\n\n    # 3) Imp\u00f4t brut via bar\u00e8me (avec toutes parts)\n    imp_brut_A = impot_brut_total(rni, parts)\n\n    # 4.1) Plafonnement du quotient familial\n    imp_apres_plaf = apply_plafonnement_qf(imp_brut_A, rni, adultes, enfants)\n\n    # 4.2) D\u00e9cote puis r\u00e9duction 20 % (avec rep\u00eachage)\n    decote, reduction, imp_corrige = calc_decote_reduction(imp_apres_plaf, rni, adultes, parts)\n\n    # 5) Arrondi final imp\u00f4t (\u2193) et bornage \u00e0 0\n    imp_final = max(0, arrondi_inf(imp_corrige))\n\n    return ResultatImpot(impot=imp_final, decote=decote, reduction=reduction)\n\n\n# ---------- Petit ex\u00e9cutable de test ----------\n\ndef _nearly_equal(a: int, b: int, tol: int = 1) -&gt; bool:\n    return abs(a - b) &lt;= tol\n\n\ndef tests_unitaires():\n    \"\"\"\n    Renvoie une liste de tuples (inputs, attendu, obtenu, ok) pour chaque test.\n    Tol\u00e9rance : \u00b11 \u20ac sur chaque valeur (imp\u00f4t, d\u00e9cote, r\u00e9duction).\n    \"\"\"\n    cas = [\n        # (adultes, enfants, revenus) -&gt; (impot, decote, reduction)\n        ((2, 2, 55555), (2815, 0, 0)),\n        ((2, 2, 50000), (1385, 384, 346)),\n        ((2, 3, 50000), (0, 720, 0)),\n        ((1, 2, 100000), (19884, 0, 0)),\n        ((1, 3, 100000), (16782, 0, 0)),\n        ((2, 3, 100000), (9200, 0, 0)),\n        ((2, 5, 100000), (4230, 0, 0)),\n        ((1, 0, 100000), (22986, 0, 0)),\n        ((2, 2, 30000), (0, 0, 0)),\n        ((1, 0, 200000), (64211, 0, 0)),\n        ((2, 3, 200000), (42843, 0, 0)),\n        ((2, 2, 49500), (1297, 431, 324)),\n    ]\n\n    resultats = []\n    for (adultes, enfants, revenus), attendu in cas:\n        res = calcule_impot(adultes, enfants, revenus)\n        obtenu = (res.impot, res.decote, res.reduction)\n        ok = _nearly_equal(obtenu[0], attendu[0]) and _nearly_equal(obtenu[1], attendu[1]) and _nearly_equal(obtenu[2],\n                                                                                                             attendu[2])\n        resultats.append(((adultes, enfants, revenus), attendu, obtenu, ok))\n    return resultats\n\n\nif __name__ == \"__main__\":\n    for inputs, attendu, obtenu, ok in tests_unitaires():\n        print(f\"{inputs} -&gt; attendu={attendu}, obtenu={obtenu} : {'OK' if ok else 'ECHEC'}\")\n</code></pre>"},{"location":"resolution-des-trois-problemes-avec-chatgpt.html#54-le-probleme-3","title":"5.4. Le probl\u00e8me 3","text":"<p>Maintenant on demande \u00e0 ChatGPT de chercher les r\u00e8gles de calcul de l\u2019imp\u00f4t sur internet\u00a0:</p> <p>Cette fois-ci on ne fournit pas le PDF qui donnait les r\u00e8gles de calcul \u00e0 observer. On donne seulement nos instructions dans le fichier texte. On rappelle que ce fichier texte contient maintenant 12 tests unitaires apr\u00e8s avoir ajout\u00e9 aux 11 tests initiaux, celui utilis\u00e9 par Gemini pour d\u00e9montrer que mon PDF initial \u00e9tait erron\u00e9.</p> <p>ChatGPT r\u00e9pond en 8 minutes, donne un lien pour t\u00e9l\u00e9charger le script g\u00e9n\u00e9r\u00e9. Une fois charg\u00e9 dans PyCharm, ce script passe les 12 tests. Donc aux deux probl\u00e8mes pos\u00e9s, ChatGPT a r\u00e9pondu juste du premier coup, surpassant ainsi Gemini.</p> <p>ChatGPT donne ses sources dans sa r\u00e9ponse\u00a0:</p> <p>Il n\u2019y a rien \u00e0 dire, c\u2019est du beau travail.</p> <p>Maintenant, on peut lui demander, comme on l\u2019a fait avec Gemini de g\u00e9n\u00e9rer un PDF pour des \u00e9tudiants.</p> <p>La r\u00e9ponse de ChatGPT a \u00e9t\u00e9 obtenue apr\u00e8s plusieurs allers-retours\u00a0car le PDF g\u00e9n\u00e9r\u00e9 utilisait une police qui rempla\u00e7ait des caract\u00e8res par un carr\u00e9. Mais finalement, il a g\u00e9n\u00e9r\u00e9 le PDF. Je le donne car il donne des r\u00e8gles diff\u00e9rentes du PDF de Gemini et je me suis demand\u00e9 alors qui avait raison. On va enqu\u00eater.</p> <p>La diff\u00e9rence avec le PDF de Gemini est dans le calcul de la d\u00e9cote. Les deux IA n\u2019ont pas la m\u00eame approche. Gemini avait \u00e9crit\u00a0:</p> <p>Les deux IA ont deux approches diff\u00e9rentes. Qui a raison\u00a0?</p>"},{"location":"resolution-des-trois-problemes-avec-chatgpt.html#55-le-probleme-4","title":"5.5. Le probl\u00e8me 4","text":"<p>On va demander \u00e0 ChatGPT de s\u2019appuyer sur son PDF pour faire le calcul de l\u2019imp\u00f4t\u00a0:</p> <p>Comme les fois pr\u00e9c\u00e9dentes, il g\u00e9n\u00e8re un script Python qui marche du premier coup. On avait ajout\u00e9 dans les instructions un test suppl\u00e9mentaire\u00a0:</p> <pre><code>test13 : (1, 0, 18535) -&gt; (359, 491, 90)\n</code></pre> <p>Les 13 tests ont \u00e9t\u00e9 pass\u00e9s avec succ\u00e8s.</p>"},{"location":"resolution-des-trois-problemes-avec-chatgpt.html#56-retour-sur-gemini","title":"5.6. Retour sur Gemini","text":"<p>Maintenant, on revient dans Gemini \u00e0 qui on va pr\u00e9senter le PDF de ChatGPT. Vu que les r\u00e8gles impl\u00e9ment\u00e9es dans ce PDF sont diff\u00e9rentes de celles impl\u00e9ment\u00e9es dans le PDF de Gemini, on peut se demander ce qui va se passer\u00a0:</p> <p>Gemini a tout d\u2019abord g\u00e9n\u00e9r\u00e9 un script Python qui ratait des tests. On lui a pr\u00e9sent\u00e9 les logs\u00a0:</p> <p>Question 2</p> <p>Question 3</p> <p>Il y a encore des erreurs. On continue.</p> <p>Question 4</p> <p>Toujours des erreurs \u00e0 l\u2019ex\u00e9cution\u00a0:</p> <p>Cette fois-ci c\u2019est bon.</p> <p>On est quand m\u00eame intrigu\u00e9s qu\u2019avec des PDF ayant des r\u00e8gles de calcul assez diff\u00e9rentes les IA g\u00e9n\u00e8rent toutes deux des r\u00e9sultats corrects.</p> <p>On pose la question suivante \u00e0 Gemini\u00a0:</p> <p>La question compl\u00e8te est la suivante\u00a0:</p> <pre><code>Apr\u00e8s tout ce qu'on a fait, compare les deux approches, la tienne et celle de ChatGPT dans les pDF que je te joins [.. selon Gemini] pour toi, [.. selon ChatGPT] pour ChatGPT. Dis-moi laquelle on doit pr\u00e9f\u00e9rer vu que sur les 13 tests g\u00e9n\u00e9r\u00e9s tu les r\u00e9ussis tous avec l'un ou avec l'autre PDF.\n</code></pre> <p>La r\u00e9ponse de Gemini est cat\u00e9gorique\u00a0:</p>"},{"location":"resolution-des-trois-problemes-avec-chatgpt.html#57-quen-pense-chatgpt","title":"5.7. Qu\u2019en pense ChatGPT","text":"<p>On pose \u00e0 ChatGPT la m\u00eame question pos\u00e9e \u00e0 Gemini.</p> <p>La r\u00e9ponse de ChatGPT est la suivante\u00a0:</p> <p>Du coup, ChatGPT nous propose un test unitaire pour d\u00e9partager les deux m\u00e9thodes. Nous dupliquons\u00a0:</p> <ul> <li>Le script [gemini3] g\u00e9n\u00e9r\u00e9 par Gemini en prenant comme source son PDF [Le probl\u00e8me selon Gemini] est dupliqu\u00e9 dans le script [gemini4]\u00a0;</li> <li>Le script [chatGPT3] g\u00e9n\u00e9r\u00e9 par ChatGPT en prenant comme source son PDF [Le probl\u00e8me selon ChatGPT] est dupliqu\u00e9 dans le script [chatGPT4]\u00a0;</li> </ul> <p>Par ailleurs, on ajoute dans chacun des scripts [gemini4, chatGPT4] le test unitaire propos\u00e9 par ChatGPT pour d\u00e9partager les deux IA.</p> <p>L\u2019ex\u00e9cution de [gemini4] donne les r\u00e9sultats suivants\u00a0:</p> <pre><code>C:\\Data\\st-2025\\dev\\python\\code\\python-flask-2025-cours\\.venv\\Scripts\\python.exe \"C:/Program Files/JetBrains/PyCharm 2025.2.1.1/plugins/python-ce/helpers/pycharm/_jb_unittest_runner.py\" --path \"C:\\Data\\st-2025\\dev\\python\\code\\python-flask-2025-cours\\outils ia\\gemini\\gemini4.py\" \nTesting started at 17:45 ...\nLaunching unittests with arguments python -m unittest C:\\Data\\st-2025\\dev\\python\\code\\python-flask-2025-cours\\outils ia\\gemini\\gemini4.py in C:\\Data\\st-2025\\dev\\python\\code\\python-flask-2025-cours\n\nSubTest failure: Traceback (most recent call last):\n  File \"C:\\Program Files\\Python313\\Lib\\unittest\\case.py\", line 58, in testPartExecutor\n    yield\n  File \"C:\\Program Files\\Python313\\Lib\\unittest\\case.py\", line 556, in subTest\n    yield\n  File \"C:\\Data\\st-2025\\dev\\python\\code\\python-flask-2025-cours\\outils ia\\gemini\\gemini4.py\", line 234, in test_cas_verifies_simulateur_officiel\n    self.assertAlmostEqual(calcul_impot, attendu_impot, delta=1, msg=\"\u00c9chec sur le montant de l'imp\u00f4t\")\n    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAssertionError: 2669 != 2270 within 1 delta (399 difference) : \u00c9chec sur le montant de l'imp\u00f4t\n\n\n\n\nRan 1 test in 0.010s\n\nFAILED (failures=1)\n\nOne or more subtests failed\nFailed subtests list: [Test 'test12' avec entr\u00e9e (2, 0, 43333)]\n\nProcess finished with exit code 1\n</code></pre> <p>Donc Gemini \u00e9choue au test rajout\u00e9 par ChatGPT.</p> <p>L\u2019ex\u00e9cution de [chatGPT4] donne les r\u00e9sultats suivants\u00a0:</p> <pre><code>C:\\Data\\st-2025\\dev\\python\\code\\python-flask-2025-cours\\.venv\\Scripts\\python.exe \"C:\\Data\\st-2025\\dev\\python\\code\\python-flask-2025-cours\\outils ia\\chatGPT\\chatGPT4.py\" \nTest (2, 2, 55555) -&gt; obtenu (imp\u00f4t=2814, d\u00e9cote=0, r\u00e9duction=0) | attendu (2815, 0, 0) | OK\nTest (2, 2, 50000) -&gt; obtenu (imp\u00f4t=1384, d\u00e9cote=384, r\u00e9duction=347) | attendu (1385, 384, 346) | OK\nTest (2, 3, 50000) -&gt; obtenu (imp\u00f4t=0, d\u00e9cote=721, r\u00e9duction=0) | attendu (0, 720, 0) | OK\nTest (1, 2, 100000) -&gt; obtenu (imp\u00f4t=19884, d\u00e9cote=0, r\u00e9duction=0) | attendu (19884, 0, 0) | OK\nTest (1, 3, 100000) -&gt; obtenu (imp\u00f4t=16782, d\u00e9cote=0, r\u00e9duction=0) | attendu (16782, 0, 0) | OK\nTest (2, 3, 100000) -&gt; obtenu (imp\u00f4t=9200, d\u00e9cote=0, r\u00e9duction=0) | attendu (9200, 0, 0) | OK\nTest (2, 5, 100000) -&gt; obtenu (imp\u00f4t=4230, d\u00e9cote=0, r\u00e9duction=0) | attendu (4230, 0, 0) | OK\nTest (1, 0, 100000) -&gt; obtenu (imp\u00f4t=22986, d\u00e9cote=0, r\u00e9duction=0) | attendu (22986, 0, 0) | OK\nTest (2, 2, 30000) -&gt; obtenu (imp\u00f4t=0, d\u00e9cote=0, r\u00e9duction=0) | attendu (0, 0, 0) | OK\nTest (1, 0, 200000) -&gt; obtenu (imp\u00f4t=64210, d\u00e9cote=0, r\u00e9duction=0) | attendu (64211, 0, 0) | OK\nTest (2, 3, 200000) -&gt; obtenu (imp\u00f4t=42842, d\u00e9cote=0, r\u00e9duction=0) | attendu (42843, 0, 0) | OK\nTest (2, 2, 49500) -&gt; obtenu (imp\u00f4t=1296, d\u00e9cote=431, r\u00e9duction=325) | attendu (1297, 431, 324) | OK\nTest (1, 0, 18535) -&gt; obtenu (imp\u00f4t=359, d\u00e9cote=491, r\u00e9duction=90) | attendu (359, 491, 90) | OK\nTest (2, 0, 43333) -&gt; obtenu (imp\u00f4t=2268, d\u00e9cote=0, r\u00e9duction=401) | attendu (2270, 0, 400) | ECHEC\n D\u00e9tails tol\u00e9rance \u00b11\u20ac : imp\u00f4t ok? False, d\u00e9cote ok? True, r\u00e9duction ok? True\n\nR\u00e9sultat global : AU MOINS UN TEST \u00c9CHOUE \u274c\n\nProcess finished with exit code 0\n</code></pre> <p>ChatGPT \u00e9choue lui aussi sur le test rajout\u00e9 mais pas pour les m\u00eames raisons que Gemini. ChatGPT a trouv\u00e9 les bons r\u00e9sultats mais \u00e0 2 euros pr\u00e8s au lieu des 1 euro impos\u00e9s.</p> <p>Donc d\u00e9sormais c\u2019est le PDF g\u00e9n\u00e9r\u00e9 par ChatGPT que nous utiliserons avec les IA suivantes. Il faut noter que c\u2019est \u00e0 cause du manque de tests unitaires propos\u00e9s dans mes instructions que les deux IA ont toutes deux r\u00e9ussi les premiers tests. D\u2019o\u00f9 dans cet exemple pr\u00e9cis, l\u2019importance de mettre des tests unitaires pour les cas limites du calcul de l\u2019imp\u00f4t. Comme c\u2019est plut\u00f4t difficile d\u2019imaginer soi-m\u00eame ces tests. On va demander aux IA d\u2019en rajouter eux-m\u00eames.</p>"},{"location":"resolution-des-trois-problemes-avec-chatgpt.html#58-le-probleme-3-avec-des-test-unitaires-generes-par-les-ia","title":"5.8. Le probl\u00e8me 3 avec des test unitaires g\u00e9n\u00e9r\u00e9s par les IA","text":"<p>Les r\u00e9sultats obtenus avec Gemini et ChatGPT laissent un doute. Les IA ont-elles trouv\u00e9 une solution g\u00e9n\u00e9rale qui valide tous les tests imaginables ou ont-elles trouv\u00e9 une solution qui valide les seuls tests impos\u00e9s. On va repartir sur une solution sans PDF pour obliger les IA \u00e0 aller sur internet rechercher les informations dont elles ont besoin. Et on modifie nos instructions de la fa\u00e7on suivante\u00a0:</p> <p>Le fichier texte [instructionsSansPDF4.txt] contient d\u00e9j\u00e0 14 tests impos\u00e9s. A ces tests, on rajoute les instructions suivantes\u00a0:</p> <pre><code>7 - tu ajouteras autant de tests unitaires que n\u00e9cessaires pour v\u00e9rifier les cas limites du calcul de l'imp\u00f4t.\n\nPour le code tu compl\u00e8teras le script suivant auquel tu auras rajout\u00e9 tes propres tests.\n\n# =========================\n# Tests unitaires (tol\u00e9rance de \u00b11 \u20ac)\n# =========================\n\nTESTS = [\n    # (adultes, enfants, revenus) -&gt; (impot, decote, reduction)\n    ((2, 2, 55555), (2815, 0, 0)),\n    ((2, 2, 50000), (1385, 384, 346)),\n    ((2, 3, 50000), (0, 720, 0)),\n    ((1, 2, 100000), (19884, 0, 0)),\n    ((1, 3, 100000), (16782, 0, 0)),\n    ((2, 3, 100000), (9200, 0, 0)),\n    ((2, 5, 100000), (4230, 0, 0)),\n    ((1, 0, 100000), (22986, 0, 0)),\n    ((2, 2, 30000), (0, 0, 0)),\n    ((1, 0, 200000), (64211, 0, 0)),\n    ((2, 3, 200000), (42843, 0, 0)),\n    ((2, 2, 49500), (1297, 431, 324)),\n    ((1, 0, 18535), (359, 491, 90)),\n    ((2, 0, 43333), (2270, 0, 400)),\n]\n\n\ndef _ok(a, b, tol=1):\n    return abs(a - b) &lt;= tol\n\n\ndef run_tests(verbose: bool = True) -&gt; bool:\n    all_ok = True\n    for (params, expected) in TESTS:\n        a, e, r = params\n        exp_impot, exp_decote, exp_reduc = expected\n        res = calcul_impot_2019(a, e, r)\n        ok_impot = _ok(res.impot, exp_impot)\n        ok_decote = _ok(res.decote, exp_decote)\n        ok_reduc = _ok(res.reduction, exp_reduc)\n        test_ok = ok_impot and ok_decote and ok_reduc\n        if verbose:\n            print(\n                f\"Test {params} -&gt; obtenu (imp\u00f4t={res.impot}, d\u00e9cote={res.decote}, r\u00e9duction={res.reduction}) | attendu {expected} | {'OK' if test_ok else 'ECHEC'}\")\n            if not test_ok:\n                print(\n                    f\" D\u00e9tails tol\u00e9rance \u00b11\u20ac : imp\u00f4t ok? {ok_impot}, d\u00e9cote ok? {ok_decote}, r\u00e9duction ok? {ok_reduc}\")\n        all_ok &amp;= test_ok\n    if verbose:\n        print(\"\\nR\u00e9sultat global :\", \"TOUS LES TESTS PASSENT \u2705\" if all_ok else \"AU MOINS UN TEST \u00c9CHOUE \u274c\")\n    return all_ok\n\n\nif __name__ == \"__main__\":\n    run_tests()\n</code></pre> <ul> <li>Lignes 11-24, les 14 tests impos\u00e9s\u00a0;</li> <li>Lignes 5-55\u00a0: ce code vient du script g\u00e9n\u00e9r\u00e9 par ChatGPT. On va imposer \u00e0 Gemini d\u2019utiliser ce code pour faciliter les comparaisons entre les deux scripts g\u00e9n\u00e9r\u00e9s. On commence par ChatGPT\u00a0:</li> </ul> <p>Sa premi\u00e8re r\u00e9ponse est incorrecte. Je le lui dis en lui donnant les logs de l\u2019ex\u00e9cution\u00a0:</p> <p>Sa deuxi\u00e8me r\u00e9ponse est la bonne. ChatGPT a rajout\u00e9 les 11 tests suivants aux 14 tests impos\u00e9s\u00a0:</p> <pre><code># Cas limites suppl\u00e9mentaires (bords de paliers/arrondis)\nTESTS += [\n    # Abattement 10 % : plancher et plafond\n    ((1, 0, 3000), (0, 0, 0)),  # 10 % = 300 &lt; plancher 437 =&gt; RNI faible -&gt; imp\u00f4t nul\n    ((1, 0, 200000), (64211, 0, 0)),  # plafond abattement d\u00e9j\u00e0 couvert dans tests initiaux\n\n    # D\u00e9cote : juste en dessous / au-dessus des seuils\n    ((1, 0, 25000), None),  # diagnostique\n    ((2, 0, 35000), None),  # diagnostique\n\n    # R\u00e9duction 20 % : plein droit vs \u00e9cr\u00eatement\n    ((1, 0, 17000), None),  # diagnostique\n    ((2, 0, 34000), None),  # diagnostique\n    ((1, 0, 20000), None),  # diagnostique\n    ((2, 0, 40000), None),  # diagnostique\n\n    # Changement de parts (plafonnement QF)\n    ((2, 1, 80000), None),\n    ((2, 2, 80000), None),\n    ((2, 3, 80000), None),\n]\n</code></pre> <p>Il y a maintenant 25 tests unitaires. J\u2019ai v\u00e9rifi\u00e9 manuellement les 11 nouveaux tests avec le simulateur officiel de la DGIP et c\u2019est bon.</p> <p>Maintenant, on passe \u00e0 Gemini. Cela va \u00eatre beaucoup plus compliqu\u00e9. Il va r\u00e9ussir \u00e0 g\u00e9n\u00e9rer un script qui passe les 25 tests de ChatGPT mais apr\u00e8s un long d\u00e9bogage.</p> <p>Ci-dessous, la liste du d\u00e9bogage\u00a0:</p> <p>Bizarrement, une majorit\u00e9 de tests a \u00e9chou\u00e9 m\u00eame parmi les 14 impos\u00e9s alors que par le pass\u00e9 Gemini avait g\u00e9n\u00e9r\u00e9 du code qui les passait tous.</p> <p>La r\u00e9ponse suivante de Gemini n\u2019est toujours pas correcte\u00a0:</p> <p>La r\u00e9ponse suivante non plus\u00a0:</p> <p>La r\u00e9ponse suivante non plus. Du coup je change mon fusil d\u2019\u00e9paule. Je lui demande de r\u00e9ussir les 25 tests qu\u2019a r\u00e9ussis ChatGPT\u00a0en lui joignant les logs de ChatGPT\u00a0:</p> <p>Gemini \u00e9choue. Il a bien ajout\u00e9 les tests de ChatGPT. Je lui joins les logs de son ex\u00e9cution\u00a0:</p> <p>Toujours pas\u00a0:</p> <p>Toujours pas\u00a0:</p> <p>Toujours pas\u00a0:</p> <p>Toujours pas\u00a0mais c\u2019est mieux :</p> <p>Gemini fait de nouvelles erreurs\u00a0:</p> <p>Il s\u2019am\u00e9liore de nouveau\u00a0:</p> <p>Cette fois, c\u2019est bon\u00a0:</p> <p>Indiscutablement, sur cet exemple pr\u00e9cis du calcul de l\u2019imp\u00f4t 2019 avec les contraintes plac\u00e9es dans le fichier des instructions, ChatGPT a \u00e9t\u00e9 plus pertinent que Gemini. Mais ce n\u2019est qu\u2019un exemple.</p> <p>On peut aller plus loin. On peut demander \u00e0 Gemini de r\u00e9g\u00e9n\u00e9rer un PDF selon les r\u00e8gles de calcul qu\u2019il a utilis\u00e9es pour r\u00e9ussir les 25 tests. On veut voir s\u2019il a chang\u00e9 son raisonnement premier sur les calculs de la d\u00e9cote et de la r\u00e9duction de 20%\u00a0:</p> <p>Cette fois-ci, Gemini a g\u00e9n\u00e9r\u00e9 un fichier MarkDown que j\u2019ai ensuite transform\u00e9 en PDF [Le probl\u00e8me selon Gemini version 2]. Et Gemini a effectivement chang\u00e9 son raisonnement\u00a0:</p> <p>On constate qu\u2019il n\u2019y a plus le calcul particulier de la d\u00e9cote ni la r\u00e8gle de rep\u00eachage. Gemini a d\u00e9sormais adopt\u00e9 le raisonnement de ChatGPT.</p>"},{"location":"resolution-des-trois-problemes-avec-claudeai.html","title":"7. R\u00e9solution des trois probl\u00e8mes avec ClaudeAI","text":""},{"location":"resolution-des-trois-problemes-avec-claudeai.html#71-introduction","title":"7.1. Introduction","text":"<ul> <li>En [1], l\u2019URL de l\u2019IA ClaudeAI [https://claude.ai/chat] produit de l\u2019entreprise Anthropic [https://www.anthropic.com/]\u00a0;</li> <li>En [2], l\u2019historique de vos chats. Les sessions gratuites de ClaudeAI sont tr\u00e8s limit\u00e9es. J\u2019ai pris un abonnement payant d\u2019un mois pour faire les tests qui suivent\u00a0;</li> <li>En [3], votre question\u00a0;</li> <li>En [4], pour joindre des fichiers \u00e0 votre question\u00a0;</li> <li>En [5], pour ex\u00e9cuter votre question\u00a0;</li> </ul>"},{"location":"resolution-des-trois-problemes-avec-claudeai.html#72-le-probleme-1","title":"7.2. Le probl\u00e8me 1","text":"<p>La question\u00a0:</p> <p>ClaudeAI r\u00e9pond correctement.</p>"},{"location":"resolution-des-trois-problemes-avec-claudeai.html#73-le-probleme-2","title":"7.3. Le probl\u00e8me 2","text":"<p>La question\u00a0:</p> <p>J\u2019ai joint deux fichiers \u00e0 ma question\u00a0:</p> <ul> <li>Le PDF g\u00e9n\u00e9r\u00e9 par ChatGPT [Le probl\u00e8me selon ChatGPT.pdf]\u00a0;</li> <li>Mes instructions dans le fichier texte [InstructionsAvecPDF4.txt]. C\u2019est celui qui impose les 25 tests unitaires propos\u00e9s par ChatGPT\u00a0; La premi\u00e8re r\u00e9ponse est incorrecte. On donne les logs de l\u2019ex\u00e9cution\u00a0:</li> </ul> <p>La r\u00e9ponse comporte encore une erreur mais minime. ClaudeAI rate un test \u00e0 2 euros pr\u00e8s alors que la pr\u00e9cision demand\u00e9e aux tests est de 1 euro. En fait, en leur temps, aussi bien Gemini que ChatGPT avaient rat\u00e9 ce test pour la m\u00eame raison. Il est probable que la contrainte \u00e0 1 euro pr\u00e8s est trop forte \u00e0 cause des probl\u00e8mes d\u2019arrondis dont on ne conna\u00eet pas les r\u00e8gles officielles.</p> <p>Toujours est-il qu\u2019apr\u00e8s deux aller / retour suppl\u00e9mentaires, ClaudeAI donne la bonne solution.</p>"},{"location":"resolution-des-trois-problemes-avec-claudeai.html#74-le-probleme-3","title":"7.4. Le probl\u00e8me 3","text":"<p>La question\u00a0:</p> <p>En [2], on a joint un fichier texte d\u00e9j\u00e0 utilis\u00e9 avec les IA pr\u00e9c\u00e9dentes. Il oblige l\u2019IA \u00e0 chercher ses informations sur internet et impose l\u00e0 encore les 25 tests unitaires.</p> <p>La premi\u00e8re r\u00e9ponse a beaucoup d\u2019erreurs. On transmet les logs \u00e0 l\u2019IA\u00a0:</p> <p>Encore des erreurs\u00a0:</p> <p>Toujours pas. On l\u2019encourage\u00a0:</p> <p>Toujours pas\u00a0:</p> <p>Toujours pas\u00a0:</p> <p>Rien \u00e0 faire\u00a0:</p> <p>Encore beaucoup d\u2019\u00e9checs. On va consid\u00e9rer que ClaudeAI n\u2019a pas su r\u00e9soudre le probl\u00e8me 3 dans un d\u00e9lai raisonnable.</p>"},{"location":"resolution-des-trois-problemes-avec-deepseek.html","title":"9. R\u00e9solution des trois probl\u00e8mes avec DeepSeek","text":""},{"location":"resolution-des-trois-problemes-avec-deepseek.html#91-introduction","title":"9.1. Introduction","text":"<ul> <li>En [1], l\u2019URL de DeepSeek [https://chat.deepseek.com/]\u00a0;</li> <li>En [2], votre historique. Pour l\u2019avoir il faut vous cr\u00e9er un compte (gratuit en sept. 2025)\u00a0;</li> <li>En [3], votre question\u00a0;</li> <li>En [4], pour joindre des fichiers \u00e0 votre question\u00a0;</li> <li>En [5], pour ex\u00e9cuter votre question\u00a0;</li> </ul>"},{"location":"resolution-des-trois-problemes-avec-deepseek.html#92-le-probleme-1","title":"9.2. Le probl\u00e8me 1","text":"<p>La question\u00a0:</p> <p>La r\u00e9ponse de DeepSeek laisse \u00e0 d\u00e9sirer. Elle est moins pr\u00e9cise que celles g\u00e9n\u00e9r\u00e9es par les autres IA.</p>"},{"location":"resolution-des-trois-problemes-avec-deepseek.html#93-le-probleme-2","title":"9.3. Le probl\u00e8me 2","text":"<p>La question\u00a0:</p> <p>La premi\u00e8re r\u00e9ponse est incorrecte. On relance\u00a0:</p> <p>La r\u00e9ponse suivante est un peu meilleure\u00a0:</p> <p>La r\u00e9ponse suivante est tr\u00e8s d\u00e9cevante. Quasiment tous les tests \u00e9chouent. Dans les r\u00e9ponses de DeepSeek, on ne sent pas la certitude des premi\u00e8res IA test\u00e9es. On dirait que l\u2019IA doute elle-m\u00eame de l\u2019exactitude de ses r\u00e9ponses. Par ailleurs, on a l\u2019impression que DeepSeek ne r\u00e9fl\u00e9chit pas. Elle donne une r\u00e9ponse tr\u00e8s rapidement alors que ChatGPT mettait des minutes \u00e0 r\u00e9fl\u00e9chir. Peut-\u00eatre un probl\u00e8me de configuration.</p> <p>Cette fois-ci c\u2019est mieux. Il ne reste plus qu\u2019un \u00e9chec \u00e0 2 euros pr\u00e8s. D\u2019autres IA ont chut\u00e9 sur ce m\u00eame test avec ces m\u00eames deux euros d\u2019\u00e9cart. On va consid\u00e9rer que le script de DeepSeek est correct.</p>"},{"location":"resolution-des-trois-problemes-avec-deepseek.html#94-le-probleme-3","title":"9.4. Le probl\u00e8me 3","text":"<p>La question</p> <p>Cette fois, plus de PDF. DeepSeek va devoir chercher les r\u00e8gles de calcul sur internet.</p> <p>Premi\u00e8re r\u00e9ponse\u00a0: les 25 tests \u00e9chouent. On recommence.</p> <p>Les 25 tests \u00e9chouent de nouveau.</p> <p>De nouveau, 25 tests \u00e9chou\u00e9s. On abandonne et on consid\u00e8re que DeepSeek n\u2019a pas su r\u00e9soudre le probl\u00e8me 3 dans un temps raisonnable.</p>"},{"location":"resolution-des-trois-problemes-avec-google-gemini.html","title":"4. R\u00e9solution des trois probl\u00e8mes avec Google Gemini","text":"<p>Nous allons donner les copies d\u2019\u00e9cran des trois sessions Gemini qui ont permis de r\u00e9soudre les trois probl\u00e8mes pos\u00e9s. Nous irons assez dans les d\u00e9tails. Ceci fait, nous ne r\u00e9p\u00e9terons pas le processus pour les autres IA test\u00e9es. Elles fonctionnent de mani\u00e8re analogue. Nous ne donnerons que les d\u00e9tails frappants.</p>"},{"location":"resolution-des-trois-problemes-avec-google-gemini.html#41-introduction","title":"4.1. Introduction","text":"<p>Nous rappelons la premi\u00e8re copie d\u2019\u00e9cran de Gemini donn\u00e9e pr\u00e9c\u00e9demment\u00a0:</p> <ul> <li>En [1], l\u2019URL de Gemini\u00a0;</li> <li>En [2], la version de Gemini utilis\u00e9e\u00a0;</li> <li>En [3-5], les trois probl\u00e8mes pos\u00e9s \u00e0 Gemini\u00a0; Gemini est un produit de Google disponible \u00e0 l\u2019URL [https://gemini.google.com/]. Pour avoir un historique de vos sessions de questions / r\u00e9ponses comme ci-dessus, il vous faut cr\u00e9er un compte. Par ailleurs, comme toutes les autres IA test\u00e9es, Gemini limite le nombre de vos questions et le nombre de fichiers t\u00e9l\u00e9charg\u00e9s. Quand cette limite est atteinte, la session est termin\u00e9e et on vous propose de la continuer plus tard dans le temps. Comme il est assez frustrant de s\u2019arr\u00eater en plein milieu d\u2019une session, j\u2019ai pris un abonnement. Le premier mois de l\u2019abonnement Gemini est par chance gratuit. J\u2019ai fait de m\u00eame avec les autres IA qui avaient ces limites, \u00e0 savoir ChatGPT, MistralAI, ClaudeAI. J\u2019ai pris un abonnement d\u2019un mois, mais l\u00e0 le premier mois \u00e9tait payant. Je n\u2019ai pas rencontr\u00e9 de limites avec Grok. DeepSeek n\u2019annonce pas de limites mais r\u00e9pond parfois [Server busy] et interrompt la session. Ca revient \u00e0 mettre des limites sans le dire.</li> </ul> <p>Dans la suite, je parlerai de session de questions / r\u00e9ponses, raccourcie \u00e0 session simplement. Les IA utilisent le plus souvent le terme anglais chat (discussion) ou conversation.</p> <p>L\u2019interface de Gemini pour poser une question est la suivante\u00a0:</p> <ul> <li>En [1], votre question\u00a0;</li> <li>En [2], l\u2019ic\u00f4ne qui lance l\u2019IA pour le calcul de la r\u00e9ponse\u00a0;</li> <li>En [3-4], vous pouvez joindre des fichiers\u00a0;</li> </ul>"},{"location":"resolution-des-trois-problemes-avec-google-gemini.html#42-le-probleme-1","title":"4.2. Le probl\u00e8me 1","text":"<p>La session pour le probl\u00e8me 1 est la suivante\u00a0:</p> <ul> <li>En [1], la question\u00a0;</li> <li>En [2], le d\u00e9but de la r\u00e9ponse de Gemini\u00a0; La suite de la r\u00e9ponse est la suivante\u00a0:</li> </ul> <p>La r\u00e9ponse est correcte. Les cinq autres IA donneront \u00e9galement la bonne r\u00e9ponse sous une forme analogue.</p>"},{"location":"resolution-des-trois-problemes-avec-google-gemini.html#43-le-probleme-2","title":"4.3. Le probl\u00e8me 2","text":""},{"location":"resolution-des-trois-problemes-avec-google-gemini.html#431-introduction","title":"4.3.1. Introduction","text":"<p>On rappelle ici le probl\u00e8me initial du cours [python3-flask-2020]. C\u2019est un texte donn\u00e9 en TD \u00e0 des \u00e9tudiants.</p> <p>Le tableau ci-dessus permet de calculer l\u2019imp\u00f4t dans le cas simplifi\u00e9 d'un contribuable n'ayant que son seul salaire \u00e0 d\u00e9clarer. Comme l\u2019indique la note (1), l\u2019imp\u00f4t ainsi calcul\u00e9 est l\u2019imp\u00f4t avant trois m\u00e9canismes\u00a0:</p> <ul> <li>Le plafonnement du quotient familial qui intervient pour les hauts revenus\u00a0;</li> <li>La d\u00e9cote et la r\u00e9duction d\u2019imp\u00f4ts qui interviennent pour les faibles revenus\u00a0; Ainsi le calcul de l\u2019imp\u00f4t comprend les \u00e9tapes suivantes [http://impotsurlerevenu.org/comprendre-le-calcul-de-l-impot/1217-calcul-de-l-impot-2019.php]\u00a0:</li> </ul> <p>On se propose d'\u00e9crire un programme permettant de calculer l'imp\u00f4t d'un contribuable en 2019 dans le cas simplifi\u00e9 d'un contribuable n'ayant que son seul salaire \u00e0 d\u00e9clarer.</p>"},{"location":"resolution-des-trois-problemes-avec-google-gemini.html#4311-calcul-de-limpot-brut","title":"4.3.1.1. Calcul de l\u2019imp\u00f4t brut","text":"<p>L\u2019imp\u00f4t brut peut \u00eatre calcul\u00e9 de la fa\u00e7on suivante\u00a0:</p> <p>On calcule d\u2019abord le nombre de parts du contribuable\u00a0:</p> <ul> <li>Chaque parent am\u00e8ne 1 part\u00a0;</li> <li>Les deux premiers enfants am\u00e8nent chacun 1/2 part\u00a0;</li> <li> <p>Les enfants suivants am\u00e8nent une part chacun\u00a0: Le nombre de parts est donc\u00a0:</p> </li> <li> <p>nbParts=1+nbEnfants*0,5+(nbEnfants-2)*0,5 si le salari\u00e9 n\u2019est pas mari\u00e9\u00a0;</p> </li> <li>nbParts=2+nbEnfants*0,5+(nbEnfants-2)*0,5 s'il est mari\u00e9\u00a0;</li> <li>o\u00f9 nbEnfants est son nombre d'enfants\u00a0;</li> <li>On calcule le revenu imposable R=0.9*S o\u00f9 S est le salaire annuel\u00a0;</li> <li>On calcule le quotient familial QF=R/nbParts\u00a0;</li> <li>On calcule l\u2019imp\u00f4t brut I d'apr\u00e8s les donn\u00e9es suivantes (2019)\u00a0:</li> </ul> <p>9964</p><p>0</p><p>0</p><p>27519    </p><p>0.14</p><p>1394.96</p><p>73779    </p><p>0.3</p><p>5798</p><p>156244    </p><p>0.4</p><p>13913.69</p><p>0    </p><p>0.45</p><p>20163.45</p> <p>Chaque ligne a 3 champs\u00a0: champ1, champ2, champ3. Pour calculer l'imp\u00f4t I, on recherche la premi\u00e8re ligne o\u00f9 QF&lt;=champ1 et on prend les valeurs de cette ligne. Par exemple, pour un salari\u00e9 mari\u00e9 avec deux enfants et un salaire annuel S de 50000 euros\u00a0:</p> <p>Revenu imposable\u00a0: R=0,9*S=45000</p> <p>Nombre de parts\u00a0: nbParts=2+2*0,5=3</p> <p>Quotient familial\u00a0: QF=45000/3=15000</p> <p>La 1re ligne o\u00f9 QF&lt;=champ1 est la suivante\u00a0:</p> <pre><code>    27519    0.14    1394.96\n</code></pre> <p>L'imp\u00f4t I est alors \u00e9gal \u00e0 0.14*R \u2013 1394,96*nbParts=[0,14*45000-1394,96*3]=2115. L\u2019imp\u00f4t est arrondi \u00e0 l\u2019euro inf\u00e9rieur.</p> <p>Si la relation QF&lt;=champ1 d\u00e8s la 1re ligne, alors l\u2019imp\u00f4t est nul.</p> <p>Si QF est tel que la relation QF&lt;=champ1 n'est jamais v\u00e9rifi\u00e9e, alors ce sont les coefficients de la derni\u00e8re ligne qui sont utilis\u00e9s. Ici\u00a0:</p> <pre><code>    0    0.45    20163.45\n</code></pre> <p>ce qui donne l'imp\u00f4t brut I=0.45*R \u2013 20163,45*nbParts.</p>"},{"location":"resolution-des-trois-problemes-avec-google-gemini.html#4312-plafonnement-du-quotient-familial","title":"4.3.1.2. Plafonnement du quotient familial","text":"<p>Pour savoir si le plafonnement du quotient familial QF s\u2019applique, on refait le calcul de l\u2019imp\u00f4t brut sans les enfants. Toujours pour le salari\u00e9 mari\u00e9 avec deux enfants et un salaire annuel S de 50000 euros\u00a0:</p> <p>Revenu imposable\u00a0: R=0,9*S=45000</p> <p>Nombre de parts\u00a0: nbParts=2 (on ne compte plus les enfants)</p> <p>Quotient familial\u00a0: QF=45000/2=22500</p> <p>La 1re ligne o\u00f9 QF&lt;=champ1 est la suivante\u00a0:</p> <pre><code>    27519    0.14    1394.96\n</code></pre> <p>L'imp\u00f4t I est alors \u00e9gal \u00e0 0.14*R \u2013 1394,96*nbParts=[0,14*45000-1394,96*2]=3510.</p> <p>Gain maximal li\u00e9 aux enfants\u00a0: 1551 * 2  = 3102 euros</p> <p>Imp\u00f4t minimal\u00a0: 3510-3102 = 408 euros</p> <p>L\u2019imp\u00f4t brut avec 2 parts d\u00e9j\u00e0 calcul\u00e9 au paragraphe pr\u00e9c\u00e9dent 2115 euros est sup\u00e9rieur \u00e0 l\u2019imp\u00f4t minimal 408 euros, donc le plafonnement familial ne s\u2019applique pas ici.</p> <p>De fa\u00e7on g\u00e9n\u00e9rale, l\u2019imp\u00f4t brut est sup(imp\u00f4t1, imp\u00f4t2) o\u00f9\u00a0:</p> <ul> <li>[imp\u00f4t1]\u00a0: est l\u2019imp\u00f4t brut calcul\u00e9 avec les enfants\u00a0;</li> <li>[imp\u00f4t2]\u00a0: est l\u2019imp\u00f4t brut calcul\u00e9 sans les enfants et diminu\u00e9 du gain maximal (ici 1551 euros par demi-part) li\u00e9 aux enfants\u00a0;</li> </ul>"},{"location":"resolution-des-trois-problemes-avec-google-gemini.html#4313-calcul-de-la-decote","title":"4.3.1.3. Calcul de la d\u00e9cote","text":"<p>Toujours pour le salari\u00e9 mari\u00e9 avec deux enfants et un salaire annuel S de 50000 euros\u00a0:</p> <p>L\u2019imp\u00f4t brut (2115 euros) issu de l\u2019\u00e9tape pr\u00e9c\u00e9dente est inf\u00e9rieur \u00e0 2627 euros pour un couple (1595 euros pour un c\u00e9libataire)\u00a0: la d\u00e9cote s\u2019applique donc. Elle est obtenue avec le calcul suivant\u00a0:</p> <p>d\u00e9cote= seuil (couple=1970/c\u00e9libataire=1196)-0,75* Imp\u00f4t brut</p> <p>d\u00e9cote=1970-0,75*2115=383,75 arrondi \u00e0 384 euros.</p> <p>Nouvel Imp\u00f4t brut= 2115-384= 1731 euros</p> <p>Il faut observer deux r\u00e8gles dans le calcul de la d\u00e9cote (certains outils d\u2019IA ont but\u00e9 sur cette question)\u00a0:</p> <ul> <li>La d\u00e9cote ne peut \u00eatre n\u00e9gative\u00a0;</li> <li>La d\u00e9cote ne peut \u00eatre sup\u00e9rieure \u00e0 l\u2019imp\u00f4t d\u00e9j\u00e0 calcul\u00e9\u00a0;</li> </ul>"},{"location":"resolution-des-trois-problemes-avec-google-gemini.html#4314-calcul-de-la-reduction-dimpots","title":"4.3.1.4. Calcul de la r\u00e9duction d\u2019imp\u00f4ts","text":"<p>Au-dessous d\u2019un certain seuil, une r\u00e9duction de 20\u00a0% est faite sur l\u2019imp\u00f4t brut issu des calculs pr\u00e9c\u00e9dents. En 2019, les seuils sont les suivants\u00a0:</p> <ul> <li>c\u00e9libataire : 21037 euros\u00a0;</li> <li>couple\u00a0: 42074 euros\u00a0; (le chiffre 37968 utilis\u00e9 dans l\u2019exemple ci-dessus semble erron\u00e9)\u00a0; Ce seuil est augment\u00e9 de la valeur\u00a0: 3797 * (nombre de demi-parts amen\u00e9es par les enfants).</li> </ul> <p>Toujours pour le salari\u00e9 mari\u00e9 avec deux enfants et un salaire annuel S de 50000 euros\u00a0:</p> <ul> <li>Son revenu imposable (45000 euros) est inf\u00e9rieur au seuil (42074+2*3797)=49668 euros\u00a0;</li> <li>Il a donc droit \u00e0 une r\u00e9duction de 20\u00a0% de son imp\u00f4t\u00a0: 1731 * 0,2= 346,2 euros arrondi \u00e0 347 euros\u00a0;</li> <li>L\u2019imp\u00f4t brut du contribuable devient\u00a0: 1731-347= 1384 euros\u00a0;</li> </ul>"},{"location":"resolution-des-trois-problemes-avec-google-gemini.html#4315-calcul-de-limpot-net","title":"4.3.1.5. Calcul de l\u2019imp\u00f4t net","text":"<p>Notre calcul s\u2019arr\u00eatera l\u00e0\u00a0: l\u2019imp\u00f4t net \u00e0 payer sera de 1384 euros. Dans la r\u00e9alit\u00e9, le contribuable peut b\u00e9n\u00e9ficier d\u2019autres r\u00e9ductions notamment pour des dons \u00e0 des organismes d\u2019int\u00e9r\u00eat public ou g\u00e9n\u00e9ral.</p>"},{"location":"resolution-des-trois-problemes-avec-google-gemini.html#4316-cas-des-hauts-revenus","title":"4.3.1.6. Cas des hauts revenus","text":"<p>Notre exemple pr\u00e9c\u00e9dent correspond \u00e0 la majorit\u00e9 des cas de salari\u00e9s. Cependant le calcul de l\u2019imp\u00f4t est diff\u00e9rent dans le cas des hauts revenus.</p>"},{"location":"resolution-des-trois-problemes-avec-google-gemini.html#43161-plafonnement-de-la-reduction-de-10-sur-les-revenus-annuels","title":"4.3.1.6.1. Plafonnement de la r\u00e9duction de 10\u00a0% sur les revenus annuels","text":"<p>Dans la plupart des cas, le revenu imposable est obtenu par la formule\u00a0: R=0,9*S o\u00f9 S est le salaire annuel. On appelle cela la r\u00e9duction des 10\u00a0%. Cette r\u00e9duction est plafonn\u00e9e. En 2019\u00a0:</p> <ul> <li>Elle ne peut \u00eatre sup\u00e9rieure \u00e0 12502 euros\u00a0;</li> <li> <p>Elle ne peut \u00eatre inf\u00e9rieure \u00e0 437 euros\u00a0; Prenons le cas d\u2019un salari\u00e9 non mari\u00e9 sans enfants et un salaire annuel de 200000 euros\u00a0:</p> </li> <li> <p>La r\u00e9duction de 10\u00a0% est de 20000 euros &gt; 12502 euros. Elle est donc ramen\u00e9e \u00e0 12502 euros\u00a0;</p> </li> </ul>"},{"location":"resolution-des-trois-problemes-avec-google-gemini.html#43162-plafonnement-du-quotient-familial","title":"4.3.1.6.2. Plafonnement du quotient familial","text":"<p>Prenons un cas o\u00f9 le plafonnement familial pr\u00e9sent\u00e9 au paragraphe |Plafonnement du quotient familial|, intervient. Prenons le cas d\u2019un couple avec trois enfants et des revenus annuels de 100000 euros. Reprenons les \u00e9tapes du calcul\u00a0:</p> <ul> <li>L\u2019abattement de 10\u00a0% est de 100000 euros &lt; 12502 euros. Le revenu imposable R est donc 100000-10000=90000 euros\u00a0;</li> <li>Le couple a nbParts=2+0,5*2+1=4 parts\u00a0;</li> <li>Son quotient familial est donc QF= R/nbParts=90000/4=22500 euros\u00a0;</li> <li>Son imp\u00f4t brut I1 avec enfants est I1=0,14*90000-1394,96*4= 7020 euros\u00a0;</li> <li>Son imp\u00f4t brut I2 sans enfants\u00a0:</li> <li>QF=90000/2=45000 euros\u00a0;</li> <li>I2=0,3*90000-5798*2=15404 euros\u00a0;</li> <li>La r\u00e8gle du plafonnement du quotient familial dit que le gain amen\u00e9 par les enfants ne peut d\u00e9passer (1551*4 demi-parts)=6204 euros. Or ici, il est I2-I1=15404-7020= 8384 euros, donc sup\u00e9rieur \u00e0 6204 euros\u00a0;</li> <li>L\u2019imp\u00f4t brut est donc recalcul\u00e9 comme I3=I2-6204=15404-6204= 9200 euros\u00a0;</li> <li>Comme I3&gt;I1, ce sera l\u2019imp\u00f4t I3 qui sera conserv\u00e9\u00a0; Ce couple n\u2019aura ni d\u00e9cote, ni r\u00e9duction et son imp\u00f4t final sera de 9200 euros.</li> </ul>"},{"location":"resolution-des-trois-problemes-avec-google-gemini.html#4317-chiffres-officiels","title":"4.3.1.7. Chiffres officiels","text":"<p>Le calcul de l\u2019imp\u00f4t est complexe. Tout au long du document, les tests seront faits avec les exemples suivants. Les r\u00e9sultats sont ceux du simulateur de l\u2019administration fiscale |https://www3.impots.gouv.fr/simulateur/calcul_impot/2019/simplifie/index.htm|\u00a0:</p> <p>Contribuable</p><p>R\u00e9sultats officiels</p><p>R\u00e9sultats de l\u2019algorithme du document</p><p>Couple avec 2 enfants et des revenus annuels de 55555 euros</p><p>Imp\u00f4t=2815 euros</p><p>Taux d\u2019imposition=14\u00a0%</p><p>Imp\u00f4t=2814 euros</p><p>Taux d\u2019imposition=14\u00a0%</p><p>Couple avec 2 enfants et des revenus annuels de 50000 euros</p><p>Imp\u00f4t=1385 euros</p><p>D\u00e9cote=384 euros</p><p>R\u00e9duction=346 euros</p><p>Taux d\u2019imposition=14\u00a0%</p><p>Imp\u00f4t=1384 euros</p><p>D\u00e9cote=384 euros</p><p>R\u00e9duction=347 euros</p><p>Taux d\u2019imposition=14\u00a0%</p><p>Couple avec 3 enfants et des revenus annuels de 50000 euros</p><p>Imp\u00f4t=0 euro</p><p>d\u00e9cote=720 euros</p><p>R\u00e9duction=0 euro</p><p>Taux d\u2019imposition=14\u00a0%</p><p>Imp\u00f4t=0 euro</p><p>d\u00e9cote=720 euros</p><p>R\u00e9duction=0 euro</p><p>Taux d\u2019imposition=14\u00a0%</p><p>C\u00e9libataire avec 2 enfants et des revenus annuels de 100000 euros</p><p>Imp\u00f4t=19884 euros</p><p>d\u00e9cote=0 euro</p><p>R\u00e9duction=0 euro</p><p>Taux d\u2019imposition=41\u00a0%</p><p>Imp\u00f4t=19884 euros</p><p>Surcote=4480 euros</p><p>d\u00e9cote=0 euro</p><p>R\u00e9duction=0 euro</p><p>Taux d\u2019imposition=41\u00a0%</p><p>C\u00e9libataire avec 3 enfants et des revenus annuels de 100000 euros</p><p>Imp\u00f4t=16782 euros</p><p>d\u00e9cote=0 euro</p><p>R\u00e9duction=0 euro</p><p>Taux d\u2019imposition=41\u00a0%</p><p>Imp\u00f4t=16782 euros</p><p>Surcote=7176 euros</p><p>d\u00e9cote=0 euro</p><p>R\u00e9duction=0 euro</p><p>Taux d\u2019imposition=41\u00a0%</p><p>Couple avec 3 enfants et des revenus annuels de 100000 euros</p><p>Imp\u00f4t=9200 euros</p><p>d\u00e9cote=0 euro</p><p>R\u00e9duction=0 euro</p><p>Taux d\u2019imposition=30\u00a0%</p><p>Imp\u00f4t=9200 euros</p><p>Surcote=2180 euros</p><p>d\u00e9cote=0 euro</p><p>R\u00e9duction=0 euro</p><p>Taux d\u2019imposition=30\u00a0%</p><p>Couple avec 5 enfants et des revenus annuels de 100000 euros</p><p>Imp\u00f4t=4230 euros</p><p>d\u00e9cote=0 euro</p><p>R\u00e9duction=0 euro</p><p>Taux d\u2019imposition=14\u00a0%</p><p>Imp\u00f4t=4230 euros</p><p>d\u00e9cote=0 euro</p><p>R\u00e9duction=0 euro</p><p>Taux d\u2019imposition=14\u00a0%</p><p>C\u00e9libataire sans enfants et des revenus annuels de 100000 euros</p><p>Imp\u00f4t=22986 euros</p><p>d\u00e9cote=0 euro</p><p>R\u00e9duction=0 euro</p><p>Taux d\u2019imposition=41\u00a0%</p><p>Imp\u00f4t= 22986 euros</p><p>Surcote=0 euro</p><p>d\u00e9cote=0 euro</p><p>R\u00e9duction=0 euro</p><p>Taux d\u2019imposition=41\u00a0%</p><p>Couple avec 2 enfants et des revenus annuels de 30000 euros</p><p>Imp\u00f4t=0 euro</p><p>d\u00e9cote=0 euro</p><p>R\u00e9duction=0 euro</p><p>Taux d\u2019imposition=0\u00a0%</p><p>Imp\u00f4t=0 euro</p><p>d\u00e9cote=0 euro</p><p>R\u00e9duction=0 euro</p><p>Taux d\u2019imposition=0\u00a0%</p><p>C\u00e9libataire sans enfants et des revenus annuels de 200000 euros</p><p>Imp\u00f4t=64211 euro</p><p>d\u00e9cote=0 euro</p><p>R\u00e9duction=0 euro</p><p>Taux d\u2019imposition=45\u00a0%</p><p>Imp\u00f4t= 64210 euros</p><p>Surcote=7498 euros</p><p>d\u00e9cote=0 euro</p><p>R\u00e9duction=0 euro</p><p>Taux d\u2019imposition=45\u00a0%</p><p>Couple avec 3 enfants et des revenus annuels de 200000 euros</p><p>Imp\u00f4t=42843 euro</p><p>d\u00e9cote=0 euro</p><p>R\u00e9duction=0 euro</p><p>Taux d\u2019imposition=41\u00a0%</p><p>Imp\u00f4t=42842 euros</p><p>Surcote=17283 euros</p><p>d\u00e9cote=0 euro</p><p>R\u00e9duction=0 euro</p><p>Taux d\u2019imposition=41\u00a0%</p> <p>Ci-dessus, on appelle surcote, ce que paient en plus les hauts revenus \u00e0 cause de deux ph\u00e9nom\u00e8nes\u00a0:</p> <ul> <li>Le plafonnement de l\u2019abattement de 10\u00a0% sur les revenus annuels\u00a0;</li> <li>Le plafonnement du quotient familial\u00a0; Cet indicateur n\u2019a pu \u00eatre v\u00e9rifi\u00e9 car le simulateur de l\u2019administration fiscale ne le donne pas.</li> </ul> <p>On voit que l\u2019algorithme du document donne un imp\u00f4t juste \u00e0 chaque fois, avec cependant une marge d\u2019erreur de 1 euro. Cette marge d\u2019erreur provient des arrondis. Toutes les sommes d\u2019argent sont arrondies parfois \u00e0 l\u2019euro sup\u00e9rieur, parfois \u00e0 l\u2019euro inf\u00e9rieur. Comme je ne connaissais pas les r\u00e8gles officielles, les sommes d\u2019argent de l\u2019algorithme du document ont \u00e9t\u00e9 arrondies\u00a0:</p> <ul> <li>\u00c0 l\u2019euro sup\u00e9rieur pour les d\u00e9cotes et r\u00e9ductions\u00a0;</li> <li>\u00c0 l\u2019euro inf\u00e9rieur pour les surcotes et l\u2019imp\u00f4t final\u00a0; Nous allons demander \u00e0 l\u2019IA de faire ce calcul d\u2019imp\u00f4t.</li> </ul>"},{"location":"resolution-des-trois-problemes-avec-google-gemini.html#432-configuration-de-la-session-gemini","title":"4.3.2. Configuration de la session Gemini","text":"<p>La question pos\u00e9e \u00e0 Gemini s\u2019accompagne de deux fichiers\u00a0:</p> <ul> <li>En [1], le calcul qui vient d\u2019\u00eatre d\u00e9taill\u00e9 a \u00e9t\u00e9 mis dans un PDF qui est donn\u00e9 \u00e0 Gemini. Gemini va y trouver les r\u00e8gles exactes de calcul simplifi\u00e9 de l\u2019imp\u00f4t 2019 sur les revenus 2018\u00a0;</li> <li>En [2], nos instructions\u00a0;</li> <li>En [3] pour lancer l\u2019IA\u00a0; Nos instructions dans le fichier texte [instructionsAvecPDF.txt] sont les suivantes\u00a0:</li> </ul> <pre><code>1 - Exprime-toi en fran\u00e7ais.\n\n2 - Peux-tu g\u00e9n\u00e9rer un script Python permettant de calculer l'imp\u00f4t pay\u00e9 par les familles en 2019 sur leurs revenus de 2018.\n\n3 - Tu t'aideras du document PDF que j'ai joint et qui explique les calculs \u00e0 faire.\n\n4 - Tu dois faire attention aux points suivants :\n\n- plafonnement du quotient familial. Il y a des seuils \u00e0 v\u00e9rifier.\n- calcul de la d\u00e9cote dans certains cas. Il y a des seuils \u00e0 v\u00e9rifier.\n- calcul de la r\u00e9duction de 20% dans certains cas. Il y a des seuils \u00e0 v\u00e9rifier.\n- plafonnement de l'abattement de 10% sur les revenus annuels dans certains cas.\n- tu consid\u00e8reras que tous les revenus sont \u00e0 d\u00e9clarer pour le d\u00e9clarant 1 m\u00eame si le couple est mari\u00e9.\n\n5 - Tu ajouteras au script g\u00e9n\u00e9r\u00e9 des tests unitaires pour les cas suivants.\n\nDans ces tests on appelle :\n\nadultes :nombre d'adultes du foyer fiscal\nenfants : nombre d'enfants du foyer fiscal\nrevenus : revenus nets annuels avant imp\u00f4t, \u00e7-\u00e0-d avant le 1er calcul de l'abattement.\nimpot : l'imp\u00f4t \u00e0 payer\ndecote :la d\u00e9cote \u00e9ventuelle du foyer fiscal\nreduction : la r\u00e9duction de 20% pour les faibles revenus\n\nVoici les 11 tests \u00e0 v\u00e9rifier. Ils ont tous \u00e9t\u00e9 v\u00e9rifi\u00e9s manuellement sur le simulateur officiel\ndu calcul de l'imp\u00f4t 2019 [https://www3.impots.gouv.fr/simulateur/calcul_impot/2019/simplifie/index.html].\nSi tu utilises ce simulateur les revenus doivent \u00eatre associ\u00e9s au seul d\u00e9clarant 1 dans le cas d'un couple, le d\u00e9clarant 2 \u00e9tant alors ignor\u00e9. Lorsqu'on r\u00e9partit les revenus\nsur deux d\u00e9clarants, on n'obtient pas le m\u00eame r\u00e9sultat.\n\nOn utilise la syntaxe (adultes, enfants, revenus) -&gt; (impot, decote, reduction) pour dire que le script re\u00e7oit les entr\u00e9es\n(adultes, enfants, revenus) et produit les r\u00e9sultats (impot, decote, reduction)\n\ntest1 : (2,2,55555) -&gt; (2815, 0, 0)\ntest2 : (2, 2, 50000) -&gt; (1385, 384, 346)\ntest3 : (2,3,50000) -&gt; (0, 720, 0)\ntest4: (1,2,100000) -&gt; (19884, 0, 0)\ntest5: (1,3,100000) -&gt; (16782, 0, 0)\ntest6 : (2, 3, 100000) -&gt; (9200, 0, 0)\ntest7 : (2, 5, 100000) -&gt; (4230, 0, 0)\ntest8 : (1, 0, 100000) -&gt; (22986, 0, 0)\ntest9 : (2, 2, 30000) -&gt; (0, 0, 0)\ntest10 : (1,0,200000) -&gt; (64211, 0, 0)\ntest11  : (2, 3, 200000) -&gt; (42843, 0, 0)\n\n6 - Il peut y avoir des probl\u00e8mes d'arrondis. Tu proc\u00e8deras comme suit\n- l'imp\u00f4t \u00e0 payer sera arrondi \u00e0 l'euro inf\u00e9rieur,\n- la d\u00e9cote sera arrondie \u00e0 l'euro sup\u00e9rieur,\n- la r\u00e9duction de 20 % sera arrondie \u00e0 l'euro sup\u00e9rieur.\n- l'abattement de 10% sera arrondi \u00e0 l'euro sup\u00e9rieur\n\nFais tous les tests unitaires \u00e0 l'euro pr\u00e8s \u00e0 cause de ces \u00e9ventuelles erreurs d'arrondi.\nNe cherche pas \u00e0 avoir les valeurs exactes ci-dessus mais ces valeurs \u00e0 1 euro pr\u00e8s.\n\n7 - Evite de chercher sur internet. Le PDF que je te donne est correct.\nNe donne ton r\u00e9sultat que lorsque tu as pass\u00e9 les 11 tests unitaires avec succ\u00e8s.\n\n8 - si l'un des tests \u00e9choue et que tu es bloqu\u00e9, affiche ton raisonnement pour ce test\nafin que je puisse t'aider.\n\n9- Mets des commentaires d\u00e9taill\u00e9s dans le script que tu g\u00e9n\u00e8res.\nMets le bar\u00e8me progressif dans une liste ou dictionnaire puis utilise cette liste ou dictionnaire\nMets les nombres en dur (nombres magiques) que tu utilises dans des constantes\nUtilise des fonctions pour s\u00e9parer les \u00e9tapes du calcul.\nEcris le tout en fran\u00e7ais\n\n9 - n'affiche pas le code g\u00e9n\u00e9r\u00e9 \u00e0 l'\u00e9cran. Donne-moi simplement un lien pour le r\u00e9cup\u00e9rer.\nSi les tests unitaires \u00e9chouent, je te donnerai les logs de l'ex\u00e9cution du script pour que\ntu voies tes erreurs.\n\n10 - si c'est possible, indique le temps en minutes et secondes que tu as mis pour produire\nle script demand\u00e9.\n</code></pre> <p>Ces instructions sont le r\u00e9sultat de tr\u00e8s nombreuses questions pos\u00e9es \u00e0 Gemini. Assez rapidement, on se rend compte que l\u2019IA doit \u00eatre tr\u00e8s cadr\u00e9e si on veut obtenir ce qu\u2019on veut. C\u2019est \u00e0 cause de tous ces t\u00e2tonnements que la session Gemini \u00e9tait finalement stopp\u00e9e pour d\u00e9passement de limites. Examinons la suite de ces instructions\u00a0:</p> <ul> <li>Ligne 1\u00a0: on demande que la conversation soit en fran\u00e7ais. Cette indication est pour DeepSeek qui avait tendance \u00e0 parler anglais\u00a0;</li> <li>Ligne 3\u00a0: ce qu\u2019on veut\u00a0;</li> <li>Ligne 5\u00a0: on dit \u00e0 l\u2019IA d\u2019utiliser le PDF qu\u2019on lui a donn\u00e9\u00a0;</li> <li>Lignes 7-14\u00a0: un certain nombre de conseils utiles surtout pour le probl\u00e8me 3 sans PDF. Plusieurs IA se sont perdues dans le calcul de l\u2019imp\u00f4t\u00a0;</li> <li>Lignes 15-44\u00a0: les 11 tests unitaires que l\u2019on veut voir inclus dans le script g\u00e9n\u00e9r\u00e9. Lorsque le script sera g\u00e9n\u00e9r\u00e9, on l\u2019ex\u00e9cutera dans PyCharm et on verra bien si les 11 tests passent\u00a0;</li> <li>Lignes 46-53\u00a0: sans ces instructions, les IA g\u00e9n\u00e9raient des tests unitaires cherchant des r\u00e9sultats exacts qui \u00e9chouaient\u00a0;</li> <li>Lignes 55-56\u00a0: je dis \u00e0 l\u2019IA de ne pas aller sur internet. La solution la plus simple est d\u2019utiliser le PDF\u00a0;</li> <li>Lignes 58-59\u00a0: cette instruction n\u2019a pas \u00e9t\u00e9 suivie par les IA. J\u2019ai \u00e9t\u00e9 oblig\u00e9 de l\u2019\u00e9crire explicitement dans une question, lorsque je constatais qu\u2019un test avait \u00e9chou\u00e9\u00a0;</li> <li>Lignes 61-65\u00a0: j\u2019indique quel type de script Python je souhaite\u00a0;</li> <li>Lignes 67-69\u00a0: j\u2019aurais pr\u00e9f\u00e9r\u00e9 un lien pour r\u00e9cup\u00e9rer le script g\u00e9n\u00e9r\u00e9 car l\u2019affichage du code \u00e0 l\u2019\u00e9cran prend du temps. Il s\u2019est av\u00e9r\u00e9 que la plupart des IA ne savent pas faire cela. Les liens donn\u00e9s ne marchaient pas\u00a0;</li> <li>Lignes 71-72\u00a0: j\u2019aurais aim\u00e9 avoir le temps pass\u00e9 par l\u2019IA pour r\u00e9pondre \u00e0 la question. Seule Gemini a pu me donner ce renseignement. Les autres IA soit ne r\u00e9pondaient pas \u00e0 cette instruction, soit donnaient des chiffres fantaisistes montrant qu\u2019elles ne comprenaient pas cette instruction\u00a0;</li> </ul>"},{"location":"resolution-des-trois-problemes-avec-google-gemini.html#433-la-reponse-de-gemini","title":"4.3.3. La r\u00e9ponse de Gemini","text":"<p>La premi\u00e8re r\u00e9ponse de Gemini est la suivante\u00a0:</p> <ul> <li>En [1-4], Gemini fournit des liens sur la partie du PDF ou du fichier texte des instructions qu\u2019il utilise \u00e0 un moment donn\u00e9\u00a0; La suite est la suivante\u00a0:</li> </ul> <ul> <li>En [1], Gemini affirme qu\u2019il a ex\u00e9cut\u00e9 les 11 tests unitaires avec succ\u00e8s. La plupart des IA ont affirm\u00e9 cela aussi bien sur le probl\u00e8me 2 que le probl\u00e8me 3 et souvent lorsqu\u2019on chargeait le script g\u00e9n\u00e9r\u00e9 \u00e7a ne marchait pas. Il faut donc se m\u00e9fier de cette affirmation. Pour Gemini cela va s\u2019av\u00e9rer vrai\u00a0; </li> <li>En [2], un lien qui s\u2019av\u00e9rera ne pas marcher\u00a0;</li> <li>En [3 seule Gemini a donn\u00e9 un temps d\u2019ex\u00e9cution r\u00e9aliste\u00a0; Donc le lien [2] ne marche pas. On le dit \u00e0 Gemini\u00a0:</li> </ul> <p>La r\u00e9ponse de Gemini\u00a0:</p> <ul> <li>En [1], le script Python g\u00e9n\u00e9r\u00e9 par Gemini\u00a0; On charge ce script dans PyCharm et on l\u2019ex\u00e9cute\u00a0:</li> </ul> <ul> <li>En [1], [gemini1] est le script g\u00e9n\u00e9r\u00e9 par Gemini\u00a0; A l\u2019ex\u00e9cution du script apparaissent des erreurs de compilation\u00a0:</li> </ul> <pre><code>\"C:\\Program Files\\Python313\\python.exe\" \"C:/Program Files/JetBrains/PyCharm 2025.2.0.1/plugins/python-ce/helpers/pycharm/_jb_unittest_runner.py\" --path \"C:\\Data\\st-2025\\dev\\python\\code\\python-flask-2025-cours\\outils ia\\chatGPT\\chatGPT1.py\" \nTesting started at 17:12 ...\nLaunching unittests with arguments python -m unittest C:\\Data\\st-2025\\dev\\python\\code\\python-flask-2025-cours\\outils ia\\chatGPT\\chatGPT1.py in C:\\Data\\st-2025\\dev\\python\\code\\python-flask-2025-cours\n\nTraceback (most recent call last):\n  File \"C:\\Program Files\\JetBrains\\PyCharm 2025.2.0.1\\plugins\\python-ce\\helpers\\pycharm\\_jb_unittest_runner.py\", line 38, in &lt;module&gt;\n    sys.exit(main(argv=args, module=None, testRunner=unittestpy.TeamcityTestRunner,\n             ~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n                  buffer=not JB_DISABLE_BUFFERING))\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Program Files\\Python313\\Lib\\unittest\\main.py\", line 103, in __init__\n    self.parseArgs(argv)\n    ~~~~~~~~~~~~~~^^^^^^\n  File \"C:\\Program Files\\Python313\\Lib\\unittest\\main.py\", line 142, in parseArgs\n    self.createTests()\n    ~~~~~~~~~~~~~~~~^^\n  File \"C:\\Program Files\\Python313\\Lib\\unittest\\main.py\", line 153, in createTests\n    self.test = self.testLoader.loadTestsFromNames(self.testNames,\n                ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^\n                                                   self.module)\n                                                   ^^^^^^^^^^^^\n  File \"C:\\Program Files\\Python313\\Lib\\unittest\\loader.py\", line 207, in loadTestsFromNames\n    suites = [self.loadTestsFromName(name, module) for name in names]\n              ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^\n  File \"C:\\Program Files\\Python313\\Lib\\unittest\\loader.py\", line 137, in loadTestsFromName\n    module = __import__(module_name)\n  File \"C:\\Data\\st-2025\\dev\\python\\code\\python-flask-2025-cours\\outils ia\\chatGPT\\chatGPT1.py\", line 28, in &lt;module&gt;\n    [cite_start]\n     ^^^^^^^^^^\nNameError: name 'cite_start' is not defined\n\nProcess finished with exit code 1\n\nEmpty suite\n</code></pre> <ul> <li>Ligne 30, l\u2019erreur de compilation. [cite_start] est un marqueur pour g\u00e9n\u00e9rer une certaine forme de texte\u00a0; On met les logs ci-dessus dans un fichier [logs gemini1.txt] et on donne celui-ci \u00e0 Gemini\u00a0:</li> </ul> <p>La r\u00e9ponse de Gemini est alors la suivante\u00a0:</p> <p>Charg\u00e9 dans PyCharm, l\u2019ex\u00e9cution du nouveau script g\u00e9n\u00e8re exactement la m\u00eame erreur. On le dit \u00e0 Gemini en lui fournissant de nouveau les logs de l\u2019ex\u00e9cution\u00a0:</p> <p>La r\u00e9ponse de Gemini est la suivante\u00a0:</p> <p>Cette fois c\u2019est bon. Les 11 tests unitaires sont r\u00e9ussis. On le dit \u00e0 Gemini\u00a0:</p> <p>Qui r\u00e9pond\u00a0:</p> <p>Le script g\u00e9n\u00e9r\u00e9 par Gemini a suivi les instructions donn\u00e9es dans le fichier texte [instructionsAvecPDF.txt]\u00a0:</p> <pre><code># -*- coding: utf-8 -*-\n\"\"\"\nScript pour le calcul de l'imp\u00f4t 2019 sur les revenus de 2018 en France,\nbas\u00e9 sur les r\u00e8gles simplifi\u00e9es fournies dans le document PDF.\n\"\"\"\n\nimport math\nimport unittest\n\n# --- CONSTANTES DE CALCUL POUR L'IMP\u00d4T 2019 ---\n# Toutes les valeurs sont extraites du document PDF fourni.\n\n# Plafonds pour l'abattement de 10% sur les revenus annuels\nPLAFOND_ABATTEMENT_10_POURCENT = 12502.0\nMINIMUM_ABATTEMENT_10_POURCENT = 437.0\n\n# Bar\u00e8me de l'imp\u00f4t sur le revenu 2019\n# Structure: (Seuil maximum de la tranche, Taux d'imposition, Montant \u00e0 d\u00e9duire par part)\nBAREME_IMPOT_2019 = [\n    {\"seuil\": 9964, \"taux\": 0.0, \"deduction_par_part\": 0},\n    {\"seuil\": 27519, \"taux\": 0.14, \"deduction_par_part\": 1394.96},\n    {\"seuil\": 73779, \"taux\": 0.30, \"deduction_par_part\": 5798},\n    {\"seuil\": 156244, \"taux\": 0.41, \"deduction_par_part\": 13913.69},\n    {\"seuil\": float('inf'), \"taux\": 0.45, \"deduction_par_part\": 20163.45}\n]\n\n# Plafonnement du quotient familial\nGAIN_MAX_DEMI_PART = 1551.0  # Gain maximal par demi-part suppl\u00e9mentaire\n\n# Seuils et montants pour la d\u00e9cote\nSEUIL_APPLICATION_DECOTE = {\"celibataire\": 1595.0, \"couple\": 2627.0}\nSEUIL_CALCUL_DECOTE = {\"celibataire\": 1196.0, \"couple\": 1970.0}\n\n# Seuils pour la r\u00e9duction d'imp\u00f4t de 20%\nSEUIL_BASE_REDUCTION_20 = {\"celibataire\": 21037.0, \"couple\": 42074.0}\nMAJORATION_SEUIL_REDUCTION_PAR_DEMI_PART = 3797.0\n\n\ndef calculer_nombre_parts(adultes: int, enfants: int) -&gt; float:\n    \"\"\"\n    Calcule le nombre de parts fiscales du foyer.\n    - Chaque parent am\u00e8ne 1 part.\n    - Les deux premiers enfants am\u00e8nent chacun 1/2 part.\n    - Les enfants suivants am\u00e8nent une part chacun.\n    \"\"\"\n    if adultes not in [1, 2]:\n        raise ValueError(\"Le nombre d'adultes doit \u00eatre 1 ou 2.\")\n\n    parts = float(adultes)\n    if enfants &gt; 0:\n        parts += 0.5 * min(enfants, 2)\n    if enfants &gt; 2:\n        parts += 1.0 * (enfants - 2)\n\n    return parts\n\n\ndef calculer_revenu_imposable(revenus: float) -&gt; float:\n    \"\"\"\n    Calcule le revenu net imposable apr\u00e8s l'abattement de 10%.\n    Cet abattement est plafonn\u00e9.\n    L'abattement est arrondi \u00e0 l'euro sup\u00e9rieur.\n    \"\"\"\n    abattement_calcule = revenus * 0.1\n    # L'abattement est plafonn\u00e9 entre un minimum et un maximum\n    abattement = min(PLAFOND_ABATTEMENT_10_POURCENT, max(MINIMUM_ABATTEMENT_10_POURCENT, abattement_calcule))\n\n    # L'\u00e9nonc\u00e9 demande d'arrondir l'abattement \u00e0 l'euro sup\u00e9rieur\n    abattement_arrondi = math.ceil(abattement)\n\n    return revenus - abattement_arrondi\n\n\ndef calculer_impot_brut_base(revenu_imposable: float, nombre_parts: float) -&gt; float:\n    \"\"\"\n    Calcule l'imp\u00f4t brut selon le bar\u00e8me progressif.\n    \"\"\"\n    if nombre_parts &lt;= 0:\n        return 0.0\n\n    quotient_familial = revenu_imposable / nombre_parts\n\n    tranche_applicable = None\n    for tranche in BAREME_IMPOT_2019:\n        if quotient_familial &lt;= tranche[\"seuil\"]:\n            tranche_applicable = tranche\n            break\n\n    # Si le QF est sup\u00e9rieur \u00e0 tous les seuils, on utilise la derni\u00e8re tranche\n    if tranche_applicable is None:\n        tranche_applicable = BAREME_IMPOT_2019[-1]\n\n    # Formule de calcul de l'imp\u00f4t brut\n    impot_brut = (revenu_imposable * tranche_applicable[\"taux\"]) - (\n            tranche_applicable[\"deduction_par_part\"] * nombre_parts)\n\n    return max(0.0, impot_brut)\n\n\ndef appliquer_plafonnement_qf(impot_brut_avec_enfants: float, revenu_imposable: float, adultes: int,\n                              enfants: int) -&gt; float:\n    \"\"\"\n    Applique le plafonnement du quotient familial si n\u00e9cessaire.\n    L'imp\u00f4t final ne peut \u00eatre inf\u00e9rieur \u00e0 l'imp\u00f4t calcul\u00e9 sans les enfants,\n    diminu\u00e9 d'un gain maximal par demi-part.\n    \"\"\"\n    if enfants == 0:\n        return impot_brut_avec_enfants\n\n    # Calcul de l'imp\u00f4t sans les parts des enfants\n    parts_sans_enfants = calculer_nombre_parts(adultes, 0)\n    impot_sans_enfants = calculer_impot_brut_base(revenu_imposable, parts_sans_enfants)\n\n    # Calcul du gain maximal li\u00e9 aux enfants\n    parts_avec_enfants = calculer_nombre_parts(adultes, enfants)\n    demi_parts_enfants = (parts_avec_enfants - parts_sans_enfants) * 2\n    gain_maximal = demi_parts_enfants * GAIN_MAX_DEMI_PART\n\n    impot_minimal_plafone = impot_sans_enfants - gain_maximal\n\n    # L'imp\u00f4t retenu est le plus \u00e9lev\u00e9 des deux calculs\n    return max(impot_brut_avec_enfants, impot_minimal_plafone)\n\n\ndef appliquer_decote(impot_avant_decote: float, adultes: int) -&gt; tuple[float, float]:\n    \"\"\"\n    Applique la d\u00e9cote si l'imp\u00f4t est inf\u00e9rieur \u00e0 certains seuils.\n    La d\u00e9cote est arrondie \u00e0 l'euro sup\u00e9rieur.\n    \"\"\"\n    statut = \"couple\" if adultes == 2 else \"celibataire\"\n    seuil_application = SEUIL_APPLICATION_DECOTE[statut]\n    seuil_calcul = SEUIL_CALCUL_DECOTE[statut]\n\n    decote = 0.0\n    # La d\u00e9cote s'applique si l'imp\u00f4t est sous le seuil d'application\n    if impot_avant_decote &lt; seuil_application:\n        # Formule de la d\u00e9cote : seuil - 0.75 * Imp\u00f4t brut\n        decote_calculee = seuil_calcul - (0.75 * impot_avant_decote)\n\n        # Arrondi \u00e0 l'euro sup\u00e9rieur\n        decote = math.ceil(decote_calculee)\n\n        # La d\u00e9cote ne peut \u00eatre n\u00e9gative ni sup\u00e9rieure \u00e0 l'imp\u00f4t\n        decote = max(0.0, min(decote, impot_avant_decote))\n\n    impot_apres_decote = impot_avant_decote - decote\n    return impot_apres_decote, decote\n\n\ndef appliquer_reduction_20_pourcent(impot_avant_reduction: float, revenu_imposable: float, adultes: int,\n                                    enfants: int) -&gt; tuple[float, float]:\n    \"\"\"\n    Applique la r\u00e9duction de 20% sous condition de revenus.\n    La r\u00e9duction est arrondie \u00e0 l'euro sup\u00e9rieur.\n    \"\"\"\n    statut = \"couple\" if adultes == 2 else \"celibataire\"\n    seuil_base = SEUIL_BASE_REDUCTION_20[statut]\n\n    # Le seuil est augment\u00e9 pour chaque demi-part li\u00e9e aux enfants\n    parts_avec_enfants = calculer_nombre_parts(adultes, enfants)\n    parts_adultes = calculer_nombre_parts(adultes, 0)\n    demi_parts_enfants = (parts_avec_enfants - parts_adultes) * 2\n    seuil_final = seuil_base + (demi_parts_enfants * MAJORATION_SEUIL_REDUCTION_PAR_DEMI_PART)\n\n    reduction = 0.0\n    # La r\u00e9duction s'applique si le revenu imposable est sous le seuil\n    if revenu_imposable &lt; seuil_final:\n        reduction_calculee = impot_avant_reduction * 0.20\n\n        # Arrondi \u00e0 l'euro sup\u00e9rieur\n        reduction = math.ceil(reduction_calculee)\n\n    impot_apres_reduction = impot_avant_reduction - reduction\n    return max(0.0, impot_apres_reduction), reduction\n\n\ndef calculer_impot(adultes: int, revenus: float, enfants: int) -&gt; dict:\n    \"\"\"\n    Orchestre le calcul complet de l'imp\u00f4t net \u00e0 payer.\n    \"\"\"\n    # \u00c9tape 1: Calcul du revenu imposable\n    revenu_imposable = calculer_revenu_imposable(revenus)\n\n    # \u00c9tape 2: Calcul du nombre de parts\n    nombre_parts = calculer_nombre_parts(adultes, enfants)\n\n    # \u00c9tape 3: Calcul de l'imp\u00f4t brut\n    impot_brut_initial = calculer_impot_brut_base(revenu_imposable, nombre_parts)\n\n    # \u00c9tape 4: Application du plafonnement du QF\n    impot_apres_plafonnement = appliquer_plafonnement_qf(impot_brut_initial, revenu_imposable, adultes, enfants)\n\n    # \u00c9tape 5: Application de la d\u00e9cote\n    impot_apres_decote, decote_calculee = appliquer_decote(impot_apres_plafonnement, adultes)\n\n    # \u00c9tape 6: Application de la r\u00e9duction de 20%\n    impot_avant_arrondi_final, reduction_calculee = appliquer_reduction_20_pourcent(impot_apres_decote,\n                                                                                    revenu_imposable, adultes, enfants)\n\n    # \u00c9tape 7: Arrondi final de l'imp\u00f4t \u00e0 l'euro inf\u00e9rieur\n    impot_final = math.floor(impot_avant_arrondi_final)\n\n    return {\n        \"impot\": impot_final,\n        \"decote\": decote_calculee,\n        \"reduction\": reduction_calculee\n    }\n\n\n# --- TESTS UNITAIRES ---\n# Validation du script avec les cas fournis\nclass TestCalculImpot2019(unittest.TestCase):\n\n    def _verifier_resultat(self, adultes, enfants, revenus, impot_attendu, decote_attendue, reduction_attendue):\n        \"\"\"Fonction utilitaire pour ex\u00e9cuter un test et v\u00e9rifier les r\u00e9sultats \u00e0 1 euro pr\u00e8s.\"\"\"\n        resultat = calculer_impot(adultes=adultes, revenus=revenus, enfants=enfants)\n\n        self.assertAlmostEqual(resultat[\"impot\"], impot_attendu, delta=1,\n                               msg=f\"Test ({adultes}, {enfants}, {revenus}): Imp\u00f4t attendu {impot_attendu}, obtenu {resultat['impot']}\")\n\n        self.assertAlmostEqual(resultat[\"decote\"], decote_attendue, delta=1,\n                               msg=f\"Test ({adultes}, {enfants}, {revenus}): D\u00e9cote attendue {decote_attendue}, obtenue {resultat['decote']}\")\n\n        self.assertAlmostEqual(resultat[\"reduction\"], reduction_attendue, delta=1,\n                               msg=f\"Test ({adultes}, {enfants}, {revenus}): R\u00e9duction attendue {reduction_attendue}, obtenue {resultat['reduction']}\")\n\n    def test_cas_1(self):\n        # (2, 2, 55555) -&gt; (2815, 0, 0)\n        self._verifier_resultat(2, 2, 55555, 2815, 0, 0)\n\n    def test_cas_2(self):\n        # (2, 2, 50000) -&gt; (1385, 384, 346)\n        self._verifier_resultat(2, 2, 50000, 1385, 384, 346)\n\n    def test_cas_3(self):\n        # (2, 3, 50000) -&gt; (0, 720, 0)\n        self._verifier_resultat(2, 3, 50000, 0, 720, 0)\n\n    def test_cas_4(self):\n        # (1, 2, 100000) -&gt; (19884, 0, 0)\n        self._verifier_resultat(1, 2, 100000, 19884, 0, 0)\n\n    def test_cas_5(self):\n        # (1, 3, 100000) -&gt; (16782, 0, 0)\n        self._verifier_resultat(1, 3, 100000, 16782, 0, 0)\n\n    def test_cas_6(self):\n        # (2, 3, 100000) -&gt; (9200, 0, 0)\n        self._verifier_resultat(2, 3, 100000, 9200, 0, 0)\n\n    def test_cas_7(self):\n        # (2, 5, 100000) -&gt; (4230, 0, 0)\n        self._verifier_resultat(2, 5, 100000, 4230, 0, 0)\n\n    def test_cas_8(self):\n        # (1, 0, 100000) -&gt; (22986, 0, 0)\n        self._verifier_resultat(1, 0, 100000, 22986, 0, 0)\n\n    def test_cas_9(self):\n        # (2, 2, 30000) -&gt; (0, 0, 0)\n        self._verifier_resultat(2, 2, 30000, 0, 0, 0)\n\n    def test_cas_10(self):\n        # (1, 0, 200000) -&gt; (64211, 0, 0)\n        self._verifier_resultat(1, 0, 200000, 64211, 0, 0)\n\n    def test_cas_11(self):\n        # (2, 3, 200000) -&gt; (42843, 0, 0)\n        self._verifier_resultat(2, 3, 200000, 42843, 0, 0)\n\n\nif __name__ == '__main__':\n    print(\"Ex\u00e9cution des tests unitaires...\")\n    unittest.main(argv=['first-arg-is-ignored'], exit=False)\n\n    # Exemple d'utilisation du calculateur pour un cas pr\u00e9cis\n    print(\"\\n--- Exemple de calcul ---\")\n    revenus_annuels = 50000\n    nombre_adultes = 2\n    nombre_enfants = 2\n\n    resultat_calcul = calculer_impot(adultes=nombre_adultes, revenus=revenus_annuels, enfants=nombre_enfants)\n\n    print(f\"Pour un couple ({nombre_adultes} adultes) avec {nombre_enfants} enfants et {revenus_annuels}\u20ac de revenus :\")\n    print(f\"  - Imp\u00f4t \u00e0 payer : {resultat_calcul['impot']}\u20ac\")\n    print(f\"  - Montant de la d\u00e9cote : {resultat_calcul['decote']}\u20ac\")\n    print(f\"  - Montant de la r\u00e9duction : {resultat_calcul['reduction']}\u20ac\")\n</code></pre> <p>Je n\u2019ai pas v\u00e9rifi\u00e9 ce code. Puisque les 11 tests unitaires sont pass\u00e9s, je consid\u00e8re qu\u2019il est \u00ab\u00a0probablement correct\u00a0\u00bb. Je n\u2019ai pas fait davantage pour mon propre code que de v\u00e9rifier ces 11 tests.</p>"},{"location":"resolution-des-trois-problemes-avec-google-gemini.html#44-le-probleme-3","title":"4.4. Le probl\u00e8me 3","text":"<p>Le probl\u00e8me 3 est identique au probl\u00e8me 2, si ce n\u2019est qu\u2019on ne donne plus \u00e0 l\u2019IA le PDF qui donnait les r\u00e8gles de calcul \u00e0 observer.</p> <p>La question initiale \u00e0 Gemini est la suivante\u00a0:</p> <p>Le fichier des instructions en [1] est quasiment le m\u00eame que pour le probl\u00e8me 2 avec les diff\u00e9rences suivantes\u00a0:</p> <pre><code>1 - Exprime-toi en fran\u00e7ais.\n\n2 - Peux-tu g\u00e9n\u00e9rer un script Python permettant de calculer l'imp\u00f4t pay\u00e9 par les familles en 2019 sur leurs revenus de 2018.\n\n3 - Tu t'aideras des sources que tu trouveras sur internet. Dans ta r\u00e9ponse indique-moi ces sources.\n\n4 - Tu dois faire attention aux points suivants :\n\u2026\n</code></pre> <ul> <li>En [3], on lui dit de trouver sur internet les r\u00e8gles de calcul de l\u2019imp\u00f4t 2019 sur les revenus 2018. C\u2019est un exercice plus difficile que le pr\u00e9c\u00e9dent\u00a0; Je ne donne ci-dessous que des parties de la premi\u00e8re r\u00e9ponse de Gemini\u00a0:</li> </ul> <p>Le temps estim\u00e9 est plausible. On attend longtemps la r\u00e9ponse de Gemini.</p> <p>Comme pr\u00e9c\u00e9demment, Gemini a fourni un lien de t\u00e9l\u00e9chargement du script g\u00e9n\u00e9r\u00e9, lien qui ne marche pas. On le lui dit\u00a0:</p> <p>La r\u00e9ponse de Gemini\u00a0:</p> <p>On charge le script dans PyCharm\u00a0sous le nom [gemini2]:</p> <p>On l\u2019ex\u00e9cute et\u2026 \u00e7a ne marche pas. Les logs de l\u2019ex\u00e9cution sont les suivants\u00a0:</p> <pre><code>\"C:\\Program Files\\Python313\\python.exe\" \"C:/Program Files/JetBrains/PyCharm 2025.2.0.1/plugins/python-ce/helpers/pycharm/_jb_unittest_runner.py\" --path \"C:\\Data\\st-2025\\dev\\python\\code\\python-flask-2025-cours\\outils ia\\gemini\\gemini2.py\" \nTesting started at 17:23 ...\nLaunching unittests with arguments python -m unittest C:\\Data\\st-2025\\dev\\python\\code\\python-flask-2025-cours\\outils ia\\gemini\\gemini2.py in C:\\Data\\st-2025\\dev\\python\\code\\python-flask-2025-cours\n\n\nFailure\nTraceback (most recent call last):\n  File \"C:\\Data\\st-2025\\dev\\python\\code\\python-flask-2025-cours\\outils ia\\gemini\\gemini2.py\", line 278, in test_cas_2\n    self.assertAlmostEqual(impot, 1385, delta=1)\n    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^\nAssertionError: 1691 != 1385 within 1 delta (306 difference)\n\n\nError\nTraceback (most recent call last):\n  File \"C:\\Data\\st-2025\\dev\\python\\code\\python-flask-2025-cours\\outils ia\\gemini\\gemini2.py\", line 291, in test_cas_3\n    impot, _, _ = calculer_impot_final(2, 3, 50000)\n                  ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^\n  File \"C:\\Data\\st-2025\\dev\\python\\code\\python-flask-2025-cours\\outils ia\\gemini\\gemini2.py\", line 187, in calculer_impot_final\n    decote, impot_apres_decote = calculer_decote(impot_apres_plafonnement, adultes)\n                                 ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Data\\st-2025\\dev\\python\\code\\python-flask-2025-cours\\outils ia\\gemini\\gemini2.py\", line 134, in calculer_decote\n    decote = seuil_decote - (impot_avant_decote * COFFICIENT_DECOTE)\n                                                  ^^^^^^^^^^^^^^^^^\nNameError: name 'COFFICIENT_DECOTE' is not defined. Did you mean: 'COEFFICIENT_DECOTE'?\n\n\nError\nTraceback (most recent call last):\n  File \"C:\\Data\\st-2025\\dev\\python\\code\\python-flask-2025-cours\\outils ia\\gemini\\gemini2.py\", line 316, in test_cas_9\n    self._verifier_cas(2, 2, 30000, (0, 0, 0))\n    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Data\\st-2025\\dev\\python\\code\\python-flask-2025-cours\\outils ia\\gemini\\gemini2.py\", line 216, in _verifier_cas\n    impot_calcule, decote_calculee, reduction_calculee = calculer_impot_final(adultes, enfants, revenus)\n                                                         ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Data\\st-2025\\dev\\python\\code\\python-flask-2025-cours\\outils ia\\gemini\\gemini2.py\", line 187, in calculer_impot_final\n    decote, impot_apres_decote = calculer_decote(impot_apres_plafonnement, adultes)\n                                 ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Data\\st-2025\\dev\\python\\code\\python-flask-2025-cours\\outils ia\\gemini\\gemini2.py\", line 134, in calculer_decote\n    decote = seuil_decote - (impot_avant_decote * COFFICIENT_DECOTE)\n                                                  ^^^^^^^^^^^^^^^^^\nNameError: name 'COFFICIENT_DECOTE' is not defined. Did you mean: 'COEFFICIENT_DECOTE'?\n\n\n\nRan 11 tests in 0.038s\n\nFAILED (failures=1, errors=2)\n\nProcess finished with exit code 1\n</code></pre> <ul> <li>Ligne 11, un test a \u00e9chou\u00e9\u00a0;</li> <li>Lignes 25, 42\u00a0: une m\u00eame erreur de compilation\u00a0; On met ces logs dans un fichier texte qu\u2019on donne \u00e0 Gemini\u00a0:</li> </ul> <p>La r\u00e9ponse de Gemini\u00a0:</p> <p>On charge dans PyCharm le script et on l\u2019ex\u00e9cute. Encore des erreurs. On le dit \u00e0 Gemini en joignant de nouveau les logs de l\u2019ex\u00e9cution\u00a0:</p> <p>La r\u00e9ponse de Gemini\u00a0:</p> <p>On charge ce nouveau script dans PyCharm et on l\u2019ex\u00e9cute. Cette fois les 11 tests unitaires passent\u00a0:</p> <p>Le code g\u00e9n\u00e9r\u00e9 par Gemini est le suivant\u00a0:</p> <pre><code># -*- coding: utf-8 -*-\nimport math\nimport unittest\n\n# ==============================================================================\n# CONSTANTES POUR L'IMPOSITION DES REVENUS 2018 (PAY\u00c9E EN 2019)\n# ==============================================================================\nBAREME_IMPOT_2019 = [\n    {'seuil': 0, 'taux': 0.0},\n    {'seuil': 9964, 'taux': 0.14},\n    {'seuil': 27519, 'taux': 0.30},\n    {'seuil': 73779, 'taux': 0.41},\n    {'seuil': 156244, 'taux': 0.45},\n]\nABATTEMENT_FORFAITAIRE_TAUX = 0.10\nABATTEMENT_FORFAITAIRE_MINIMUM = 437\nABATTEMENT_FORFAITAIRE_PLAFOND = 12502\nPLAFONNEMENT_AVANTAGE_QF_DEMI_PART = 1551\nSEUIL_DECOTE_CELIBATAIRE = 1196\nSEUIL_DECOTE_COUPLE = 1970\nCOEFFICIENT_DECOTE = 0.75\nTAUX_REDUCTION_20_POURCENT = 0.20\nSEUIL_RFR_REDUCTION_CELIBATAIRE = 18985\nSEUIL_RFR_REDUCTION_COUPLE = 37970\nMAJORATION_RFR_REDUCTION_PAR_DEMI_PART = 3803\n\n\n# ==============================================================================\n# FONCTIONS DE CALCUL\n# ==============================================================================\n\ndef calculer_nombre_parts(adultes: int, enfants: int) -&gt; float:\n    \"\"\"Calcule le nombre de parts du foyer fiscal.\"\"\"\n    if adultes &lt; 1: return 0\n    parts = float(adultes)\n    if enfants &gt;= 1: parts += 0.5\n    if enfants &gt;= 2: parts += 0.5\n    if enfants &gt;= 3: parts += (enfants - 2) * 1.0\n    return parts\n\n\ndef calculer_revenu_imposable(revenus_bruts: float) -&gt; float:\n    \"\"\"Calcule le revenu net imposable apr\u00e8s abattement de 10%.\"\"\"\n    if revenus_bruts == 0: return 0.0\n    abattement = revenus_bruts * ABATTEMENT_FORFAITAIRE_TAUX\n    if abattement &lt; ABATTEMENT_FORFAITAIRE_MINIMUM: abattement = ABATTEMENT_FORFAITAIRE_MINIMUM\n    if abattement &gt; ABATTEMENT_FORFAITAIRE_PLAFOND: abattement = ABATTEMENT_FORFAITAIRE_PLAFOND\n    abattement = math.ceil(abattement)\n    revenu_imposable = revenus_bruts - abattement\n    return revenu_imposable if revenu_imposable &gt; 0 else 0\n\n\ndef calculer_impot_brut_par_tranche(revenu_imposable: float, nombre_parts: float) -&gt; float:\n    \"\"\"Calcule l'imp\u00f4t brut en appliquant le bar\u00e8me progressif.\"\"\"\n    if nombre_parts &lt;= 0 or revenu_imposable &lt;= 0: return 0.0\n    quotient_familial = revenu_imposable / nombre_parts\n    impot_par_part = 0.0\n    for i in range(len(BAREME_IMPOT_2019)):\n        tranche = BAREME_IMPOT_2019[i]\n        seuil_actuel = tranche['seuil']\n        taux = tranche['taux']\n        if quotient_familial &gt; seuil_actuel:\n            base_imposable_tranche = 0\n            if i &lt; len(BAREME_IMPOT_2019) - 1:\n                seuil_suivant = BAREME_IMPOT_2019[i + 1]['seuil']\n                base_imposable_tranche = min(quotient_familial, seuil_suivant) - seuil_actuel\n            else:\n                base_imposable_tranche = quotient_familial - seuil_actuel\n            impot_par_part += base_imposable_tranche * taux\n    return impot_par_part * nombre_parts\n\n\ndef appliquer_plafonnement_qf(revenu_imposable: float, nombre_parts: float, adultes: int,\n                              impot_brut_famille: float) -&gt; float:\n    \"\"\"Applique le plafonnement des effets du quotient familial.\"\"\"\n    if nombre_parts &lt;= adultes: return impot_brut_famille\n    impot_base = calculer_impot_brut_par_tranche(revenu_imposable, float(adultes))\n    demi_parts_enfants = (nombre_parts - adultes) * 2\n    avantage_qf_max = PLAFONNEMENT_AVANTAGE_QF_DEMI_PART * demi_parts_enfants\n    avantage_qf_reel = impot_base - impot_brut_famille\n    if avantage_qf_reel &gt; avantage_qf_max:\n        return impot_base - avantage_qf_max\n    return impot_brut_famille\n\n\ndef calculer_impot_final(adultes: int, enfants: int, revenus: float) -&gt; (int, int, int):\n    \"\"\"Orchestre le calcul complet de l'imp\u00f4t.\"\"\"\n    revenu_imposable = calculer_revenu_imposable(revenus)\n    nombre_parts = calculer_nombre_parts(adultes, enfants)\n    impot_brut = calculer_impot_brut_par_tranche(revenu_imposable, nombre_parts)\n    impot_apres_plafonnement = appliquer_plafonnement_qf(revenu_imposable, nombre_parts, adultes, impot_brut)\n\n    # CORRECTION : Si l'imp\u00f4t est d\u00e9j\u00e0 0, pas de d\u00e9cote ni de r\u00e9duction.\n    if impot_apres_plafonnement == 0:\n        return 0, 0, 0\n\n    # --- LOGIQUE CORRIG\u00c9E POUR L'INTERACTION D\u00c9COTE / R\u00c9DUCTION ---\n    decote_calculee = 0.0\n    reduction_calculee = 0.0\n    impot_a_traiter = impot_apres_plafonnement\n\n    # 1. D\u00e9terminer l'\u00e9ligibilit\u00e9 \u00e0 la r\u00e9duction de 20%\n    est_eligible_reduction = False\n    if adultes &gt;= 2:\n        seuil_rfr = SEUIL_RFR_REDUCTION_COUPLE + max(0, (nombre_parts - 2) * 2) * MAJORATION_RFR_REDUCTION_PAR_DEMI_PART\n    else:\n        seuil_rfr = SEUIL_RFR_REDUCTION_CELIBATAIRE + max(0, (\n                nombre_parts - 1) * 2) * MAJORATION_RFR_REDUCTION_PAR_DEMI_PART\n    if revenu_imposable &lt; seuil_rfr:\n        est_eligible_reduction = True\n\n    # 2. D\u00e9terminer l'\u00e9ligibilit\u00e9 \u00e0 la d\u00e9cote\n    seuil_decote_foyer = SEUIL_DECOTE_COUPLE if adultes &gt;= 2 else SEUIL_DECOTE_CELIBATAIRE\n    reduction_theorique = math.ceil(impot_a_traiter * TAUX_REDUCTION_20_POURCENT) if est_eligible_reduction else 0\n\n    if (impot_a_traiter - reduction_theorique) &lt; seuil_decote_foyer:\n        decote_calculee = seuil_decote_foyer - (impot_a_traiter * COEFFICIENT_DECOTE)\n        decote_calculee = math.ceil(decote_calculee)\n        # CORRECTION : La d\u00e9cote retourn\u00e9e ne peut exc\u00e9der l'imp\u00f4t qu'elle annule\n        decote_calculee = min(decote_calculee, math.ceil(impot_a_traiter))\n        impot_a_traiter -= decote_calculee\n        impot_a_traiter = max(0.0, impot_a_traiter)\n\n    # 3. Appliquer la r\u00e9duction de 20% si \u00e9ligible\n    if est_eligible_reduction:\n        reduction_calculee = math.ceil(impot_a_traiter * TAUX_REDUCTION_20_POURCENT)\n        impot_a_traiter -= reduction_calculee\n        impot_a_traiter = max(0.0, impot_a_traiter)\n\n    impot_final = math.floor(impot_a_traiter)\n\n    return impot_final, int(decote_calculee), int(reduction_calculee)\n\n\n# ==============================================================================\n# TESTS UNITAIRES\n# ==============================================================================\n\nclass TestCalculImpot2019(unittest.TestCase):\n    def _verifier_cas(self, adultes, enfants, revenus, attendu):\n        impot_attendu, decote_attendue, reduction_attendue = attendu\n        impot_calcule, decote_calculee, reduction_calculee = calculer_impot_final(adultes, enfants, revenus)\n        self.assertAlmostEqual(impot_calcule, impot_attendu, delta=1, msg=f\"Imp\u00f4t ({impot_calcule} vs {impot_attendu})\")\n        self.assertAlmostEqual(decote_calculee, decote_attendue, delta=1,\n                               msg=f\"D\u00e9cote ({decote_calculee} vs {decote_attendue})\")\n        self.assertAlmostEqual(reduction_calculee, reduction_attendue, delta=1,\n                               msg=f\"R\u00e9duction ({reduction_calculee} vs {reduction_attendue})\")\n\n    def test_cas_1(self): self._verifier_cas(2, 2, 55555, (2815, 0, 0))\n\n    def test_cas_2(self): self._verifier_cas(2, 2, 50000, (1385, 384, 346))\n\n    def test_cas_3(self): self._verifier_cas(2, 3, 50000, (0, 720, 0))\n\n    def test_cas_4(self): self._verifier_cas(1, 2, 100000, (19884, 0, 0))\n\n    def test_cas_5(self): self._verifier_cas(1, 3, 100000, (16782, 0, 0))\n\n    def test_cas_6(self): self._verifier_cas(2, 3, 100000, (9200, 0, 0))\n\n    def test_cas_7(self): self._verifier_cas(2, 5, 100000, (4230, 0, 0))\n\n    def test_cas_8(self): self._verifier_cas(1, 0, 100000, (22986, 0, 0))\n\n    def test_cas_9(self): self._verifier_cas(2, 2, 30000, (0, 0, 0))\n\n    def test_cas_10(self): self._verifier_cas(1, 0, 200000, (64211, 0, 0))\n\n    def test_cas_11(self): self._verifier_cas(2, 3, 200000, (42843, 0, 0))\n\n\nif __name__ == '__main__':\n    print(\"Lancement des tests unitaires pour le calcul de l'imp\u00f4t 2019...\")\n    unittest.main(argv=['first-arg-is-ignored'], exit=False)\n</code></pre> <p>De nouveau je n\u2019ai pas inspect\u00e9 ce code. J\u2019ai simplement constat\u00e9 qu\u2019il passait les 11 tests avec succ\u00e8s.</p> <p>Mais on peut \u00eatre curieux de conna\u00eetre son raisonnement, notamment pour les cas particuliers du calcul de l\u2019imp\u00f4t. On le lui demande\u00a0:</p> <p>C\u2019est un cas de hauts revenus avec \u00e0 la fois un plafonnement possible de l\u2019abattement de 10% et un plafonnement possible du quotient familial.</p> <p>La r\u00e9ponse de Gemini est la suivante\u00a0:</p> <p>Ces deux derni\u00e8res copies d\u2019\u00e9cran sont int\u00e9ressantes. Gemini utilise une m\u00e9thode de calcul diff\u00e9rente de celle expliqu\u00e9e dans le PDF. On trouve effectivement cette m\u00e9thode de calcul sur internet. Les deux m\u00e9thodes sont \u00e9quivalentes.</p> <p>L\u2019explication est remarquable par sa clart\u00e9. On pourrait la donner telle-quelle \u00e0 des \u00e9tudiants pour expliquer la m\u00e9thode de calcul de l\u2019imp\u00f4t.</p> <p>Maintenant prenons un autre exemple cette fois-ci avec des faibles revenus. Dans ce cas, il peut y avoir d\u00e9cote et r\u00e9duction\u00a0:</p> <p>La r\u00e9ponse de Gemini est la suivante\u00a0:</p> <p>Ici, on constate que Gemini applique une r\u00e8gle qui n\u2019est pas dans le PDF. Il l\u2019a probablement trouv\u00e9e sur internet, mais la source est-elle fiable\u00a0?</p> <p>Ici, Gemini continue d\u2019appliquer une r\u00e8gle inconnue (la r\u00e8gle sp\u00e9ciale ci-dessus).</p> <p>Donc les r\u00e9sultats de Gemini collent avec le r\u00e9sultat du simulateur officiel des imp\u00f4ts. Mais il a utilis\u00e9 une r\u00e8gle non pr\u00e9sente dans le PDF. O\u00f9 est l\u2019erreur\u00a0? On le lui demande en lui joignant le PDF\u00a0:</p> <p>La r\u00e9ponse de Gemini\u00a0:</p> <p>Je pense que Gemini a raison et que mon PDF est erron\u00e9. Pour le v\u00e9rifier, je lui demande un test\u00a0:</p> <ul> <li>O\u00f9 son raisonnement donnerait les m\u00eames r\u00e9sultats que le simulateur d\u2019imp\u00f4t officiel\u00a0;</li> <li>O\u00f9 le raisonnement du PDF donnerait lui des r\u00e9sultats diff\u00e9rents de ceux du simulateur\u00a0;</li> </ul> <p>La r\u00e9ponse de Gemini est la suivante\u00a0:</p> <p>Ici Gemini se trompe. J\u2019ai lanc\u00e9 le simulateur sur cet exemple et j\u2019ai trouv\u00e9 la chose suivante\u00a0:</p> <p>Cependant, on va d\u00e9couvrir que le raisonnement de Gemini donne bien les r\u00e9sultats ci-dessus. On continue\u00a0:</p> <p>Tr\u00e8s bien. C\u2019est not\u00e9. On continue\u00a0:</p> <p>Donc Gemini a trouv\u00e9 (imp\u00f4t, d\u00e9cote, r\u00e9duction)= (431, 325, 1296) alors que le simulateur utilis\u00e9 par mes soins donne (431, 324, 1297). Donc Gemini a trouv\u00e9 les bons r\u00e9sultats \u00e0 1 euro pr\u00e8s mais il ne le sait pas. On le lui dit\u00a0:</p> <p>Gemini r\u00e9pond\u00a0:</p> <p>Maintenant, on se demande si Gemini pourrait g\u00e9n\u00e9rer un PDF corrig\u00e9\u00a0:</p> <p>La r\u00e9ponse de Gemini\u00a0:</p> <p>Gemini ne m\u2019a donc pas donn\u00e9 de lien vers un PDF, mais il a g\u00e9n\u00e9r\u00e9 un texte pour g\u00e9n\u00e9rer moi-m\u00eame ce PDF. Bien que ce soit encombrant de donner ici, les copies d\u2019\u00e9cran du PDF, je le fais pour que le lecteur voie le c\u00f4t\u00e9 g\u00e9n\u00e9ratif de l\u2019IA\u00a0:</p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p>Honn\u00eatement je n\u2019ai pas v\u00e9rifi\u00e9 si tout ce qui est dit dans ce PDF est vrai. En tout cas, c\u2019est un document parfait pour un TD, g\u00e9n\u00e9r\u00e9 en quelques secondes.</p> <p>N\u00e9anmoins, on peut faire v\u00e9rifier par Gemini lui-m\u00eame que son PDF est bon. On d\u00e9marre une nouvelle conversation\u00a0:</p> <ul> <li>en [1], on a mis le PDF g\u00e9n\u00e9r\u00e9 par Gemini [Le probl\u00e8me selon Gemini.pdf]\u00a0;</li> <li>en [2], [instructionsAvecPDF2.txt] est identique aux instructions de [instructionsAvecPDF.txt], si ce n\u2019est qu\u2019on a ajout\u00e9 un douzi\u00e8me test unitaire, celui-l\u00e0 m\u00eame qui a montr\u00e9 que le PDF initial \u00e9tait erron\u00e9\u00a0: <pre><code>test12 : (2, 2, 49500) -&gt; (1297, 431, 324)\n</code></pre></li> </ul> <p>Curieusement il a fallu plusieurs allers-retours avant que Gemini g\u00e9n\u00e8re le bon script\u00a0:</p> <p>Question 2</p> <p>Question 3</p> <p>Comme il a \u00e9t\u00e9 fait maintenant plusieurs fois, lorsque le script g\u00e9n\u00e9r\u00e9 et charg\u00e9 dans PyCharm \u00e9choue, on donne \u00e0 Gemini le fichier texte des logs de l\u2019ex\u00e9cution. Gemini les comprend tr\u00e8s bien.</p> <p>Question 4</p> <p>Question 5</p> <p>Question 6 et fin</p> <p>Maintenant nous sommes rassur\u00e9s sur la validit\u00e9 du PDF g\u00e9n\u00e9r\u00e9 par Gemini. Les r\u00e8gles de calcul qui y sont donn\u00e9es sont correctes.</p> <p>Nous allons maintenant faire la m\u00eame chose pour les cinq autres IA mais nous serons tr\u00e8s brefs dans nos explications, sauf pour ChatGPT l\u2019IA leader du moment. Ce qui nous int\u00e9resse c\u2019est de savoir si l\u2019IA r\u00e9soud ou non les trois probl\u00e8mes qu\u2019on lui pose. En effet, les interfaces de toutes ces IA sont tr\u00e8s analogues et j\u2019ai proc\u00e9d\u00e9 avec elles comme avec Gemini. Le lecteur est encourag\u00e9 \u00e0 rejouer les conversations Gemini avec l\u2019IA de son choix.</p>"},{"location":"resolution-des-trois-problemes-avec-grok.html","title":"6. R\u00e9solution des trois probl\u00e8mes avec Grok","text":""},{"location":"resolution-des-trois-problemes-avec-grok.html#61-introduction","title":"6.1. Introduction","text":"<ul> <li>En [1], l\u2019URL de l\u2019IA Grok propri\u00e9t\u00e9 de l\u2019entreprise xAI [https://x.ai/company]\u00a0;</li> <li>En [2], l\u2019historique de vos conversations. Pour l\u2019avoir, il faut vous cr\u00e9er un compte\u00a0;</li> <li>En [3], posez votre question\u00a0;</li> <li>En [4], vous pouvez joindre des fichiers\u00a0;</li> <li>En [5], vous lancez l\u2019ex\u00e9cution de l\u2019IA\u00a0; Contrairement \u00e0 Gemini et ChatGPT, je n\u2019ai pas rencontr\u00e9 de limites de questions, de temps ou de nombre de fichiers joints. Cela ne veut pas dire que ces limites n\u2019existent pas.</li> </ul>"},{"location":"resolution-des-trois-problemes-avec-grok.html#62-le-probleme-1","title":"6.2. Le probl\u00e8me 1","text":"<p>Grok r\u00e9pond correctement \u00e0 cette question.</p>"},{"location":"resolution-des-trois-problemes-avec-grok.html#63-le-probleme-2","title":"6.3. Le probl\u00e8me 2","text":"<p>On propose \u00e0 Grok de r\u00e9soudre le calcul de l\u2019imp\u00f4t \u00e0 l\u2019aide du PDF g\u00e9n\u00e9r\u00e9 par ChatGPT et on lui donne nos instructions dans un fichier texte.</p> <p>Le fichier texte est celui d\u00e9j\u00e0 utilis\u00e9 avec les deux IA test\u00e9es, mais on y a mis les 25 tests valid\u00e9s par ChatGPT et Gemini. Le PDF utilis\u00e9 est celui g\u00e9n\u00e9r\u00e9 par ChatGPT\u00a0:</p> <p>Grok fournit alors un script tr\u00e8s propre mais port\u00e9 dans PyCharm, pratiquement aucun test ne passe. Je lui fournis alors les logs de ses erreurs\u00a0:</p> <p>Cette fois-ci, Grok r\u00e9ussit les 25 tests. En [1-3], on montre le script [grok1] g\u00e9n\u00e9r\u00e9 ainsi que les deux fichiers joints \u00e0 la question.</p>"},{"location":"resolution-des-trois-problemes-avec-grok.html#64-le-probleme-3","title":"6.4. Le probl\u00e8me 3","text":"<p>Cette fois-ci, on ne donne pas de PDF pour les r\u00e8gles de calcul. Grok devra les trouver sur internet. Les instructions texte [instructionsSansPDF5.txt] lui donnent les m\u00eames 25 tests que pr\u00e9c\u00e9demment \u00e0 v\u00e9rifier.</p> <p>Grok r\u00e9ussit presque du premier coup. Il g\u00e9n\u00e8re un script qui r\u00e9ussit 24 tests sur 25. On lui donne ses logs.</p> <p>Au deuxi\u00e8me coup \u00e7a marche. En [1], le script g\u00e9n\u00e9r\u00e9 par Grok, en [2] les instructions \u00e0 suivre.</p> <p>On lui demande maintenant de g\u00e9n\u00e9rer un PDF qui explique les r\u00e8gles de calcul qu\u2019il a utilis\u00e9es pour r\u00e9ussir les 25 tests\u00a0:</p> <p>Grok ne g\u00e9n\u00e8re alors pas un PDF mais un fichier [MarkDown]. J\u2019ai utilis\u00e9 un outil gratuit pour le transformer en PDF. Par ailleurs, PyCharm sait lire les fichiers [MarkDown]\u00a0:</p>"},{"location":"resolution-des-trois-problemes-avec-grok.html#65-le-probleme-4","title":"6.5. Le probl\u00e8me 4","text":"<p>Pour valider le PDF g\u00e9n\u00e9r\u00e9 pr\u00e9c\u00e9demment, on le donne \u00e0 Grok.</p> <p>Sa premi\u00e8re mouture est correcte. Le script passe les 25 tests. En fait les IA ne semblent pas d\u00e9terministes. On peut leur poser deux fois la m\u00eame question et voir leurs r\u00e9ponses diverger. Cela a \u00e9t\u00e9 le cas ici avec Grok. La premi\u00e8re fois, j\u2019avais omis qu\u2019il ne devait pas aller sur internet et utiliser uniquement son PDF. Il a alors produit un script erron\u00e9. Je lui ai donn\u00e9 ses logs et l\u00e0 j\u2019ai vu qu\u2019il allait sur internet v\u00e9rifier des choses. Dans la question ci-dessus, j\u2019ai demand\u00e9 \u00e0 ce qu\u2019il ne le fasse pas. Du coup, globalement Grok a \u00e9t\u00e9 performant.</p>"},{"location":"resolution-des-trois-problemes-avec-mistralai.html","title":"8. R\u00e9solution des trois probl\u00e8mes avec MistralAI","text":""},{"location":"resolution-des-trois-problemes-avec-mistralai.html#81-introduction","title":"8.1. Introduction","text":"<ul> <li>En [1], l\u2019URL de l\u2019IA MistralAI [https://chat.mistral.ai/chat] produit de l\u2019entreprise Mistral AI [https://mistral.ai/]\u00a0;</li> <li>En [2], l\u2019historique de vos questions. Les sessions gratuites de MistralAI sont tr\u00e8s limit\u00e9es en nombre de questions, nombre de fichiers joints, temps pass\u00e9. J\u2019ai d\u00fb prendre un abonnement payant d\u2019un mois pour faire les tests sui suivent\u00a0;</li> <li>En [3], votre question\u00a0;</li> <li>En [4], pour joindre des fichiers \u00e0 votre question\u00a0;</li> <li>En [5], pour ex\u00e9cuter votre question\u00a0;</li> </ul>"},{"location":"resolution-des-trois-problemes-avec-mistralai.html#82-le-probleme-1","title":"8.2. Le probl\u00e8me 1","text":"<p>La question\u00a0:</p> <p>MistralAI r\u00e9pond correctement \u00e0 la question.</p>"},{"location":"resolution-des-trois-problemes-avec-mistralai.html#83-le-probleme-2","title":"8.3. Le probl\u00e8me 2","text":"<p>La question\u00a0:</p> <p>On propose \u00e0 MistralAI de r\u00e9soudre le probl\u00e8me de calcul de l\u2019imp\u00f4t 2019 avec les r\u00e8gles de calcul g\u00e9n\u00e9r\u00e9es par ChatGPT dans le PDF. Le fichier texte donne mes instructions avec les 25 tests \u00e0 r\u00e9aliser.</p> <p>En fait, je n\u2019arriverai \u00e0 rien avec MistralAI. Le probl\u00e8me principal est qu\u2019il ne lit pas (ou ne veut pas lire) les instructions du fichier texte [instructionsAvecPDF4.txt]. Il g\u00e9n\u00e8re un code qui ne respecte pas mes exigences et ne g\u00e9n\u00e8re pas non plus les 25 tests unitaires demand\u00e9s.</p>"},{"location":"resolution-des-trois-problemes-avec-perplexity.html","title":"10. R\u00e9solution des trois probl\u00e8mes avec Perplexity","text":""},{"location":"resolution-des-trois-problemes-avec-perplexity.html#101-introduction","title":"10.1. Introduction","text":"<p>Voici une copie d\u2019\u00e9cran de la page d\u2019accueil de l\u2019IA Perplexity\u00a0:</p> <ul> <li>En [1], l\u2019URL de Perplexity\u00a0;</li> <li>En [2], l\u2019ic\u00f4ne pour commencer une nouvelle conversation avec l\u2019IA\u00a0;</li> <li>En [3], on a utilis\u00e9 la version Pro avec un abonnement payant d\u2019un mois. Avec la version gratuite, on ne peut pas attacher des fichiers \u00e0 la question pos\u00e9e. Perplexity indique tout de suite qu\u2019il faut passer \u00e0 la version Pro\u00a0;</li> <li>En [4], l\u2019ic\u00f4ne pour attacher des fichiers \u00e0 la question pos\u00e9e\u00a0;</li> <li>En [5], votre question\u00a0;</li> </ul>"},{"location":"resolution-des-trois-problemes-avec-perplexity.html#102-le-probleme-1","title":"10.2. Le probl\u00e8me 1","text":"<ul> <li>En [1], l\u2019ic\u00f4ne pour lancer la conversation avec l\u2019IA\u00a0; La r\u00e9ponse est correcte et compl\u00e8te.</li> </ul>"},{"location":"resolution-des-trois-problemes-avec-perplexity.html#103-le-probleme-2","title":"10.3. Le probl\u00e8me 2","text":"<ul> <li>En [1], on fournit le PDF g\u00e9n\u00e9r\u00e9 par ChatGPT qui explique le mode de calcul de l\u2019imp\u00f4t\u00a0;</li> <li>En [2], on fournit des instructions compl\u00e9mentaires pour la g\u00e9n\u00e9ration du script Python. Ce fichier texte demande la v\u00e9rification de 25 tests unitaires alors que le PDF n\u2019en propose que 12\u00a0;</li> <li>En [3], on lance la conversation\u00a0; Perplexity ne r\u00e9ussira jamais \u00e0 r\u00e9soudre le probl\u00e8me. Il a des r\u00e9ponses tr\u00e8s bizarres. Ainsi il peut proposer un script Python en indiquant qu\u2019il ne passe pas tous les tests. Quel est l\u2019int\u00e9r\u00eat de cette r\u00e9ponse alors qu\u2019on lui demande un script qui passe les 25 tests\u00a0? Par ailleurs, il a indiqu\u00e9 \u00e0 de multiples reprises que le script Python qu\u2019il avait g\u00e9n\u00e9r\u00e9 passait les 25 tests, alors que c\u2019\u00e9tait faux. Test\u00e9 sous Pycharm, le script g\u00e9n\u00e9r\u00e9 \u00e9chouait, la plupart du temps, aux 25 tests. Les r\u00e9ponses de l\u2019IA ont toujours \u00e9t\u00e9 rapides et toujours fausses. Cette IA s\u2019est r\u00e9v\u00e9l\u00e9e tr\u00e8s d\u00e9cevante et trompeuse.</li> </ul> <p>Du coup, il m\u2019a sembl\u00e9 inutile de lui proposer la r\u00e9solution du probl\u00e8me 3.</p>"}]}